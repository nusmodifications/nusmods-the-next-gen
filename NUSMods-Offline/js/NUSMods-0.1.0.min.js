/*!
 * jQuery JavaScript Library v1.7.2
 * http://jquery.com/
 *
 * Copyright 2011, John Resig
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 * Copyright 2011, The Dojo Foundation
 * Released under the MIT, BSD, and GPL Licenses.
 *
 * Date: Wed Mar 21 12:46:34 2012 -0700
 */(function(e,t){function u(e){var t=o[e]={},n,r;e=e.split(/\s+/);for(n=0,r=e.length;n<r;n++)t[e[n]]=!0;return t}function c(e,n,r){if(r===t&&e.nodeType===1){var i="data-"+n.replace(l,"-$1").toLowerCase();r=e.getAttribute(i);if(typeof r=="string"){try{r=r==="true"?!0:r==="false"?!1:r==="null"?null:s.isNumeric(r)?+r:f.test(r)?s.parseJSON(r):r}catch(o){}s.data(e,n,r)}else r=t}return r}function h(e){for(var t in e){if(t==="data"&&s.isEmptyObject(e[t]))continue;if(t!=="toJSON")return!1}return!0}function p(e,t,n){var r=t+"defer",i=t+"queue",o=t+"mark",u=s._data(e,r);u&&(n==="queue"||!s._data(e,i))&&(n==="mark"||!s._data(e,o))&&setTimeout(function(){if(!s._data(e,i)&&!s._data(e,o)){s.removeData(e,r,!0);u.fire()}},0)}function H(){return!1}function B(){return!0}function W(e){return!e||!e.parentNode||e.parentNode.nodeType===11}function X(e,t,n){t=t||0;if(s.isFunction(t))return s.grep(e,function(e,r){var i=!!t.call(e,r,e);return i===n});if(t.nodeType)return s.grep(e,function(e,r){return e===t===n});if(typeof t=="string"){var r=s.grep(e,function(e){return e.nodeType===1});if(q.test(t))return s.filter(t,r,!n);t=s.filter(t,r)}return s.grep(e,function(e,r){return s.inArray(e,t)>=0===n})}function V(e){var t=$.split("|"),n=e.createDocumentFragment();if(n.createElement)while(t.length)n.createElement(t.pop());return n}function at(e,t){return s.nodeName(e,"table")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function ft(e,t){if(t.nodeType!==1||!s.hasData(e))return;var n,r,i,o=s._data(e),u=s._data(t,o),a=o.events;if(a){delete u.handle;u.events={};for(n in a)for(r=0,i=a[n].length;r<i;r++)s.event.add(t,n,a[n][r])}u.data&&(u.data=s.extend({},u.data))}function lt(e,t){var n;if(t.nodeType!==1)return;t.clearAttributes&&t.clearAttributes();t.mergeAttributes&&t.mergeAttributes(e);n=t.nodeName.toLowerCase();if(n==="object")t.outerHTML=e.outerHTML;else if(n!=="input"||e.type!=="checkbox"&&e.type!=="radio")n==="option"?t.selected=e.defaultSelected:n==="input"||n==="textarea"?t.defaultValue=e.defaultValue:n==="script"&&t.text!==e.text&&(t.text=e.text);else{e.checked&&(t.defaultChecked=t.checked=e.checked);t.value!==e.value&&(t.value=e.value)}t.removeAttribute(s.expando);t.removeAttribute("_submit_attached");t.removeAttribute("_change_attached")}function ct(e){return typeof e.getElementsByTagName!="undefined"?e.getElementsByTagName("*"):typeof e.querySelectorAll!="undefined"?e.querySelectorAll("*"):[]}function ht(e){if(e.type==="checkbox"||e.type==="radio")e.defaultChecked=e.checked}function pt(e){var t=(e.nodeName||"").toLowerCase();t==="input"?ht(e):t!=="script"&&typeof e.getElementsByTagName!="undefined"&&s.grep(e.getElementsByTagName("input"),ht)}function dt(e){var t=n.createElement("div");ut.appendChild(t);t.innerHTML=e.outerHTML;return t.firstChild}function kt(e,t,n){var r=t==="width"?e.offsetWidth:e.offsetHeight,i=t==="width"?1:0,o=4;if(r>0){if(n!=="border")for(;i<o;i+=2){n||(r-=parseFloat(s.css(e,"padding"+xt[i]))||0);n==="margin"?r+=parseFloat(s.css(e,n+xt[i]))||0:r-=parseFloat(s.css(e,"border"+xt[i]+"Width"))||0}return r+"px"}r=Tt(e,t);if(r<0||r==null)r=e.style[t];if(bt.test(r))return r;r=parseFloat(r)||0;if(n)for(;i<o;i+=2){r+=parseFloat(s.css(e,"padding"+xt[i]))||0;n!=="padding"&&(r+=parseFloat(s.css(e,"border"+xt[i]+"Width"))||0);n==="margin"&&(r+=parseFloat(s.css(e,n+xt[i]))||0)}return r+"px"}function Qt(e){return function(t,n){if(typeof t!="string"){n=t;t="*"}if(s.isFunction(n)){var r=t.toLowerCase().split(qt),i=0,o=r.length,u,a,f;for(;i<o;i++){u=r[i];f=/^\+/.test(u);f&&(u=u.substr(1)||"*");a=e[u]=e[u]||[];a[f?"unshift":"push"](n)}}}}function Gt(e,n,r,i,s,o){s=s||n.dataTypes[0];o=o||{};o[s]=!0;var u=e[s],a=0,f=u?u.length:0,l=e===Wt,c;for(;a<f&&(l||!c);a++){c=u[a](n,r,i);if(typeof c=="string")if(!l||o[c])c=t;else{n.dataTypes.unshift(c);c=Gt(e,n,r,i,c,o)}}(l||!c)&&!o["*"]&&(c=Gt(e,n,r,i,"*",o));return c}function Yt(e,n){var r,i,o=s.ajaxSettings.flatOptions||{};for(r in n)n[r]!==t&&((o[r]?e:i||(i={}))[r]=n[r]);i&&s.extend(!0,e,i)}function Zt(e,t,n,r){if(s.isArray(t))s.each(t,function(t,i){n||At.test(e)?r(e,i):Zt(e+"["+(typeof i=="object"?t:"")+"]",i,n,r)});else if(!n&&s.type(t)==="object")for(var i in t)Zt(e+"["+i+"]",t[i],n,r);else r(e,t)}function en(e,n,r){var i=e.contents,s=e.dataTypes,o=e.responseFields,u,a,f,l;for(a in o)a in r&&(n[o[a]]=r[a]);while(s[0]==="*"){s.shift();u===t&&(u=e.mimeType||n.getResponseHeader("content-type"))}if(u)for(a in i)if(i[a]&&i[a].test(u)){s.unshift(a);break}if(s[0]in r)f=s[0];else{for(a in r){if(!s[0]||e.converters[a+" "+s[0]]){f=a;break}l||(l=a)}f=f||l}if(f){f!==s[0]&&s.unshift(f);return r[f]}}function tn(e,n){e.dataFilter&&(n=e.dataFilter(n,e.dataType));var r=e.dataTypes,i={},o,u,a=r.length,f,l=r[0],c,h,p,d,v;for(o=1;o<a;o++){if(o===1)for(u in e.converters)typeof u=="string"&&(i[u.toLowerCase()]=e.converters[u]);c=l;l=r[o];if(l==="*")l=c;else if(c!=="*"&&c!==l){h=c+" "+l;p=i[h]||i["* "+l];if(!p){v=t;for(d in i){f=d.split(" ");if(f[0]===c||f[0]==="*"){v=i[f[1]+" "+l];if(v){d=i[d];d===!0?p=v:v===!0&&(p=d);break}}}}!p&&!v&&s.error("No conversion from "+h.replace(" "," to "));p!==!0&&(n=p?p(n):v(d(n)))}}return n}function an(){try{return new e.XMLHttpRequest}catch(t){}}function fn(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function yn(){setTimeout(bn,0);return gn=s.now()}function bn(){gn=t}function wn(e,t){var n={};s.each(mn.concat.apply([],mn.slice(0,t)),function(){n[this]=e});return n}function En(e){if(!ln[e]){var t=n.body,r=s("<"+e+">").appendTo(t),i=r.css("display");r.remove();if(i==="none"||i===""){if(!cn){cn=n.createElement("iframe");cn.frameBorder=cn.width=cn.height=0}t.appendChild(cn);if(!hn||!cn.createElement){hn=(cn.contentWindow||cn.contentDocument).document;hn.write((s.support.boxModel?"<!doctype html>":"")+"<html><body>");hn.close()}r=hn.createElement(e);hn.body.appendChild(r);i=s.css(r,"display");t.removeChild(cn)}ln[e]=i}return ln[e]}function Nn(e){return s.isWindow(e)?e:e.nodeType===9?e.defaultView||e.parentWindow:!1}var n=e.document,r=e.navigator,i=e.location,s=function(){function H(){if(i.isReady)return;try{n.documentElement.doScroll("left")}catch(e){setTimeout(H,1);return}i.ready()}var i=function(e,t){return new i.fn.init(e,t,u)},s=e.jQuery,o=e.$,u,a=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,f=/\S/,l=/^\s+/,c=/\s+$/,h=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,p=/^[\],:{}\s]*$/,d=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,v=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,m=/(?:^|:|,)(?:\s*\[)+/g,g=/(webkit)[ \/]([\w.]+)/,y=/(opera)(?:.*version)?[ \/]([\w.]+)/,b=/(msie) ([\w.]+)/,w=/(mozilla)(?:.*? rv:([\w.]+))?/,E=/-([a-z]|[0-9])/ig,S=/^-ms-/,x=function(e,t){return(t+"").toUpperCase()},T=r.userAgent,N,C,k,L=Object.prototype.toString,A=Object.prototype.hasOwnProperty,O=Array.prototype.push,M=Array.prototype.slice,_=String.prototype.trim,D=Array.prototype.indexOf,P={};i.fn=i.prototype={constructor:i,init:function(e,r,s){var o,u,f,l;if(!e)return this;if(e.nodeType){this.context=this[0]=e;this.length=1;return this}if(e==="body"&&!r&&n.body){this.context=n;this[0]=n.body;this.selector=e;this.length=1;return this}if(typeof e=="string"){e.charAt(0)==="<"&&e.charAt(e.length-1)===">"&&e.length>=3?o=[null,e,null]:o=a.exec(e);if(o&&(o[1]||!r)){if(o[1]){r=r instanceof i?r[0]:r;l=r?r.ownerDocument||r:n;f=h.exec(e);if(f)if(i.isPlainObject(r)){e=[n.createElement(f[1])];i.fn.attr.call(e,r,!0)}else e=[l.createElement(f[1])];else{f=i.buildFragment([o[1]],[l]);e=(f.cacheable?i.clone(f.fragment):f.fragment).childNodes}return i.merge(this,e)}u=n.getElementById(o[2]);if(u&&u.parentNode){if(u.id!==o[2])return s.find(e);this.length=1;this[0]=u}this.context=n;this.selector=e;return this}return!r||r.jquery?(r||s).find(e):this.constructor(r).find(e)}if(i.isFunction(e))return s.ready(e);if(e.selector!==t){this.selector=e.selector;this.context=e.context}return i.makeArray(e,this)},selector:"",jquery:"1.7.2",length:0,size:function(){return this.length},toArray:function(){return M.call(this,0)},get:function(e){return e==null?this.toArray():e<0?this[this.length+e]:this[e]},pushStack:function(e,t,n){var r=this.constructor();i.isArray(e)?O.apply(r,e):i.merge(r,e);r.prevObject=this;r.context=this.context;t==="find"?r.selector=this.selector+(this.selector?" ":"")+n:t&&(r.selector=this.selector+"."+t+"("+n+")");return r},each:function(e,t){return i.each(this,e,t)},ready:function(e){i.bindReady();C.add(e);return this},eq:function(e){e=+e;return e===-1?this.slice(e):this.slice(e,e+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(M.apply(this,arguments),"slice",M.call(arguments).join(","))},map:function(e){return this.pushStack(i.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:O,sort:[].sort,splice:[].splice};i.fn.init.prototype=i.fn;i.extend=i.fn.extend=function(){var e,n,r,s,o,u,a=arguments[0]||{},f=1,l=arguments.length,c=!1;if(typeof a=="boolean"){c=a;a=arguments[1]||{};f=2}typeof a!="object"&&!i.isFunction(a)&&(a={});if(l===f){a=this;--f}for(;f<l;f++)if((e=arguments[f])!=null)for(n in e){r=a[n];s=e[n];if(a===s)continue;if(c&&s&&(i.isPlainObject(s)||(o=i.isArray(s)))){if(o){o=!1;u=r&&i.isArray(r)?r:[]}else u=r&&i.isPlainObject(r)?r:{};a[n]=i.extend(c,u,s)}else s!==t&&(a[n]=s)}return a};i.extend({noConflict:function(t){e.$===i&&(e.$=o);t&&e.jQuery===i&&(e.jQuery=s);return i},isReady:!1,readyWait:1,holdReady:function(e){e?i.readyWait++:i.ready(!0)},ready:function(e){if(e===!0&&!--i.readyWait||e!==!0&&!i.isReady){if(!n.body)return setTimeout(i.ready,1);i.isReady=!0;if(e!==!0&&--i.readyWait>0)return;C.fireWith(n,[i]);i.fn.trigger&&i(n).trigger("ready").off("ready")}},bindReady:function(){if(C)return;C=i.Callbacks("once memory");if(n.readyState==="complete")return setTimeout(i.ready,1);if(n.addEventListener){n.addEventListener("DOMContentLoaded",k,!1);e.addEventListener("load",i.ready,!1)}else if(n.attachEvent){n.attachEvent("onreadystatechange",k);e.attachEvent("onload",i.ready);var t=!1;try{t=e.frameElement==null}catch(r){}n.documentElement.doScroll&&t&&H()}},isFunction:function(e){return i.type(e)==="function"},isArray:Array.isArray||function(e){return i.type(e)==="array"},isWindow:function(e){return e!=null&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return e==null?String(e):P[L.call(e)]||"object"},isPlainObject:function(e){if(!e||i.type(e)!=="object"||e.nodeType||i.isWindow(e))return!1;try{if(e.constructor&&!A.call(e,"constructor")&&!A.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}var r;for(r in e);return r===t||A.call(e,r)},isEmptyObject:function(e){for(var t in e)return!1;return!0},error:function(e){throw new Error(e)},parseJSON:function(t){if(typeof t!="string"||!t)return null;t=i.trim(t);if(e.JSON&&e.JSON.parse)return e.JSON.parse(t);if(p.test(t.replace(d,"@").replace(v,"]").replace(m,"")))return(new Function("return "+t))();i.error("Invalid JSON: "+t)},parseXML:function(n){if(typeof n!="string"||!n)return null;var r,s;try{if(e.DOMParser){s=new DOMParser;r=s.parseFromString(n,"text/xml")}else{r=new ActiveXObject("Microsoft.XMLDOM");r.async="false";r.loadXML(n)}}catch(o){r=t}(!r||!r.documentElement||r.getElementsByTagName("parsererror").length)&&i.error("Invalid XML: "+n);return r},noop:function(){},globalEval:function(t){t&&f.test(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(S,"ms-").replace(E,x)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toUpperCase()===t.toUpperCase()},each:function(e,n,r){var s,o=0,u=e.length,a=u===t||i.isFunction(e);if(r){if(a){for(s in e)if(n.apply(e[s],r)===!1)break}else for(;o<u;)if(n.apply(e[o++],r)===!1)break}else if(a){for(s in e)if(n.call(e[s],s,e[s])===!1)break}else for(;o<u;)if(n.call(e[o],o,e[o++])===!1)break;return e},trim:_?function(e){return e==null?"":_.call(e)}:function(e){return e==null?"":e.toString().replace(l,"").replace(c,"")},makeArray:function(e,t){var n=t||[];if(e!=null){var r=i.type(e);e.length==null||r==="string"||r==="function"||r==="regexp"||i.isWindow(e)?O.call(n,e):i.merge(n,e)}return n},inArray:function(e,t,n){var r;if(t){if(D)return D.call(t,e,n);r=t.length;n=n?n<0?Math.max(0,r+n):n:0;for(;n<r;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,n){var r=e.length,i=0;if(typeof n.length=="number")for(var s=n.length;i<s;i++)e[r++]=n[i];else while(n[i]!==t)e[r++]=n[i++];e.length=r;return e},grep:function(e,t,n){var r=[],i;n=!!n;for(var s=0,o=e.length;s<o;s++){i=!!t(e[s],s);n!==i&&r.push(e[s])}return r},map:function(e,n,r){var s,o,u=[],a=0,f=e.length,l=e instanceof i||f!==t&&typeof f=="number"&&(f>0&&e[0]&&e[f-1]||f===0||i.isArray(e));if(l)for(;a<f;a++){s=n(e[a],a,r);s!=null&&(u[u.length]=s)}else for(o in e){s=n(e[o],o,r);s!=null&&(u[u.length]=s)}return u.concat.apply([],u)},guid:1,proxy:function(e,n){if(typeof n=="string"){var r=e[n];n=e;e=r}if(!i.isFunction(e))return t;var s=M.call(arguments,2),o=function(){return e.apply(n,s.concat(M.call(arguments)))};o.guid=e.guid=e.guid||o.guid||i.guid++;return o},access:function(e,n,r,s,o,u,a){var f,l=r==null,c=0,h=e.length;if(r&&typeof r=="object"){for(c in r)i.access(e,n,c,r[c],1,u,s);o=1}else if(s!==t){f=a===t&&i.isFunction(s);if(l)if(f){f=n;n=function(e,t,n){return f.call(i(e),n)}}else{n.call(e,s);n=null}if(n)for(;c<h;c++)n(e[c],r,f?s.call(e[c],c,n(e[c],r)):s,a);o=1}return o?e:l?n.call(e):h?n(e[0],r):u},now:function(){return(new Date).getTime()},uaMatch:function(e){e=e.toLowerCase();var t=g.exec(e)||y.exec(e)||b.exec(e)||e.indexOf("compatible")<0&&w.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},sub:function(){function e(t,n){return new e.fn.init(t,n)}i.extend(!0,e,this);e.superclass=this;e.fn=e.prototype=this();e.fn.constructor=e;e.sub=this.sub;e.fn.init=function(r,s){s&&s instanceof i&&!(s instanceof e)&&(s=e(s));return i.fn.init.call(this,r,s,t)};e.fn.init.prototype=e.fn;var t=e(n);return e},browser:{}});i.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(e,t){P["[object "+t+"]"]=t.toLowerCase()});N=i.uaMatch(T);if(N.browser){i.browser[N.browser]=!0;i.browser.version=N.version}i.browser.webkit&&(i.browser.safari=!0);if(f.test("Â ")){l=/^[\s\xA0]+/;c=/[\s\xA0]+$/}u=i(n);n.addEventListener?k=function(){n.removeEventListener("DOMContentLoaded",k,!1);i.ready()}:n.attachEvent&&(k=function(){if(n.readyState==="complete"){n.detachEvent("onreadystatechange",k);i.ready()}});return i}(),o={};s.Callbacks=function(e){e=e?o[e]||u(e):{};var n=[],r=[],i,a,f,l,c,h,p=function(t){var r,i,o,u,a;for(r=0,i=t.length;r<i;r++){o=t[r];u=s.type(o);u==="array"?p(o):u==="function"&&(!e.unique||!v.has(o))&&n.push(o)}},d=function(t,s){s=s||[];i=!e.memory||[t,s];a=!0;f=!0;h=l||0;l=0;c=n.length;for(;n&&h<c;h++)if(n[h].apply(t,s)===!1&&e.stopOnFalse){i=!0;break}f=!1;if(n)if(!e.once){if(r&&r.length){i=r.shift();v.fireWith(i[0],i[1])}}else i===!0?v.disable():n=[]},v={add:function(){if(n){var e=n.length;p(arguments);if(f)c=n.length;else if(i&&i!==!0){l=e;d(i[0],i[1])}}return this},remove:function(){if(n){var t=arguments,r=0,i=t.length;for(;r<i;r++)for(var s=0;s<n.length;s++)if(t[r]===n[s]){if(f&&s<=c){c--;s<=h&&h--}n.splice(s--,1);if(e.unique)break}}return this},has:function(e){if(n){var t=0,r=n.length;for(;t<r;t++)if(e===n[t])return!0}return!1},empty:function(){n=[];return this},disable:function(){n=r=i=t;return this},disabled:function(){return!n},lock:function(){r=t;(!i||i===!0)&&v.disable();return this},locked:function(){return!r},fireWith:function(t,n){r&&(f?e.once||r.push([t,n]):(!e.once||!i)&&d(t,n));return this},fire:function(){v.fireWith(this,arguments);return this},fired:function(){return!!a}};return v};var a=[].slice;s.extend({Deferred:function(e){var t=s.Callbacks("once memory"),n=s.Callbacks("once memory"),r=s.Callbacks("memory"),i="pending",o={resolve:t,reject:n,notify:r},u={done:t.add,fail:n.add,progress:r.add,state:function(){return i},isResolved:t.fired,isRejected:n.fired,then:function(e,t,n){a.done(e).fail(t).progress(n);return this},always:function(){a.done.apply(a,arguments).fail.apply(a,arguments);return this},pipe:function(e,t,n){return s.Deferred(function(r){s.each({done:[e,"resolve"],fail:[t,"reject"],progress:[n,"notify"]},function(e,t){var n=t[0],i=t[1],o;s.isFunction(n)?a[e](function(){o=n.apply(this,arguments);o&&s.isFunction(o.promise)?o.promise().then(r.resolve,r.reject,r.notify):r[i+"With"](this===a?r:this,[o])}):a[e](r[i])})}).promise()},promise:function(e){if(e==null)e=u;else for(var t in u)e[t]=u[t];return e}},a=u.promise({}),f;for(f in o){a[f]=o[f].fire;a[f+"With"]=o[f].fireWith}a.done(function(){i="resolved"},n.disable,r.lock).fail(function(){i="rejected"},t.disable,r.lock);e&&e.call(a,a);return a},when:function(e){function c(e){return function(n){t[e]=arguments.length>1?a.call(arguments,0):n;--o||f.resolveWith(f,t)}}function h(e){return function(t){i[e]=arguments.length>1?a.call(arguments,0):t;f.notifyWith(l,i)}}var t=a.call(arguments,0),n=0,r=t.length,i=new Array(r),o=r,u=r,f=r<=1&&e&&s.isFunction(e.promise)?e:s.Deferred(),l=f.promise();if(r>1){for(;n<r;n++)t[n]&&t[n].promise&&s.isFunction(t[n].promise)?t[n].promise().then(c(n),f.reject,h(n)):--o;o||f.resolveWith(f,t)}else f!==e&&f.resolveWith(f,r?[e]:[]);return l}});s.support=function(){var t,r,i,o,u,a,f,l,c,h,p,d,v=n.createElement("div"),m=n.documentElement;v.setAttribute("className","t");v.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>";r=v.getElementsByTagName("*");i=v.getElementsByTagName("a")[0];if(!r||!r.length||!i)return{};o=n.createElement("select");u=o.appendChild(n.createElement("option"));a=v.getElementsByTagName("input")[0];t={leadingWhitespace:v.firstChild.nodeType===3,tbody:!v.getElementsByTagName("tbody").length,htmlSerialize:!!v.getElementsByTagName("link").length,style:/top/.test(i.getAttribute("style")),hrefNormalized:i.getAttribute("href")==="/a",opacity:/^0.55/.test(i.style.opacity),cssFloat:!!i.style.cssFloat,checkOn:a.value==="on",optSelected:u.selected,getSetAttribute:v.className!=="t",enctype:!!n.createElement("form").enctype,html5Clone:n.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,pixelMargin:!0};s.boxModel=t.boxModel=n.compatMode==="CSS1Compat";a.checked=!0;t.noCloneChecked=a.cloneNode(!0).checked;o.disabled=!0;t.optDisabled=!u.disabled;try{delete v.test}catch(g){t.deleteExpando=!1}if(!v.addEventListener&&v.attachEvent&&v.fireEvent){v.attachEvent("onclick",function(){t.noCloneEvent=!1});v.cloneNode(!0).fireEvent("onclick")}a=n.createElement("input");a.value="t";a.setAttribute("type","radio");t.radioValue=a.value==="t";a.setAttribute("checked","checked");a.setAttribute("name","t");v.appendChild(a);f=n.createDocumentFragment();f.appendChild(v.lastChild);t.checkClone=f.cloneNode(!0).cloneNode(!0).lastChild.checked;t.appendChecked=a.checked;f.removeChild(a);f.appendChild(v);if(v.attachEvent)for(p in{submit:1,change:1,focusin:1}){h="on"+p;d=h in v;if(!d){v.setAttribute(h,"return;");d=typeof v[h]=="function"}t[p+"Bubbles"]=d}f.removeChild(v);f=o=u=v=a=null;s(function(){var r,i,o,u,a,f,c,h,p,m,g,y,b,w=n.getElementsByTagName("body")[0];if(!w)return;h=1;b="padding:0;margin:0;border:";g="position:absolute;top:0;left:0;width:1px;height:1px;";y=b+"0;visibility:hidden;";p="style='"+g+b+"5px solid #000;";m="<div "+p+"display:block;'><div style='"+b+"0;display:block;overflow:hidden;'></div></div>"+"<table "+p+"' cellpadding='0' cellspacing='0'>"+"<tr><td></td></tr></table>";r=n.createElement("div");r.style.cssText=y+"width:0;height:0;position:static;top:0;margin-top:"+h+"px";w.insertBefore(r,w.firstChild);v=n.createElement("div");r.appendChild(v);v.innerHTML="<table><tr><td style='"+b+"0;display:none'></td><td>t</td></tr></table>";l=v.getElementsByTagName("td");d=l[0].offsetHeight===0;l[0].style.display="";l[1].style.display="none";t.reliableHiddenOffsets=d&&l[0].offsetHeight===0;if(e.getComputedStyle){v.innerHTML="";c=n.createElement("div");c.style.width="0";c.style.marginRight="0";v.style.width="2px";v.appendChild(c);t.reliableMarginRight=(parseInt((e.getComputedStyle(c,null)||{marginRight:0}).marginRight,10)||0)===0}if(typeof v.style.zoom!="undefined"){v.innerHTML="";v.style.width=v.style.padding="1px";v.style.border=0;v.style.overflow="hidden";v.style.display="inline";v.style.zoom=1;t.inlineBlockNeedsLayout=v.offsetWidth===3;v.style.display="block";v.style.overflow="visible";v.innerHTML="<div style='width:5px;'></div>";t.shrinkWrapBlocks=v.offsetWidth!==3}v.style.cssText=g+y;v.innerHTML=m;i=v.firstChild;o=i.firstChild;a=i.nextSibling.firstChild.firstChild;f={doesNotAddBorder:o.offsetTop!==5,doesAddBorderForTableAndCells:a.offsetTop===5};o.style.position="fixed";o.style.top="20px";f.fixedPosition=o.offsetTop===20||o.offsetTop===15;o.style.position=o.style.top="";i.style.overflow="hidden";i.style.position="relative";f.subtractsBorderForOverflowNotVisible=o.offsetTop===-5;f.doesNotIncludeMarginInBodyOffset=w.offsetTop!==h;if(e.getComputedStyle){v.style.marginTop="1%";t.pixelMargin=(e.getComputedStyle(v,null)||{marginTop:0}).marginTop!=="1%"}typeof r.style.zoom!="undefined"&&(r.style.zoom=1);w.removeChild(r);c=v=r=null;s.extend(t,f)});return t}();var f=/^(?:\{.*\}|\[.*\])$/,l=/([A-Z])/g;s.extend({cache:{},uuid:0,expando:"jQuery"+(s.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){e=e.nodeType?s.cache[e[s.expando]]:e[s.expando];return!!e&&!h(e)},data:function(e,n,r,i){if(!s.acceptData(e))return;var o,u,a,f=s.expando,l=typeof n=="string",c=e.nodeType,h=c?s.cache:e,p=c?e[f]:e[f]&&f,d=n==="events";if((!p||!h[p]||!d&&!i&&!h[p].data)&&l&&r===t)return;p||(c?e[f]=p=++s.uuid:p=f);if(!h[p]){h[p]={};c||(h[p].toJSON=s.noop)}if(typeof n=="object"||typeof n=="function")i?h[p]=s.extend(h[p],n):h[p].data=s.extend(h[p].data,n);o=u=h[p];if(!i){u.data||(u.data={});u=u.data}r!==t&&(u[s.camelCase(n)]=r);if(d&&!u[n])return o.events;if(l){a=u[n];a==null&&(a=u[s.camelCase(n)])}else a=u;return a},removeData:function(e,t,n){if(!s.acceptData(e))return;var r,i,o,u=s.expando,a=e.nodeType,f=a?s.cache:e,l=a?e[u]:u;if(!f[l])return;if(t){r=n?f[l]:f[l].data;if(r){if(!s.isArray(t))if(t in r)t=[t];else{t=s.camelCase(t);t in r?t=[t]:t=t.split(" ")}for(i=0,o=t.length;i<o;i++)delete r[t[i]];if(!(n?h:s.isEmptyObject)(r))return}}if(!n){delete f[l].data;if(!h(f[l]))return}s.support.deleteExpando||!f.setInterval?delete f[l]:f[l]=null;a&&(s.support.deleteExpando?delete e[u]:e.removeAttribute?e.removeAttribute(u):e[u]=null)},_data:function(e,t,n){return s.data(e,t,n,!0)},acceptData:function(e){if(e.nodeName){var t=s.noData[e.nodeName.toLowerCase()];if(t)return t!==!0&&e.getAttribute("classid")===t}return!0}});s.fn.extend({data:function(e,n){var r,i,o,u,a,f=this[0],l=0,h=null;if(e===t){if(this.length){h=s.data(f);if(f.nodeType===1&&!s._data(f,"parsedAttrs")){o=f.attributes;for(a=o.length;l<a;l++){u=o[l].name;if(u.indexOf("data-")===0){u=s.camelCase(u.substring(5));c(f,u,h[u])}}s._data(f,"parsedAttrs",!0)}}return h}if(typeof e=="object")return this.each(function(){s.data(this,e)});r=e.split(".",2);r[1]=r[1]?"."+r[1]:"";i=r[1]+"!";return s.access(this,function(n){if(n===t){h=this.triggerHandler("getData"+i,[r[0]]);if(h===t&&f){h=s.data(f,e);h=c(f,e,h)}return h===t&&r[1]?this.data(r[0]):h}r[1]=n;this.each(function(){var t=s(this);t.triggerHandler("setData"+i,r);s.data(this,e,n);t.triggerHandler("changeData"+i,r)})},null,n,arguments.length>1,null,!1)},removeData:function(e){return this.each(function(){s.removeData(this,e)})}});s.extend({_mark:function(e,t){if(e){t=(t||"fx")+"mark";s._data(e,t,(s._data(e,t)||0)+1)}},_unmark:function(e,t,n){if(e!==!0){n=t;t=e;e=!1}if(t){n=n||"fx";var r=n+"mark",i=e?0:(s._data(t,r)||1)-1;if(i)s._data(t,r,i);else{s.removeData(t,r,!0);p(t,n,"mark")}}},queue:function(e,t,n){var r;if(e){t=(t||"fx")+"queue";r=s._data(e,t);n&&(!r||s.isArray(n)?r=s._data(e,t,s.makeArray(n)):r.push(n));return r||[]}},dequeue:function(e,t){t=t||"fx";var n=s.queue(e,t),r=n.shift(),i={};r==="inprogress"&&(r=n.shift());if(r){t==="fx"&&n.unshift("inprogress");s._data(e,t+".run",i);r.call(e,function(){s.dequeue(e,t)},i)}if(!n.length){s.removeData(e,t+"queue "+t+".run",!0);p(e,t,"queue")}}});s.fn.extend({queue:function(e,n){var r=2;if(typeof e!="string"){n=e;e="fx";r--}return arguments.length<r?s.queue(this[0],e):n===t?this:this.each(function(){var t=s.queue(this,e,n);e==="fx"&&t[0]!=="inprogress"&&s.dequeue(this,e)})},dequeue:function(e){return this.each(function(){s.dequeue(this,e)})},delay:function(e,t){e=s.fx?s.fx.speeds[e]||e:e;t=t||"fx";return this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){function h(){--u||r.resolveWith(i,[i])}if(typeof e!="string"){n=e;e=t}e=e||"fx";var r=s.Deferred(),i=this,o=i.length,u=1,a=e+"defer",f=e+"queue",l=e+"mark",c;while(o--)if(c=s.data(i[o],a,t,!0)||(s.data(i[o],f,t,!0)||s.data(i[o],l,t,!0))&&s.data(i[o],a,s.Callbacks("once memory"),!0)){u++;c.add(h)}h();return r.promise(n)}});var d=/[\n\t\r]/g,v=/\s+/,m=/\r/g,g=/^(?:button|input)$/i,y=/^(?:button|input|object|select|textarea)$/i,b=/^a(?:rea)?$/i,w=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,E=s.support.getSetAttribute,S,x,T;s.fn.extend({attr:function(e,t){return s.access(this,s.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){s.removeAttr(this,e)})},prop:function(e,t){return s.access(this,s.prop,e,t,arguments.length>1)},removeProp:function(e){e=s.propFix[e]||e;return this.each(function(){try{this[e]=t;delete this[e]}catch(n){}})},addClass:function(e){var t,n,r,i,o,u,a;if(s.isFunction(e))return this.each(function(t){s(this).addClass(e.call(this,t,this.className))});if(e&&typeof e=="string"){t=e.split(v);for(n=0,r=this.length;n<r;n++){i=this[n];if(i.nodeType===1)if(!i.className&&t.length===1)i.className=e;else{o=" "+i.className+" ";for(u=0,a=t.length;u<a;u++)~o.indexOf(" "+t[u]+" ")||(o+=t[u]+" ");i.className=s.trim(o)}}}return this},removeClass:function(e){var n,r,i,o,u,a,f;if(s.isFunction(e))return this.each(function(t){s(this).removeClass(e.call(this,t,this.className))});if(e&&typeof e=="string"||e===t){n=(e||"").split(v);for(r=0,i=this.length;r<i;r++){o=this[r];if(o.nodeType===1&&o.className)if(e){u=(" "+o.className+" ").replace(d," ");for(a=0,f=n.length;a<f;a++)u=u.replace(" "+n[a]+" "," ");o.className=s.trim(u)}else o.className=""}}return this},toggleClass:function(e,t){var n=typeof e,r=typeof t=="boolean";return s.isFunction(e)?this.each(function(n){s(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if(n==="string"){var i,o=0,u=s(this),a=t,f=e.split(v);while(i=f[o++]){a=r?a:!u.hasClass(i);u[a?"addClass":"removeClass"](i)}}else if(n==="undefined"||n==="boolean"){this.className&&s._data(this,"__className__",this.className);this.className=this.className||e===!1?"":s._data(this,"__className__")||""}})},hasClass:function(e){var t=" "+e+" ",n=0,r=this.length;for(;n<r;n++)if(this[n].nodeType===1&&(" "+this[n].className+" ").replace(d," ").indexOf(t)>-1)return!0;return!1},val:function(e){var n,r,i,o=this[0];if(!arguments.length){if(o){n=s.valHooks[o.type]||s.valHooks[o.nodeName.toLowerCase()];if(n&&"get"in n&&(r=n.get(o,"value"))!==t)return r;r=o.value;return typeof r=="string"?r.replace(m,""):r==null?"":r}return}i=s.isFunction(e);return this.each(function(r){var o=s(this),u;if(this.nodeType!==1)return;i?u=e.call(this,r,o.val()):u=e;u==null?u="":typeof u=="number"?u+="":s.isArray(u)&&(u=s.map(u,function(e){return e==null?"":e+""}));n=s.valHooks[this.type]||s.valHooks[this.nodeName.toLowerCase()];if(!n||!("set"in n)||n.set(this,u,"value")===t)this.value=u})}});s.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t,n,r,i,o=e.selectedIndex,u=[],a=e.options,f=e.type==="select-one";if(o<0)return null;n=f?o:0;r=f?o+1:a.length;for(;n<r;n++){i=a[n];if(i.selected&&(s.support.optDisabled?!i.disabled:i.getAttribute("disabled")===null)&&(!i.parentNode.disabled||!s.nodeName(i.parentNode,"optgroup"))){t=s(i).val();if(f)return t;u.push(t)}}return f&&!u.length&&a.length?s(a[o]).val():u},set:function(e,t){var n=s.makeArray(t);s(e).find("option").each(function(){this.selected=s.inArray(s(this).val(),n)>=0});n.length||(e.selectedIndex=-1);return n}}},attrFn:{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0},attr:function(e,n,r,i){var o,u,a,f=e.nodeType;if(!e||f===3||f===8||f===2)return;if(i&&n in s.attrFn)return s(e)[n](r);if(typeof e.getAttribute=="undefined")return s.prop(e,n,r);a=f!==1||!s.isXMLDoc(e);if(a){n=n.toLowerCase();u=s.attrHooks[n]||(w.test(n)?x:S)}if(r!==t){if(r===null){s.removeAttr(e,n);return}if(u&&"set"in u&&a&&(o=u.set(e,r,n))!==t)return o;e.setAttribute(n,""+r);return r}if(u&&"get"in u&&a&&(o=u.get(e,n))!==null)return o;o=e.getAttribute(n);return o===null?t:o},removeAttr:function(e,t){var n,r,i,o,u,a=0;if(t&&e.nodeType===1){r=t.toLowerCase().split(v);o=r.length;for(;a<o;a++){i=r[a];if(i){n=s.propFix[i]||i;u=w.test(i);u||s.attr(e,i,"");e.removeAttribute(E?i:n);u&&n in e&&(e[n]=!1)}}}},attrHooks:{type:{set:function(e,t){if(g.test(e.nodeName)&&e.parentNode)s.error("type property can't be changed");else if(!s.support.radioValue&&t==="radio"&&s.nodeName(e,"input")){var n=e.value;e.setAttribute("type",t);n&&(e.value=n);return t}}},value:{get:function(e,t){return S&&s.nodeName(e,"button")?S.get(e,t):t in e?e.value:null},set:function(e,t,n){if(S&&s.nodeName(e,"button"))return S.set(e,t,n);e.value=t}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,n,r){var i,o,u,a=e.nodeType;if(!e||a===3||a===8||a===2)return;u=a!==1||!s.isXMLDoc(e);if(u){n=s.propFix[n]||n;o=s.propHooks[n]}return r!==t?o&&"set"in o&&(i=o.set(e,r,n))!==t?i:e[n]=r:o&&"get"in o&&(i=o.get(e,n))!==null?i:e[n]},propHooks:{tabIndex:{get:function(e){var n=e.getAttributeNode("tabindex");return n&&n.specified?parseInt(n.value,10):y.test(e.nodeName)||b.test(e.nodeName)&&e.href?0:t}}}});s.attrHooks.tabindex=s.propHooks.tabIndex;x={get:function(e,n){var r,i=s.prop(e,n);return i===!0||typeof i!="boolean"&&(r=e.getAttributeNode(n))&&r.nodeValue!==!1?n.toLowerCase():t},set:function(e,t,n){var r;if(t===!1)s.removeAttr(e,n);else{r=s.propFix[n]||n;r in e&&(e[r]=!0);e.setAttribute(n,n.toLowerCase())}return n}};if(!E){T={name:!0,id:!0,coords:!0};S=s.valHooks.button={get:function(e,n){var r;r=e.getAttributeNode(n);return r&&(T[n]?r.nodeValue!=="":r.specified)?r.nodeValue:t},set:function(e,t,r){var i=e.getAttributeNode(r);if(!i){i=n.createAttribute(r);e.setAttributeNode(i)}return i.nodeValue=t+""}};s.attrHooks.tabindex.set=S.set;s.each(["width","height"],function(e,t){s.attrHooks[t]=s.extend(s.attrHooks[t],{set:function(e,n){if(n===""){e.setAttribute(t,"auto");return n}}})});s.attrHooks.contenteditable={get:S.get,set:function(e,t,n){t===""&&(t="false");S.set(e,t,n)}}}s.support.hrefNormalized||s.each(["href","src","width","height"],function(e,n){s.attrHooks[n]=s.extend(s.attrHooks[n],{get:function(e){var r=e.getAttribute(n,2);return r===null?t:r}})});s.support.style||(s.attrHooks.style={get:function(e){return e.style.cssText.toLowerCase()||t},set:function(e,t){return e.style.cssText=""+t}});s.support.optSelected||(s.propHooks.selected=s.extend(s.propHooks.selected,{get:function(e){var t=e.parentNode;if(t){t.selectedIndex;t.parentNode&&t.parentNode.selectedIndex}return null}}));s.support.enctype||(s.propFix.enctype="encoding");s.support.checkOn||s.each(["radio","checkbox"],function(){s.valHooks[this]={get:function(e){return e.getAttribute("value")===null?"on":e.value}}});s.each(["radio","checkbox"],function(){s.valHooks[this]=s.extend(s.valHooks[this],{set:function(e,t){if(s.isArray(t))return e.checked=s.inArray(s(e).val(),t)>=0}})});var N=/^(?:textarea|input|select)$/i
,C=/^([^\.]*)?(?:\.(.+))?$/,k=/(?:^|\s)hover(\.\S+)?\b/,L=/^key/,A=/^(?:mouse|contextmenu)|click/,O=/^(?:focusinfocus|focusoutblur)$/,M=/^(\w*)(?:#([\w\-]+))?(?:\.([\w\-]+))?$/,_=function(e){var t=M.exec(e);if(t){t[1]=(t[1]||"").toLowerCase();t[3]=t[3]&&new RegExp("(?:^|\\s)"+t[3]+"(?:\\s|$)")}return t},D=function(e,t){var n=e.attributes||{};return(!t[1]||e.nodeName.toLowerCase()===t[1])&&(!t[2]||(n.id||{}).value===t[2])&&(!t[3]||t[3].test((n["class"]||{}).value))},P=function(e){return s.event.special.hover?e:e.replace(k,"mouseenter$1 mouseleave$1")};s.event={add:function(e,n,r,i,o){var u,a,f,l,c,h,p,d,v,m,g,y;if(e.nodeType===3||e.nodeType===8||!n||!r||!(u=s._data(e)))return;if(r.handler){v=r;r=v.handler;o=v.selector}r.guid||(r.guid=s.guid++);f=u.events;f||(u.events=f={});a=u.handle;if(!a){u.handle=a=function(e){return typeof s=="undefined"||!!e&&s.event.triggered===e.type?t:s.event.dispatch.apply(a.elem,arguments)};a.elem=e}n=s.trim(P(n)).split(" ");for(l=0;l<n.length;l++){c=C.exec(n[l])||[];h=c[1];p=(c[2]||"").split(".").sort();y=s.event.special[h]||{};h=(o?y.delegateType:y.bindType)||h;y=s.event.special[h]||{};d=s.extend({type:h,origType:c[1],data:i,handler:r,guid:r.guid,selector:o,quick:o&&_(o),namespace:p.join(".")},v);g=f[h];if(!g){g=f[h]=[];g.delegateCount=0;if(!y.setup||y.setup.call(e,i,p,a)===!1)e.addEventListener?e.addEventListener(h,a,!1):e.attachEvent&&e.attachEvent("on"+h,a)}if(y.add){y.add.call(e,d);d.handler.guid||(d.handler.guid=r.guid)}o?g.splice(g.delegateCount++,0,d):g.push(d);s.event.global[h]=!0}e=null},global:{},remove:function(e,t,n,r,i){var o=s.hasData(e)&&s._data(e),u,a,f,l,c,h,p,d,v,m,g,y;if(!o||!(d=o.events))return;t=s.trim(P(t||"")).split(" ");for(u=0;u<t.length;u++){a=C.exec(t[u])||[];f=l=a[1];c=a[2];if(!f){for(f in d)s.event.remove(e,f+t[u],n,r,!0);continue}v=s.event.special[f]||{};f=(r?v.delegateType:v.bindType)||f;g=d[f]||[];h=g.length;c=c?new RegExp("(^|\\.)"+c.split(".").sort().join("\\.(?:.*\\.)?")+"(\\.|$)"):null;for(p=0;p<g.length;p++){y=g[p];if((i||l===y.origType)&&(!n||n.guid===y.guid)&&(!c||c.test(y.namespace))&&(!r||r===y.selector||r==="**"&&y.selector)){g.splice(p--,1);y.selector&&g.delegateCount--;v.remove&&v.remove.call(e,y)}}if(g.length===0&&h!==g.length){(!v.teardown||v.teardown.call(e,c)===!1)&&s.removeEvent(e,f,o.handle);delete d[f]}}if(s.isEmptyObject(d)){m=o.handle;m&&(m.elem=null);s.removeData(e,["events","handle"],!0)}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(n,r,i,o){if(!i||i.nodeType!==3&&i.nodeType!==8){var u=n.type||n,a=[],f,l,c,h,p,d,v,m,g,y;if(O.test(u+s.event.triggered))return;if(u.indexOf("!")>=0){u=u.slice(0,-1);l=!0}if(u.indexOf(".")>=0){a=u.split(".");u=a.shift();a.sort()}if((!i||s.event.customEvent[u])&&!s.event.global[u])return;n=typeof n=="object"?n[s.expando]?n:new s.Event(u,n):new s.Event(u);n.type=u;n.isTrigger=!0;n.exclusive=l;n.namespace=a.join(".");n.namespace_re=n.namespace?new RegExp("(^|\\.)"+a.join("\\.(?:.*\\.)?")+"(\\.|$)"):null;d=u.indexOf(":")<0?"on"+u:"";if(!i){f=s.cache;for(c in f)f[c].events&&f[c].events[u]&&s.event.trigger(n,r,f[c].handle.elem,!0);return}n.result=t;n.target||(n.target=i);r=r!=null?s.makeArray(r):[];r.unshift(n);v=s.event.special[u]||{};if(v.trigger&&v.trigger.apply(i,r)===!1)return;g=[[i,v.bindType||u]];if(!o&&!v.noBubble&&!s.isWindow(i)){y=v.delegateType||u;h=O.test(y+u)?i:i.parentNode;p=null;for(;h;h=h.parentNode){g.push([h,y]);p=h}p&&p===i.ownerDocument&&g.push([p.defaultView||p.parentWindow||e,y])}for(c=0;c<g.length&&!n.isPropagationStopped();c++){h=g[c][0];n.type=g[c][1];m=(s._data(h,"events")||{})[n.type]&&s._data(h,"handle");m&&m.apply(h,r);m=d&&h[d];m&&s.acceptData(h)&&m.apply(h,r)===!1&&n.preventDefault()}n.type=u;if(!o&&!n.isDefaultPrevented()&&(!v._default||v._default.apply(i.ownerDocument,r)===!1)&&(u!=="click"||!s.nodeName(i,"a"))&&s.acceptData(i)&&d&&i[u]&&(u!=="focus"&&u!=="blur"||n.target.offsetWidth!==0)&&!s.isWindow(i)){p=i[d];p&&(i[d]=null);s.event.triggered=u;i[u]();s.event.triggered=t;p&&(i[d]=p)}return n.result}return},dispatch:function(n){n=s.event.fix(n||e.event);var r=(s._data(this,"events")||{})[n.type]||[],i=r.delegateCount,o=[].slice.call(arguments,0),u=!n.exclusive&&!n.namespace,a=s.event.special[n.type]||{},f=[],l,c,h,p,d,v,m,g,y,b,w;o[0]=n;n.delegateTarget=this;if(a.preDispatch&&a.preDispatch.call(this,n)===!1)return;if(i&&(!n.button||n.type!=="click")){p=s(this);p.context=this.ownerDocument||this;for(h=n.target;h!=this;h=h.parentNode||this)if(h.disabled!==!0){v={};g=[];p[0]=h;for(l=0;l<i;l++){y=r[l];b=y.selector;v[b]===t&&(v[b]=y.quick?D(h,y.quick):p.is(b));v[b]&&g.push(y)}g.length&&f.push({elem:h,matches:g})}}r.length>i&&f.push({elem:this,matches:r.slice(i)});for(l=0;l<f.length&&!n.isPropagationStopped();l++){m=f[l];n.currentTarget=m.elem;for(c=0;c<m.matches.length&&!n.isImmediatePropagationStopped();c++){y=m.matches[c];if(u||!n.namespace&&!y.namespace||n.namespace_re&&n.namespace_re.test(y.namespace)){n.data=y.data;n.handleObj=y;d=((s.event.special[y.origType]||{}).handle||y.handler).apply(m.elem,o);if(d!==t){n.result=d;if(d===!1){n.preventDefault();n.stopPropagation()}}}}}a.postDispatch&&a.postDispatch.call(this,n);return n.result},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){e.which==null&&(e.which=t.charCode!=null?t.charCode:t.keyCode);return e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,r){var i,s,o,u=r.button,a=r.fromElement;if(e.pageX==null&&r.clientX!=null){i=e.target.ownerDocument||n;s=i.documentElement;o=i.body;e.pageX=r.clientX+(s&&s.scrollLeft||o&&o.scrollLeft||0)-(s&&s.clientLeft||o&&o.clientLeft||0);e.pageY=r.clientY+(s&&s.scrollTop||o&&o.scrollTop||0)-(s&&s.clientTop||o&&o.clientTop||0)}!e.relatedTarget&&a&&(e.relatedTarget=a===e.target?r.toElement:a);!e.which&&u!==t&&(e.which=u&1?1:u&2?3:u&4?2:0);return e}},fix:function(e){if(e[s.expando])return e;var r,i,o=e,u=s.event.fixHooks[e.type]||{},a=u.props?this.props.concat(u.props):this.props;e=s.Event(o);for(r=a.length;r;){i=a[--r];e[i]=o[i]}e.target||(e.target=o.srcElement||n);e.target.nodeType===3&&(e.target=e.target.parentNode);e.metaKey===t&&(e.metaKey=e.ctrlKey);return u.filter?u.filter(e,o):e},special:{ready:{setup:s.bindReady},load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(e,t,n){s.isWindow(this)&&(this.onbeforeunload=n)},teardown:function(e,t){this.onbeforeunload===t&&(this.onbeforeunload=null)}}},simulate:function(e,t,n,r){var i=s.extend(new s.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?s.event.trigger(i,null,t):s.event.dispatch.call(t,i);i.isDefaultPrevented()&&n.preventDefault()}};s.event.handle=s.event.dispatch;s.removeEvent=n.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){e.detachEvent&&e.detachEvent("on"+t,n)};s.Event=function(e,t){if(!(this instanceof s.Event))return new s.Event(e,t);if(e&&e.type){this.originalEvent=e;this.type=e.type;this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?B:H}else this.type=e;t&&s.extend(this,t);this.timeStamp=e&&e.timeStamp||s.now();this[s.expando]=!0};s.Event.prototype={preventDefault:function(){this.isDefaultPrevented=B;var e=this.originalEvent;if(!e)return;e.preventDefault?e.preventDefault():e.returnValue=!1},stopPropagation:function(){this.isPropagationStopped=B;var e=this.originalEvent;if(!e)return;e.stopPropagation&&e.stopPropagation();e.cancelBubble=!0},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=B;this.stopPropagation()},isDefaultPrevented:H,isPropagationStopped:H,isImmediatePropagationStopped:H};s.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){s.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n=this,r=e.relatedTarget,i=e.handleObj,o=i.selector,u;if(!r||r!==n&&!s.contains(n,r)){e.type=i.origType;u=i.handler.apply(this,arguments);e.type=t}return u}}});s.support.submitBubbles||(s.event.special.submit={setup:function(){if(s.nodeName(this,"form"))return!1;s.event.add(this,"click._submit keypress._submit",function(e){var n=e.target,r=s.nodeName(n,"input")||s.nodeName(n,"button")?n.form:t;if(r&&!r._submit_attached){s.event.add(r,"submit._submit",function(e){e._submit_bubble=!0});r._submit_attached=!0}})},postDispatch:function(e){if(e._submit_bubble){delete e._submit_bubble;this.parentNode&&!e.isTrigger&&s.event.simulate("submit",this.parentNode,e,!0)}},teardown:function(){if(s.nodeName(this,"form"))return!1;s.event.remove(this,"._submit")}});s.support.changeBubbles||(s.event.special.change={setup:function(){if(N.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio"){s.event.add(this,"propertychange._change",function(e){e.originalEvent.propertyName==="checked"&&(this._just_changed=!0)});s.event.add(this,"click._change",function(e){if(this._just_changed&&!e.isTrigger){this._just_changed=!1;s.event.simulate("change",this,e,!0)}})}return!1}s.event.add(this,"beforeactivate._change",function(e){var t=e.target;if(N.test(t.nodeName)&&!t._change_attached){s.event.add(t,"change._change",function(e){this.parentNode&&!e.isSimulated&&!e.isTrigger&&s.event.simulate("change",this.parentNode,e,!0)});t._change_attached=!0}})},handle:function(e){var t=e.target;if(this!==t||e.isSimulated||e.isTrigger||t.type!=="radio"&&t.type!=="checkbox")return e.handleObj.handler.apply(this,arguments)},teardown:function(){s.event.remove(this,"._change");return N.test(this.nodeName)}});s.support.focusinBubbles||s.each({focus:"focusin",blur:"focusout"},function(e,t){var r=0,i=function(e){s.event.simulate(t,e.target,s.event.fix(e),!0)};s.event.special[t]={setup:function(){r++===0&&n.addEventListener(e,i,!0)},teardown:function(){--r===0&&n.removeEventListener(e,i,!0)}}});s.fn.extend({on:function(e,n,r,i,o){var u,a;if(typeof e=="object"){if(typeof n!="string"){r=r||n;n=t}for(a in e)this.on(a,n,r,e[a],o);return this}if(r==null&&i==null){i=n;r=n=t}else if(i==null)if(typeof n=="string"){i=r;r=t}else{i=r;r=n;n=t}if(i===!1)i=H;else if(!i)return this;if(o===1){u=i;i=function(e){s().off(e);return u.apply(this,arguments)};i.guid=u.guid||(u.guid=s.guid++)}return this.each(function(){s.event.add(this,e,i,r,n)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,n,r){if(e&&e.preventDefault&&e.handleObj){var i=e.handleObj;s(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler);return this}if(typeof e=="object"){for(var o in e)this.off(o,n,e[o]);return this}if(n===!1||typeof n=="function"){r=n;n=t}r===!1&&(r=H);return this.each(function(){s.event.remove(this,e,r,n)})},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},live:function(e,t,n){s(this.context).on(e,this.selector,t,n);return this},die:function(e,t){s(this.context).off(e,this.selector||"**",t);return this},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return arguments.length==1?this.off(e,"**"):this.off(t,e,n)},trigger:function(e,t){return this.each(function(){s.event.trigger(e,t,this)})},triggerHandler:function(e,t){if(this[0])return s.event.trigger(e,t,this[0],!0)},toggle:function(e){var t=arguments,n=e.guid||s.guid++,r=0,i=function(n){var i=(s._data(this,"lastToggle"+e.guid)||0)%r;s._data(this,"lastToggle"+e.guid,i+1);n.preventDefault();return t[i].apply(this,arguments)||!1};i.guid=n;while(r<t.length)t[r++].guid=n;return this.click(i)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}});s.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){s.fn[t]=function(e,n){if(n==null){n=e;e=null}return arguments.length>0?this.on(t,null,e,n):this.trigger(t)};s.attrFn&&(s.attrFn[t]=!0);L.test(t)&&(s.event.fixHooks[t]=s.event.keyHooks);A.test(t)&&(s.event.fixHooks[t]=s.event.mouseHooks)});(function(){function S(e,t,n,i,s,o){for(var u=0,a=i.length;u<a;u++){var f=i[u];if(f){var l=!1;f=f[e];while(f){if(f[r]===n){l=i[f.sizset];break}if(f.nodeType===1&&!o){f[r]=n;f.sizset=u}if(f.nodeName.toLowerCase()===t){l=f;break}f=f[e]}i[u]=l}}}function x(e,t,n,i,s,o){for(var u=0,a=i.length;u<a;u++){var f=i[u];if(f){var l=!1;f=f[e];while(f){if(f[r]===n){l=i[f.sizset];break}if(f.nodeType===1){if(!o){f[r]=n;f.sizset=u}if(typeof t!="string"){if(f===t){l=!0;break}}else if(h.filter(t,[f]).length>0){l=f;break}}f=f[e]}i[u]=l}}}var e=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,r="sizcache"+(Math.random()+"").replace(".",""),i=0,o=Object.prototype.toString,u=!1,a=!0,f=/\\/g,l=/\r\n/g,c=/\W/;[0,0].sort(function(){a=!1;return 0});var h=function(t,r,i,s){i=i||[];r=r||n;var u=r;if(r.nodeType!==1&&r.nodeType!==9)return[];if(!t||typeof t!="string")return i;var a,f,l,c,p,m,g,b,w=!0,E=h.isXML(r),S=[],x=t;do{e.exec("");a=e.exec(x);if(a){x=a[3];S.push(a[1]);if(a[2]){c=a[3];break}}}while(a);if(S.length>1&&v.exec(t))if(S.length===2&&d.relative[S[0]])f=T(S[0]+S[1],r,s);else{f=d.relative[S[0]]?[r]:h(S.shift(),r);while(S.length){t=S.shift();d.relative[t]&&(t+=S.shift());f=T(t,f,s)}}else{if(!s&&S.length>1&&r.nodeType===9&&!E&&d.match.ID.test(S[0])&&!d.match.ID.test(S[S.length-1])){p=h.find(S.shift(),r,E);r=p.expr?h.filter(p.expr,p.set)[0]:p.set[0]}if(r){p=s?{expr:S.pop(),set:y(s)}:h.find(S.pop(),S.length!==1||S[0]!=="~"&&S[0]!=="+"||!r.parentNode?r:r.parentNode,E);f=p.expr?h.filter(p.expr,p.set):p.set;S.length>0?l=y(f):w=!1;while(S.length){m=S.pop();g=m;d.relative[m]?g=S.pop():m="";g==null&&(g=r);d.relative[m](l,g,E)}}else l=S=[]}l||(l=f);l||h.error(m||t);if(o.call(l)==="[object Array]")if(!w)i.push.apply(i,l);else if(r&&r.nodeType===1)for(b=0;l[b]!=null;b++)l[b]&&(l[b]===!0||l[b].nodeType===1&&h.contains(r,l[b]))&&i.push(f[b]);else for(b=0;l[b]!=null;b++)l[b]&&l[b].nodeType===1&&i.push(f[b]);else y(l,i);if(c){h(c,u,i,s);h.uniqueSort(i)}return i};h.uniqueSort=function(e){if(w){u=a;e.sort(w);if(u)for(var t=1;t<e.length;t++)e[t]===e[t-1]&&e.splice(t--,1)}return e};h.matches=function(e,t){return h(e,null,null,t)};h.matchesSelector=function(e,t){return h(t,null,null,[e]).length>0};h.find=function(e,t,n){var r,i,s,o,u,a;if(!e)return[];for(i=0,s=d.order.length;i<s;i++){u=d.order[i];if(o=d.leftMatch[u].exec(e)){a=o[1];o.splice(1,1);if(a.substr(a.length-1)!=="\\"){o[1]=(o[1]||"").replace(f,"");r=d.find[u](o,t,n);if(r!=null){e=e.replace(d.match[u],"");break}}}}r||(r=typeof t.getElementsByTagName!="undefined"?t.getElementsByTagName("*"):[]);return{set:r,expr:e}};h.filter=function(e,n,r,i){var s,o,u,a,f,l,c,p,v,m=e,g=[],y=n,b=n&&n[0]&&h.isXML(n[0]);while(e&&n.length){for(u in d.filter)if((s=d.leftMatch[u].exec(e))!=null&&s[2]){l=d.filter[u];c=s[1];o=!1;s.splice(1,1);if(c.substr(c.length-1)==="\\")continue;y===g&&(g=[]);if(d.preFilter[u]){s=d.preFilter[u](s,y,r,g,i,b);if(!s)o=a=!0;else if(s===!0)continue}if(s)for(p=0;(f=y[p])!=null;p++)if(f){a=l(f,s,p,y);v=i^a;if(r&&a!=null)v?o=!0:y[p]=!1;else if(v){g.push(f);o=!0}}if(a!==t){r||(y=g);e=e.replace(d.match[u],"");if(!o)return[];break}}if(e===m){if(o!=null)break;h.error(e)}m=e}return y};h.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)};var p=h.getText=function(e){var t,n,r=e.nodeType,i="";if(r){if(r===1||r===9||r===11){if(typeof e.textContent=="string")return e.textContent;if(typeof e.innerText=="string")return e.innerText.replace(l,"");for(e=e.firstChild;e;e=e.nextSibling)i+=p(e)}else if(r===3||r===4)return e.nodeValue}else for(t=0;n=e[t];t++)n.nodeType!==8&&(i+=p(n));return i},d=h.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(e){return e.getAttribute("href")},type:function(e){return e.getAttribute("type")}},relative:{"+":function(e,t){var n=typeof t=="string",r=n&&!c.test(t),i=n&&!r;r&&(t=t.toLowerCase());for(var s=0,o=e.length,u;s<o;s++)if(u=e[s]){while((u=u.previousSibling)&&u.nodeType!==1);e[s]=i||u&&u.nodeName.toLowerCase()===t?u||!1:u===t}i&&h.filter(t,e,!0)},">":function(e,t){var n,r=typeof t=="string",i=0,s=e.length;if(r&&!c.test(t)){t=t.toLowerCase();for(;i<s;i++){n=e[i];if(n){var o=n.parentNode;e[i]=o.nodeName.toLowerCase()===t?o:!1}}}else{for(;i<s;i++){n=e[i];n&&(e[i]=r?n.parentNode:n.parentNode===t)}r&&h.filter(t,e,!0)}},"":function(e,t,n){var r,s=i++,o=x;if(typeof t=="string"&&!c.test(t)){t=t.toLowerCase();r=t;o=S}o("parentNode",t,s,e,r,n)},"~":function(e,t,n){var r,s=i++,o=x;if(typeof t=="string"&&!c.test(t)){t=t.toLowerCase();r=t;o=S}o("previousSibling",t,s,e,r,n)}},find:{ID:function(e,t,n){if(typeof t.getElementById!="undefined"&&!n){var r=t.getElementById(e[1]);return r&&r.parentNode?[r]:[]}},NAME:function(e,t){if(typeof t.getElementsByName!="undefined"){var n=[],r=t.getElementsByName(e[1]);for(var i=0,s=r.length;i<s;i++)r[i].getAttribute("name")===e[1]&&n.push(r[i]);return n.length===0?null:n}},TAG:function(e,t){if(typeof t.getElementsByTagName!="undefined")return t.getElementsByTagName(e[1])}},preFilter:{CLASS:function(e,t,n,r,i,s){e=" "+e[1].replace(f,"")+" ";if(s)return e;for(var o=0,u;(u=t[o])!=null;o++)u&&(i^(u.className&&(" "+u.className+" ").replace(/[\t\n\r]/g," ").indexOf(e)>=0)?n||r.push(u):n&&(t[o]=!1));return!1},ID:function(e){return e[1].replace(f,"")},TAG:function(e,t){return e[1].replace(f,"").toLowerCase()},CHILD:function(e){if(e[1]==="nth"){e[2]||h.error(e[0]);e[2]=e[2].replace(/^\+|\s*/g,"");var t=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(e[2]==="even"&&"2n"||e[2]==="odd"&&"2n+1"||!/\D/.test(e[2])&&"0n+"+e[2]||e[2]);e[2]=t[1]+(t[2]||1)-0;e[3]=t[3]-0}else e[2]&&h.error(e[0]);e[0]=i++;return e},ATTR:function(e,t,n,r,i,s){var o=e[1]=e[1].replace(f,"");!s&&d.attrMap[o]&&(e[1]=d.attrMap[o]);e[4]=(e[4]||e[5]||"").replace(f,"");e[2]==="~="&&(e[4]=" "+e[4]+" ");return e},PSEUDO:function(t,n,r,i,s){if(t[1]==="not"){if(!((e.exec(t[3])||"").length>1||/^\w/.test(t[3]))){var o=h.filter(t[3],n,r,!0^s);r||i.push.apply(i,o);return!1}t[3]=h(t[3],null,null,n)}else if(d.match.POS.test(t[0])||d.match.CHILD.test(t[0]))return!0;return t},POS:function(e){e.unshift(!0);return e}},filters:{enabled:function(e){return e.disabled===!1&&e.type!=="hidden"},disabled:function(e){return e.disabled===!0},checked:function(e){return e.checked===!0},selected:function(e){e.parentNode&&e.parentNode.selectedIndex;return e.selected===!0},parent:function(e){return!!e.firstChild},empty:function(e){return!e.firstChild},has:function(e,t,n){return!!h(n[3],e).length},header:function(e){return/h\d/i.test(e.nodeName)},text:function(e){var t=e.getAttribute("type"),n=e.type;return e.nodeName.toLowerCase()==="input"&&"text"===n&&(t===n||t===null)},radio:function(e){return e.nodeName.toLowerCase()==="input"&&"radio"===e.type},checkbox:function(e){return e.nodeName.toLowerCase()==="input"&&"checkbox"===e.type},file:function(e){return e.nodeName.toLowerCase()==="input"&&"file"===e.type},password:function(e){return e.nodeName.toLowerCase()==="input"&&"password"===e.type},submit:function(e){var t=e.nodeName.toLowerCase();return(t==="input"||t==="button")&&"submit"===e.type},image:function(e){return e.nodeName.toLowerCase()==="input"&&"image"===e.type},reset:function(e){var t=e.nodeName.toLowerCase();return(t==="input"||t==="button")&&"reset"===e.type},button:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&"button"===e.type||t==="button"},input:function(e){return/input|select|textarea|button/i.test(e.nodeName)},focus:function(e){return e===e.ownerDocument.activeElement}},setFilters:{first:function(e,t){return t===0},last:function(e,t,n,r){return t===r.length-1},even:function(e,t){return t%2===0},odd:function(e,t){return t%2===1},lt:function(e,t,n){return t<n[3]-0},gt:function(e,t,n){return t>n[3]-0},nth:function(e,t,n){return n[3]-0===t},eq:function(e,t,n){return n[3]-0===t}},filter:{PSEUDO:function(e,t,n,r){var i=t[1],s=d.filters[i];if(s)return s(e,n,t,r);if(i==="contains")return(e.textContent||e.innerText||p([e])||"").indexOf(t[3])>=0;if(i==="not"){var o=t[3];for(var u=0,a=o.length;u<a;u++)if(o[u]===e)return!1;return!0}h.error(i)},CHILD:function(e,t){var n,i,s,o,u,a,f,l=t[1],c=e;switch(l){case"only":case"first":while(c=c.previousSibling)if(c.nodeType===1)return!1;if(l==="first")return!0;c=e;case"last":while(c=c.nextSibling)if(c.nodeType===1)return!1;return!0;case"nth":n=t[2];i=t[3];if(n===1&&i===0)return!0;s=t[0];o=e.parentNode;if(o&&(o[r]!==s||!e.nodeIndex)){a=0;for(c=o.firstChild;c;c=c.nextSibling)c.nodeType===1&&(c.nodeIndex=++a);o[r]=s}f=e.nodeIndex-i;return n===0?f===0:f%n===0&&f/n>=0}},ID:function(e,t){return e.nodeType===1&&e.getAttribute("id")===t},TAG:function(e,t){return t==="*"&&e.nodeType===1||!!e.nodeName&&e.nodeName.toLowerCase()===t},CLASS:function(e,t){return(" "+(e.className||e.getAttribute("class"))+" ").indexOf(t)>-1},ATTR:function(e,t){var n=t[1],r=h.attr?h.attr(e,n):d.attrHandle[n]?d.attrHandle[n](e):e[n]!=null?e[n]:e.getAttribute(n),i=r+"",s=t[2],o=t[4];return r==null?s==="!=":!s&&h.attr?r!=null:s==="="?i===o:s==="*="?i.indexOf(o)>=0:s==="~="?(" "+i+" ").indexOf(o)>=0:o?s==="!="?i!==o:s==="^="?i.indexOf(o)===0:s==="$="?i.substr(i.length-o.length)===o:s==="|="?i===o||i.substr(0,o.length+1)===o+"-":!1:i&&r!==!1},POS:function(e,t,n,r){var i=t[2],s=d.setFilters[i];if(s)return s(e,n,t,r)}}},v=d.match.POS,m=function(e,t){return"\\"+(t-0+1)};for(var g in d.match){d.match[g]=new RegExp(d.match[g].source+/(?![^\[]*\])(?![^\(]*\))/.source);d.leftMatch[g]=new RegExp(/(^(?:.|\r|\n)*?)/.source+d.match[g].source.replace(/\\(\d+)/g,m))}d.match.globalPOS=v;var y=function(e,t){e=Array.prototype.slice.call(e,0);if(t){t.push.apply(t,e);return t}return e};try{Array.prototype.slice.call(n.documentElement.childNodes,0)[0].nodeType}catch(b){y=function(e,t){var n=0,r=t||[];if(o.call(e)==="[object Array]")Array.prototype.push.apply(r,e);else if(typeof e.length=="number")for(var i=e.length;n<i;n++)r.push(e[n]);else for(;e[n];n++)r.push(e[n]);return r}}var w,E;if(n.documentElement.compareDocumentPosition)w=function(e,t){if(e===t){u=!0;return 0}return!e.compareDocumentPosition||!t.compareDocumentPosition?e.compareDocumentPosition?-1:1:e.compareDocumentPosition(t)&4?-1:1};else{w=function(e,t){if(e===t){u=!0;return 0}if(e.sourceIndex&&t.sourceIndex)return e.sourceIndex-t.sourceIndex;var n,r,i=[],s=[],o=e.parentNode,a=t.parentNode,f=o;if(o===a)return E(e,t);if(!o)return-1;if(!a)return 1;while(f){i.unshift(f);f=f.parentNode}f=a;while(f){s.unshift(f);f=f.parentNode}n=i.length;r=s.length;for(var l=0;l<n&&l<r;l++)if(i[l]!==s[l])return E(i[l],s[l]);return l===n?E(e,s[l],-1):E(i[l],t,1)};E=function(e,t,n){if(e===t)return n;var r=e.nextSibling;while(r){if(r===t)return-1;r=r.nextSibling}return 1}}(function(){var e=n.createElement("div"),r="script"+(new Date).getTime(),i=n.documentElement;e.innerHTML="<a name='"+r+"'/>";i.insertBefore(e,i.firstChild);if(n.getElementById(r)){d.find.ID=function(e,n,r){if(typeof n.getElementById!="undefined"&&!r){var i=n.getElementById(e[1]);return i?i.id===e[1]||typeof i.getAttributeNode!="undefined"&&i.getAttributeNode("id").nodeValue===e[1]?[i]:t:[]}};d.filter.ID=function(e,t){var n=typeof e.getAttributeNode!="undefined"&&e.getAttributeNode("id");return e.nodeType===1&&n&&n.nodeValue===t}}i.removeChild(e);i=e=null})();(function(){var e=n.createElement("div");e.appendChild(n.createComment(""));e.getElementsByTagName("*").length>0&&(d.find.TAG=function(e,t){var n=t.getElementsByTagName(e[1]);if(e[1]==="*"){var r=[];for(var i=0;n[i];i++)n[i].nodeType===1&&r.push(n[i]);n=r}return n});e.innerHTML="<a href='#'></a>";e.firstChild&&typeof e.firstChild.getAttribute!="undefined"&&e.firstChild.getAttribute("href")!=="#"&&(d.attrHandle.href=function(e){return e.getAttribute("href",2)});e=null})();n.querySelectorAll&&function(){var e=h,t=n.createElement("div"),r="__sizzle__";t.innerHTML="<p class='TEST'></p>";if(t.querySelectorAll&&t.querySelectorAll(".TEST").length===0)return;h=function(t,i,s,o){i=i||n;if(!o&&!h.isXML(i)){var u=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(t);if(u&&(i.nodeType===1||i.nodeType===9)){if(u[1])return y(i.getElementsByTagName(t),s);if(u[2]&&d.find.CLASS&&i.getElementsByClassName)return y(i.getElementsByClassName(u[2]),s)}if(i.nodeType===9){if(t==="body"&&i.body)return y([i.body],s);if(u&&u[3]){var a=i.getElementById(u[3]);if(!a||!a.parentNode)return y([],s);if(a.id===u[3])return y([a],s)}try{return y(i.querySelectorAll(t),s)}catch(f){}}else if(i.nodeType===1&&i.nodeName.toLowerCase()!=="object"){var l=i,c=i.getAttribute("id"),p=c||r,v=i.parentNode,m=/^\s*[+~]/.test(t);c?p=p.replace(/'/g,"\\$&"):i.setAttribute("id",p);m&&v&&(i=i.parentNode);try{if(!m||v)return y(i.querySelectorAll("[id='"+p+"'] "+t),s)}catch(g){}finally{c||l.removeAttribute("id")}}}return e(t,i,s,o)};for(var i in e)h[i]=e[i];t=null}();(function(){var e=n.documentElement,t=e.matchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector||e.msMatchesSelector;if(t){var r=!t.call(n.createElement("div"),"div"),i=!1;try{t.call(n.documentElement,"[test!='']:sizzle")}catch(s){i=!0}h.matchesSelector=function(e,n){n=n.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!h.isXML(e))try{if(i||!d.match.PSEUDO.test(n)&&!/!=/.test(n)){var s=t.call(e,n);if(s||!r||e.document&&e.document.nodeType!==11)return s}}catch(o){}return h(n,null,null,[e]).length>0}}})();(function(){var e=n.createElement("div");e.innerHTML="<div class='test e'></div><div class='test'></div>";if(!e.getElementsByClassName||e.getElementsByClassName("e").length===0)return;e.lastChild.className="e";if(e.getElementsByClassName("e").length===1)return;d.order.splice(1,0,"CLASS");d.find.CLASS=function(e,t,n){if(typeof t.getElementsByClassName!="undefined"&&!n)return t.getElementsByClassName(e[1])};e=null})();n.documentElement.contains?h.contains=function(e,t){return e!==t&&(e.contains?e.contains(t):!0)}:n.documentElement.compareDocumentPosition?h.contains=function(e,t){return!!(e.compareDocumentPosition(t)&16)}:h.contains=function(){return!1};h.isXML=function(e){var t=(e?e.ownerDocument||e:0).documentElement;return t?t.nodeName!=="HTML":!1};var T=function(e,t,n){var r,i=[],s="",o=t.nodeType?[t]:t;while(r=d.match.PSEUDO.exec(e)){s+=r[0];e=e.replace(d.match.PSEUDO,"")}e=d.relative[e]?e+"*":e;for(var u=0,a=o.length;u<a;u++)h(e,o[u],i,n);return h.filter(s,i)};h.attr=s.attr;h.selectors.attrMap={};s.find=h;s.expr=h.selectors;s.expr[":"]=s.expr.filters;s.unique=h.uniqueSort;s.text=h.getText;s.isXMLDoc=h.isXML;s.contains=h.contains})();var j=/Until$/,F=/^(?:parents|prevUntil|prevAll)/,I=/,/,q=/^.[^:#\[\.,]*$/,R=Array.prototype.slice,U=s.expr.match.globalPOS,z={children:!0,contents:!0,next:!0,prev:!0};s.fn.extend({find:function(e){var t=this,n,r;if(typeof e!="string")return s(e).filter(function(){for(n=0,r=t.length;n<r;n++)if(s.contains(t[n],this))return!0});var i=this.pushStack("","find",e),o,u,a;for(n=0,r=this.length;n<r;n++){o=i.length;s.find(e,this[n],i);if(n>0)for(u=o;u<i.length;u++)for(a=0;a<o;a++)if(i[a]===i[u]){i.splice(u--,1);break}}return i},has:function(e){var t=s(e);return this.filter(function(){for(var e=0,n=t.length;e<n;e++)if(s.contains(this,t[e]))return!0})},not:function(e){return this.pushStack(X(this,e,!1),"not",e)},filter:function(e){return this.pushStack(X(this,e,!0),"filter",e)},is:function(e){return!!e&&(typeof e=="string"?U.test(e)?s(e,this.context).index(this[0])>=0:s.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){var n=[],r,i,o=this[0];if(s.isArray(e)){var u=1;while(o&&o.ownerDocument&&o!==t){for(r=0;r<e.length;r++)s(o).is(e[r])&&n.push({selector:e[r],elem:o,level:u});o=o.parentNode;u++}return n}var a=U.test(e)||typeof e!="string"?s(e,t||this.context):0;for(r=0,i=this.length;r<i;r++){o=this[r];while(o){if(a?a.index(o)>-1:s.find.matchesSelector(o,e)){n.push(o);break}o=o.parentNode;if(!o||!o.ownerDocument||o===t||o.nodeType===11)break}}n=n.length>1?s.unique(n):n;return this.pushStack(n,"closest",e)},index:function(e){return e?typeof e=="string"?s.inArray(this[0],s(e)):s.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(e,t){var n=typeof e=="string"?s(e,t):s.makeArray(e&&e.nodeType?[e]:e),r=s.merge(this.get(),n);return this.pushStack(W(n[0])||W(r[0])?r:s.unique(r))},andSelf:function(){return this.add(this.prevObject)}});s.each({parent:function(e){var t=e.parentNode;return t&&t.nodeType!==11?t:null},parents:function(e){return s.dir(e,"parentNode")},parentsUntil:function(e,t,n){return s.dir(e,"parentNode",n)},next:function(e){return s.nth(e,2,"nextSibling")},prev:function(e){return s.nth(e,2,"previousSibling")},nextAll:function(e){return s.dir(e,"nextSibling")},prevAll:function(e){return s.dir(e,"previousSibling")},nextUntil:function(e,t,n){return s.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return s.dir(e,"previousSibling",n)},siblings:function(e){return s.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return s.sibling(e.firstChild)},contents:function(e){return s.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:s.makeArray(e.childNodes)}},function(e,t){s.fn[e]=function(n,r){var i=s.map(this,t,n);j.test(e)||(r=n);r&&typeof r=="string"&&(i=s.filter(r,i));i=this.length>1&&!z[e]?s.unique(i):i;(this.length>1||I.test(r))&&F.test(e)&&(i=i.reverse());return this.pushStack(i,e,R.call(arguments).join(","))}});s.extend({filter:function(e,t,n){n&&(e=":not("+e+")");return t.length===1?s.find.matchesSelector(t[0],e)?[t[0]]:[]:s.find.matches(e,t)},dir:function(e,n,r){var i=[],o=e[n];while(o&&o.nodeType!==9&&(r===t||o.nodeType!==1||!s(o).is(r))){o.nodeType===1&&i.push(o);o=o[n]}return i},nth:function(e,t,n,r){t=t||1;var i=0;for(;e;e=e[n])if(e.nodeType===1&&++i===t)break;return e},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling)e.nodeType===1&&e!==t&&n.push(e);return n}});var $="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",J=/ jQuery\d+="(?:\d+|null)"/g,K=/^\s+/,Q=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,G=/<([\w:]+)/,Y=/<tbody/i,Z=/<|&#?\w+;/,et=/<(?:script|style)/i,tt=/<(?:script|object|embed|option|style)/i,nt=new RegExp("<(?:"+$+")[\\s/>]","i"),rt=/checked\s*(?:[^=]|=\s*.checked.)/i,it=/\/(java|ecma)script/i,st=/^\s*<!(?:\[CDATA\[|\-\-)/,ot={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},ut=V(n);ot.optgroup=ot.option;ot.tbody=ot.tfoot=ot.colgroup=ot.caption=ot.thead;ot.th=ot.td;s.support.htmlSerialize||(ot._default=[1,"div<div>","</div>"]);s.fn.extend({text:function(e){return s.access(this,function(e){return e===t?s.text(this):this.empty().append((this[0]&&this[0].ownerDocument||n).createTextNode(e))},null,e,arguments.length)},wrapAll:function(e){if(s.isFunction(e))return this.each(function(t){s(this).wrapAll(e.call(this,t))});if(this[0]){var t=s(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]);t.map(function(){var e=this;while(e.firstChild&&e.firstChild.nodeType===1)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return s.isFunction(e)?this.each(function(t){s(this).wrapInner(e.call(this,t))}):this.each(function(){var t=s(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=s.isFunction(e);return this.each(function(n){s(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){s.nodeName(this,"body")||s(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(e){this.nodeType===1&&this.appendChild(e)})},prepend
:function(){return this.domManip(arguments,!0,function(e){this.nodeType===1&&this.insertBefore(e,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this)});if(arguments.length){var e=s.clean(arguments);e.push.apply(e,this.toArray());return this.pushStack(e,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this.nextSibling)});if(arguments.length){var e=this.pushStack(this,"after",arguments);e.push.apply(e,s.clean(arguments));return e}},remove:function(e,t){for(var n=0,r;(r=this[n])!=null;n++)if(!e||s.filter(e,[r]).length){if(!t&&r.nodeType===1){s.cleanData(r.getElementsByTagName("*"));s.cleanData([r])}r.parentNode&&r.parentNode.removeChild(r)}return this},empty:function(){for(var e=0,t;(t=this[e])!=null;e++){t.nodeType===1&&s.cleanData(t.getElementsByTagName("*"));while(t.firstChild)t.removeChild(t.firstChild)}return this},clone:function(e,t){e=e==null?!1:e;t=t==null?e:t;return this.map(function(){return s.clone(this,e,t)})},html:function(e){return s.access(this,function(e){var n=this[0]||{},r=0,i=this.length;if(e===t)return n.nodeType===1?n.innerHTML.replace(J,""):null;if(typeof e=="string"&&!et.test(e)&&(s.support.leadingWhitespace||!K.test(e))&&!ot[(G.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(Q,"<$1></$2>");try{for(;r<i;r++){n=this[r]||{};if(n.nodeType===1){s.cleanData(n.getElementsByTagName("*"));n.innerHTML=e}}n=0}catch(o){}}n&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(e){if(this[0]&&this[0].parentNode){if(s.isFunction(e))return this.each(function(t){var n=s(this),r=n.html();n.replaceWith(e.call(this,t,r))});typeof e!="string"&&(e=s(e).detach());return this.each(function(){var t=this.nextSibling,n=this.parentNode;s(this).remove();t?s(t).before(e):s(n).append(e)})}return this.length?this.pushStack(s(s.isFunction(e)?e():e),"replaceWith",e):this},detach:function(e){return this.remove(e,!0)},domManip:function(e,n,r){var i,o,u,a,f=e[0],l=[];if(!s.support.checkClone&&arguments.length===3&&typeof f=="string"&&rt.test(f))return this.each(function(){s(this).domManip(e,n,r,!0)});if(s.isFunction(f))return this.each(function(i){var o=s(this);e[0]=f.call(this,i,n?o.html():t);o.domManip(e,n,r)});if(this[0]){a=f&&f.parentNode;s.support.parentNode&&a&&a.nodeType===11&&a.childNodes.length===this.length?i={fragment:a}:i=s.buildFragment(e,this,l);u=i.fragment;u.childNodes.length===1?o=u=u.firstChild:o=u.firstChild;if(o){n=n&&s.nodeName(o,"tr");for(var c=0,h=this.length,p=h-1;c<h;c++)r.call(n?at(this[c],o):this[c],i.cacheable||h>1&&c<p?s.clone(u,!0,!0):u)}l.length&&s.each(l,function(e,t){t.src?s.ajax({type:"GET",global:!1,url:t.src,async:!1,dataType:"script"}):s.globalEval((t.text||t.textContent||t.innerHTML||"").replace(st,"/*$0*/"));t.parentNode&&t.parentNode.removeChild(t)})}return this}});s.buildFragment=function(e,t,r){var i,o,u,a,f=e[0];t&&t[0]&&(a=t[0].ownerDocument||t[0]);a.createDocumentFragment||(a=n);if(e.length===1&&typeof f=="string"&&f.length<512&&a===n&&f.charAt(0)==="<"&&!tt.test(f)&&(s.support.checkClone||!rt.test(f))&&(s.support.html5Clone||!nt.test(f))){o=!0;u=s.fragments[f];u&&u!==1&&(i=u)}if(!i){i=a.createDocumentFragment();s.clean(e,a,i,r)}o&&(s.fragments[f]=u?i:1);return{fragment:i,cacheable:o}};s.fragments={};s.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){s.fn[e]=function(n){var r=[],i=s(n),o=this.length===1&&this[0].parentNode;if(o&&o.nodeType===11&&o.childNodes.length===1&&i.length===1){i[t](this[0]);return this}for(var u=0,a=i.length;u<a;u++){var f=(u>0?this.clone(!0):this).get();s(i[u])[t](f);r=r.concat(f)}return this.pushStack(r,e,i.selector)}});s.extend({clone:function(e,t,n){var r,i,o,u=s.support.html5Clone||s.isXMLDoc(e)||!nt.test("<"+e.nodeName+">")?e.cloneNode(!0):dt(e);if((!s.support.noCloneEvent||!s.support.noCloneChecked)&&(e.nodeType===1||e.nodeType===11)&&!s.isXMLDoc(e)){lt(e,u);r=ct(e);i=ct(u);for(o=0;r[o];++o)i[o]&&lt(r[o],i[o])}if(t){ft(e,u);if(n){r=ct(e);i=ct(u);for(o=0;r[o];++o)ft(r[o],i[o])}}r=i=null;return u},clean:function(e,t,r,i){var o,u,a,f=[];t=t||n;typeof t.createElement=="undefined"&&(t=t.ownerDocument||t[0]&&t[0].ownerDocument||n);for(var l=0,c;(c=e[l])!=null;l++){typeof c=="number"&&(c+="");if(!c)continue;if(typeof c=="string")if(!Z.test(c))c=t.createTextNode(c);else{c=c.replace(Q,"<$1></$2>");var h=(G.exec(c)||["",""])[1].toLowerCase(),p=ot[h]||ot._default,d=p[0],v=t.createElement("div"),m=ut.childNodes,g;t===n?ut.appendChild(v):V(t).appendChild(v);v.innerHTML=p[1]+c+p[2];while(d--)v=v.lastChild;if(!s.support.tbody){var y=Y.test(c),b=h==="table"&&!y?v.firstChild&&v.firstChild.childNodes:p[1]==="<table>"&&!y?v.childNodes:[];for(a=b.length-1;a>=0;--a)s.nodeName(b[a],"tbody")&&!b[a].childNodes.length&&b[a].parentNode.removeChild(b[a])}!s.support.leadingWhitespace&&K.test(c)&&v.insertBefore(t.createTextNode(K.exec(c)[0]),v.firstChild);c=v.childNodes;if(v){v.parentNode.removeChild(v);if(m.length>0){g=m[m.length-1];g&&g.parentNode&&g.parentNode.removeChild(g)}}}var w;if(!s.support.appendChecked)if(c[0]&&typeof (w=c.length)=="number")for(a=0;a<w;a++)pt(c[a]);else pt(c);c.nodeType?f.push(c):f=s.merge(f,c)}if(r){o=function(e){return!e.type||it.test(e.type)};for(l=0;f[l];l++){u=f[l];if(i&&s.nodeName(u,"script")&&(!u.type||it.test(u.type)))i.push(u.parentNode?u.parentNode.removeChild(u):u);else{if(u.nodeType===1){var E=s.grep(u.getElementsByTagName("script"),o);f.splice.apply(f,[l+1,0].concat(E))}r.appendChild(u)}}}return f},cleanData:function(e){var t,n,r=s.cache,i=s.event.special,o=s.support.deleteExpando;for(var u=0,a;(a=e[u])!=null;u++){if(a.nodeName&&s.noData[a.nodeName.toLowerCase()])continue;n=a[s.expando];if(n){t=r[n];if(t&&t.events){for(var f in t.events)i[f]?s.event.remove(a,f):s.removeEvent(a,f,t.handle);t.handle&&(t.handle.elem=null)}o?delete a[s.expando]:a.removeAttribute&&a.removeAttribute(s.expando);delete r[n]}}}});var vt=/alpha\([^)]*\)/i,mt=/opacity=([^)]*)/,gt=/([A-Z]|^ms)/g,yt=/^[\-+]?(?:\d*\.)?\d+$/i,bt=/^-?(?:\d*\.)?\d+(?!px)[^\d\s]+$/i,wt=/^([\-+])=([\-+.\de]+)/,Et=/^margin/,St={position:"absolute",visibility:"hidden",display:"block"},xt=["Top","Right","Bottom","Left"],Tt,Nt,Ct;s.fn.css=function(e,n){return s.access(this,function(e,n,r){return r!==t?s.style(e,n,r):s.css(e,n)},e,n,arguments.length>1)};s.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Tt(e,"opacity");return n===""?"1":n}return e.style.opacity}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":s.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,n,r,i){if(!e||e.nodeType===3||e.nodeType===8||!e.style)return;var o,u,a=s.camelCase(n),f=e.style,l=s.cssHooks[a];n=s.cssProps[a]||a;if(r===t)return l&&"get"in l&&(o=l.get(e,!1,i))!==t?o:f[n];u=typeof r;if(u==="string"&&(o=wt.exec(r))){r=+(o[1]+1)*+o[2]+parseFloat(s.css(e,n));u="number"}if(r==null||u==="number"&&isNaN(r))return;u==="number"&&!s.cssNumber[a]&&(r+="px");if(!l||!("set"in l)||(r=l.set(e,r))!==t)try{f[n]=r}catch(c){}},css:function(e,n,r){var i,o;n=s.camelCase(n);o=s.cssHooks[n];n=s.cssProps[n]||n;n==="cssFloat"&&(n="float");if(o&&"get"in o&&(i=o.get(e,!0,r))!==t)return i;if(Tt)return Tt(e,n)},swap:function(e,t,n){var r={},i,s;for(s in t){r[s]=e.style[s];e.style[s]=t[s]}i=n.call(e);for(s in t)e.style[s]=r[s];return i}});s.curCSS=s.css;n.defaultView&&n.defaultView.getComputedStyle&&(Nt=function(e,t){var n,r,i,o,u=e.style;t=t.replace(gt,"-$1").toLowerCase();if((r=e.ownerDocument.defaultView)&&(i=r.getComputedStyle(e,null))){n=i.getPropertyValue(t);n===""&&!s.contains(e.ownerDocument.documentElement,e)&&(n=s.style(e,t))}if(!s.support.pixelMargin&&i&&Et.test(t)&&bt.test(n)){o=u.width;u.width=n;n=i.width;u.width=o}return n});n.documentElement.currentStyle&&(Ct=function(e,t){var n,r,i,s=e.currentStyle&&e.currentStyle[t],o=e.style;s==null&&o&&(i=o[t])&&(s=i);if(bt.test(s)){n=o.left;r=e.runtimeStyle&&e.runtimeStyle.left;r&&(e.runtimeStyle.left=e.currentStyle.left);o.left=t==="fontSize"?"1em":s;s=o.pixelLeft+"px";o.left=n;r&&(e.runtimeStyle.left=r)}return s===""?"auto":s});Tt=Nt||Ct;s.each(["height","width"],function(e,t){s.cssHooks[t]={get:function(e,n,r){if(n)return e.offsetWidth!==0?kt(e,t,r):s.swap(e,St,function(){return kt(e,t,r)})},set:function(e,t){return yt.test(t)?t+"px":t}}});s.support.opacity||(s.cssHooks.opacity={get:function(e,t){return mt.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?parseFloat(RegExp.$1)/100+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=s.isNumeric(t)?"alpha(opacity="+t*100+")":"",o=r&&r.filter||n.filter||"";n.zoom=1;if(t>=1&&s.trim(o.replace(vt,""))===""){n.removeAttribute("filter");if(r&&!r.filter)return}n.filter=vt.test(o)?o.replace(vt,i):o+" "+i}});s(function(){s.support.reliableMarginRight||(s.cssHooks.marginRight={get:function(e,t){return s.swap(e,{display:"inline-block"},function(){return t?Tt(e,"margin-right"):e.style.marginRight})}})});if(s.expr&&s.expr.filters){s.expr.filters.hidden=function(e){var t=e.offsetWidth,n=e.offsetHeight;return t===0&&n===0||!s.support.reliableHiddenOffsets&&(e.style&&e.style.display||s.css(e,"display"))==="none"};s.expr.filters.visible=function(e){return!s.expr.filters.hidden(e)}}s.each({margin:"",padding:"",border:"Width"},function(e,t){s.cssHooks[e+t]={expand:function(n){var r,i=typeof n=="string"?n.split(" "):[n],s={};for(r=0;r<4;r++)s[e+xt[r]+t]=i[r]||i[r-2]||i[0];return s}}});var Lt=/%20/g,At=/\[\]$/,Ot=/\r?\n/g,Mt=/#.*$/,_t=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,Dt=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,Pt=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,Ht=/^(?:GET|HEAD)$/,Bt=/^\/\//,jt=/\?/,Ft=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,It=/^(?:select|textarea)/i,qt=/\s+/,Rt=/([?&])_=[^&]*/,Ut=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,zt=s.fn.load,Wt={},Xt={},Vt,$t,Jt=["*/"]+["*"];try{Vt=i.href}catch(Kt){Vt=n.createElement("a");Vt.href="";Vt=Vt.href}$t=Ut.exec(Vt.toLowerCase())||[];s.fn.extend({load:function(e,n,r){if(typeof e!="string"&&zt)return zt.apply(this,arguments);if(!this.length)return this;var i=e.indexOf(" ");if(i>=0){var o=e.slice(i,e.length);e=e.slice(0,i)}var u="GET";if(n)if(s.isFunction(n)){r=n;n=t}else if(typeof n=="object"){n=s.param(n,s.ajaxSettings.traditional);u="POST"}var a=this;s.ajax({url:e,type:u,dataType:"html",data:n,complete:function(e,t,n){n=e.responseText;if(e.isResolved()){e.done(function(e){n=e});a.html(o?s("<div>").append(n.replace(Ft,"")).find(o):n)}r&&a.each(r,[n,t,e])}});return this},serialize:function(){return s.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?s.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||It.test(this.nodeName)||Dt.test(this.type))}).map(function(e,t){var n=s(this).val();return n==null?null:s.isArray(n)?s.map(n,function(e,n){return{name:t.name,value:e.replace(Ot,"\r\n")}}):{name:t.name,value:n.replace(Ot,"\r\n")}}).get()}});s.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(e,t){s.fn[t]=function(e){return this.on(t,e)}});s.each(["get","post"],function(e,n){s[n]=function(e,r,i,o){if(s.isFunction(r)){o=o||i;i=r;r=t}return s.ajax({type:n,url:e,data:r,success:i,dataType:o})}});s.extend({getScript:function(e,n){return s.get(e,t,n,"script")},getJSON:function(e,t,n){return s.get(e,t,n,"json")},ajaxSetup:function(e,t){if(t)Yt(e,s.ajaxSettings);else{t=e;e=s.ajaxSettings}Yt(e,t);return e},ajaxSettings:{url:Vt,isLocal:Pt.test($t[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":Jt},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":e.String,"text html":!0,"text json":s.parseJSON,"text xml":s.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:Qt(Wt),ajaxTransport:Qt(Xt),ajax:function(e,n){function S(e,n,c,h){if(y===2)return;y=2;m&&clearTimeout(m);v=t;p=h||"";E.readyState=e>0?4:0;var d,g,w,S=n,x=c?en(r,E,c):t,T,N;if(e>=200&&e<300||e===304){if(r.ifModified){if(T=E.getResponseHeader("Last-Modified"))s.lastModified[l]=T;if(N=E.getResponseHeader("Etag"))s.etag[l]=N}if(e===304){S="notmodified";d=!0}else try{g=tn(r,x);S="success";d=!0}catch(C){S="parsererror";w=C}}else{w=S;if(!S||e){S="error";e<0&&(e=0)}}E.status=e;E.statusText=""+(n||S);d?u.resolveWith(i,[g,S,E]):u.rejectWith(i,[E,S,w]);E.statusCode(f);f=t;b&&o.trigger("ajax"+(d?"Success":"Error"),[E,r,d?g:w]);a.fireWith(i,[E,S]);if(b){o.trigger("ajaxComplete",[E,r]);--s.active||s.event.trigger("ajaxStop")}}if(typeof e=="object"){n=e;e=t}n=n||{};var r=s.ajaxSetup({},n),i=r.context||r,o=i!==r&&(i.nodeType||i instanceof s)?s(i):s.event,u=s.Deferred(),a=s.Callbacks("once memory"),f=r.statusCode||{},l,c={},h={},p,d,v,m,g,y=0,b,w,E={readyState:0,setRequestHeader:function(e,t){if(!y){var n=e.toLowerCase();e=h[n]=h[n]||e;c[e]=t}return this},getAllResponseHeaders:function(){return y===2?p:null},getResponseHeader:function(e){var n;if(y===2){if(!d){d={};while(n=_t.exec(p))d[n[1].toLowerCase()]=n[2]}n=d[e.toLowerCase()]}return n===t?null:n},overrideMimeType:function(e){y||(r.mimeType=e);return this},abort:function(e){e=e||"abort";v&&v.abort(e);S(0,e);return this}};u.promise(E);E.success=E.done;E.error=E.fail;E.complete=a.add;E.statusCode=function(e){if(e){var t;if(y<2)for(t in e)f[t]=[f[t],e[t]];else{t=e[E.status];E.then(t,t)}}return this};r.url=((e||r.url)+"").replace(Mt,"").replace(Bt,$t[1]+"//");r.dataTypes=s.trim(r.dataType||"*").toLowerCase().split(qt);if(r.crossDomain==null){g=Ut.exec(r.url.toLowerCase());r.crossDomain=!(!g||g[1]==$t[1]&&g[2]==$t[2]&&(g[3]||(g[1]==="http:"?80:443))==($t[3]||($t[1]==="http:"?80:443)))}r.data&&r.processData&&typeof r.data!="string"&&(r.data=s.param(r.data,r.traditional));Gt(Wt,r,n,E);if(y===2)return!1;b=r.global;r.type=r.type.toUpperCase();r.hasContent=!Ht.test(r.type);b&&s.active++===0&&s.event.trigger("ajaxStart");if(!r.hasContent){if(r.data){r.url+=(jt.test(r.url)?"&":"?")+r.data;delete r.data}l=r.url;if(r.cache===!1){var x=s.now(),T=r.url.replace(Rt,"$1_="+x);r.url=T+(T===r.url?(jt.test(r.url)?"&":"?")+"_="+x:"")}}(r.data&&r.hasContent&&r.contentType!==!1||n.contentType)&&E.setRequestHeader("Content-Type",r.contentType);if(r.ifModified){l=l||r.url;s.lastModified[l]&&E.setRequestHeader("If-Modified-Since",s.lastModified[l]);s.etag[l]&&E.setRequestHeader("If-None-Match",s.etag[l])}E.setRequestHeader("Accept",r.dataTypes[0]&&r.accepts[r.dataTypes[0]]?r.accepts[r.dataTypes[0]]+(r.dataTypes[0]!=="*"?", "+Jt+"; q=0.01":""):r.accepts["*"]);for(w in r.headers)E.setRequestHeader(w,r.headers[w]);if(!r.beforeSend||r.beforeSend.call(i,E,r)!==!1&&y!==2){for(w in{success:1,error:1,complete:1})E[w](r[w]);v=Gt(Xt,r,n,E);if(!v)S(-1,"No Transport");else{E.readyState=1;b&&o.trigger("ajaxSend",[E,r]);r.async&&r.timeout>0&&(m=setTimeout(function(){E.abort("timeout")},r.timeout));try{y=1;v.send(c,S)}catch(N){if(!(y<2))throw N;S(-1,N)}}return E}E.abort();return!1},param:function(e,n){var r=[],i=function(e,t){t=s.isFunction(t)?t():t;r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};n===t&&(n=s.ajaxSettings.traditional);if(s.isArray(e)||e.jquery&&!s.isPlainObject(e))s.each(e,function(){i(this.name,this.value)});else for(var o in e)Zt(o,e[o],n,i);return r.join("&").replace(Lt,"+")}});s.extend({active:0,lastModified:{},etag:{}});var nn=s.now(),rn=/(\=)\?(&|$)|\?\?/i;s.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return s.expando+"_"+nn++}});s.ajaxPrefilter("json jsonp",function(t,n,r){var i=typeof t.data=="string"&&/^application\/x\-www\-form\-urlencoded/.test(t.contentType);if(t.dataTypes[0]==="jsonp"||t.jsonp!==!1&&(rn.test(t.url)||i&&rn.test(t.data))){var o,u=t.jsonpCallback=s.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,a=e[u],f=t.url,l=t.data,c="$1"+u+"$2";if(t.jsonp!==!1){f=f.replace(rn,c);if(t.url===f){i&&(l=l.replace(rn,c));t.data===l&&(f+=(/\?/.test(f)?"&":"?")+t.jsonp+"="+u)}}t.url=f;t.data=l;e[u]=function(e){o=[e]};r.always(function(){e[u]=a;o&&s.isFunction(a)&&e[u](o[0])});t.converters["script json"]=function(){o||s.error(u+" was not called");return o[0]};t.dataTypes[0]="json";return"script"}});s.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(e){s.globalEval(e);return e}}});s.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1);if(e.crossDomain){e.type="GET";e.global=!1}});s.ajaxTransport("script",function(e){if(e.crossDomain){var r,i=n.head||n.getElementsByTagName("head")[0]||n.documentElement;return{send:function(s,o){r=n.createElement("script");r.async="async";e.scriptCharset&&(r.charset=e.scriptCharset);r.src=e.url;r.onload=r.onreadystatechange=function(e,n){if(n||!r.readyState||/loaded|complete/.test(r.readyState)){r.onload=r.onreadystatechange=null;i&&r.parentNode&&i.removeChild(r);r=t;n||o(200,"success")}};i.insertBefore(r,i.firstChild)},abort:function(){r&&r.onload(0,1)}}}});var sn=e.ActiveXObject?function(){for(var e in un)un[e](0,1)}:!1,on=0,un;s.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&an()||fn()}:an;(function(e){s.extend(s.support,{ajax:!!e,cors:!!e&&"withCredentials"in e})})(s.ajaxSettings.xhr());s.support.ajax&&s.ajaxTransport(function(n){if(!n.crossDomain||s.support.cors){var r;return{send:function(i,o){var u=n.xhr(),a,f;n.username?u.open(n.type,n.url,n.async,n.username,n.password):u.open(n.type,n.url,n.async);if(n.xhrFields)for(f in n.xhrFields)u[f]=n.xhrFields[f];n.mimeType&&u.overrideMimeType&&u.overrideMimeType(n.mimeType);!n.crossDomain&&!i["X-Requested-With"]&&(i["X-Requested-With"]="XMLHttpRequest");try{for(f in i)u.setRequestHeader(f,i[f])}catch(l){}u.send(n.hasContent&&n.data||null);r=function(e,i){var f,l,c,h,p;try{if(r&&(i||u.readyState===4)){r=t;if(a){u.onreadystatechange=s.noop;sn&&delete un[a]}if(i)u.readyState!==4&&u.abort();else{f=u.status;c=u.getAllResponseHeaders();h={};p=u.responseXML;p&&p.documentElement&&(h.xml=p);try{h.text=u.responseText}catch(e){}try{l=u.statusText}catch(d){l=""}!f&&n.isLocal&&!n.crossDomain?f=h.text?200:404:f===1223&&(f=204)}}}catch(v){i||o(-1,v)}h&&o(f,l,h,c)};if(!n.async||u.readyState===4)r();else{a=++on;if(sn){if(!un){un={};s(e).unload(sn)}un[a]=r}u.onreadystatechange=r}},abort:function(){r&&r(0,1)}}}});var ln={},cn,hn,pn=/^(?:toggle|show|hide)$/,dn=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,vn,mn=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]],gn;s.fn.extend({show:function(e,t,n){var r,i;if(e||e===0)return this.animate(wn("show",3),e,t,n);for(var o=0,u=this.length;o<u;o++){r=this[o];if(r.style){i=r.style.display;!s._data(r,"olddisplay")&&i==="none"&&(i=r.style.display="");(i===""&&s.css(r,"display")==="none"||!s.contains(r.ownerDocument.documentElement,r))&&s._data(r,"olddisplay",En(r.nodeName))}}for(o=0;o<u;o++){r=this[o];if(r.style){i=r.style.display;if(i===""||i==="none")r.style.display=s._data(r,"olddisplay")||""}}return this},hide:function(e,t,n){if(e||e===0)return this.animate(wn("hide",3),e,t,n);var r,i,o=0,u=this.length;for(;o<u;o++){r=this[o];if(r.style){i=s.css(r,"display");i!=="none"&&!s._data(r,"olddisplay")&&s._data(r,"olddisplay",i)}}for(o=0;o<u;o++)this[o].style&&(this[o].style.display="none");return this},_toggle:s.fn.toggle,toggle:function(e,t,n){var r=typeof e=="boolean";s.isFunction(e)&&s.isFunction(t)?this._toggle.apply(this,arguments):e==null||r?this.each(function(){var t=r?e:s(this).is(":hidden");s(this)[t?"show":"hide"]()}):this.animate(wn("toggle",3),e,t,n);return this},fadeTo:function(e,t,n,r){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){function o(){i.queue===!1&&s._mark(this);var t=s.extend({},i),n=this.nodeType===1,r=n&&s(this).is(":hidden"),o,u,a,f,l,c,h,p,d,v,m;t.animatedProperties={};for(a in e){o=s.camelCase(a);if(a!==o){e[o]=e[a];delete e[a]}if((l=s.cssHooks[o])&&"expand"in l){c=l.expand(e[o]);delete e[o];for(a in c)a in e||(e[a]=c[a])}}for(o in e){u=e[o];if(s.isArray(u)){t.animatedProperties[o]=u[1];u=e[o]=u[0]}else t.animatedProperties[o]=t.specialEasing&&t.specialEasing[o]||t.easing||"swing";if(u==="hide"&&r||u==="show"&&!r)return t.complete.call(this);if(n&&(o==="height"||o==="width")){t.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY];s.css(this,"display")==="inline"&&s.css(this,"float")==="none"&&(!s.support.inlineBlockNeedsLayout||En(this.nodeName)==="inline"?this.style.display="inline-block":this.style.zoom=1)}}t.overflow!=null&&(this.style.overflow="hidden");for(a in e){f=new s.fx(this,t,a);u=e[a];if(pn.test(u)){m=s._data(this,"toggle"+a)||(u==="toggle"?r?"show":"hide":0);if(m){s._data(this,"toggle"+a,m==="show"?"hide":"show");f[m]()}else f[u]()}else{h=dn.exec(u);p=f.cur();if(h){d=parseFloat(h[2]);v=h[3]||(s.cssNumber[a]?"":"px");if(v!=="px"){s.style(this,a,(d||1)+v);p=(d||1)/f.cur()*p;s.style(this,a,p+v)}h[1]&&(d=(h[1]==="-="?-1:1)*d+p);f.custom(p,d,v)}else f.custom(p,u,"")}}return!0}var i=s.speed(t,n,r);if(s.isEmptyObject(e))return this.each(i.complete,[!1]);e=s.extend({},e);return i.queue===!1?this.each(o):this.queue(i.queue,o)},stop:function(e,n,r){if(typeof e!="string"){r=n;n=e;e=t}n&&e!==!1&&this.queue(e||"fx",[]);return this.each(function(){function u(e,t,n){var i=t[n];s.removeData(e,n,!0);i.stop(r)}var t,n=!1,i=s.timers,o=s._data(this);r||s._unmark(!0,this);if(e==null)for(t in o)o[t]&&o[t].stop&&t.indexOf(".run")===t.length-4&&u(this,o,t);else o[t=e+".run"]&&o[t].stop&&u(this,o,t);for(t=i.length;t--;)if(i[t].elem===this&&(e==null||i[t].queue===e)){r?i[t](!0):i[t].saveState();n=!0;i.splice(t,1)}(!r||!n)&&s.dequeue(this,e)})}});s.each({slideDown:wn("show",1),slideUp:wn("hide",1),slideToggle:wn("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){s.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}});s.extend({speed:function(e,t,n){var r=e&&typeof e=="object"?s.extend({},e):{complete:n||!n&&t||s.isFunction(e)&&e,duration:e,easing:n&&t||t&&!s.isFunction(t)&&t};r.duration=s.fx.off?0:typeof r.duration=="number"?r.duration:r.duration in s.fx.speeds?s.fx.speeds[r.duration]:s.fx.speeds._default;if(r.queue==null||r.queue===!0)r.queue="fx";r.old=r.complete;r.complete=function(e){s.isFunction(r.old)&&r.old.call(this);r.queue?s.dequeue(this,r.queue):e!==!1&&s._unmark(this)};return r},easing:{linear:function(e){return e},swing:function(e){return-Math.cos(e*Math.PI)/2+.5}},timers:[],fx:function(e,t,n){this.options=t;this.elem=e;this.prop=n;t.orig=t.orig||{}}});s.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this);(s.fx.step[this.prop]||s.fx.step._default)(this)},cur:function(){if(this.elem[this.prop]==null||!!this.elem.style&&this.elem.style[this.prop]!=null){var e,t=s.css(this.elem,this.prop);return isNaN(e=parseFloat(t))?!t||t==="auto"?0:t:e}return this.elem[this.prop]},custom:function(e,n,r){function u(e){return i.step(e)}var i=this,o=s.fx;this.startTime=gn||yn();this.end=n;this.now=this.start=e;this.pos=this.state=0;this.unit=r||this.unit||(s.cssNumber[this.prop]?"":"px");u.queue=this.options.queue;u.elem=this.elem;u.saveState=function(){s._data(i.elem,"fxshow"+i.prop)===t&&(i.options.hide?s._data(i.elem,"fxshow"+i.prop,i.start):i.options.show&&s._data(i.elem,"fxshow"+i.prop,i.end))};u()&&s.timers.push(u)&&!vn&&(vn=setInterval(o.tick,o.interval))},show:function(){var e=s._data(this.elem,"fxshow"+this.prop);this.options.orig[this.prop]=e||s.style(this.elem,this.prop);this.options.show=!0;e!==t?this.custom(this.cur(),e):this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur());s(this.elem).show()},hide:function(){this.options.orig[this.prop]=s._data(this.elem,"fxshow"+this.prop)||s.style(this.elem,this.prop);this.options.hide=!0;this.custom(this.cur(),0)},step:function(e){var t,n,r,i=gn||yn(),o=!0,u=this.elem,a=this.options;if(e||i>=a.duration+this.startTime){this.now=this.end;this.pos=this.state=1;this.update();a.animatedProperties[this.prop]=!0;for(t in a.animatedProperties)a.animatedProperties[t]!==!0&&(o=!1);if(o){a.overflow!=null&&!s.support.shrinkWrapBlocks&&s.each(["","X","Y"],function(e,t){u.style["overflow"+t]=a.overflow[e]});a.hide&&s(u).hide();if(a.hide||a.show)for(t in a.animatedProperties){s.style(u,t,a.orig[t]);s.removeData(u,"fxshow"+t,!0);s.removeData(u,"toggle"+t,!0)}r=a.complete;if(r){a.complete=!1;r.call(u)}}return!1}if(a.duration==Infinity)this.now=i;else{n=i-this.startTime;this.state=n/a.duration;this.pos=s.easing[a.animatedProperties[this.prop]](this.state,n,0,1,a.duration);this.now=this.start+(this.end-this.start)*this.pos}this.update();return!0}};s.extend(s.fx,{tick:function(){var e,t=s.timers,n=0;for(;n<t.length;n++){e=t[n];!e()&&t[n]===e&&t.splice(n--,1)}t.length||s.fx.stop()},interval:13,stop:function(){clearInterval(vn);vn=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(e){s.style(e.elem,"opacity",e.now)},_default:function(e){e.elem.style&&e.elem.style[e.prop]!=null?e.elem.style[e.prop]=e.now+e.unit:e.elem[e.prop]=e.now}}});s.each(mn.concat.apply([],mn),function(e,t){t.indexOf("margin")&&(s.fx.step[t]=function(e){s.style(e.elem,t,Math.max(0,e.now)+e.unit)})});s.expr&&s.expr.filters&&(s.expr.filters.animated=function(e){return s.grep(s.timers,function(t){return e===t.elem}).length});var Sn,xn=/^t(?:able|d|h)$/i,Tn=/^(?:body|html)$/i;"getBoundingClientRect"in n.documentElement?Sn=function(e,t,n,r){try{r=e.getBoundingClientRect()}catch(i){}if(!r||!s.contains(n,e))return r?{top:r.top,left:r.left}:{top:0,left:0};var o=t.body,u=Nn(t),a=n.clientTop||o.clientTop||0,f=n.clientLeft||o.clientLeft||0,l=u.pageYOffset||s.support.boxModel&&n.scrollTop||o.scrollTop,c=u.pageXOffset||s.support.boxModel&&n.scrollLeft||o.scrollLeft,h=r.top+l-a,p=r.left+c-f;return{top:h,left:p}}:Sn=function(e,t,n){var r,i=e.offsetParent,o=e,u=t.body,a=t.defaultView,f=a?a.getComputedStyle(e,null):e.currentStyle,l=e.offsetTop,c=e.offsetLeft;while((e=e.parentNode)&&e!==u&&e!==n){if(s.support.fixedPosition&&f.position==="fixed")break;r=a?a.getComputedStyle(e,null):e.currentStyle;l-=e.scrollTop;c-=e.scrollLeft;if(e===i){l+=e.offsetTop;c+=e.offsetLeft;if(s.support.doesNotAddBorder&&(!s.support.doesAddBorderForTableAndCells||!xn.test(e.nodeName))){l+=parseFloat(r.borderTopWidth)||0;c+=parseFloat(r.borderLeftWidth)||0}o=i;i=e.offsetParent}if(s.support.subtractsBorderForOverflowNotVisible&&r.overflow!=="visible"){l+=parseFloat(r.borderTopWidth)||0;c+=parseFloat(r.borderLeftWidth)||0}f=r}if(f.position==="relative"||f.position==="static"){l+=u.offsetTop;c+=u.offsetLeft}if(s.support.fixedPosition&&f.position==="fixed"){l+=Math.max(n.scrollTop,u.scrollTop);c+=Math.max(n.scrollLeft,u.scrollLeft)}return{top:l,left:c}};s.fn.offset=function(e){if(arguments.length)return e===t?this:this.each(function(t){s.offset.setOffset(this,e,t)});var n=this[0],r=n&&n.ownerDocument;return r?n===r.body?s.offset.bodyOffset(n):Sn(n,r,r.documentElement):null};s.offset={bodyOffset:function(e){var t=e.offsetTop,n=e.offsetLeft;if(s.support.doesNotIncludeMarginInBodyOffset){t+=parseFloat(s.css(e,"marginTop"))||0;n+=parseFloat(s.css(e,"marginLeft"))||0}return{top:t,left:n}},setOffset:function(e,t,n){var r=s.css(e,"position");r==="static"&&(e.style.position="relative");var i=s(e),o=i.offset(),u=s.css(e,"top"),a=s.css(e,"left"),f=(r==="absolute"||r==="fixed")&&s.inArray("auto",[u,a])>-1,l={},c={},h,p;if(f){c=i.position();h=c.top;p=c.left}else{h=parseFloat(u)||0;p=parseFloat(a)||0}s.isFunction(t)&&(t=t.call(e,n,o));t.top!=null&&(l.top=t.top-o.top+h);t.left!=null&&(l.left=t.left-o.left+p);"using"in t?t.using.call(e,l):i.css(l)}};s.fn.extend({position:function(){if(!this[0])return null;var e=this[0],t=this.offsetParent(),n=this.offset(),r=Tn.test(t[0].nodeName)?{top:0,left:0}:t.offset();n.top-=parseFloat(s.css(e,"marginTop"))||0;n.left-=parseFloat(s.css(e,"marginLeft"))||0;r.top+=parseFloat(s.css(t[0],"borderTopWidth"))||0;r.left+=parseFloat(s.css(t[0],"borderLeftWidth"))||0;return{top:n.top-r.top,left:n.left-r.left}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||n.body;while(e&&!Tn.test(e.nodeName)&&s.css(e,"position")==="static")e=e.offsetParent;return e})}});s.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,n){var r=/Y/.test(n);s.fn[e]=function(i){return s.access(this,function(e,i,o){var u=Nn(e);if(o===t)return u?n in u?u[n]:s.support.boxModel&&u.document.documentElement[i]||u.document.body[i]:e[i];u?u.scrollTo(r?s(u).scrollLeft():o,r?o:s(u).scrollTop()):e[i]=o},e,i,arguments.length,null)}});s.each({Height:"height",Width:"width"},function(e,n){var r="client"+e,i="scroll"+e,o="offset"+e;s.fn["inner"+e]=function(){var e=this[0];return e?e.style?parseFloat(s.css(e,n,"padding")):this[n]():null};s.fn["outer"+e]=function(e){var t=this[0];return t?t.style?parseFloat(s.css(t,n,e?"margin":"border")):this[n]():null};s.fn[n]=function(e){return s.access(this,function(e,n,u){var a,f,l,c;if(s.isWindow(e)){a=e.document;f=a.documentElement[r];return s.support.boxModel&&f||a.body&&a.body[r]||f}if(e.nodeType===9){a=e.documentElement;return a[r]>=a[i]?a[r]:Math.max(e.body[i],a[i],e.body[o],a[o])}if(u===t){l=s.css(e,n);c=parseFloat(l);return s.isNumeric(c)?c:l}s(e).css(n,u)},n,e,arguments.length,null)}});e.jQuery=e.$=s;typeof define=="function"&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return s})})(window);(function(e){function b(e){return Object.prototype.toString.call(e)=="[object Function]"}function w(e){return Object.prototype.toString.call(e)=="[object Array]"}function E(e,t){var n=/^\w+\:\/\//;/^\/\/\/?/.test(e)?e=location.protocol+e:!n.test(e)&&e.charAt(0)!="/"&&(e=(t||"")+e);return n.test(e)?e:(e.charAt(0)=="/"?f:a)+e}function S(e,t){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function x(e){var t=!1;for(var n=0;n<e.scripts.length;n++)if(e.scripts[n].ready&&e.scripts[n].exec_trigger){t=!0;e.scripts[n].exec_trigger();e.scripts[n].exec_trigger=null}return t}function T(e,t,n,r){e.onload=e.onreadystatechange=function(){if(e.readyState&&e.readyState!="complete"&&e.readyState!="loaded"||t[n])return;e.onload=e.onreadystatechange=null;r()}}function N(e){e.ready=e.finished=!0;for(var t=0;t<e.finished_listeners.length;t++)e.finished_listeners[t]();e.ready_listeners=[];e.finished_listeners=[]}function C(e,t,r,i,s){setTimeout(function(){var u,a=t.real_src,c;if("item"in l){if(!l[0]){setTimeout(arguments.callee,25);return}l=l[0]}u=document.createElement("script");t.type&&(u.type=t.type);t.charset&&(u.charset=t.charset);if(s)if(m){e[o]&&h("start script preload: "+a);r.elem=u;if(v){u.preload=!0;u.onpreload=i}else u.onreadystatechange=function(){u.readyState=="loaded"&&i()};u.src=a}else if(s&&a.indexOf(f)==0&&e[n]){c=new XMLHttpRequest;e[o]&&h("start script preload (xhr): "+a);c.onreadystatechange=function(){if(c.readyState==4){c.onreadystatechange=function(){};r.text=c.responseText+"\n//@ sourceURL="+a;i()}};c.open("GET",a);c.send()}else{e[o]&&h("start script preload (cache): "+a);u.type="text/cache-script";T(u,r,"ready",function(){l.removeChild(u);i()});u.src=a;l.insertBefore(u,l.firstChild)}else if(g){e[o]&&h("start script load (ordered async): "+a);u.async=!1;T(u,r,"finished",i);u.src=a;l.insertBefore(u,l.firstChild)}else{e[o]&&h("start script load: "+a);T(u,r,"finished",i);u.src=a;l.insertBefore(u,l.firstChild)}},0)}function k(){function g(e,t,n){function s(){if(r!=null){r=null;N(n)}}var r;if(d[t.src].finished)return;e[i]||(d[t.src].finished=!0);r=n.elem||document.createElement("script");t.type&&(r.type=t.type);t.charset&&(r.charset=t.charset);T(r,n,"finished",s);if(n.elem)n.elem=null;else if(n.text){r.onload=r.onreadystatechange=null;r.text=n.text}else r.src=t.real_src;l.insertBefore(r,l.firstChild);n.text&&s()}function L(e,t,n,r){var o,a,f=function(){t.ready_cb(t,function(){g(e,t,o)})},l=function(){t.finished_cb(t,n)};t.src=E(t.src,e[u]);t.real_src=t.src+(e[s]?(/\?.*$/.test(t.src)?"&_":"?_")+~~(Math.random()*1e9)+"=":"");d[t.src]||(d[t.src]={items:[],finished:!1});a=d[t.src].items;if(e[i]||a.length==0){o=a[a.length]={ready:!1,finished:!1,ready_listeners:[f],finished_listeners:[l]};C(e,t,o,r?function(){o.ready=!0;for(var e=0;e<o.ready_listeners
.length;e++)o.ready_listeners[e]();o.ready_listeners=[]}:function(){N(o)},r)}else{o=a[0];o.finished?l():o.finished_listeners.push(l)}}function A(){function l(e,n){t[o]&&h("script preload finished: "+e.real_src);e.ready=!0;e.exec_trigger=n;d()}function c(e,n){t[o]&&h("script execution finished: "+e.real_src);e.ready=e.finished=!0;e.exec_trigger=null;for(var r=0;r<n.scripts.length;r++)if(!n.scripts[r].finished)return;n.finished=!0;d()}function d(){while(i<n.length){if(b(n[i])){t[o]&&h("$LAB.wait() executing: "+n[i]);try{n[i++]()}catch(e){t[o]&&p("$LAB.wait() error caught: ",e)}continue}if(!n[i].finished){if(x(n[i]))continue;break}i++}if(i==n.length){s=!1;u=!1}}function v(){(!u||!u.scripts)&&n.push(u={scripts:[],finished:!0})}var e,t=S(a,{}),n=[],i=0,s=!1,u;e={script:function(){for(var n=0;n<arguments.length;n++)(function(n,i){var o;w(n)||(i=[n]);for(var a=0;a<i.length;a++){v();n=i[a];b(n)&&(n=n());if(!n)continue;if(w(n)){o=[].slice.call(n);o.unshift(a,1);[].splice.apply(i,o);a--;continue}typeof n=="string"&&(n={src:n});n=S(n,{ready:!1,ready_cb:l,finished:!1,finished_cb:c});u.finished=!1;u.scripts.push(n);L(t,n,u,f&&s);s=!0;t[r]&&e.wait()}})(arguments[n],arguments[n]);return e},wait:function(){if(arguments.length>0){for(var t=0;t<arguments.length;t++)n.push(arguments[t]);u=n[n.length-1]}else u=!1;d();return e}};return{script:e.script,wait:e.wait,setOptions:function(n){S(n,t);return e}}}var a={},f=m||y,c=[],d={},v;a[n]=!0;a[r]=!1;a[i]=!1;a[s]=!1;a[o]=!1;a[u]="";v={setGlobalDefaults:function(e){S(e,a);return v},setOptions:function(){return A().setOptions.apply(null,arguments)},script:function(){return A().script.apply(null,arguments)},wait:function(){return A().wait.apply(null,arguments)},queueScript:function(){c[c.length]={type:"script",args:[].slice.call(arguments)};return v},queueWait:function(){c[c.length]={type:"wait",args:[].slice.call(arguments)};return v},runQueue:function(){var e=v,t=c.length,n=t,r;for(;--n>=0;){r=c.shift();e=e[r.type].apply(null,r.args)}return e},noConflict:function(){e.$LAB=t;return v},sandbox:function(){return k()}};return v}var t=e.$LAB,n="UseLocalXHR",r="AlwaysPreserveOrder",i="AllowDuplicates",s="CacheBust",o="Debug",u="BasePath",a=/^[^?#]*\//.exec(location.href)[0],f=/^\w+\:\/\/\/?[^\/]+/.exec(a)[0],l=document.head||document.getElementsByTagName("head"),c=e.opera&&Object.prototype.toString.call(e.opera)=="[object Opera]"||"MozAppearance"in document.documentElement.style,h=function(){},p=h,d=document.createElement("script"),v=typeof d.preload=="boolean",m=v||d.readyState&&d.readyState=="uninitialized",g=!m&&d.async===!0,y=!m&&!g&&!c;if(e.console&&e.console.log){e.console.error||(e.console.error=e.console.log);h=function(t){e.console.log(t)};p=function(t,n){e.console.error(t,n)}}e.$LAB=k();(function(e,t,n){if(document.readyState==null&&document[e]){document.readyState="loading";document[e](t,n=function(){document.removeEventListener(t,n,!1);document.readyState="complete"},!1)}})("addEventListener","DOMContentLoaded")})(this);var Exhibit={version:"3.0.0rc1",namespace:"http://simile.mit.edu/2006/11/exhibit#",locales:[],loaded:!1,signals:{"loadExtensions.exhibit":!1,"exhibitConfigured.exhibit":!1},urlPrefix:"js/",params:{bundle:!0,autoCreate:!1,safe:!1,babel:undefined,backstage:undefined,locale:undefined},Extension:{},loader:null,scripts:[],styles:[],registry:null};Exhibit.parseURLParameters=function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p,d;t=t||{};n=n||{};typeof e=="undefined"&&(e=document.location.href);r=e.indexOf("?");if(r<0)return t;e=(e+"#").slice(r+1,e.indexOf("#"));o=e.split("&");s={};u=window.decodeURIComponent||unescape;for(a=0;a<o.length;a++){i=o[a];f=i.indexOf("=");l=u(i.slice(0,f));c=s[l];h=u(i.slice(f+1));typeof c=="undefined"?c=[]:c instanceof Array||(c=[c]);s[l]=c.concat(h)}for(a in s)if(s.hasOwnProperty(a)){p=n[a]||String;d=s[a];d instanceof Array||(d=[d]);p===Boolean&&d[0]==="false"?t[a]=!1:t[a]=p.apply(this,d)}return t};$LAB.setGlobalDefaults({AlwaysPreserveOrder:!0,UseLocalXHR:!1,AllowDuplicates:!1});Exhibit.loader=$LAB.setOptions({AlwaysPreserveOrder:!0});var Base64=function(){function e(e){var t="",r,i,s,o,u,a,f;for(var l=0;l<e.length;){r=e.charCodeAt(l++);i=e.charCodeAt(l++);s=e.charCodeAt(l++);o=r>>2;u=((r&3)<<4)+(i>>4);a=((i&15)<<2)+(s>>6);f=s&63;isNaN(i)?a=f=64:isNaN(s)&&(f=64);t+=n.charAt(o)+n.charAt(u)+n.charAt(a)+n.charAt(f)}return t}function t(e){var t="",r,i,s,o,u,a,f;for(var l=0;l<e.length;){o=n.indexOf(e.charAt(l++));u=n.indexOf(e.charAt(l++));a=n.indexOf(e.charAt(l++));f=n.indexOf(e.charAt(l++));r=(o<<2)+(u>>4);i=((u&15)<<4)+(a>>2);s=((a&3)<<6)+f;t+=String.fromCharCode(r);a!=64&&(t+=String.fromCharCode(i));f!=64&&(t+=String.fromCharCode(s))}return t}var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=";return{encode:e,decode:t}}(),sprintf=function(){function e(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function t(e,t){for(var n=[];t>0;n[--t]=e);return n.join("")}var n=function(){n.cache.hasOwnProperty(arguments[0])||(n.cache[arguments[0]]=n.parse(arguments[0]));return n.format.call(null,n.cache[arguments[0]],arguments)};n.format=function(n,r){var i=1,s=n.length,o="",u,a=[],f,l,c,h,p,d;for(f=0;f<s;f++){o=e(n[f]);if(o==="string")a.push(n[f]);else if(o==="array"){c=n[f];if(c[2]){u=r[i];for(l=0;l<c[2].length;l++){if(!u.hasOwnProperty(c[2][l]))throw sprintf('[sprintf] property "%s" does not exist',c[2][l]);u=u[c[2][l]]}}else c[1]?u=r[c[1]]:u=r[i++];if(/[^s]/.test(c[8])&&e(u)!="number")throw sprintf("[sprintf] expecting number but found %s",e(u));switch(c[8]){case"b":u=u.toString(2);break;case"c":u=String.fromCharCode(u);break;case"d":u=parseInt(u,10);break;case"e":u=c[7]?u.toExponential(c[7]):u.toExponential();break;case"f":u=c[7]?parseFloat(u).toFixed(c[7]):parseFloat(u);break;case"o":u=u.toString(8);break;case"s":u=(u=String(u))&&c[7]?u.substring(0,c[7]):u;break;case"u":u=Math.abs(u);break;case"x":u=u.toString(16);break;case"X":u=u.toString(16).toUpperCase()}u=/[def]/.test(c[8])&&c[3]&&u>=0?"+"+u:u;p=c[4]?c[4]=="0"?"0":c[4].charAt(1):" ";d=c[6]-String(u).length;h=c[6]?t(p,d):"";a.push(c[5]?u+h:h+u)}}return a.join("")};n.cache={};n.parse=function(e){var t=e,n=[],r=[],i=0;while(t){if((n=/^[^\x25]+/.exec(t))!==null)r.push(n[0]);else if((n=/^\x25{2}/.exec(t))!==null)r.push("%");else{if((n=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(t))===null)throw"[sprintf] huh?";if(n[2]){i|=1;var s=[],o=n[2],u=[];if((u=/^([a-z_][a-z_\d]*)/i.exec(o))===null)throw"[sprintf] huh?";s.push(u[1]);while((o=o.substring(u[0].length))!=="")if((u=/^\.([a-z_][a-z_\d]*)/i.exec(o))!==null)s.push(u[1]);else{if((u=/^\[(\d+)\]/.exec(o))===null)throw"[sprintf] huh?";s.push(u[1])}n[2]=s}else i|=2;if(i===3)throw"[sprintf] mixing positional and named placeholders is not (yet) supported";r.push(n)}t=t.substring(n[0].length)}return r};return n}(),vsprintf=function(e,t){t.unshift(e);return sprintf.apply(null,t)};(function(e,t){"use strict";var n=e.History=e.History||{},r=e.jQuery;if(typeof n.Adapter!="undefined")throw new Error("History.js Adapter has already been loaded...");n.Adapter={bind:function(e,t,n){r(e).bind(t,n)},trigger:function(e,t,n){r(e).trigger(t,n)},extractEventData:function(e,n,r){var i=n&&n.originalEvent&&n.originalEvent[e]||r&&r[e]||t;return i},onDomLoad:function(e){r(e)}};typeof n.init!="undefined"&&n.init()})(window);(function(e,t){"use strict";var n=e.document,r=e.setTimeout||r,i=e.clearTimeout||i,s=e.setInterval||s,o=e.History=e.History||{};if(typeof o.initHtml4!="undefined")throw new Error("History.js HTML4 Support has already been loaded...");o.initHtml4=function(){if(typeof o.initHtml4.initialized!="undefined")return!1;o.initHtml4.initialized=!0;o.enabled=!0;o.savedHashes=[];o.isLastHash=function(e){var t=o.getHashByIndex(),n;n=e===t;return n};o.saveHash=function(e){if(o.isLastHash(e))return!1;o.savedHashes.push(e);return!0};o.getHashByIndex=function(e){var t=null;typeof e=="undefined"?t=o.savedHashes[o.savedHashes.length-1]:e<0?t=o.savedHashes[o.savedHashes.length+e]:t=o.savedHashes[e];return t};o.discardedHashes={};o.discardedStates={};o.discardState=function(e,t,n){var r=o.getHashByState(e),i;i={discardedState:e,backState:n,forwardState:t};o.discardedStates[r]=i;return!0};o.discardHash=function(e,t,n){var r={discardedHash:e,backState:n,forwardState:t};o.discardedHashes[e]=r;return!0};o.discardedState=function(e){var t=o.getHashByState(e),n;n=o.discardedStates[t]||!1;return n};o.discardedHash=function(e){var t=o.discardedHashes[e]||!1;return t};o.recycleState=function(e){var t=o.getHashByState(e);o.discardedState(e)&&delete o.discardedStates[t];return!0};if(o.emulated.hashChange){o.hashChangeInit=function(){o.checkerFunction=null;var t="",r,i,u,a;if(o.isInternetExplorer()){r="historyjs-iframe";i=n.createElement("iframe");i.setAttribute("id",r);i.style.display="none";n.body.appendChild(i);i.contentWindow.document.open();i.contentWindow.document.close();u="";a=!1;o.checkerFunction=function(){if(a)return!1;a=!0;var n=o.getHash()||"",r=o.unescapeHash(i.contentWindow.document.location.hash)||"";if(n!==t){t=n;if(r!==n){u=r=n;i.contentWindow.document.open();i.contentWindow.document.close();i.contentWindow.document.location.hash=o.escapeHash(n)}o.Adapter.trigger(e,"hashchange")}else if(r!==u){u=r;o.setHash(r,!1)}a=!1;return!0}}else o.checkerFunction=function(){var n=o.getHash();if(n!==t){t=n;o.Adapter.trigger(e,"hashchange")}return!0};o.intervalList.push(s(o.checkerFunction,o.options.hashChangeInterval));return!0};o.Adapter.onDomLoad(o.hashChangeInit)}if(o.emulated.pushState){o.onHashChange=function(t){var r=t&&t.newURL||n.location.href,i=o.getHashByUrl(r),s=null,u=null,a=null,f;if(o.isLastHash(i)){o.busy(!1);return!1}o.doubleCheckComplete();o.saveHash(i);if(i&&o.isTraditionalAnchor(i)){o.Adapter.trigger(e,"anchorchange");o.busy(!1);return!1}s=o.extractState(o.getFullUrl(i||n.location.href,!1),!0);if(o.isLastSavedState(s)){o.busy(!1);return!1}u=o.getHashByState(s);f=o.discardedState(s);if(f){o.getHashByIndex(-2)===o.getHashByState(f.forwardState)?o.back(!1):o.forward(!1);return!1}o.pushState(s.data,s.title,s.url,!1);return!0};o.Adapter.bind(e,"hashchange",o.onHashChange);o.pushState=function(t,r,i,s){if(o.getHashByUrl(i))throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(s!==!1&&o.busy()){o.pushQueue({scope:o,callback:o.pushState,args:arguments,queue:s});return!1}o.busy(!0);var u=o.createStateObject(t,r,i),a=o.getHashByState(u),f=o.getState(!1),l=o.getHashByState(f),c=o.getHash();o.storeState(u);o.expectedStateId=u.id;o.recycleState(u);o.setTitle(u);if(a===l){o.busy(!1);return!1}if(a!==c&&a!==o.getShortUrl(n.location.href)){o.setHash(a,!1);return!1}o.saveState(u);o.Adapter.trigger(e,"statechange");o.busy(!1);return!0};o.replaceState=function(e,t,n,r){if(o.getHashByUrl(n))throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(r!==!1&&o.busy()){o.pushQueue({scope:o,callback:o.replaceState,args:arguments,queue:r});return!1}o.busy(!0);var i=o.createStateObject(e,t,n),s=o.getState(!1),u=o.getStateByIndex(-2);o.discardState(s,i,u);o.pushState(i.data,i.title,i.url,!1);return!0}}o.emulated.pushState&&o.getHash()&&!o.emulated.hashChange&&o.Adapter.onDomLoad(function(){o.Adapter.trigger(e,"hashchange")})};typeof o.init!="undefined"&&o.init()})(window);(function(e,t){"use strict";var n=e.console||t,r=e.document,i=e.navigator,s=e.sessionStorage||!1,o=e.setTimeout,u=e.clearTimeout,a=e.setInterval,f=e.clearInterval,l=e.JSON,c=e.alert,h=e.History=e.History||{},p=e.history;l.stringify=l.stringify||l.encode;l.parse=l.parse||l.decode;if(typeof h.init!="undefined")throw new Error("History.js Core has already been loaded...");h.init=function(){if(typeof h.Adapter=="undefined")return!1;typeof h.initCore!="undefined"&&h.initCore();typeof h.initHtml4!="undefined"&&h.initHtml4();return!0};h.initCore=function(){if(typeof h.initCore.initialized!="undefined")return!1;h.initCore.initialized=!0;h.options=h.options||{};h.options.hashChangeInterval=h.options.hashChangeInterval||100;h.options.safariPollInterval=h.options.safariPollInterval||500;h.options.doubleCheckInterval=h.options.doubleCheckInterval||500;h.options.storeInterval=h.options.storeInterval||1e3;h.options.busyDelay=h.options.busyDelay||250;h.options.debug=h.options.debug||!1;h.options.initialTitle=h.options.initialTitle||r.title;h.intervalList=[];h.clearAllIntervals=function(){var e,t=h.intervalList;if(typeof t!="undefined"&&t!==null){for(e=0;e<t.length;e++)f(t[e]);h.intervalList=null}};h.debug=function(){(h.options.debug||!1)&&h.log.apply(h,arguments)};h.log=function(){var e=typeof n!="undefined"&&typeof n.log!="undefined"&&typeof n.log.apply!="undefined",t=r.getElementById("log"),i,s,o,u,a;if(e){u=Array.prototype.slice.call(arguments);i=u.shift();typeof n.debug!="undefined"?n.debug.apply(n,[i,u]):n.log.apply(n,[i,u])}else i="\n"+arguments[0]+"\n";for(s=1,o=arguments.length;s<o;++s){a=arguments[s];if(typeof a=="object"&&typeof l!="undefined")try{a=l.stringify(a)}catch(f){}i+="\n"+a+"\n"}if(t){t.value+=i+"\n-----\n";t.scrollTop=t.scrollHeight-t.clientHeight}else e||c(i);return!0};h.getInternetExplorerMajorVersion=function(){var e=h.getInternetExplorerMajorVersion.cached=typeof h.getInternetExplorerMajorVersion.cached!="undefined"?h.getInternetExplorerMajorVersion.cached:function(){var e=3,t=r.createElement("div"),n=t.getElementsByTagName("i");while((t.innerHTML="<!--[if gt IE "+ ++e+"]><i></i><![endif]-->")&&n[0]);return e>4?e:!1}();return e};h.isInternetExplorer=function(){var e=h.isInternetExplorer.cached=typeof h.isInternetExplorer.cached!="undefined"?h.isInternetExplorer.cached:Boolean(h.getInternetExplorerMajorVersion());return e};h.emulated={pushState:!Boolean(e.history&&e.history.pushState&&e.history.replaceState&&!/ Mobile\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i.test(i.userAgent)&&!/AppleWebKit\/5([0-2]|3[0-2])/i.test(i.userAgent)),hashChange:Boolean(!("onhashchange"in e||"onhashchange"in r)||h.isInternetExplorer()&&h.getInternetExplorerMajorVersion()<8)};h.enabled=!h.emulated.pushState;h.bugs={setHash:Boolean(!h.emulated.pushState&&i.vendor==="Apple Computer, Inc."&&/AppleWebKit\/5([0-2]|3[0-3])/.test(i.userAgent)),safariPoll:Boolean(!h.emulated.pushState&&i.vendor==="Apple Computer, Inc."&&/AppleWebKit\/5([0-2]|3[0-3])/.test(i.userAgent)),ieDoubleCheck:Boolean(h.isInternetExplorer()&&h.getInternetExplorerMajorVersion()<8),hashEscape:Boolean(h.isInternetExplorer()&&h.getInternetExplorerMajorVersion()<7)};h.isEmptyObject=function(e){for(var t in e)return!1;return!0};h.cloneObject=function(e){var t,n;if(e){t=l.stringify(e);n=l.parse(t)}else n={};return n};h.getRootUrl=function(){var e=r.location.protocol+"//"+(r.location.hostname||r.location.host);if(r.location.port||!1)e+=":"+r.location.port;e+="/";return e};h.getBaseHref=function(){var e=r.getElementsByTagName("base"),t=null,n="";if(e.length===1){t=e[0];n=t.href.replace(/[^\/]+$/,"")}n=n.replace(/\/+$/,"");n&&(n+="/");return n};h.getBaseUrl=function(){var e=h.getBaseHref()||h.getBasePageUrl()||h.getRootUrl();return e};h.getPageUrl=function(){var e=h.getState(!1,!1),t=(e||{}).url||r.location.href,n;n=t.replace(/\/+$/,"").replace(/[^\/]+$/,function(e,t,n){return/\./.test(e)?e:e+"/"});return n};h.getBasePageUrl=function(){var e=r.location.href.replace(/[#\?].*/,"").replace(/[^\/]+$/,function(e,t,n){return/[^\/]$/.test(e)?"":e}).replace(/\/+$/,"")+"/";return e};h.getFullUrl=function(e,t){var n=e,r=e.substring(0,1);t=typeof t=="undefined"?!0:t;/[a-z]+\:\/\//.test(e)||(r==="/"?n=h.getRootUrl()+e.replace(/^\/+/,""):r==="#"?n=h.getPageUrl().replace(/#.*/,"")+e:r==="?"?n=h.getPageUrl().replace(/[\?#].*/,"")+e:t?n=h.getBaseUrl()+e.replace(/^(\.\/)+/,""):n=h.getBasePageUrl()+e.replace(/^(\.\/)+/,""));return n.replace(/\#$/,"")};h.getShortUrl=function(e){var t=e,n=h.getBaseUrl(),r=h.getRootUrl();h.emulated.pushState&&(t=t.replace(n,""));t=t.replace(r,"/");h.isTraditionalAnchor(t)&&(t="./"+t);t=t.replace(/^(\.\/)+/g,"./").replace(/\#$/,"");return t};h.store={};h.idToState=h.idToState||{};h.stateToId=h.stateToId||{};h.urlToId=h.urlToId||{};h.storedStates=h.storedStates||[];h.savedStates=h.savedStates||[];h.normalizeStore=function(){h.store.idToState=h.store.idToState||{};h.store.urlToId=h.store.urlToId||{};h.store.stateToId=h.store.stateToId||{}};h.getState=function(e,t){typeof e=="undefined"&&(e=!0);typeof t=="undefined"&&(t=!0);var n=h.getLastSavedState();!n&&t&&(n=h.createStateObject());if(e){n=h.cloneObject(n);n.url=n.cleanUrl||n.url}return n};h.getIdByState=function(e){var t=h.extractId(e.url),n;if(!t){n=h.getStateString(e);if(typeof h.stateToId[n]!="undefined")t=h.stateToId[n];else if(typeof h.store.stateToId[n]!="undefined")t=h.store.stateToId[n];else{for(;;){t=(new Date).getTime()+String(Math.random()).replace(/\D/g,"");if(typeof h.idToState[t]=="undefined"&&typeof h.store.idToState[t]=="undefined")break}h.stateToId[n]=t;h.idToState[t]=e}}return t};h.normalizeState=function(e){var t,n;if(!e||typeof e!="object")e={};if(typeof e.normalized!="undefined")return e;if(!e.data||typeof e.data!="object")e.data={};t={};t.normalized=!0;t.title=e.title||"";t.url=h.getFullUrl(h.unescapeString(e.url||r.location.href));t.hash=h.getShortUrl(t.url);t.data=h.cloneObject(e.data);t.id=h.getIdByState(t);t.cleanUrl=t.url.replace(/\??\&_suid.*/,"");t.url=t.cleanUrl;n=!h.isEmptyObject(t.data);if(t.title||n){t.hash=h.getShortUrl(t.url).replace(/\??\&_suid.*/,"");/\?/.test(t.hash)||(t.hash+="?");t.hash+="&_suid="+t.id}t.hashedUrl=h.getFullUrl(t.hash);(h.emulated.pushState||h.bugs.safariPoll)&&h.hasUrlDuplicate(t)&&(t.url=t.hashedUrl);return t};h.createStateObject=function(e,t,n){var r={data:e,title:t,url:n};r=h.normalizeState(r);return r};h.getStateById=function(e){e=String(e);var n=h.idToState[e]||h.store.idToState[e]||t;return n};h.getStateString=function(e){var t,n,r;t=h.normalizeState(e);n={data:t.data,title:e.title,url:e.url};r=l.stringify(n);return r};h.getStateId=function(e){var t,n;t=h.normalizeState(e);n=t.id;return n};h.getHashByState=function(e){var t,n;t=h.normalizeState(e);n=t.hash;return n};h.extractId=function(e){var t,n,r;n=/(.*)\&_suid=([0-9]+)$/.exec(e);r=n?n[1]||e:e;t=n?String(n[2]||""):"";return t||!1};h.isTraditionalAnchor=function(e){var t=!/[\/\?\.]/.test(e);return t};h.extractState=function(e,t){var n=null,r,i;t=t||!1;r=h.extractId(e);r&&(n=h.getStateById(r));if(!n){i=h.getFullUrl(e);r=h.getIdByUrl(i)||!1;r&&(n=h.getStateById(r));!n&&t&&!h.isTraditionalAnchor(e)&&(n=h.createStateObject(null,null,i))}return n};h.getIdByUrl=function(e){var n=h.urlToId[e]||h.store.urlToId[e]||t;return n};h.getLastSavedState=function(){return h.savedStates[h.savedStates.length-1]||t};h.getLastStoredState=function(){return h.storedStates[h.storedStates.length-1]||t};h.hasUrlDuplicate=function(e){var t=!1,n;n=h.extractState(e.url);t=n&&n.id!==e.id;return t};h.storeState=function(e){h.urlToId[e.url]=e.id;h.storedStates.push(h.cloneObject(e));return e};h.isLastSavedState=function(e){var t=!1,n,r,i;if(h.savedStates.length){n=e.id;r=h.getLastSavedState();i=r.id;t=n===i}return t};h.saveState=function(e){if(h.isLastSavedState(e))return!1;h.savedStates.push(h.cloneObject(e));return!0};h.getStateByIndex=function(e){var t=null;typeof e=="undefined"?t=h.savedStates[h.savedStates.length-1]:e<0?t=h.savedStates[h.savedStates.length+e]:t=h.savedStates[e];return t};h.getHash=function(){var e=h.unescapeHash(r.location.hash);return e};h.unescapeString=function(t){var n=t,r;for(;;){r=e.unescape(n);if(r===n)break;n=r}return n};h.unescapeHash=function(e){var t=h.normalizeHash(e);t=h.unescapeString(t);return t};h.normalizeHash=function(e){var t=e.replace(/[^#]*#/,"").replace(/#.*/,"");return t};h.setHash=function(e,t){var n,i,s;if(t!==!1&&h.busy()){h.pushQueue({scope:h,callback:h.setHash,args:arguments,queue:t});return!1}n=h.escapeHash(e);h.busy(!0);i=h.extractState(e,!0);if(i&&!h.emulated.pushState)h.pushState(i.data,i.title,i.url,!1);else if(r.location.hash!==n)if(h.bugs.setHash){s=h.getPageUrl();h.pushState(null,null,s+"#"+n,!1)}else r.location.hash=n;return h};h.escapeHash=function(t){var n=h.normalizeHash(t);n=e.escape(n);h.bugs.hashEscape||(n=n.replace(/\%21/g,"!").replace(/\%26/g,"&").replace(/\%3D/g,"=").replace(/\%3F/g,"?"));return n};h.getHashByUrl=function(e){var t=String(e).replace(/([^#]*)#?([^#]*)#?(.*)/,"$2");t=h.unescapeHash(t);return t};h.setTitle=function(e){var t=e.title,n;if(!t){n=h.getStateByIndex(0);n&&n.url===e.url&&(t=n.title||h.options.initialTitle)}try{r.getElementsByTagName("title")[0].innerHTML=t.replace("<","&lt;").replace(">","&gt;").replace(" & "," &amp; ")}catch(i){}r.title=t;return h};h.queues=[];h.busy=function(e){typeof e!="undefined"?h.busy.flag=e:typeof h.busy.flag=="undefined"&&(h.busy.flag=!1);if(!h.busy.flag){u(h.busy.timeout);var t=function(){var e,n,r;if(h.busy.flag)return;for(e=h.queues.length-1;e>=0;--e){n=h.queues[e];if(n.length===0)continue;r=n.shift();h.fireQueueItem(r);h.busy.timeout=o(t,h.options.busyDelay)}};h.busy.timeout=o(t,h.options.busyDelay)}return h.busy.flag};h.busy.flag=!1;h.fireQueueItem=function(e){return e.callback.apply(e.scope||h,e.args||[])};h.pushQueue=function(e){h.queues[e.queue||0]=h.queues[e.queue||0]||[];h.queues[e.queue||0].push(e);return h};h.queue=function(e,t){typeof e=="function"&&(e={callback:e});typeof t!="undefined"&&(e.queue=t);h.busy()?h.pushQueue(e):h.fireQueueItem(e);return h};h.clearQueue=function(){h.busy.flag=!1;h.queues=[];return h};h.stateChanged=!1;h.doubleChecker=!1;h.doubleCheckComplete=function(){h.stateChanged=!0;h.doubleCheckClear();return h};h.doubleCheckClear=function(){if(h.doubleChecker){u(h.doubleChecker);h.doubleChecker=!1}return h};h.doubleCheck=function(e){h.stateChanged=!1;h.doubleCheckClear();h.bugs.ieDoubleCheck&&(h.doubleChecker=o(function(){h.doubleCheckClear();h.stateChanged||e();return!0},h.options.doubleCheckInterval));return h};h.safariStatePoll=function(){var t=h.extractState(r.location.href),n;if(!h.isLastSavedState(t)){n=t;n||(n=h.createStateObject());h.Adapter.trigger(e,"popstate");return h}return};h.back=function(e){if(e!==!1&&h.busy()){h.pushQueue({scope:h,callback:h.back,args:arguments,queue:e});return!1}h.busy(!0);h.doubleCheck(function(){h.back(!1)});p.go(-1);return!0};h.forward=function(e){if(e!==!1&&h.busy()){h.pushQueue({scope:h,callback:h.forward,args:arguments,queue:e});return!1}h.busy(!0);h.doubleCheck(function(){h.forward(!1)});p.go(1);return!0};h.go=function(e,t){var n;if(e>0)for(n=1;n<=e;++n)h.forward(t);else{if(!(e<0))throw new Error("History.go: History.go requires a positive or negative integer passed.");for(n=-1;n>=e;--n)h.back(t)}return h};if(h.emulated.pushState){var d=function(){};h.pushState=h.pushState||d;h.replaceState=h.replaceState||d}else{h.onPopState=function(t,n){var i=!1,s=!1,o,u;h.doubleCheckComplete();o=h.getHash();if(o){u=h.extractState(o||r.location.href,!0);if(u)h.replaceState(u.data,u.title,u.url,!1);else{h.Adapter.trigger(e,"anchorchange");h.busy(!1)}h.expectedStateId=!1;return!1}i=h.Adapter.extractEventData("state",t,n)||!1;i?s=h.getStateById(i):h.expectedStateId?s=h.getStateById(h.expectedStateId):s=h.extractState(r.location.href);s||(s=h.createStateObject(null,null,r.location.href));h.expectedStateId=!1;if(h.isLastSavedState(s)){h.busy(!1);return!1}h.storeState(s);h.saveState(s);h.setTitle(s);h.Adapter.trigger(e,"statechange");h.busy(!1);return!0};h.Adapter.bind(e,"popstate",h.onPopState);h.pushState=function(t,n,r,i){if(h.getHashByUrl(r)&&h.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(i!==!1&&h.busy()){h.pushQueue({scope:h,callback:h.pushState,args:arguments,queue:i});return!1}h.busy(!0);var s=h.createStateObject(t,n,r);if(h.isLastSavedState(s))h.busy(!1);else{h.storeState(s);h.expectedStateId=s.id;p.pushState(s.id,s.title,s.url);h.Adapter.trigger(e,"popstate")}return!0};h.replaceState=function(t,n,r,i){if(h.getHashByUrl(r)&&h.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(i!==!1&&h.busy()){h.pushQueue({scope:h,callback:h.replaceState,args:arguments,queue:i});return!1}h.busy(!0);var s=h.createStateObject(t,n,r);if(h.isLastSavedState(s))h.busy(!1);else{h.storeState(s);h.expectedStateId=s.id;p.replaceState(s.id,s.title,s.url);h.Adapter.trigger(e,"popstate")}return!0}}if(s){try{h.store=l.parse(s.getItem("History.store"))||{}}catch(v){h.store={}}h.normalizeStore()}else{h.store={};h.normalizeStore()}h.Adapter.bind(e,"beforeunload",h.clearAllIntervals);h.Adapter.bind(e,"unload",h.clearAllIntervals);h.saveState(h.storeState(h.extractState(r.location.href,!0)));if(s){h.onUnload=function(){var e,t;try{e=l.parse(s.getItem("History.store"))||{}}catch(n){e={}}e.idToState=e.idToState||{};e.urlToId=e.urlToId||{};e.stateToId=e.stateToId||{};for(t in h.idToState){if(!h.idToState.hasOwnProperty(t))continue;e.idToState[t]=h.idToState[t]}for(t in h.urlToId){if(!h.urlToId.hasOwnProperty(t))continue;e.urlToId[t]=h.urlToId[t]}for(t in h.stateToId){if(!h.stateToId.hasOwnProperty(t))continue;e.stateToId[t]=h.stateToId[t]}h.store=e;h.normalizeStore();s.setItem("History.store",l.stringify(e))};h.intervalList.push(a(h.onUnload,h.options.storeInterval));h.Adapter.bind(e,"beforeunload",h.onUnload);h.Adapter.bind(e,"unload",h.onUnload)}if(!h.emulated.pushState){h.bugs.safariPoll&&h.intervalList.push(a(h.safariStatePoll,h.options.safariPollInterval));if(i.vendor==="Apple Computer, Inc."||(i.appCodeName||"")==="Mozilla"){h.Adapter.bind(e,"hashchange",function(){h.Adapter.trigger(e,"popstate")});h.getHash()&&h.Adapter.onDomLoad(function(){h.Adapter.trigger(e,"hashchange")})}}};h.init()})(window);History.isTraditionalAnchor=function(){return!0};(function(e){var t={hit:function(e,n,r){return t._hit(document.body,e,n,r)},_hit:function(n,r,i,s){var o=null;e(n).children().each(function(n,u){var a,f,l,c,h;for(a=0;a<s.length;a++)if(this===s[a])return!0;if(e(this).width()===0&&e(this).height()===0){o=t._hit(this,r,i,s);if(o!==this)return!1}else{f=0;l=0;c=this;while(c){h=e(c).offset();f+=h.top;l+=h.left;c=e(c).offsetParent().get(0)}if(l<=r&&f<=i&&r-l<e(this).width()&&i-f<e(this).height()){o=t._hit(this,r,i,s);return!1}if(this.nodeType===1&&this.tagName==="TR"){o=t._hit(this,r,i,s);if(o!==this)return!1}}});return o},template:function(e){var n={};n.elmt=t._fromTemplate(e,n,null);return n},_fromTemplate:function(n,r,i){var s,o,u,a,f,l;if(typeof n!="undefined"){if(n===null)return null;if(typeof n!="object"){s=document.createTextNode(n);typeof i!="undefined"&&i!==null&&e(i).append(s);return s}o=null;if(n.hasOwnProperty("tag")){l=n.tag;l==="input"?o=e('<input type="'+n.type+'" />'):o=e("<"+l+">");typeof i!="undefined"&&i!==null&&e(i).append(o)}else{o=e(n.elmt);typeof i!="undefined"&&i!==null&&e(i).append(o)}for(u in n)if(n.hasOwnProperty(u)){a=n[u];if(u==="field")r[a]=o;else if(u!=="type"||o.get(0).tagName!=="input")if(u==="children")for(f=0;f<a.length;f++)t._fromTemplate(a[f],r,o);else u!=="tag"&&u!=="elmt"&&o.attr(u,a)}return o}},string:function(n,r,i){var s,o;typeof n=="string"?s=e("<"+n+">"):s=e(n);s.html(r);o={elmt:s};if(typeof i=="undefined"||i===null)i={};t._fromStringChildren(o,s,i);return o},_fromString:function(n,r,i){var s,o;s=e(r).attr("id");if(typeof s!="undefined"&&s.length>0){e(r).removeAttr("id");if(i.hasOwnProperty(s)){e(r).before(e(i[s]));e(r).remove();n[s]=i[s];return}n[s]=r}e("> *",r).length>0&&t._fromStringChildren(n,r,i)},_fromStringChildren:function(n,r,i){var s,o;s=e(r).children(":first");while(s.length!==0){o=s.next();t._fromString(n,s,i);s=o}}};e.simileDOM=function(n){if(typeof n!="undefined"&&n!==null&&typeof n=="string"&&n.indexOf("_")!==0&&typeof t[n]!="undefined")return t[n].apply(this,Array.prototype.slice.call(arguments,1));e.error("Method "+n+" does not exist on jQuery.simileDOM")}})(jQuery);(function(e){var t,n,r,i;t=e.browser.msie&&Number(e.browser.version[0]).valueOf()<=6;i=!1;n={containerCSSClass:"simileAjax-bubble-container",innerContainerCSSClass:"simileAjax-bubble-innerContainer",contentContainerCSSClass:"simileAjax-bubble-contentContainer",borderGraphicSize:50,borderGraphicCSSClassPrefix:"simileAjax-bubble-border-",arrowGraphicTargetOffset:33,arrowGraphicLength:100,arrowGraphicWidth:49,arrowGraphicCSSClassPrefix:"simileAjax-bubble-arrow-",closeGraphicCSSClass:"simileAjax-bubble-close",extraPadding:20};r={configure:function(e){var t;for(t in e)e.hasOwnProperty(t)&&(n[t]=e[t])},createBubbleForContentAndPoint:function(t,n,i,s,o,u){typeof s!="number"&&(s=300);typeof u!="number"&&(u=0);t=e(t);t.css("position","absolute").css("left","-5000px").css("top","0px").css("width",s+"px");e(document.body).append(t);window.setTimeout(function(){var s,a,f,l,c;s=t.prop("scrollWidth")+10;a=t.prop("scrollHeight")+10;f=0;if(u>0&&a>u){a=u;f=s-25}l=r.createBubbleForPoint(n,i,s,a,o);t.remove();t.css("position","static");t.css("left",null);t.css("top",null);if(f>0){c=e("<div>");t.css("width",null);c.css("width",f+"px");c.append(t);e(l.content).append(c)}else{t.css("width",s+"px");e(l.content).append(t)}},200)},createBubbleForPoint:function(r,i,s,o,u){var a,f,l,c,h,p,d,v,m,g,y,b,w;s=parseInt(s,10);o=parseInt(o,10);a=n;pngTransparencyClassSuffix=t?"pngNotTranslucent":"pngTranslucent";l=s+2*a.borderGraphicSize;c=o+2*a.borderGraphicSize;h=function(e){return e+" "+e+"-"+pngTransparencyClassSuffix};p=e("<div>").attr("class",h(a.containerCSSClass)).css("width",s+"px").css("height",o+"px");d=e("<div>").attr("class",h(a.innerContainerCSSClass));p.append(d);m=function(){if(!v._closed){e(v._div).remove();v._doc=null;v._div=null;v._content=null;v._closed=!0}};v={_closed:!1};v._div=p.get(0);v.close=function(){m()};y=function(t){var n=e("<div>").attr("class",h(a.borderGraphicCSSClassPrefix+t));d.append(n)};y("top-left");y("top-right");y("bottom-left");y("bottom-right");y("left");y("right");y("top");y("bottom");b=e("<div>").attr("class",h(a.contentContainerCSSClass));d.append(b);v.content=b.get(0);w=e("<div>").attr("class",h(a.closeGraphicCSSClass));d.append(w);w.bind("click",v.close);(function(){var t,n,f,l,c,v,m;t=e(window).width();n=e(window).height();f=Math.ceil(a.arrowGraphicWidth/2);l=function(t){var n=e("<div>").attr("class",h(a.arrowGraphicCSSClassPrefix+"point-"+t));d.append(n);return n};if(r-f-a.borderGraphicSize-a.extraPadding>0&&r+f+a.borderGraphicSize+a.extraPadding<t){c=r-Math.round(s/2);c=r<t/2?Math.max(c,a.extraPadding+a.borderGraphicSize):Math.min(c,t-a.extraPadding-a.borderGraphicSize-s);if(u&&u==="top"||!u&&i-a.arrowGraphicTargetOffset-o-a.borderGraphicSize-a.extraPadding>0){v=l("down");v.css("left",r-f-c+"px");p.css("left",c+"px");p.css("top",i-a.arrowGraphicTargetOffset-o+"px");return}if(u&&u==="bottom"||!u&&i+a.arrowGraphicTargetOffset+o+a.borderGraphicSize+a.extraPadding<n){v=l("up");v.css("left",r-f-c+"px");p.css("left",c+"px");p.css("top",i+a.arrowGraphicTargetOffset+"px");return}}m=i-Math.round(o/2);m=i<n/2?Math.max(m,a.extraPadding+a.borderGraphicSize):Math.min(m,n-a.extraPadding-a.borderGraphicSize-o);if(u&&u==="left"||!u&&r-a.arrowGraphicTargetOffset-s-a.borderGraphicSize-a.extraPadding>0){v=l("right");v.css("top",i-f-m+"px");p.css("top",m+"px");p.css("left",r-a.arrowGraphicTargetOffset-s+"px")}else{v=l("left");v.css("top",i-f-m+"px");p.css("top",m+"px");p.css("left",r+a.arrowGraphicTargetOffset+"px")}})();e(document.body).append(p);return v},createMessageBubble:function(){var n,r,i,s,o,u,a,f;n=e("<div>");if(!t){r=e("<div>").css({height:33,background:"url("+Exhibit.urlPrefix+"images/message-top-left.png) top left no-repeat","padding-left":44});n.append(r);i=e("<div>").css({height:33,background:"url("+Exhibit.urlPrefix+"images/message-top-right.png) top right no-repeat"});r.append(i);s=e("<div>").css({background:"url("+Exhibit.urlPrefix+"images/message-left.png) top left repeat-y","padding-left":44});n.append(s);o=e("<div>").css({background:"url("+Exhibit.urlPrefix+"images/message-right.png) top right repeat-y","padding-right":44});s.append(o);u=e("<div>");o.append(u);a=e("<div>").css({height:55,background:"url("+Exhibit.urlPrefix+"images/message-bottom-left.png) bottom left no-repeat","padding-left":44});n.append(a);f=e("<div>").css({height:55,background:"url("+Exhibit.urlPrefix+"images/message-bottom-right.png) bottom right no-repeat"});a.append(f)}else{n.css({border:"2px solid #7777AA",padding:"20px",background:"white",opacity:.9});u=e("<div>");n.append(u)}return{containerDiv:n,contentDiv:u}},createTranslucentImage:function(n,r){var i=e("<img />");t?i.css("width","1px").css("height","1px").css("filter","progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+n+"', sizingMethod='image')"):i.attr("src",n);typeof r!="undefined"&&r!==null?i.css("vertical-align",r):i.css("vertical-align","middle"
);return i.get(0)},createTranslucentImageHTML:function(e,n){if(t){var r="width: 1px; height: 1px; filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+e+"', sizingMethod='image');"+(n!==null?" vertical-align: "+n+";":"");return"<img src='"+e+"' style=\""+r+'" />'}return'<img src="'+e+'"'+(typeof n!="undefined"&&n!==null?' style="vertical-align: '+n+';"':"")+" />"},pngIsTranslucent:function(){return!t}};e.simileBubble=function(t){if(typeof t!="undefined"&&t!==null&&typeof t=="string"&&t.indexOf("_")!==0&&typeof r[t]!="undefined")return r[t].apply(this,Array.prototype.slice.call(arguments,1));if(typeof t=="object"||typeof t=="undefined"||t===null)return r.configure.apply(this,arguments);e.error("Method "+t+" does not exist on jQuery.simileBubble")}})(jQuery);Exhibit.create=function(e){return new Exhibit._Impl(e)};Exhibit.checkBackwardsCompatibility=function(){var e;e=$("*").filter(function(){return typeof $(this).attr("ex:role")!="undefined"});e.length>0&&Exhibit.Backwards.enable("Attributes")};Exhibit.getAttribute=function(e,t,n){var r,i,s;try{r=$(e).attr(t);if(typeof r=="undefined"||r===null||r.length===0){r=$(e).data("ex-"+t);if(typeof r=="undefined"||r===null||r.length===0)return null}if(typeof n=="undefined"||n===null)return r;s=r.split(n);for(i=0;i<s.length;i++)s[i]=s[i].trim();return s}catch(o){return null}};Exhibit.getRoleAttribute=function(e){var t=Exhibit.getAttribute(e,"role")||"";typeof t=="object"&&(t=t[0]);t=t.replace(/^exhibit-/,"");return t};Exhibit.isExhibitAttribute=function(e){return e.length>"data-ex-".length&&e.startsWith("data-ex-")};Exhibit.extractAttributeName=function(e){return e.substr("data-ex-".length)};Exhibit.makeExhibitAttribute=function(e){var t;switch(e){case"itemID":t="itemid";break;default:t="data-ex-"+e.replace(/([A-Z])/g,"-$1").toLowerCase()}return t};Exhibit.getConfigurationFromDOM=function(elmt){var c,o;c=Exhibit.getAttribute(elmt,"configuration");if(typeof c!="undefined"&&c!==null&&c.length>0)try{o=eval(c);if(typeof o=="object")return o}catch(e){}return{}};Exhibit.extractOptionsFromElement=function(e){var t,n,r;t={};n=$(e).data();for(r in n)n.hasOwnProperty(r)&&(r.startsWith("ex")?t[r.substring(2)]=n[r]:t[r]=n[r]);return t};Exhibit._Impl=function(e){this._database=e!==null&&typeof e!="undefined"?e:typeof window.database!="undefined"?window.database:Exhibit.Database.create();this._uiContext=Exhibit.UIContext.createRootContext({},this);this._registry=new Exhibit.Registry;$(document).trigger("registerComponents.exhibit",this._registry);this._collectionMap={}};Exhibit._Impl.prototype.dispose=function(){var e;for(e in this._collectionMap)if(this._collectionMap.hasOwnProperty(e))try{this._collectionMap[e].dispose()}catch(t){Exhibit.Debug.exception(t,Exhibit._("%general.error.disposeCollection"))}this._uiContext.dispose();this._collectionMap=null;this._uiContext=null;this._database=null;this._registry.dispose();this._registry=null};Exhibit._Impl.prototype.getDatabase=function(){return this._database};Exhibit._Impl.prototype.getRegistry=function(){return this._registry};Exhibit._Impl.prototype.getUIContext=function(){return this._uiContext};Exhibit._Impl.prototype.getCollection=function(e){var t=this._collectionMap[e];if((typeof t=="undefined"||t===null)&&e==="default"){t=Exhibit.Collection.createAllItemsCollection(e,this._database);this.setDefaultCollection(t)}return t};Exhibit._Impl.prototype.getDefaultCollection=function(){return this.getCollection("default")};Exhibit._Impl.prototype.setCollection=function(e,t){if(typeof this._collectionMap[e]!="undefined")try{this._collectionMap[e].dispose()}catch(n){Exhibit.Debug.exception(n)}this._collectionMap[e]=t};Exhibit._Impl.prototype.setDefaultCollection=function(e){this.setCollection("default",e)};Exhibit._Impl.prototype.getComponent=function(e){return this.getRegistry().getID(e)};Exhibit._Impl.prototype.configure=function(e){var t,n,r;if(typeof e["collections"]!="undefined")for(t=0;t<e.collections.length;t++){n=e.collections[t];r=n.id;if(typeof r=="undefined"||r===null||r.length===0)r="default";this.setCollection(r,Exhibit.Collection.create2(r,n,this._uiContext))}if(typeof e["components"]!="undefined")for(t=0;t<e.components.length;t++){n=e.components[t];component=Exhibit.UI.create(n,n.elmt,this._uiContext)}};Exhibit._Impl.prototype.configureFromDOM=function(root){var controlPanelElmts,collectionElmts,coderElmts,coordinatorElmts,lensElmts,facetElmts,otherElmts,f,uiContext,i,elmt,id,self,processElmts,exporters,expr,exporter,hash,itemID;collectionElmts=[];coderElmts=[];coordinatorElmts=[];lensElmts=[];facetElmts=[];controlPanelElmts=[];otherElmts=[];f=function(e){var t,n;t=Exhibit.getRoleAttribute(e);if(t.length>0)switch(t){case"collection":collectionElmts.push(e);break;case"coder":coderElmts.push(e);break;case"coordinator":coordinatorElmts.push(e);break;case"lens":case"submission-lens":case"edit-lens":lensElmts.push(e);break;case"facet":facetElmts.push(e);break;case"controlPanel":controlPanelElmts.push(e);break;default:otherElmts.push(e)}else{n=e.firstChild;while(typeof n!="undefined"&&n!==null){n.nodeType===1&&f(n);n=n.nextSibling}}};f(root||document.body);uiContext=this._uiContext;for(i=0;i<collectionElmts.length;i++){elmt=collectionElmts[i];id=elmt.id;if(typeof id=="undefined"||id===null||id.length===0)id="default";this.setCollection(id,Exhibit.Collection.createFromDOM2(id,elmt,uiContext))}self=this;processElmts=function(e){var t,n;for(t=0;t<e.length;t++){n=e[t];try{Exhibit.UI.createFromDOM(n,uiContext)}catch(r){Exhibit.Debug.exception(r)}}};processElmts(coordinatorElmts);processElmts(coderElmts);processElmts(lensElmts);processElmts(facetElmts);if(controlPanelElmts.length===0){panel=Exhibit.ControlPanel.createFromDOM($("<div>").prependTo(document.body),null,uiContext);panel.setCreatedAsDefault()}else processElmts(controlPanelElmts);processElmts(otherElmts);exporters=Exhibit.getAttribute(document.body,"exporters");if(typeof exporters!="undefined"&&exporters!==null){exporters=exporters.split(";");for(i=0;i<exporters.length;i++){expr=exporters[i];exporter=null;try{exporter=eval(expr)}catch(ex2){}if(exporter===null)try{exporter=eval(expr+"Exporter")}catch(ex3){}if(exporter===null)try{exporter=eval("Exhibit."+expr+"Exporter")}catch(ex4){}typeof exporter=="object"&&Exhibit.addExporter(exporter)}}hash=document.location.hash;if(hash.length>1){itemID=decodeURIComponent(hash.substr(1));this._database.containsItem(itemID)&&this._showFocusDialogOnItem(itemID)}$(document).trigger("exhibitConfigured.exhibit",this)};Exhibit._Impl.prototype._showFocusDialogOnItem=function(e){var t,n;t=$.simileDOM("string","div","<div class='exhibit-focusDialog-viewContainer' id='lensContainer'></div><div class='exhibit-focusDialog-controls'><button id='closeButton'>"+Exhibit._("%export.focusDialogBoxCloseButtonLabel")+"</button>"+"</div>");$(t.elmt).attr("class","exhibit-focusDialog exhibit-ui-protection");Exhibit.UI.setupDialog(t,!0);n=this._uiContext.getLensRegistry().createLens(e,t.lensContainer,this._uiContext);$(t.elmt).css("top",document.body.scrollTop+100+"px");$(document.body).append($(t.elmt));$(document).trigger("modalSuperseded.exhibit");$(t.closeButton).bind("click",function(e){t.close()})};Exhibit.Registry=function(e){this._registry={};this._idCache={};this._components=[];this._isStatic=typeof e!="undefined"&&e!==null?e:!1};Exhibit.Registry.prototype.isStatic=function(){return this._isStatic};Exhibit.Registry.prototype.createRegistry=function(e){this._registry[e]={};this._components.push(e)};Exhibit.Registry.prototype.components=function(){return this._components};Exhibit.Registry.prototype.hasRegistry=function(e){return typeof this._registry[e]!="undefined"};Exhibit.Registry.prototype.generateIdentifier=function(e){var t,n,r;r=0;t=this._registry[e];if(typeof t=="undefined")throw new Error(Exhibit._("%registry.error.noSuchRegistry",e));for(n in t)t.hasOwnProperty(n)&&r++;return r};Exhibit.Registry.prototype.isRegistered=function(e,t){return this.hasRegistry(e)&&typeof this._registry[e][t]!="undefined"};Exhibit.Registry.prototype.register=function(e,t,n){if(!this.isRegistered(e,t)){this._registry[e][t]=n;!this.isStatic()&&typeof this._idCache[t]=="undefined"&&(this._idCache[t]=n);return!0}return!1};Exhibit.Registry.prototype.componentHandlers=function(e){return this.hasRegistry(e)?this._registry[e]:null};Exhibit.Registry.prototype.getKeys=function(e){var t,n,r;t=this._registry[e];r=[];for(n in t)t.hasOwnProperty(n)&&r.push(n);return r};Exhibit.Registry.prototype.get=function(e,t){return this.isRegistered(e,t)?this._registry[e][t]:null};Exhibit.Registry.prototype.getID=function(e){return!this.isStatic()&&typeof this._idCache[e]!="undefined"?this._idCache[e]:null};Exhibit.Registry.prototype.unregister=function(e,t){var n;if(this.isRegistered(e,t)){n=this.get(e,t);this._registry[e][t]=null;delete this._registry[e][t];if(!this.isStatic()&&typeof this._idCache[t]!="undefined"){this._idCache[t]=null;delete this._idCache[t]}}};Exhibit.Util={};Exhibit.Util.round=function(e,t){var n;t=t||1;n=Math.floor(Math.log(t)/Math.log(10));e=(Math.round(e/t)*t).toString();if(n>=0)return parseInt(e,10).toString();n=-n;return parseFloat(e).toFixed(n)};(function(){typeof String.prototype.trim=="undefined"&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});typeof String.prototype.startsWith=="undefined"&&(String.prototype.startsWith=function(e){return this.length>=e.length&&this.substr(0,e.length)===e});typeof String.prototype.endsWith=="undefined"&&(String.prototype.endsWith=function(e){return this.length>=e.length&&this.substr(this.length-e.length)===e})})();Exhibit.Debug={silent:!1};Exhibit.Debug.log=function(e){var t;typeof window.console!="undefined"&&typeof window.console.log=="function"?t=function(e){console.log(e)}:t=function(e){Exhibit.Debug.silent||alert(e)};Exhibit.Debug.log=t;t(e)};Exhibit.Debug.warn=function(e){var t;typeof window.console!="undefined"&&typeof window.console.warn=="function"?t=function(e){console.warn(e)}:t=function(e){Exhibit.Debug.silent||alert(e)};Exhibit.Debug.warn=t;t(e)};Exhibit.Debug.exception=function(e,t){var n,r=Exhibit.parseURLParameters();r.errors==="throw"||Exhibit.params.errors==="throw"?n=function(e,t){throw e}:typeof window.console!="undefined"&&typeof window.console.error!="undefined"?n=function(e,t){typeof t!="undefined"&&t!==null?console.error(t+" %o",e):console.error(e);throw e}:n=function(e,t){Exhibit.Debug.silent||alert("Caught exception: "+t+"\n\nDetails: "+(typeof e.description!="undefined"?e.description:e));throw e};Exhibit.Debug.exception=n;n(e,t)};Exhibit.Debug.objectToString=function(e){return Exhibit.Debut._objectToString(e,"")};Exhibit.Debug._objectToString=function(e,t){var n=t+" ",r,i;if(typeof e=="object"){r="{";for(i in e)e.hasOwnProperty(i)&&(r+=n+i+": "+Exhibit.Debug._objectToString(e[i],n)+"\n");r+=t+"}";return r}if(typeof e=="array"){r="[";for(i=0;i<e.length;i++)r+=Exhibit.Debug._objectToString(e[i],n)+"\n";r+=t+"]";return r}return typeof e=="function"?t+"{function}\n":e};Exhibit.Util.HTML={};Exhibit.Util.HTML._e2uHash={};(function(){var e=Exhibit.Util.HTML._e2uHash;e.quot='"';e.amp="&";e.lt="<";e.gt=">";e.nbsp="Â [space]";e.iexcl="Â¡";e.cent="Â¢";e.pound="Â£";e.curren="Â¤";e.yen="Â¥";e.brvbar="Â¦";e.sect="Â§";e.uml="Â¨";e.copy="Â©";e.ordf="Âª";e.laquo="Â«";e.not="Â¬";e.shy="Â­";e.reg="Â®";e.macr="Â¯";e.deg="Â°";e.plusmn="Â±";e.sup2="Â²";e.sup3="Â³";e.acute="Â´";e.micro="Âµ";e.para="Â¶";e.middot="Â·";e.cedil="Â¸";e.sup1="Â¹";e.ordm="Âº";e.raquo="Â»";e.frac14="Â¼";e.frac12="Â½";e.frac34="Â¾";e.iquest="Â¿";e.Agrave="Ã";e.Aacute="Ã";e.Acirc="Ã";e.Atilde="Ã";e.Auml="Ã";e.Aring="Ã";e.AElig="Ã";e.Ccedil="Ã";e.Egrave="Ã";e.Eacute="Ã";e.Ecirc="Ã";e.Euml="Ã";e.Igrave="Ã";e.Iacute="Ã";e.Icirc="Ã";e.Iuml="Ã";e.ETH="Ã";e.Ntilde="Ã";e.Ograve="Ã";e.Oacute="Ã";e.Ocirc="Ã";e.Otilde="Ã";e.Ouml="Ã";e.times="Ã";e.Oslash="Ã";e.Ugrave="Ã";e.Uacute="Ã";e.Ucirc="Ã";e.Uuml="Ã";e.Yacute="Ã";e.THORN="Ã";e.szlig="Ã";e.agrave="Ã ";e.aacute="Ã¡";e.acirc="Ã¢";e.atilde="Ã£";e.auml="Ã¤";e.aring="Ã¥";e.aelig="Ã¦";e.ccedil="Ã§";e.egrave="Ã¨";e.eacute="Ã©";e.ecirc="Ãª";e.euml="Ã«";e.igrave="Ã¬";e.iacute="Ã­";e.icirc="Ã®";e.iuml="Ã¯";e.eth="Ã°";e.ntilde="Ã±";e.ograve="Ã²";e.oacute="Ã³";e.ocirc="Ã´";e.otilde="Ãµ";e.ouml="Ã¶";e.divide="Ã·";e.oslash="Ã¸";e.ugrave="Ã¹";e.uacute="Ãº";e.ucirc="Ã»";e.uuml="Ã¼";e.yacute="Ã½";e.thorn="Ã¾";e.yuml="Ã¿";e.OElig="";e.oelig="Å";e.Scaron="Å ";e.scaron="Å¡";e.Yuml="Å¸";e.circ="Ë";e.tilde="Ë";e.ensp="â";e.emsp="â";e.thinsp="â";e.zwnj="â";e.zwj="â";e.lrm="â";e.rlm="â";e.ndash="â";e.mdash="â";e.lsquo="â";e.rsquo="â";e.sbquo="â";e.ldquo="â";e.rdquo="â";e.bdquo="â";e.dagger="â ";e.Dagger="â¡";e.permil="â°";e.lsaquo="â¹";e.rsaquo="âº";e.euro="â¬";e.fnof="Æ";e.Alpha="Î";e.Beta="Î";e.Gamma="Î";e.Delta="Î";e.Epsilon="Î";e.Zeta="Î";e.Eta="Î";e.Theta="Î";e.Iota="Î";e.Kappa="Î";e.Lambda="Î";e.Mu="Î";e.Nu="Î";e.Xi="Î";e.Omicron="Î";e.Pi="Î ";e.Rho="Î¡";e.Sigma="Î£";e.Tau="Î¤";e.Upsilon="Î¥";e.Phi="Î¦";e.Chi="Î§";e.Psi="Î¨";e.Omega="Î©";e.alpha="Î±";e.beta="Î²";e.gamma="Î³";e.delta="Î´";e.epsilon="Îµ";e.zeta="Î¶";e.eta="Î·";e.theta="Î¸";e.iota="Î¹";e.kappa="Îº";e.lambda="Î»";e.mu="Î¼";e.nu="Î½";e.xi="Î¾";e.omicron="Î¿";e.pi="Ï";e.rho="Ï";e.sigmaf="Ï";e.sigma="Ï";e.tau="Ï";e.upsilon="Ï";e.phi="Ï";e.chi="Ï";e.psi="Ï";e.omega="Ï";e.thetasym="Ï";e.upsih="Ï";e.piv="Ï";e.bull="â¢";e.hellip="â¦";e.prime="â²";e.Prime="â³";e.oline="â¾";e.frasl="â";e.weierp="â";e.image="â";e.real="â";e.trade="â¢";e.alefsym="âµ";e.larr="â";e.uarr="â";e.rarr="â";e.darr="â";e.harr="â";e.crarr="âµ";e.lArr="â";e.uArr="â";e.rArr="â";e.dArr="â";e.hArr="â";e.forall="â";e.part="â";e.exist="â";e.empty="â";e.nabla="â";e.isin="â";e.notin="â";e.ni="â";e.prod="â";e.sum="â";e.minus="â";e.lowast="â";e.radic="â";e.prop="â";e.infin="â";e.ang="â ";e.and="â§";e.or="â¨";e.cap="â©";e.cup="âª";e["int"]="â«";e.there4="â´";e.sim="â¼";e.cong="â";e.asymp="â";e.ne="â ";e.equiv="â¡";e.le="â¤";e.ge="â¥";e.sub="â";e.sup="â";e.nsub="â";e.sube="â";e.supe="â";e.oplus="â";e.otimes="â";e.perp="â¥";e.sdot="â";e.lceil="â";e.rceil="â";e.lfloor="â";e.rfloor="â";e.lang="â©";e.rang="âª";e.loz="â";e.spades="â ";e.clubs="â£";e.hearts="â¥";e.diams="â¦"})();Exhibit.Util.HTML.deEntify=function(e){var t,n=/&(\w+?);/,r=Exhibit.Util.HTML._e2uHash;while(n.test(e)){t=e.match(n);e=e.replace(n,r[t[1]])}return e};Exhibit.Set=function(e){this._hash={};this._count=0;var t;if(e instanceof Array)for(t=0;t<e.length;t++)this.add(e[t]);else e instanceof Exhibit.Set&&this.addSet(e)};Exhibit.Set.prototype.add=function(e){if(typeof e!="number"&&typeof e!="string"||typeof this._hash[e]!="undefined")return!1;this._hash[e]=!0;this._count++;return!0};Exhibit.Set.prototype.addSet=function(e){var t;for(t in e._hash)e._hash.hasOwnProperty(t)&&this.add(t)};Exhibit.Set.prototype.remove=function(e){if(typeof this._hash[e]!="undefined"){delete this._hash[e];this._count--;return!0}return!1};Exhibit.Set.prototype.removeSet=function(e){var t;for(t in e._hash)e._hash.hasOwnProperty(t)&&this.remove(t)};Exhibit.Set.prototype.retainSet=function(e){var t;for(t in this._hash)if(this._hash.hasOwnProperty(t)&&!e.contains(t)){delete this._hash[t];this._count--}};Exhibit.Set.prototype.contains=function(e){return typeof this._hash[e]!="undefined"};Exhibit.Set.prototype.size=function(){return this._count};Exhibit.Set.prototype.toArray=function(){var e,t=[];for(e in this._hash)this._hash.hasOwnProperty(e)&&t.push(e);return t};Exhibit.Set.prototype.visit=function(e){var t;for(t in this._hash)if(this._hash.hasOwnProperty(t)&&e(t)===!0)break};Exhibit.Set.createIntersection=function(e,t,n){var r,i,s=n?n:new Exhibit.Set;if(e.size()<t.size()){r=e;i=t}else{r=t;i=e}r.visit(function(e){i.contains(e)&&s.add(e)});return s};Exhibit.DateTime={};Exhibit.DateTime.MILLISECOND=0;Exhibit.DateTime.SECOND=1;Exhibit.DateTime.MINUTE=2;Exhibit.DateTime.HOUR=3;Exhibit.DateTime.DAY=4;Exhibit.DateTime.WEEK=5;Exhibit.DateTime.MONTH=6;Exhibit.DateTime.YEAR=7;Exhibit.DateTime.DECADE=8;Exhibit.DateTime.CENTURY=9;Exhibit.DateTime.MILLENNIUM=10;Exhibit.DateTime.QUARTER=11;Exhibit.DateTime.EPOCH=-1;Exhibit.DateTime.ERA=-2;Exhibit.DateTime.gregorianUnitLengths=[];(function(){var e=Exhibit.DateTime,t=e.gregorianUnitLengths;t[e.MILLISECOND]=1;t[e.SECOND]=1e3;t[e.MINUTE]=t[e.SECOND]*60;t[e.HOUR]=t[e.MINUTE]*60;t[e.DAY]=t[e.HOUR]*24;t[e.WEEK]=t[e.DAY]*7;t[e.MONTH]=t[e.DAY]*31;t[e.QUARTER]=t[e.MONTH]*3;t[e.YEAR]=t[e.DAY]*365;t[e.DECADE]=t[e.YEAR]*10;t[e.CENTURY]=t[e.YEAR]*100;t[e.MILLENNIUM]=t[e.YEAR]*1e3})();Exhibit.DateTime._dateRegexp=new RegExp("^(-?)([0-9]{4})("+["(-?([0-9]{2})(-?([0-9]{2}))?)","(-?([0-9]{3}))","(-?W([0-9]{2})(-?([1-7]))?)"].join("|")+")?$");Exhibit.DateTime._timezoneRegexp=/Z|(([\-+])([0-9]{2})(:?([0-9]{2}))?)$/;Exhibit.DateTime._timeRegexp=/^([0-9]{2})(:?([0-9]{2})(:?([0-9]{2})(\.([0-9]+))?)?)?$/;Exhibit.DateTime.setIso8601Date=function(e,t){var n,r,i,s,o,u,a,f,l,c,h;n=t.match(Exhibit.DateTime._dateRegexp);if(!n)throw new Error(Exhibit._("%datetime.error.invalidDate",t));r=n[1]==="-"?-1:1;i=r*n[2];s=n[5];o=n[7];u=n[9];a=n[11];f=n[13]?n[13]:1;e.setUTCFullYear(i);if(u){e.setUTCMonth(0);e.setUTCDate(Number(u))}else if(a){e.setUTCMonth(0);e.setUTCDate(1);l=e.getUTCDay();c=l?l:7;h=Number(f)+7*Number(a);c<=4?e.setUTCDate(h+1-c):e.setUTCDate(h+8-c)}else{if(s){e.setUTCDate(1);e.setUTCMonth(s-1)}o&&e.setUTCDate(o)}return e};Exhibit.DateTime.setIso8601Time=function(e,t){var n,r,i,s,o;n=t.match(Exhibit.DateTime._timeRegexp);if(!n)throw new Error(Exhibit._("%datetime.error.invalidTime",t));r=n[1];i=Number(n[3]?n[3]:0);s=n[5]?n[5]:0;o=n[7]?Number("0."+n[7])*1e3:0;e.setUTCHours(r);e.setUTCMinutes(i);e.setUTCSeconds(s);e.setUTCMilliseconds(o);return e};Exhibit.DateTime.timezoneOffset=(new Date).getTimezoneOffset();Exhibit.DateTime.setIso8601=function(e,t){var n,r,i;n=null;r=t.indexOf("T")===-1?t.split(" "):t.split("T");Exhibit.DateTime.setIso8601Date(e,r[0]);if(r.length===2){i=r[1].match(Exhibit.DateTime._timezoneRegexp);if(i){if(i[0]==="Z")n=0;else{n=Number(i[3])*60+Number(i[5]);n*=i[2]==="-"?1:-1}r[1]=r[1].substr(0,r[1].length-i[0].length)}Exhibit.DateTime.setIso8601Time(e,r[1])}if(typeof n=="undefined"||n===null)n=e.getTimezoneOffset();e.setTime(e.getTime()+n*6e4);return e};Exhibit.DateTime.parseIso8601DateTime=function(e){try{return Exhibit.DateTime.setIso8601(new Date(0),e)}catch(t){return null}};Exhibit.DateTime.parseGregorianDateTime=function(e){var t,n,r,i,s;if(typeof e=="undefined"||e===null)return null;if(e instanceof Date)return e;t=e.toString();if(t.length>0&&t.length<8){n=t.indexOf(" ");if(n>0){r=parseInt(t.substr(0,n),10);i=t.substr(n+1);i.toLowerCase()==="bc"&&(r=1-r)}else r=parseInt(t,10);s=new Date(0);s.setUTCFullYear(r);return s}try{return new Date(Date.parse(t))}catch(o){return null}};Exhibit.DateTime.roundDownToInterval=function(e,t,n,r,i){var s,o,u,a,f,l;s=n*Exhibit.DateTime.gregorianUnitLengths[Exhibit.DateTime.HOUR];o=new Date(e.getTime()+s);u=Exhibit.DateTime.zeroTimeUTC;a=function(e){u(e);e.setUTCDate(1);e.setUTCMonth(0)};switch(t){case Exhibit.DateTime.MILLISECOND:f=o.getUTCMilliseconds();o.setUTCMilliseconds(f-f%r);break;case Exhibit.DateTime.SECOND:o.setUTCMilliseconds(0);f=o.getUTCSeconds();o.setUTCSeconds(f-f%r);break;case Exhibit.DateTime.MINUTE:o.setUTCMilliseconds(0);o.setUTCSeconds(0);f=o.getUTCMinutes();o.setTime(o.getTime()-f%r*Exhibit.DateTime.gregorianUnitLengths[Exhibit.DateTime.MINUTE]);break;case Exhibit.DateTime.HOUR:o.setUTCMilliseconds(0);o.setUTCSeconds(0);o.setUTCMinutes(0);f=o.getUTCHours();o.setUTCHours(f-f%r);break;case Exhibit.DateTime.DAY:u(o);f=o.getUTCDate();o.setUTCDate(f-f%r);break;case Exhibit.DateTime.WEEK:l=new Date(o.getUTCFullYear(),0,1);u(o);u(l);f=Math.ceil(((o-l)/Exhibit.DateTime.gregorianUnitLengths[Exhibit.DateTime.DAY]-(i-l.getUTCDay()+7)%7+1)/7)+(l.getUTCDay()!==i?1:0);o.setTime(o.getTime()-f%r*Exhibit.DateTime.gregorianUnitLengths[Exhibit.DateTime.WEEK]);o<l&&(o=l);break;case Exhibit.DateTime.MONTH:u(o);o.setUTCDate(1);f=o.getUTCMonth()+1;o.setUTCMonth(Math.max(0,f-1-f%r));break;case Exhibit.DateTime.YEAR:a(o);f=o.getUTCFullYear();o.setUTCFullYear(f-f%r);break;case Exhibit.DateTime.DECADE:a(o);o.setUTCFullYear(Math.floor(o.getUTCFullYear()/10)*10);break;case Exhibit.DateTime.CENTURY:a(o);o.setUTCFullYear(Math.floor(o.getUTCFullYear()/100)*100);break;case Exhibit.DateTime.MILLENNIUM:a(o);o.setUTCFullYear(Math.floor(o.getUTCFullYear()/1e3)*1e3)}e.setTime(o.getTime()-s)};Exhibit.DateTime.roundUpToInterval=function(e,t,n,r,i){var s,o,u,a,f,l,c;s=e.getTime();c=function(e){Exhibit.DateTime.zeroTimeUTC(e);e.setUTCDate(1);e.setUTCMonth(0)};u=!1;o=function(){Exhibit.DateTime.roundDownToInterval(e,t,n,r,i);e.getTime()<s&&e.setTime(e.getTime()+Exhibit.DateTime.gregorianUnitLengths[t]*r);u=!0};timeShift=n*Exhibit.DateTime.gregorianUnitLengths[Exhibit.DateTime.HOUR];a=new Date(e.getTime()+timeShift);switch(t){case Exhibit.DateTime.MILLISECOND:o();break;case Exhibit.DateTime.SECOND:o();break;case Exhibit.DateTime.MINUTE:o();break;case Exhibit.DateTime.HOUR:o();break;case Exhibit.DateTime.DAY:o();break;case Exhibit.DateTime.WEEK:f=new Date(a.getUTCFullYear(),0,1);Exhibit.DateTime.zeroTimeUTC(a);Exhibit.DateTime.zeroTimeUTC(f);l=Math.ceil(((a-f)/Exhibit.DateTime.gregorianUnitLengths[Exhibit.DateTime.DAY]-(i-f.getUTCDay()+7)%7+1)/7)+(f.getUTCDay()!==i?1:0);a.setTime(a.getTime()+(r-l%r)%r*Exhibit.DateTime.gregorianUnitLengths[Exhibit.DateTime.WEEK]);break;case Exhibit.DateTime.MONTH:Exhibit.DateTime.zeroTimeUTC(a);a.setUTCDate(1);l=a.getUTCMonth()+1;a.setUTCMonth(l-1+(r-l%r)%r);break;case Exhibit.DateTime.YEAR:c(a);l=a.getUTCFullYear();a.setUTCFullYear(l+(r-l%r)%r);break;case Exhibit.DateTime.DECADE:c(a);a.setUTCFullYear(Math.ceil(a.getUTCFullYear()/10)*10);break;case Exhibit.DateTime.CENTURY:c(a);a.setUTCFullYear(Math.ceil(a.getUTCFullYear()/100)*100);break;case Exhibit.DateTime.MILLENNIUM:c(a);a.setUTCFullYear(Math.ceil(a.getUTCFullYear()/1e3)*1e3)}u||e.setTime(a.getTime()-timeShift)};Exhibit.DateTime.incrementByInterval=function(e,t,n){n=typeof n=="undefined"?0:n;var r,i;r=n*Exhibit.DateTime.gregorianUnitLengths[Exhibit.DateTime.HOUR];i=new Date(e.getTime()+r);switch(t){case Exhibit.DateTime.MILLISECOND:i.setTime(i.getTime()+1);break;case Exhibit.DateTime.SECOND:i.setTime(i.getTime()+1e3);break;case Exhibit.DateTime.MINUTE:i.setTime(i.getTime()+Exhibit.DateTime.gregorianUnitLengths[Exhibit.DateTime.MINUTE]);break;case Exhibit.DateTime.HOUR:i.setTime(i.getTime()+Exhibit.DateTime.gregorianUnitLengths[Exhibit.DateTime.HOUR]);break;case Exhibit.DateTime.DAY:i.setUTCDate(i.getUTCDate()+1);break;case Exhibit.DateTime.WEEK:i.setUTCDate(i.getUTCDate()+7);break;case Exhibit.DateTime.MONTH:i.setUTCMonth(i.getUTCMonth()+1);break;case Exhibit.DateTime.YEAR:i.setUTCFullYear(i.getUTCFullYear()+1);break;case Exhibit.DateTime.DECADE:i.setUTCFullYear(i.getUTCFullYear()+10);break;case Exhibit.DateTime.CENTURY:i.setUTCFullYear(i.getUTCFullYear()+100);break;case Exhibit.DateTime.MILLENNIUM:i.setUTCFullYear(i.getUTCFullYear()+1e3)}e.setTime(i.getTime()-r)};Exhibit.DateTime.removeTimeZoneOffset=function(e,t){return new Date(e.getTime()+t*Exhibit.DateTime.gregorianUnitLengths[Exhibit.DateTime.HOUR])};Exhibit.DateTime.getTimezone=function(){var e=(new Date).getTimezoneOffset();return e/-60};Exhibit.DateTime.zeroTimeUTC=function(e){e.setUTCHours(0);e.setUTCMinutes(0);e.setUTCSeconds(0);e.setUTCMilliseconds(0);return e};Exhibit.NativeDateUnit={};Exhibit.NativeDateUnit.makeDefaultValue=function(){return new Date};Exhibit.NativeDateUnit.cloneValue=function(e){return new Date(e.getTime())};Exhibit.NativeDateUnit.getParser=function(e){typeof e=="string"&&(e=e.toLowerCase());return e==="iso8601"||e==="iso 8601"?Exhibit.DateTime.parseIso8601DateTime:Exhibit.DateTime.parseGregorianDateTime};Exhibit.NativeDateUnit.parseFromObject=function(e){return Exhibit.DateTime.parseGregorianDateTime(e)};Exhibit.NativeDateUnit.toNumber=function(e){return e.getTime()};Exhibit.NativeDateUnit.fromNumber=function(e){return new Date(e)};Exhibit.NativeDateUnit.compare=function(e,t){var n,r;typeof e=="object"?n=e.getTime():n=Number(e);typeof t=="object"?r=t.getTime():r=Number(t);return n-r};Exhibit.NativeDateUnit.earlier=function(e,t){return Exhibit.NativeDateUnit.compare(e,t)<0?e:t};Exhibit.NativeDateUnit.later=function(e,t){return Exhibit.NativeDateUnit.compare(e,t)>0?e:t};Exhibit.NativeDateUnit.change=function(e,t){return new Date(e.getTime()+t)};Exhibit.Persistence={_urlWithoutQuery:null,_urlWithoutQueryAndHash:null};Exhibit.Persistence.getBaseURL=function(e){var t,n;try{if(e.indexOf("://")<0){t=Exhibit.Persistence.getBaseURL(document.location.href);e.substr(0,1)==="/"?e=t.substr(0,t.indexOf("/",t.indexOf("://")+3))+e:e=t+e}n=e.lastIndexOf("/");return n<0?"":e.substr(0,n+1)}catch(r){return e}};Exhibit.Persistence.resolveURL=function(e){var t;if(e.indexOf("://")<0){t=Exhibit.Persistence.getBaseURL(document.location.href);e.substr(0,1)==="/"?e=t.substr(0,t.indexOf("/",t.indexOf("://")+3))+e:e=t+e}return e};Exhibit.Persistence.getURLWithoutQueryAndHash=function(){var e,t,n;if(Exhibit.Persistence._urlWithoutQueryAndHash!==null)e=Exhibit.Persistence._urlWithoutQueryAndHash;else{e=document.location.href;t=e.indexOf("#");n=e.indexOf("?");n>=0?e=e.substr(0,n):t>=0&&(e=e.substr(0,t));Exhibit.Persistence._urlWithoutQueryAndHash=e}return e};Exhibit.Persistence.getURLWithoutQuery=function(){var e,t;if(Exhibit.Persistence._urlWithoutQuery!==null)e=Exhibit.Persistence._urlWithoutQuery;else{e=document.location.href;t=e.indexOf("?");t>=0&&(e=e.substr(0,t));Exhibit.Persistence._urlWithoutQuery=e}return e};Exhibit.Persistence.getItemLink=function(e){return Exhibit.Persistence.getURLWithoutQueryAndHash()+"#"+encodeURIComponent(e)};Exhibit.History={enabled:!1,_state:0,_originalTitle:"",_originalLocation:"",_registry:null,_activeTypes:["facet","view","viewPanel"]};Exhibit.History.init=function(e){var t,n,r,i,s,o;if(typeof History!="undefined"&&History.enabled){Exhibit.History.enabled=!0;Exhibit.History._originalTitle=document.title;Exhibit.History._originalLocation=Exhibit.Persistence.getURLWithoutQueryAndHash();Exhibit.History._registry=e.getRegistry();$(window).bind("statechange",Exhibit.History.stateListener);if(Exhibit.Bookmark.runBookmark())Exhibit.Bookmark.implementBookmark(Exhibit.Bookmark.state);else{Exhibit.History._processEmptyState();Exhibit.History.stateListener()}}};Exhibit.History._processEmptyState=function(){var e,t,n,r,i,s;t=Exhibit.History._activeTypes;n=Exhibit.History._registry;e=Exhibit.History.getState();if(typeof e.data.components=="undefined"){e.data.components={};e.data.state=Exhibit.History._state;for(s=0;s<t.length;s++){r=n.getKeys(t[s]);for(j=0;j<r.length;j++){i=n.get(t[s],r[j]);if(typeof i.exportState=="function"){e.data.components[r[j]]={};e.data.components[r[j]].type=t[s];e.data.components[r[j]].state=i.exportState()}}}Exhibit.History.replaceState(e.data)}};Exhibit.History.stateListener=function(e){var t,n,r,i,s,o;t=Exhibit.History.getState();t.data.lengthy&&Exhibit.UI.showBusyIndicator();n=t.data.components;for(r in n)if(n.hasOwnProperty(r)){s=n[r].state;o=Exhibit.History._registry.get(n[r].type,r);o!==null&&typeof o.importState=="function"&&o.importState(s)}Exhibit.History._state=t.data.state||0;t.data.lengthy&&Exhibit.UI.hideBusyIndicator()};Exhibit.History.componentStateListener=function(e,t,n){var r,i,s,o;r=Exhibit.History.getState();if(r!==null){i=r.data.components;if(typeof i[n]!="undefined"){s=i[n].state;o=Exhibit.History._registry.get(t,n);o!==null&&typeof o.importState=="function"&&o.importState(s)}}};Exhibit.History.getState=function(){return Exhibit.History.enabled?History.getState():null};Exhibit.History.setComponentState=function(e,t,n,r,i){if(typeof e=="undefined"||e===null)e={data:{components:{}}};typeof e["data"]=="undefined"&&(e.data={components:{}});typeof e.data["components"]=="undefined"&&(e.data.components={});e.data.lengthy=i;e.data.components[t.getID()]={type:n,state:r};return e};Exhibit.History.pushComponentState=function(e,t,n,r,i){var s=Exhibit.History.getState();Exhibit.History.setComponentState(s,e,t,n,i);Exhibit.History.pushState(s.data,r)};Exhibit.History.pushState=function(e,t){var n,r;if(Exhibit.History.enabled){Exhibit.History._state++;e.state=Exhibit.History._state;n=Exhibit.History._originalTitle;typeof t!="undefined"&&t!==null&&t!==""&&(n+=" {"+t+"}");r=Exhibit.History._originalLocation;History.pushState(e,n,r)}};Exhibit.History.replaceState=function(e,t,n){var r,i;if(Exhibit.History.enabled){i=Exhibit.History.getState();r=Exhibit.History._originalTitle;typeof t!="undefined"&&t!==null&&t!==""?r+=" {"+t+"}":typeof i.title!="undefined"&&(r=Exhibit.History.getState().title);(typeof n=="undefined"||n===null)&&typeof i.url!="undefined"&&(n=i.url);History.replaceState(e,r,n)}};Exhibit.History.eraseState=function(){Exhibit.History.pushState({})};$(document).bind("importReady.exhibit",Exhibit.History.componentStateListener);Exhibit.Bookmark={_shouldRun:undefined,state:{},run:undefined};Exhibit.Bookmark.generateBookmarkHash=function(e){return typeof e=="undefined"||e===null||typeof e.data=="undefined"||e.data===null||typeof e.data.state=="undefined"||e.data.state===null?"":Base64.encode(JSON.stringify(e))};Exhibit.Bookmark.interpretBookmarkHash=function(e){return typeof e=="undefined"||e===null||e===""?null:JSON.parse(Base64.decode(e))};Exhibit.Bookmark.generateBookmark=function(){var e;e=Exhibit.Bookmark.generateBookmarkHash(Exhibit.History.getState());return document.location.href+(e===""?"":"#"+e)};Exhibit.Bookmark.implementBookmark=function(e){if(typeof e!="undefined"&&e!==null){Exhibit.History.replaceState(e.data,e.title,e.url);Exhibit.Bookmark.run=!0}};Exhibit.Bookmark.runBookmark=function(){return Exhibit.Bookmark._shouldRun};Exhibit.Bookmark.init=function(){var e,t;e=document.location.hash;if(e.length>0)try{t=Exhibit.Bookmark.interpretBookmarkHash(e.substr(1));if(typeof t=="object"&&typeof t.data!="undefined"&&typeof t.title!="undefined"&&typeof t.url!="undefined"){Exhibit.Bookmark.state=t;Exhibit.Bookmark._shouldRun=!0}else Exhibit.Bookmark._shouldRun=!1}catch(n){Exhibit.Bookmark._shouldRun=!1}finally{Exhibit.Bookmark.run=!1}};Exhibit.Locale=function(e,t){this._locale=e;this._url=t;Exhibit.Localization.registerLocale(this._locale,this)};Exhibit.Locale.prototype.getURL=function(){return this._url};Exhibit.l10n={};Exhibit._=function(){var e,t,n;n=[].slice.apply(arguments);if(n.length>0){e=n.shift();t=Exhibit.Localization.lookup(e);return typeof t!="undefined"?vsprintf(t,n):t}};Exhibit.Localization={_registryKey:"l10n",_registry:null,_lastResortLocale:"en",_currentLocale:undefined,_loadedLocales:[]};Exhibit.Localization._registerComponent=function(e,t){var n,r,i,s;Exhibit.Localization._registry=t;Exhibit.locales.push(Exhibit.Localization._lastResortLocale);i=(typeof navigator.language=="string"?navigator.language:typeof navigator.browserLanguage=="string"?navigator.browserLanguage:Exhibit.Localization._lastResortLocale).split(";");for(n=0;n<i.length;n++){r=i[n];if(r!==Exhibit.Localization._lastResortLocale){s=r.split("-");s.length>1&&s[0]!==Exhibit.Localization._lastResortLocale&&Exhibit.locales.push(s[0]);Exhibit.locales.push(r)}}if(typeof Exhibit.params.locale=="string"&&Exhibit.params.locale!==Exhibit.Localization._lastResortLocale){s=Exhibit.params.locale.split("-");s.length>1&&s[0]!==Exhibit.Localization._lastResortLocale&&Exhibit.locales.push(s[0]);Exhibit.locales.push(Exhibit.params.locale)}if(!t.hasRegistry(Exhibit.Localization._registryKey)){t.createRegistry(Exhibit.Localization._registryKey);$(document).trigger("registerLocales.exhibit")}};Exhibit.Localization.registerLocale=function(e,t){if(!Exhibit.Localization._registry.isRegistered(Exhibit.Localization._registryKey,e)){Exhibit.Localization._registry.register(Exhibit.Localization._registryKey,e,t);$(document).trigger("localeRegistered.exhibit");return!0}return!1};Exhibit.Localization.hasLocale=function(e){return Exhibit.Localization._registry.isRegistered(Exhibit.Localization._registryKey,e)};Exhibit.Localization.getLocale=function(e){return Exhibit.Localization._registry.get(Exhibit.Localization._registryKey,e)};Exhibit.Localization.setLocale=function(e){var t,n,r;r=[];for(t=e.length-1;t>=0;t--){n=e[t];if(Exhibit.Localization.hasLocale(n)){typeof Exhibit.Localization._currentLocale=="undefined"&&(Exhibit.Localization._currentLocale=n);Exhibit.Localization._loadedLocales.push(n);r.push(Exhibit.Localization.getLocale(n).getURL())}}$(document).trigger("localeSet.exhibit",[r])};Exhibit.Localization.getCurrentLocale=function(){return Exhibit.Localization._currentLocale};Exhibit.Localization.getLoadableLocales=function(e){var t,n,r;n=Exhibit.Localization._loadedLocales;r=[];for(t=0;t<n.length;t++)e.indexOf(n[t])>=0&&r.push(n[t]);return r};Exhibit.Localization.importLocale=function(e,t){if(typeof Exhibit.l10n[e]=="undefined"){Exhibit.l10n[e]=t;$(document).trigger("localeLoaded.exhibit"
,[e])}};Exhibit.Localization.importExtensionLocale=function(e,t){typeof Exhibit.l10n[e]!="undefined"?$.extend(Exhibit.l10n[e],t):Exhibit.l10n[e]=t};Exhibit.Localization.decodeUTF8=function(e){var t;try{t=decodeURIComponent(escape(e))}catch(n){t=e}return t};Exhibit.Localization.lookup=function(e){var t,n;for(t=0;t<Exhibit.Localization._loadedLocales.length;t++){n=Exhibit.Localization._loadedLocales[t];if(typeof Exhibit.l10n[n]!="undefined"&&typeof Exhibit.l10n[n][e]!="undefined")return Exhibit.Localization.decodeUTF8(Exhibit.l10n[n][e])}return undefined};$(document).one("registerLocalization.exhibit",Exhibit.Localization._registerComponent);$(document).bind("localesRegistered.exhibit",function(){Exhibit.Localization.setLocale(Exhibit.locales)});Exhibit.SettingsUtilities={};Exhibit.SettingsUtilities.collectSettings=function(e,t,n){Exhibit.SettingsUtilities._internalCollectSettings(function(t){return e[t]},t,n)};Exhibit.SettingsUtilities.collectSettingsFromDOM=function(e,t,n){Exhibit.SettingsUtilities._internalCollectSettings(function(t){return Exhibit.getAttribute(e,t)},t,n)};Exhibit.SettingsUtilities._internalCollectSettings=function(e,t,n){var r,i,s,o,u,a,f,l,c;for(r in t)if(t.hasOwnProperty(r)){i=t[r];s=r;typeof i.name!="undefined"&&(s=i.name);typeof n[s]=="undefined"&&typeof i.defaultValue!="undefined"&&(n[s]=i.defaultValue);o=e(r);typeof o!="undefined"&&o!==null&&typeof o=="string"&&(o=o.trim());if(typeof o!="undefined"&&o!==null&&(typeof o=="string"&&o.length>0||typeof o!="string")){u="text";typeof i.type!="undefined"&&(u=i.type);a=1;typeof i.dimensions!="undefined"&&(a=i.dimensions);try{if(a>1){f=",";typeof i.separator!="undefined"&&(f=i.separator);l=o.split(f);if(l.length!==a)throw new Error(Exhibit._("%settings.error.inconsistentDimensions",a,f,o));for(c=0;c<l.length;c++)l[c]=Exhibit.SettingsUtilities._parseSetting(l[c].trim(),u,i);n[s]=l}else n[s]=Exhibit.SettingsUtilities._parseSetting(o,u,i)}catch(h){Exhibit.Debug.exception(h)}}}};Exhibit.SettingsUtilities._parseSetting=function(s,type,spec){var sType,f,n,choices,i;sType=typeof s;if(type==="text")return s;if(type==="float"){if(sType==="number")return s;if(sType==="string"){f=parseFloat(s);if(!isNaN(f))return f}throw new Error(Exhibit._("%settings.error.notFloatingPoint",s))}if(type==="int"){if(sType==="number")return Math.round(s);if(sType==="string"){n=parseInt(s,10);if(!isNaN(n))return n}throw new Error(Exhibit._("%settings.error.notInteger",s))}if(type==="boolean"){if(sType==="boolean")return s;if(sType==="string"){s=s.toLowerCase();if(s==="true")return!0;if(s==="false")return!1}throw new Error(Exhibit._("%settings.error.notBoolean",s))}if(type==="function"){if(sType==="function")return s;if(sType==="string")try{f=eval(s);if(typeof f=="function")return f}catch(e){}throw new Error(Exhibit._("%settings.error.notFunction",s))}if(type==="enum"){choices=spec.choices;for(i=0;i<choices.length;i++)if(choices[i]===s)return s;throw new Error(Exhibit._("%settings.error.notEnumerated",choices.join(", "),s))}throw new Error(Exhibit._("%settings.error.unknownSetting",type))};Exhibit.SettingsUtilities.createAccessors=function(e,t,n){Exhibit.SettingsUtilities._internalCreateAccessors(function(t){return e[t]},t,n)};Exhibit.SettingsUtilities.createAccessorsFromDOM=function(e,t,n){Exhibit.SettingsUtilities._internalCreateAccessors(function(t){return Exhibit.getAttribute(e,t)},t,n)};Exhibit.SettingsUtilities._internalCreateAccessors=function(e,t,n){var r,i,s,o,u,a,f,l,c;c=function(e,t,n){};a=function(t){u=!1;if(typeof t["bindings"]!="undefined")return Exhibit.SettingsUtilities._createBindingsAccessor(e,t.bindings);if(typeof t["bindingNames"]!="undefined"){u=!0;return Exhibit.SettingsUtilities._createTupleAccessor(e,t)}return Exhibit.SettingsUtilities._createElementalAccessor(e,t)};for(r in t)if(t.hasOwnProperty(r)){i=t[r];s=i.accessorName;accessor=null;u=!1;if(typeof i["alternatives"]!="undefined"){f=i.alternatives;for(l=0;l<f.length;l++){accessor=a(f[l]);if(accessor!==null)break}}else accessor=a(i);accessor!==null?n[s]=accessor:typeof n[s]=="undefined"&&(n[s]=c)}};Exhibit.SettingsUtilities._createBindingsAccessor=function(e,t){var n,r,i,s,o;n=[];for(r=0;r<t.length;r++){i=t[r];s=null;o=!1;if(typeof i["bindingNames"]!="undefined"){o=!0;s=Exhibit.SettingsUtilities._createTupleAccessor(e,i)}else s=Exhibit.SettingsUtilities._createElementalAccessor(e,i);if(typeof s=="undefined"||s===null){if(typeof i.optional=="undefined"||!i.optional)return null}else n.push({bindingName:i.bindingName,accessor:s,isTuple:o})}return function(e,t,r){Exhibit.SettingsUtilities._evaluateBindings(e,t,r,n)}};Exhibit.SettingsUtilities._createTupleAccessor=function(e,t){var n,r,i,s,o,u,a;n=e(t.attributeName);if(typeof n=="undefined"||n===null)return null;if(typeof n=="string"){n=n.trim();if(n.length===0)return null}try{r=Exhibit.ExpressionParser.parse(n);i=[];s=t.types;for(a=0;a<s.length;a++)i.push(Exhibit.SettingsUtilities._typeToParser(s[a]));o=t.bindingNames;u=",";typeof t["separator"]!="undefined"&&(u=t.separator);return function(e,t,n,s){r.evaluateOnItem(e,t).values.visit(function(e){var t,r,a,f;t=e.split(u);if(t.length===i.length){r={};if(s)for(a in s)s.hasOwnProperty(a)&&(r[a]=s[a]);for(f=0;f<o.length;f++){r[o[f]]=null;i[f](t[f],function(e){r[o[f]]=e})}n(r)}})}}catch(f){Exhibit.Debug.exception(f);return null}};Exhibit.SettingsUtilities._createElementalAccessor=function(e,t){var n,r,i,s;n=e(t.attributeName);if(typeof n=="undefined"||n===null)return null;if(typeof n=="string"){n=n.trim();if(n.length===0)return null}r="text";typeof t["type"]!="undefined"&&(r=t.type);try{i=Exhibit.ExpressionParser.parse(n);s=Exhibit.SettingsUtilities._typeToParser(r);return function(e,t,n){i.evaluateOnItem(e,t).values.visit(function(e){return s(e,n)})}}catch(o){Exhibit.Debug.exception(o);return null}};Exhibit.SettingsUtilities._typeToParser=function(e){switch(e){case"text":return Exhibit.SettingsUtilities._textParser;case"url":return Exhibit.SettingsUtilities._urlParser;case"float":return Exhibit.SettingsUtilities._floatParser;case"int":return Exhibit.SettingsUtilities._intParser;case"date":return Exhibit.SettingsUtilities._dateParser;case"boolean":return Exhibit.SettingsUtilities._booleanParser;default:throw new Error(Exhibit._("%settings.error.unknownSetting",e))}};Exhibit.SettingsUtilities._textParser=function(e,t){return t(e)};Exhibit.SettingsUtilities._floatParser=function(e,t){var n=parseFloat(e);return isNaN(n)?!1:t(n)};Exhibit.SettingsUtilities._intParser=function(e,t){var n=parseInt(e,10);return isNaN(n)?!1:t(n)};Exhibit.SettingsUtilities._dateParser=function(e,t){var n;if(e instanceof Date)return t(e);if(typeof e=="number"){n=new Date(0);n.setUTCFullYear(e);return t(n)}n=Exhibit.DateTime.parseIso8601DateTime(e.toString());return n!==null?t(n):!1};Exhibit.SettingsUtilities._booleanParser=function(e,t){e=e.toString().toLowerCase();return e==="true"?t(!0):e==="false"?t(!1):!1};Exhibit.SettingsUtilities._urlParser=function(e,t){return t(Exhibit.Persistence.resolveURL(e.toString()))};Exhibit.SettingsUtilities._evaluateBindings=function(e,t,n,r){var i,s;s=r.length-1;i=function(o,u){var a,l,c,h;a=r[u];l=!1;c=u===s?function(){n(o)}:function(){i(o,u+1)};if(a.isTuple)a.accessor(e,t,function(e){l=!0;o=e;c()},o);else{h=a.bindingName;a.accessor(e,t,function(e){l=!0;o[h]=e;c()})}l||c()};i({},0)};Exhibit.Coders={mixedCaseColor:"#fff",othersCaseColor:"#aaa",missingCaseColor:"#888"};Exhibit.FacetUtilities={};Exhibit.FacetUtilities.constructFacetFrame=function(e,t,n,r,i,s,o){var u,a;$(t).attr("class","exhibit-facet");u=$.simileDOM("string",t,'<div class="exhibit-facet-header"><div class="exhibit-facet-header-filterControl" id="clearSelectionsDiv" title="'+Exhibit._("%facets.clearSelectionsTooltip")+'">'+'<span id="filterCountSpan"></span>'+'<img id="checkImage" />'+"</div>"+(s?'<img src="'+Exhibit.urlPrefix+'images/collapse.png" class="exhibit-facet-header-collapse" id="collapseImg" />':"")+'<span class="exhibit-facet-header-title">'+n+"</span>"+"</div>"+'<div class="exhibit-facet-body-frame" id="frameDiv"></div>',{checkImage:Exhibit.UI.createTranslucentImage("images/black-check.png")});a=Exhibit.ResizableDivWidget.create({},u.frameDiv,i);u.valuesContainer=a.getContentDiv();$(u.valuesContainer).attr("class","exhibit-facet-body");u.setSelectionCount=function(e){$(this.filterCountSpan).html(e);$(this.clearSelectionsDiv).toggle(e>0)};$(u.clearSelectionsDiv).bind("click",r);if(s){$(u.collapseImg).bind("click",function(t){Exhibit.FacetUtilities.toggleCollapse(u,e)});o&&Exhibit.FacetUtilities.toggleCollapse(u,e)}return u};Exhibit.FacetUtilities.toggleCollapse=function(e,t){var n=e.frameDiv;if($(n).is(":visible")){$(n).hide();$(e.collapseImg).attr("src",Exhibit.urlPrefix+"images/expand.png")}else{$(n).show();$(e.collapseImg).attr("src",Exhibit.urlPrefix+"images/collapse.png");typeof t.onUncollapse=="function"&&t.onUncollapse()}};Exhibit.FacetUtilities.isCollapsed=function(e){var t=e._dom.frameDiv;return!$(t).is(":visible")};Exhibit.FacetUtilities.constructFacetItem=function(e,t,n,r,i,s,o,u){Exhibit.params.safe&&(e=Exhibit.Formatter.encodeAngleBrackets(e));var a=$.simileDOM("string","div",'<div class="exhibit-facet-value-count">'+t+"</div>"+'<div class="exhibit-facet-value-inner" id="inner">'+('<div class="exhibit-facet-value-checkbox">&#160;'+Exhibit.UI.createTranslucentImageHTML(i?r?"images/black-check.png":"images/no-check.png":"images/no-check-no-border.png")+"</div>")+'<a class="exhibit-facet-value-link" href="#" id="link"></a>'+"</div>");$(a.elmt).attr("class",r?"exhibit-facet-value exhibit-facet-value-selected":"exhibit-facet-value");if(typeof e=="string"){$(a.elmt).attr("title",e);$(a.link).html(e);typeof n!="undefined"&&n!==null&&$(a.link).css("color",n)}else{$(a.link).append(e);typeof n!="undefined"&&n!==null&&$(e).css("color",n)}$(a.elmt).bind("click",o);i&&$(a.inner).children(":first-child").bind("click",s);return a.elmt};Exhibit.FacetUtilities.constructFlowingFacetFrame=function(e,t,n,r,i,s,o){$(t).attr("class","exhibit-flowingFacet");var u=$.simileDOM("string",t,'<div class="exhibit-flowingFacet-header">'+(s?'<img src="'+Exhibit.urlPrefix+'images/collapse.png" class="exhibit-facet-header-collapse" id="collapseImg" />':"")+'<span class="exhibit-flowingFacet-header-title">'+n+"</span>"+"</div>"+'<div id="frameDiv"><div class="exhibit-flowingFacet-body" id="valuesContainer"></div></div>');u.setSelectionCount=function(e){};if(s){$(u.collapseImg).bind("click",function(t){Exhibit.FacetUtilities.toggleCollapse(u,e)});o&&Exhibit.FacetUtilities.toggleCollapse(u,e)}return u};Exhibit.FacetUtilities.constructFlowingFacetItem=function(e,t,n,r,i,s,o,u){Exhibit.params.safe&&(e=Exhibit.Formatter.encodeAngleBrackets(e));var a=$.simileDOM("string","div",'<div class="exhibit-flowingFacet-value-checkbox">'+$.simileBubble("createTranslucentImageHTML",Exhibit.urlPrefix+(i?r?"images/black-check.png":"images/no-check.png":"images/no-check-no-border.png"))+"</div>"+'<a class="exhibit-flowingFacet-value-link" href="#" id="inner"></a>'+" "+'<span class="exhibit-flowingFacet-value-count">('+t+")</span>");$(a.elmt).attr("class",r?"exhibit-flowingFacet-value exhibit-flowingFacet-value-selected":"exhibit-flowingFacet-value");if(typeof e=="string"){$(a.elmt).attr("title",e);$(a.inner).html(e);typeof n!="undefined"&&n!==null&&$(a.inner).css("color",n)}else{$(a.inner).append(e);typeof n!="undefined"&&n!==null&&$(e).css("color",n)}$(a.elmt).bind("click",o);i&&$(a.elmt).children(":first-child").bind("click",s);return a.elmt};Exhibit.FacetUtilities.constructHierarchicalFacetItem=function(e,t,n,r,i,s,o,u,a,f,l){Exhibit.params.safe&&(e=Exhibit.Formatter.encodeAngleBrackets(e));var c=$.simileDOM("string","div",'<div class="exhibit-facet-value-count">'+t+"</div>"+'<div class="exhibit-facet-value-inner" id="inner">'+('<div class="exhibit-facet-value-checkbox">&#160;'+$.simileBubble("createTranslucentImageHTML",Exhibit.urlPrefix+(o?r?"images/black-check.png":"images/no-check.png":"images/no-check-no-border.png"))+"</div>")+'<a class="exhibit-facet-value-link" href="#" id="link"></a>'+(i?'<a class="exhibit-facet-value-children-toggle" href="#" id="toggle">'+$.simileBubble("createTranslucentImageHTML",Exhibit.urlPrefix+"images/down-arrow.png")+$.simileBubble("createTranslucentImageHTML",Exhibit.urlPrefix+"images/right-arrow.png")+"</a>":"")+"</div>"+(i?'<div class="exhibit-facet-childrenContainer" id="childrenContainer"></div>':""));$(c.elmt).attr("class",r?"exhibit-facet-value exhibit-facet-value-selected":"exhibit-facet-value");if(typeof e=="string"){$(c.elmt).attr("title",e);$(c.link).append(document.createTextNode(e));typeof n!="undefined"&&n!==null&&$(c.link).css("color",n)}else{$(c.link).append(e);typeof n!="undefined"&&n!==null&&$(e).css("color",n)}$(c.elmt).bind("click",a);o&&$(c.elmt).children(":last-child").bind("click",u);if(i){c.showChildren=function(e){$(c.childrenContainer).toggle(e);$(c.toggle).children(":eq(0)").toggle(e);$(c.toggle).children(":eq(1)").toggle(!e)};$(c.toggle).bind("click",f);c.showChildren(s)}return c};Exhibit.FacetUtilities.constructFlowingHierarchicalFacetItem=function(e,t,n,r,i,s,o,u,a,f,l){Exhibit.params.safe&&(e=Exhibit.Formatter.encodeAngleBrackets(e));var c=$.simileDOM("string","div",'<div class="exhibit-flowingFacet-value-checkbox">'+$.simileBubble("createTranslucentImageHTML",Exhibit.urlPrefix+(o?r?"images/black-check.png":"images/no-check.png":"images/no-check-no-border.png"))+"</div>"+'<a class="exhibit-flowingFacet-value-link" href="#" id="inner"></a>'+" "+'<span class="exhibit-flowingFacet-value-count">('+t+")</span>"+(i?'<a class="exhibit-flowingFacet-value-children-toggle" href="#" id="toggle">'+$.simileBubble("createTranslucentImageHTML",Exhibit.urlPrefix+"images/down-arrow.png")+$.simileBubble("createTranslucentImageHTML",Exhibit.urlPrefix+"images/right-arrow.png")+"</a>":"")+(i?'<div class="exhibit-flowingFacet-childrenContainer" id="childrenContainer"></div>':""));$(c.elmt).attr("class",r?"exhibit-flowingFacet-value exhibit-flowingFacet-value-selected":"exhibit-flowingFacet-value");if(typeof e=="string"){$(c.elmt).attr("title",e);$(c.inner).append(document.createTextNode(e));typeof n!="undefined"&&n!==null&&$(c.inner).css("color",n)}else{$(c.inner).append(e);typeof n!="undefined"&&n!==null&&$(e).css("color",n)}$(c.elmt).bind("click",a);o&&$(c.elmt).children(":first-child").bind("click",u);if(i){c.showChildren=function(e){$(c.childrenContainer).toggle(e);$(c.toggle).children(":eq(0)").toggle(e);$(c.toggle).children(":eq(1)").toggle(!e)};$(c.toggle).bind("click",f);c.showChildren(s)}return c};Exhibit.FacetUtilities.Cache=function(e,t,n){var r=this;this._database=e;this._collection=t;this._expression=n;this._onRootItemsChanged=function(){typeof r._itemToValue!="undefined"&&delete r._itemToValue;typeof r._valueToItem!="undefined"&&delete r._valueToItem;typeof r._missingItems!="undefined"&&delete r._missingItems};$(t.getElement()).bind("onRootItemsChanged.exhibit",this._onRootItemsChanged)};Exhibit.FacetUtilities.Cache.prototype.dispose=function(){$(this._collection.getElement()).unbind("onRootItemsChanged.exhibit",this._onRootItemsChanged);this._collection=null;this._listener=null;this._itemToValue=null;this._valueToItem=null;this._missingItems=null};Exhibit.FacetUtilities.Cache.prototype.getItemsFromValues=function(e,t){var n,r;if(this._expression.isPath())n=this._expression.getPath().walkBackward(e,"item",t,this._database).getSet();else{this._buildMaps();n=new Exhibit.Set;r=this._valueToItem;e.visit(function(e){var i,s,o;if(typeof valuetoItem[e]!="undefined"){i=r[e];for(s=0;s<i.length;s++){o=i[s];t.contains(o)&&n.add(o)}}})}return n};Exhibit.FacetUtilities.Cache.prototype.getItemsMissingValue=function(e,t){this._buildMaps();t=t||new Exhibit.Set;var n=this._missingItems;e.visit(function(e){typeof n[e]!="undefined"&&t.add(e)});return t};Exhibit.FacetUtilities.Cache.prototype.getValueCountsFromItems=function(e){var t,n,r,i,s,o,u,a,f;t=[];n=this._database;r="text";if(this._expression.isPath()){i=this._expression.getPath();s=i.walkForward(e,"item",n);r=s.valueType;s.size>0&&s.forEachValue(function(s){var o=i.evaluateBackward(s,r,e,n);t.push({value:s,count:o.size})})}else{this._buildMaps();r=this._valueType;for(o in this._valueToItem)if(this._valueToItem.hasOwnProperty(o)){u=this._valueToItem[o];a=0;for(f=0;f<u.length;f++)e.contains(u[f])&&a++;a>0&&t.push({value:o,count:a})}}return{entries:t,valueType:r}};Exhibit.FacetUtilities.Cache.prototype.getValuesFromItems=function(e){var t,n;if(this._expression.isPath())return this._expression.getPath().walkForward(e,"item",database).getSet();this._buildMaps();t=new Exhibit.Set;n=this._itemToValue;e.visit(function(e){var r,i;if(typeof n[e]!="undefined"){r=n[e];for(i=0;i<r.length;i++)t.add(r[i])}});return t};Exhibit.FacetUtilities.Cache.prototype.countItemsMissingValue=function(e){var t,n;this._buildMaps();t=0;for(n in this._missingItems)this._missingItems.hasOwnProperty(n)&&e.contains(n)&&t++;return t};Exhibit.FacetUtilities.Cache.prototype._buildMaps=function(){var e,t,n,r,i,s,o;if(typeof this._itemToValue=="undefined"){e={};t={};n={};r="text";i=function(e,t,n){typeof n.x!="undefined"?n[e].push(t):n[e]=[t]};s=this._expression;o=this._database;this._collection.getAllItems().visit(function(u){var a=s.evaluateOnItem(u,o);if(a.values.size()>0){r=a.valueType;a.values.visit(function(n){i(u,n,e);i(n,u,t)})}else n[u]=!0});this._itemToValue=e;this._valueToItem=t;this._missingItems=n;this._valueType=r}};Exhibit.ViewUtilities={};Exhibit.ViewUtilities.openBubbleForItems=function(e,t,n){var r,i;r=$(e).offset();i=$.simileBubble("createBubbleForPoint",r.left+Math.round(e.offsetWidth/2),r.top+Math.round(e.offsetHeight/2),n.getSetting("bubbleWidth"),n.getSetting("bubbleHeight"));Exhibit.ViewUtilities.fillBubbleWithItems(i.content,t,n)};Exhibit.ViewUtilities.fillBubbleWithItems=function(e,t,n){var r,i,s,o;if(typeof e=="undefined"||e===null)e=$("<div>");if(t.length>1){$(e).addClass("exhibit-views-bubbleWithItems");r=$("<ul>");makeItem=function(e){$("<li>").append(e).appendTo(r)};for(i=0;i<t.length;i++)n.format(t[i],"item",makeItem);$(e).append(r)}else{s=$("<div>").get(0);o=n.getLensRegistry().createLens(t[0],s,n);$(e).append(s)}return $(e).get(0)};Exhibit.ViewUtilities.constructPlottingViewDom=function(e,t,n,r,i){var s=$.simileDOM("string",e,'<div class="exhibit-views-header">'+(n?'<div id="collectionSummaryDiv"></div>':"")+'<div id="unplottableMessageDiv" class="exhibit-views-unplottableMessage"></div>'+"</div>"+'<div id="resizableDiv"></div>'+'<div id="legendDiv"></div>',{});n&&(s.collectionSummaryWidget=Exhibit.CollectionSummaryWidget.create({},s.collectionSummaryDiv,t));s.resizableDivWidget=Exhibit.ResizableDivWidget.create(r,s.resizableDiv,t);s.plotContainer=s.resizableDivWidget.getContentDiv();i.colorGradient===!0?s.legendGradientWidget=Exhibit.LegendGradientWidget.create(s.legendDiv,t):s.legendWidget=Exhibit.LegendWidget.create(i,s.legendDiv,t);s.setUnplottableMessage=function(e,n){Exhibit.ViewUtilities._setUnplottableMessage(s,e,n,t)};s.dispose=function(){n&&s.collectionSummaryWidget.dispose();s.resizableDivWidget.dispose();s.legendWidget.dispose()};return s};Exhibit.ViewUtilities._setUnplottableMessage=function(e,t,n,r){var i;i=e.unplottableMessageDiv;if(n.length===0)$(i).hide();else{$(i).empty();e=$.simileDOM("string",i,Exhibit.ViewUtilities.unplottableMessageFormatter(t,n),{});$(e.unplottableCountLink).bind("click",function(e){Exhibit.ViewUtilities.openBubbleForItems(e.target,n,r)});$(i).show()}};Exhibit.ViewUtilities.unplottableMessageFormatter=function(e,t){var n=t.length;return Exhibit._("%views.unplottableTemplate",n,Exhibit._(n===1?"%views.resultLabel":"%views.resultsLabel"),e)};Exhibit.ViewUtilities.getSortLabels=function(e){var t,n,r,i;i=function(e,t){return"%database.sortLabels."+e+"."+t};t=Exhibit._(i(e,"ascending"));typeof t!="undefined"&&t!==null?r={ascending:t,descending:Exhibit._(i(e,"descending"))}:r=Exhibit.ViewUtilities.getSortLabels("text");return r};Exhibit.ViewUtilities.makePagingActionTitle=function(e){return Exhibit._("%orderedViewFrame.pagingActionTitle",e+1)};Exhibit.ViewUtilities.makePagingLinkTooltip=function(e){return Exhibit._("%orderedViewFrame.pagingLinkTooltip",e+1)};Exhibit.Database={defaultIgnoredProperties:["uri","modified"]};Exhibit.Database.create=function(e){return typeof Exhibit.Database[e]!="undefined"?new Exhibit.Database[e]:new Exhibit.Database._LocalImpl};Exhibit.Database._indexPut=function(e,t,n,r){var i,s,o;i=e[t];if(typeof i=="undefined"){i={};e[t]=i}s=i[n];if(typeof s=="undefined"){s=[];i[n]=s}else for(o=0;o<s.length;o++)if(r===s[o])return;s.push(r)};Exhibit.Database._indexPutList=function(e,t,n,r){var i,s;i=e[t];if(typeof i=="undefined"){i={};e[t]=i}s=i[n];typeof s=="undefined"?i[n]=r:i[n]=i[n].concat(r)};Exhibit.Database._indexRemove=function(e,t,n,r){var i,s,o,u,a;i=e[t];if(typeof i=="undefined")return!1;s=i[n];if(typeof s=="undefined")return!1;for(o=0;o<s.length;o++)if(r===s[o]){s.splice(o,1);if(s.length===0){delete i[n];a=!0;for(u in i)if(i.hasOwnProperty(u)){a=!1;break}a&&delete e[t]}return!0}};Exhibit.Database._indexRemoveList=function(e,t,n){var r,i,s,o;r=e[t];if(typeof r=="undefined")return null;i=r[n];if(typeof i=="undefined")return null;delete r[n];o=!0;for(s in r)if(r.hasOwnProperty(s)){o=!1;break}o&&delete e[t];return i};Exhibit.Database._LocalImpl=function(){this._types={};this._properties={};this._propertyArray={};this._spo={};this._ops={};this._items=new Exhibit.Set;var e,t,n,r;e=new Exhibit.Database.Type("Item");e._custom={label:Exhibit._("%database.itemType.label"),pluralLabel:Exhibit._("%database.itemType.pluralLabel"),uri:Exhibit.namespace+"Item"};this._types.Item=e;t=new Exhibit.Database.Property("label",this);t._uri="http://www.w3.org/2000/01/rdf-schema#label";t._valueType="text";t._label=Exhibit._("%database.labelProperty.label");t._pluralLabel=Exhibit._("%database.labelProperty.pluralLabel");t._reverseLabel=Exhibit._("%database.labelProperty.reverseLabel");t._reversePluralLabel=Exhibit._("%database.labelProperty.reversePluralLabel");t._groupingLabel=Exhibit._("%database.labelProperty.groupingLabel");t._reverseGroupingLabel=Exhibit._("%database.labelProperty.reverseGroupingLabel");this._properties.label=t;n=new Exhibit.Database.Property("type",this);n._uri="http://www.w3.org/1999/02/22-rdf-syntax-ns#type";n._valueType="text";n._label=Exhibit._("%database.typeProperty.label");n._pluralLabel=Exhibit._("%database.typeProperty.pluralLabel");n._reverseLabel=Exhibit._("%database.typeProperty.reverseLabel");n._reversePluralLabel=Exhibit._("%database.typeProperty.reversePluralLabel");n._groupingLabel=Exhibit._("%database.typeProperty.groupingLabel");n._reverseGroupingLabel=Exhibit._("%database.typeProperty.reverseGroupingLabel");this._properties.type=n;r=new Exhibit.Database.Property("uri",this);r._uri="http://simile.mit.edu/2006/11/exhibit#uri";r._valueType="url";r._label=Exhibit._("%database.uriProperty.label");r._pluralLabel=Exhibit._("%database.uriProperty.pluralLabel");r._reverseLabel=Exhibit._("%database.uriProperty.reverseLabel");r._reversePluralLabel=Exhibit._("%database.uriProperty.reversePluralLabel");r._groupingLabel=Exhibit._("%database.uriProperty.groupingLabel");r._reverseGroupingLabel=Exhibit._("%database.uriProperty.reverseGroupingLabel");this._properties.uri=r};Exhibit.Database._LocalImpl.prototype.createDatabase=function(){return Exhibit.Database.create()};Exhibit.Database._LocalImpl.prototype.loadLinks=function(e){var t=$("head > link[rel='exhibit-data']").add("head > link[rel='exhibit/data']");this._loadLinks(t.toArray(),this,e)};Exhibit.Database._LocalImpl.prototype.loadData=function(e,t){if(typeof e=="undefined"||e===null)throw Error(Exhibit._("%database.error.unloadable"));typeof t=="undefined"&&(t=location.href);typeof e.types!="undefined"&&this.loadTypes(e.types,t);typeof e.properties!="undefined"&&this.loadProperties(e.properties,t);typeof e.items!="undefined"&&this.loadItems(e.items,t)};Exhibit.Database._LocalImpl.prototype.loadTypes=function(e,t){$(document).trigger("onBeforeLoadingTypes.exhibit");var n,r,i,s,o;try{n=t.substr(t.length-1);n==="#"?t=t.substr(0,t.length-1)+"/":n!=="/"&&n!==":"&&(t+="/");for(r in e)if(e.hasOwnProperty(r)&&typeof r=="string"){i=e[r];if(typeof i=="object"){if(typeof this._types[r]!="undefined")s=this._types[r];else{s=new Exhibit.Database.Type(r);this._types[r]=s}for(o in i)i.hasOwnProperty(o)&&(s._custom[o]=i[o]);typeof s._custom.uri=="undefined"&&(s._custom.uri=t+"type#"+encodeURIComponent(r));typeof s._custom.label=="undefined"&&(s._custom.label=r)}}$(document).trigger("onAfterLoadingTypes.exhibit")}catch(u){Exhibit.Debug.exception(u,Exhibit._("%database.error.loadTypesFailure"))}};Exhibit.Database._LocalImpl.prototype.loadProperties=function(e,t){$(document).trigger("onBeforeLoadingProperties.exhibit");var n,r,i,s;try{n=t.substr(t.length-1);n==="#"?t=t.substr(0,t.length-1)+"/":n!=="/"&&n!==":"&&(t+="/");for(r in e)if(e.hasOwnProperty(r)&&typeof r=="string"){propertyEntry=e[r];if(typeof propertyEntry=="object"){if(typeof this._properties[r]!="undefined")s=this._properties[r];else{s=new Exhibit.Database.Property(r,this);this._properties[r]=s}s._uri=typeof propertyEntry.uri!="undefined"?propertyEntry.uri:t+"property#"+encodeURIComponent(r);s._valueType=typeof propertyEntry.valueType!="undefined"?propertyEntry.valueType:"text";s._label=typeof propertyEntry.label!="undefined"?propertyEntry.label:r;s._pluralLabel=typeof propertyEntry.pluralLabel!="undefined"?propertyEntry.pluralLabel:s._label;s._reverseLabel=typeof propertyEntry.reverseLabel!="undefined"?propertyEntry.reverseLabel:"!"+s._label;s._reversePluralLabel=typeof propertyEntry.reversePluralLabel!="undefined"?propertyEntry.reversePluralLabel:"!"+s._pluralLabel;s._groupingLabel=typeof propertyEntry.groupingLabel!="undefined"?propertyEntry.groupingLabel:s._label;s._reverseGroupingLabel=typeof propertyEntry.reverseGroupingLabel!="undefined"?propertyEntry.reverseGroupingLabel:s._reverseLabel;typeof propertyEntry.origin!="undefined"&&(s._origin=propertyEntry.origin)}}this._propertyArray=null;$(document).trigger("onAfterLoadingProperties.exhibit")}catch(o){Exhibit.Debug.exception(o,Exhibit._("%database.error.loadPropertiesFailure"))}};Exhibit.Database._LocalImpl.prototype.loadItems=function(e,t){$(document).trigger("onBeforeLoadingItems.exhibit");var n,r,i,s,o,u,a;try{n=t.substr(t.length-1);n==="#"?t=t.substr(0,t.length-1)+"/":n!=="/"&&n!==":"&&(t+="/");r=this._spo;i=this._ops;s=Exhibit.Database._indexPut;o=function(e,t,n){s(r,e,t,n);s(i,n,t,e)};for(u=0;u<e.length;u++){a=e[u];typeof a=="object"&&this._loadItem(a,o,t)}this._propertyArray=null;$(document).trigger("onAfterLoadingItems.exhibit")}catch(f){Exhibit.Debug.exception(f,Exhibit._("%database.error.loadItemsFailure"))}};Exhibit.Database._LocalImpl.prototype.getType=function(e){return typeof this._types[e]?this._types[e]:null};Exhibit.Database._LocalImpl.prototype.getProperty=function(e){return typeof this._properties[e]!="undefined"?this._properties[e]:null};Exhibit.Database._LocalImpl.prototype.getAllProperties=function(){var e;if(this._propertyArray===null){this._propertyArray=[];for(e in this._properties)this._properties.hasOwnProperty(e)&&this._propertyArray.push(e)}return[].concat(this._propertyArray)};Exhibit.Database._LocalImpl.prototype.getAllItems=function(){var e=new Exhibit.Set;e.addSet(this._items);return e};Exhibit.Database._LocalImpl.prototype.getAllItemsCount=function(){return this._items.size()};Exhibit.Database._LocalImpl.prototype.containsItem=function(e){return this._items.contains(e)};Exhibit.Database._LocalImpl.prototype.getNamespaces=function(e,t){var n={},r,i,s,o,u,a,f,l,c,h,p;for(r in this._properties)if(this._properties.hasOwnProperty(r)){i=this._properties[r];s=i.getURI();o=s.indexOf("#");a=s.lastIndexOf("/");if(o>0){u=s.substr(0,o+1);n[u]=!0;e[r]={base:u,localName:s.substr(o+1)}}else if(a>0){u=s.substr(0,a+1);n[u]=!0;e[r]={base:u,localName:s.substr(a+1)}}}f={};l="abcdefghijklmnopqrstuvwxyz";c=0;for(u in n)if(n.hasOwnProperty(u)){h=l.substr(c++,1);t[h]=u;f[u]=h}for(r in e)if(e.hasOwnProperty(r)){p=e[r];p.prefix=f[p.base]}};Exhibit.Database._LocalImpl.prototype.getObjects=function(e,t,n,r){return this._get(this._spo,e,t,n,r)};Exhibit.Database._LocalImpl.prototype.countDistinctObjects=function(e,t,n){return this._countDistinct(this._spo,e,t,n)};Exhibit.Database._LocalImpl.prototype.getObjectsUnion=function(e,t,n,r){return this._getUnion(this._spo,e,t,n,r)};Exhibit.Database._LocalImpl.prototype.countDistinctObjectsUnion=function(e,t,n){return this._countDistinctUnion(this._spo,e,t,n)};Exhibit.Database._LocalImpl.prototype.getSubjects=function(e,t,n,r){return this._get(this._ops,e,t,n,r)};Exhibit.Database._LocalImpl.prototype.countDistinctSubjects=function(e,t,n){return this._countDistinct(this._ops,e,t,n)};Exhibit.Database._LocalImpl.prototype.getSubjectsUnion=function(e,t,n,r){return this._getUnion(this._ops,e,t,n,r)};Exhibit.Database._LocalImpl.prototype.countDistinctSubjectsUnion=function(e,t,n){return this._countDistinctUnion(this._ops,e,t,n)};Exhibit.Database._LocalImpl.prototype.getObject=function(e,t){var n,r;n=this._spo[e];if(n){r=n[t];if(r)return r[0]}return null};Exhibit.Database._LocalImpl.prototype.getSubject=function(e,t){var n,r;n=this._ops[e];if(n){r=n[t];if(r)return r[0]}return null};Exhibit.Database._LocalImpl.prototype.getForwardProperties=function(e){return this._getProperties(this._spo,e)};Exhibit.Database._LocalImpl.prototype.getBackwardProperties=function(e){return this._getProperties(this._ops,e)};Exhibit.Database._LocalImpl.prototype.getSubjectsInRange=function(e,t,n,r,i,s){var o,u;o=this.getProperty(e);if(o!==null){u=o.getRangeIndex();if(u!==null)return u.getSubjectsInRange(t,n,r,i,s)}return i?i:new Exhibit.Set};Exhibit.Database._LocalImpl.prototype.getTypeIDs=function(e){return this.getObjectsUnion(e,"type",null,null)};Exhibit.Database._LocalImpl.prototype.addStatement=function(e,t,n){var r=Exhibit.Database._indexPut;r(this._spo,e,t,n);r(this._ops,n,t,e)};Exhibit.Database._LocalImpl.prototype.removeStatement=function(e,t,n){var r,i,s;r=Exhibit.Database._indexRemove;i=r(this._spo,e,t,n);s=r(this._ops,n,t,e);return i||s};Exhibit.Database._LocalImpl.prototype.removeObjects=function(e,t){var n,r,i,s;n=Exhibit.Database._indexRemove;r=Exhibit.Database._indexRemoveList;i=r(this._spo,e,t);if(i===null)return!1;for(s=0;s<i.length;s++)n(this._ops,i[s],t,e);return!0};Exhibit.Database._LocalImpl.prototype.removeSubjects=function(e,t){var n,r,i,s;n=Exhibit.Database._indexRemove;r=Exhibit.Database._indexRemoveList;i=r(this._ops,e,t);if(i===null)return!1;for(s=0;s<i.length;s++)n(this._spo,i[s],t,e);return!0};Exhibit.Database._LocalImpl.prototype.removeAllStatements=function(){$(document).trigger("onBeforeRemovingAllStatements.exhibit");var e;try{this._spo={};this._ops={};this._items=new Exhibit.Set;for(e in this._properties)this._properties.hasOwnProperty(e)&&this._properties[e]._onNewData();this._propertyArray=null;$(document).trigger("onAfterRemovingAllStatements.exhibit")}catch(t){Exhibit.Debug.exception(t,Exhibit._("%database.error.removeAllStatementsFailure"))}};Exhibit.Database._LocalImpl.prototype._loadLinks=function(e,t,n){var r,i,s,o;e=[].concat(e);r=function(){while(e.length>0){i=e.shift();s=$(i).attr("type");if(typeof s=="undefined"||s===null||s.length===0)s="application/json";o=Exhibit.Importer.getImporter(s);if(typeof o!="undefined"&&o!==null){o.load(i,t,r);return}Exhibit.Debug.log(Exhibit._("%database.error.noImporterFailure",s))}typeof n!="undefined"&&n!==null&&n()};r()};Exhibit.Database._LocalImpl.prototype._loadItem=function(e,t,n){var r,i,s,o,u,a,f,l;if(typeof e.label=="undefined"&&typeof e.id=="undefined"){Exhibit.Debug.warn(Exhibit._("%database.error.itemSyntaxError",JSON.stringify(e)));e.label="item"+Math.ceil(Math.random()*1e6)}if(typeof e.label=="undefined"){r=e.id;this._items.contains(r)||Exhibit.Debug.warn(Exhibit._("%database.error.itemMissingLabelFailure",JSON.stringify(e)))}else{i=e.label;r=typeof e.id!="undefined"?e.id:i;s=typeof e.uri!="undefined"?e.uri:n+"item#"+encodeURIComponent(r);o=typeof e.type!="undefined"?e.type:"Item";u=function(e){return e.constructor.toString().indexOf("Array")===-1?!1:!0};u(i)&&(i=i[0]);u(r)&&(r=r[0]);u(s)&&(s=s[0]);u(o)&&(o=o[0]);this._items.add(r);t(r,"uri",s);t(r,"label",i);t(r,"type",o);this._ensureTypeExists(o,n)}for(a in e)if(e.hasOwnProperty(a)&&typeof a=="string"&&a!=="uri"&&a!=="label"&&a!=="id"&&a!=="type"){this._ensurePropertyExists(a,n)._onNewData();f=e[a];if(f instanceof Array)for(l=0;l<f.length;l++)t(r,a,f[l]);else f!==undefined&&f!==null&&t(r,a,f)}};Exhibit.Database._LocalImpl.prototype._ensureTypeExists=function(e,t){var n;if(typeof this._types[e]=="undefined"){n=new Exhibit.Database
.Type(e);n._custom.uri=t+"type#"+encodeURIComponent(e);n._custom.label=e;this._types[e]=n}};Exhibit.Database._LocalImpl.prototype._ensurePropertyExists=function(e,t){var n;if(typeof this._properties[e]=="undefined"){n=new Exhibit.Database.Property(e,this);n._uri=t+"property#"+encodeURIComponent(e);n._valueType="text";n._label=e;n._pluralLabel=n._label;n._reverseLabel=Exhibit._("%database.reverseLabel",n._label);n._reversePluralLabel=Exhibit._("%database.reversePluralLabel",n._pluralLabel);n._groupingLabel=n._label;n._reverseGroupingLabel=n._reverseLabel;this._properties[e]=n;this._propertyArray=null;return n}return this._properties[e]};Exhibit.Database._LocalImpl.prototype._indexFillSet=function(e,t,n,r,i){var s,o,u,a;s=e[t];if(typeof s!="undefined"){o=s[n];if(typeof o!="undefined")if(i)for(u=0;u<o.length;u++){a=o[u];i.contains(a)&&r.add(a)}else for(u=0;u<o.length;u++)r.add(o[u])}};Exhibit.Database._LocalImpl.prototype._indexCountDistinct=function(e,t,n,r){var i,s,o,u;i=0;s=e[t];if(s){o=s[n];if(o)if(r)for(u=0;u<o.length;u++)r.contains(o[u])&&i++;else i=o.length}return i};Exhibit.Database._LocalImpl.prototype._get=function(e,t,n,r,i){if(typeof r=="undefined"||r===null)r=new Exhibit.Set;this._indexFillSet(e,t,n,r,i);return r};Exhibit.Database._LocalImpl.prototype._getUnion=function(e,t,n,r,i){var s;if(typeof r=="undefined"||r===null)r=new Exhibit.Set;s=this;t.visit(function(t){s._indexFillSet(e,t,n,r,i)});return r};Exhibit.Database._LocalImpl.prototype._countDistinctUnion=function(e,t,n,r){var i,s;i=0;s=this;t.visit(function(t){i+=s._indexCountDistinct(e,t,n,r)});return i};Exhibit.Database._LocalImpl.prototype._countDistinct=function(e,t,n,r){return this._indexCountDistinct(e,t,n,r)};Exhibit.Database._LocalImpl.prototype._getProperties=function(e,t){var n,r,i;n=e[t];r=[];if(typeof n!="undefined")for(i in n)n.hasOwnProperty(i)&&r.push(i);return r};Exhibit.Database._LocalImpl.prototype.labelItemsOfType=function(e,t,n){var r,i,s,o;r=Exhibit._(e===1?"":"");i=this.getType(t);if(typeof i!="undefined"&&i!==null){r=i.getLabel();if(e!==1){s=i.getProperty("pluralLabel");typeof s!="undefined"&&s!==null&&(r=s)}}o=$("<span>").html($("<span>").attr("class",n).html(e)).append(" "+r);return o};Exhibit.Database._LocalImpl.prototype.getItem=function(e){};Exhibit.Database._LocalImpl.prototype.addItem=function(e){};Exhibit.Database._LocalImpl.prototype.editItem=function(e,t,n){};Exhibit.Database._LocalImpl.prototype.removeItem=function(e){};Exhibit.Database.Type=function(e){this._id=e;this._custom={}};Exhibit.Database.Type.prototype.getID=function(){return this._id};Exhibit.Database.Type.prototype.getURI=function(){return this._custom.uri};Exhibit.Database.Type.prototype.getLabel=function(){return this._custom.label};Exhibit.Database.Type.prototype.getOrigin=function(){return this._custom.origin};Exhibit.Database.Type.prototype.getProperty=function(e){return this._custom[e]};Exhibit.Database.Property=function(e,t){this._id=e;this._database=t;this._rangeIndex=null};Exhibit.Database.Property.prototype.getID=function(){return this._id};Exhibit.Database.Property.prototype.getURI=function(){return this._uri};Exhibit.Database.Property.prototype.getValueType=function(){return this._valueType};Exhibit.Database.Property.prototype.getLabel=function(){return this._label};Exhibit.Database.Property.prototype.getPluralLabel=function(){return this._pluralLabel};Exhibit.Database.Property.prototype.getReverseLabel=function(){return this._reverseLabel};Exhibit.Database.Property.prototype.getReversePluralLabel=function(){return this._reversePluralLabel};Exhibit.Database.Property.prototype.getGroupingLabel=function(){return this._groupingLabel};Exhibit.Database.Property.prototype.getReverseGroupingLabel=function(){return this._reverseGroupingLabel};Exhibit.Database.Property.prototype.getOrigin=function(){return this._origin};Exhibit.Database.Property.prototype.getRangeIndex=function(){this._rangeIndex===null&&this._buildRangeIndex();return this._rangeIndex};Exhibit.Database.Property.prototype._onNewData=function(){this._rangeIndex=null};Exhibit.Database.Property.prototype._buildRangeIndex=function(){var e,t,n;t=this._database;n=this._id;switch(this.getValueType()){case"currency":case"number":e=function(e,r){t.getObjects(e,n,null,null).visit(function(e){typeof e!="number"&&(e=parseFloat(e));isNaN(e)||r(e)})};break;case"date":e=function(e,r){t.getObjects(e,n,null,null).visit(function(e){typeof e!="undefined"&&e!==null&&!(e instanceof Date)&&(e=Exhibit.DateTime.parseIso8601DateTime(e));e instanceof Date&&r(e.getTime())})};break;default:e=function(e,t){}}this._rangeIndex=new Exhibit.Database.RangeIndex(t.getAllItems(),e)};Exhibit.Database.RangeIndex=function(e,t){var n=[];e.visit(function(e){t(e,function(t){n.push({item:e,value:t})})});n.sort(function(e,t){var n=e.value-t.value;return isNaN(n)===!1?n:e.value.localeCompare(t.value)});this._pairs=n};Exhibit.Database.RangeIndex.prototype.getCount=function(){return this._pairs.length};Exhibit.Database.RangeIndex.prototype.getMin=function(){return this._pairs.length>0?this._pairs[0].value:Number.POSITIVE_INFINITY};Exhibit.Database.RangeIndex.prototype.getMax=function(){return this._pairs.length>0?this._pairs[this._pairs.length-1].value:Number.NEGATIVE_INFINITY};Exhibit.Database.RangeIndex.prototype.getRange=function(e,t,n,r){var i,s,o,u,a;i=this._indexOf(t);s=this._pairs;o=s.length;r=!!r;while(i<o){u=s[i++];a=u.value;if(!(a<n||a===n&&r))break;e(u.item)}};Exhibit.Database.RangeIndex.prototype.getSubjectsInRange=function(e,t,n,r,i){if(typeof r=="undefined"||r===null)r=new Exhibit.Set;var s=typeof i!="undefined"&&i!==null?function(e){i.contains(e)&&r.add(e)}:function(e){r.add(e)};this.getRange(s,e,t,n);return r};Exhibit.Database.RangeIndex.prototype.countRange=function(e,t,n){var r,i,s,o;r=this._indexOf(e);i=this._indexOf(t);if(n){s=this._pairs;o=s.length;while(i<o){if(s[i].value!==t)break;i++}}return i-r};Exhibit.Database.RangeIndex.prototype._indexOf=function(e){var t,n,r,i,s;t=this._pairs;if(t.length===0||t[0].value>=e)return 0;n=0;r=t.length;while(n+1<r){i=n+r>>1;s=t[i].value;s>=e?r=i:n=i}return r};Exhibit.Collection=function(e,t){this._id=e;this._database=t;this._elmt=null;this._facets=[];this._updating=!1;this._items=null;this._restrictedItems=null};Exhibit.Collection.createAllItemsCollection=function(e,t){var n=new Exhibit.Collection(e,t);n._update=Exhibit.Collection._allItemsCollection_update;Exhibit.Collection._initializeBasicCollection(n,t);n._setElement();return n};Exhibit.Collection.create=function(e,t,n){var r=new Exhibit.Collection(e,n);r._setElement();if(typeof t["itemTypes"]!="undefined"){r._itemTypes=t.itemTypes;r._update=Exhibit.Collection._typeBasedCollection_update}else r._update=Exhibit.Collection._allItemsCollection_update;Exhibit.Collection._initializeBasicCollection(r,n);return r};Exhibit.Collection.createFromDOM=function(e,t,n){var r,i;r=new Exhibit.Collection(e,n);r._setElement(t);i=Exhibit.getAttribute(t,"itemTypes",",");if(typeof i!="undefined"&&i!==null&&i.length>0){r._itemTypes=i;r._update=Exhibit.Collection._typeBasedCollection_update}else r._update=Exhibit.Collection._allItemsCollection_update;Exhibit.Collection._initializeBasicCollection(r,n);return r};Exhibit.Collection.create2=function(e,t,n){var r,i;r=n.getDatabase();if(typeof t["expression"]!="undefined"){i=new Exhibit.Collection(e,r);i._setElement();i._expression=Exhibit.ExpressionParser.parse(t.expression);i._baseCollection=typeof t.baseCollectionID!="undefined"?n.getMain().getCollection(t.baseCollectionID):n.getCollection();i._restrictBaseCollection=typeof t.restrictBaseCollection!="undefined"?t.restrictBaseCollection:!1;i._restrictBaseCollection?Exhibit.Collection._initializeRestrictingBasedCollection(i):Exhibit.Collection._initializeBasedCollection(i);return i}return Exhibit.Collection.create(e,t,r)};Exhibit.Collection.createFromDOM2=function(e,t,n){var r,i,s,o;r=n.getDatabase();s=Exhibit.getAttribute(t,"expression");if(typeof s!="undefined"&&s!==null&&s.length>0){i=new Exhibit.Collection(e,r);i._setElement(t);i._expression=Exhibit.ExpressionParser.parse(s);o=Exhibit.getAttribute(t,"baseCollectionID");i._baseCollection=typeof o!="undefined"&&o!==null&&o.length>0?n.getMain().getCollection(o):n.getCollection();i._restrictBaseCollection=Exhibit.getAttribute(t,"restrictBaseCollection")==="true";i._restrictBaseCollection?Exhibit.Collection._initializeRestrictingBasedCollection(i,r):Exhibit.Collection._initializeBasedCollection(i)}else i=Exhibit.Collection.createFromDOM(e,t,r);return i};Exhibit.Collection._initializeBasicCollection=function(e,t){var n=function(){e._update()};$(document).bind("onAfterLoadingItems.exhibit",n);$(document).bind("onAfterRemovingAllStatements.exhibit",n);e._update()};Exhibit.Collection._initializeBasedCollection=function(e){e._update=Exhibit.Collection._basedCollection_update;$(this._elmt).bind("onItemsChanged.exhibit",function(t){e._update()});e._update()};Exhibit.Collection._initializeRestrictingBasedCollection=function(e,t){e._cache=new Exhibit.FacetUtilities.Cache(t,e._baseCollection,e._expression);e._isUpdatingBaseCollection=!1;e.onFacetUpdated=Exhibit.Collection._restrictingBasedCollection_onFacetUpdated;e.restrict=Exhibit.Collection._restrictingBasedCollection_restrict;e.update=Exhibit.Collection._restrictingBasedCollection_update;e.hasRestrictions=Exhibit.Collection._restrictingBasedCollection_hasRestrictions;e._baseCollection.addFacet(e)};Exhibit.Collection._allItemsCollection_update=function(){this.setItems(this._database.getAllItems());this._onRootItemsChanged()};Exhibit.Collection._typeBasedCollection_update=function(){var e,t=new Exhibit.Set;for(e=0;e<this._itemTypes.length;e++)this._database.getSubjects(this._itemTypes[e],"type",t);this.setItems(t);this._onRootItemsChanged()};Exhibit.Collection._basedCollection_update=function(){this.setItems(this._expression.evaluate({value:this._baseCollection.getRestrictedItems()},{value:"item"},"value",this._database).values);this._onRootItemsChanged()};Exhibit.Collection._restrictingBasedCollection_onFacetUpdated=function(){if(!this._updating){Exhibit.Collection.prototype.onFacetUpdated.call(this);this._isUpdatingBaseCollection=!0;this._baseCollection.onFacetUpdated();this._isUpdatingBaseCollection=!1}};Exhibit.Collection._restrictingBasedCollection_restrict=function(e){return this._restrictedItems.size()===this._items.size()?e:this._cache.getItemsFromValues(this._restrictedItems,e)};Exhibit.Collection._restrictingBasedCollection_update=function(e){if(!this._isUpdatingBaseCollection){this.setItems(this._cache.getValuesFromItems(e));this._onRootItemsChanged()}};Exhibit.Collection._restrictingBasedCollection_hasRestrictions=function(){return this._items!==null&&this._restrictedItems!==null&&this._restrictedItems.size()!==this._items.size()};Exhibit.Collection.prototype.getID=function(){return this._id};Exhibit.Collection.prototype._setElement=function(e){typeof e=="undefined"||e===null?this.getID()!=="default"?this._elmt=$("<div>").attr("id",this.getID()).attr(Exhibit.makeExhibitAttribute("role"),"exhibit-collection").css("display","none").appendTo(document.body).get(0):this._elmt=document:this._elmt=e};Exhibit.Collection.prototype.getElement=function(){return this._elmt};Exhibit.Collection.prototype.setItems=function(e){this._items=e};Exhibit.Collection.prototype.equals=function(e){return this.getID()===e.getID()};Exhibit.Collection.prototype.dispose=function(){if(typeof this["_baseCollection"]!="undefined"){this._baseCollection=null;this._expression=null}this._database=null;this._elmt=null;this._items=null;this._restrictedItems=null};Exhibit.Collection.prototype.addFacet=function(e){this._facets.push(e);if(e.hasRestrictions()){this._computeRestrictedItems();this._updateFacets();$(this._elmt).trigger("onItemsChanged.exhibit")}else e.update(this.getRestrictedItems())};Exhibit.Collection.prototype.removeFacet=function(e){var t;for(t=0;t<this._facets.length;t++)if(e===this._facets[t]){this._facets.splice(t,1);if(e.hasRestrictions()){this._computeRestrictedItems();this._updateFacets();$(this._elmt).trigger("onItemsChanged.exhibit")}break}};Exhibit.Collection.prototype.clearAllRestrictions=function(){var e,t;t=Exhibit.History.getState();this._updating=!0;for(e=0;e<this._facets.length;e++)Exhibit.History.setComponentState(t,this._facets[e],Exhibit.Facet._registryKey,this._facets[e].exportEmptyState(),!0);this._updating=!1;this.onFacetUpdated();return t};Exhibit.Collection.prototype.applyRestrictions=function(e){var t;this._updating=!0;for(t=0;t<this._facets.length;t++)this._facets[t].applyRestrictions(e[t]);this._updating=!1;this.onFacetUpdated()};Exhibit.Collection.prototype.getAllItems=function(){return new Exhibit.Set(this._items)};Exhibit.Collection.prototype.countAllItems=function(){return this._items.size()};Exhibit.Collection.prototype.getRestrictedItems=function(){return new Exhibit.Set(this._restrictedItems)};Exhibit.Collection.prototype.countRestrictedItems=function(){return this._restrictedItems.size()};Exhibit.Collection.prototype.onFacetUpdated=function(){if(!this._updating){this._computeRestrictedItems();this._updateFacets();$(this._elmt).trigger("onItemsChanged.exhibit")}};Exhibit.Collection.prototype._onRootItemsChanged=function(){$(this._elmt).trigger("onRootItemsChanged.exhibit");this._computeRestrictedItems();this._updateFacets();$(this._elmt).trigger("onItemsChanged.exhibit")};Exhibit.Collection.prototype._updateFacets=function(){var e,t,n,r,i;e=0;for(t=0;t<this._facets.length;t++)this._facets[t].hasRestrictions()&&e++;for(t=0;t<this._facets.length;t++){n=this._facets[t];if(n.hasRestrictions())if(e<=1)n.update(this.getAllItems());else{r=this.getAllItems();for(i=0;i<this._facets.length;i++)t!==i&&(r=this._facets[i].restrict(r));n.update(r)}else n.update(this.getRestrictedItems())}};Exhibit.Collection.prototype._computeRestrictedItems=function(){var e,t;this._restrictedItems=this._items;for(e=0;e<this._facets.length;e++){t=this._facets[e];t.hasRestrictions()&&(this._restrictedItems=t.restrict(this._restrictedItems))}};Exhibit.Expression={};Exhibit.Expression._Impl=function(e){this._rootNode=e};Exhibit.Expression._Impl.prototype.evaluate=function(e,t,n,r){var i=this._rootNode.evaluate(e,t,n,r);return{values:i.getSet(),valueType:i.valueType,size:i.size}};Exhibit.Expression._Impl.prototype.evaluateOnItem=function(e,t){return this.evaluate({value:e},{value:"item"},"value",t)};Exhibit.Expression._Impl.prototype.evaluateSingle=function(e,t,n,r){var i,s;i=this._rootNode.evaluate(e,t,n,r);s={value:null,valueType:i.valueType};i.forEachValue(function(e){s.value=e;return!0});return s};Exhibit.Expression._Impl.prototype.evaluateSingleOnItem=function(e,t){return this.evaluateSingle({value:e},{value:"item"},"value",t)};Exhibit.Expression._Impl.prototype.testExists=function(e,t,n,r){return this.isPath()?this._rootNode.testExists(e,t,n,r):this.evaluate(e,t,n,r).values.size()>0};Exhibit.Expression._Impl.prototype.isPath=function(){return this._rootNode instanceof Exhibit.Expression.Path};Exhibit.Expression._Impl.prototype.getPath=function(){return this.isPath()?this._rootNode:null};Exhibit.Expression._Collection=function(e,t){this._values=e;this.valueType=t;if(e instanceof Array){this.forEachValue=Exhibit.Expression._Collection._forEachValueInArray;this.getSet=Exhibit.Expression._Collection._getSetFromArray;this.contains=Exhibit.Expression._Collection._containsInArray;this.size=e.length}else{this.forEachValue=Exhibit.Expression._Collection._forEachValueInSet;this.getSet=Exhibit.Expression._Collection._getSetFromSet;this.contains=Exhibit.Expression._Collection._containsInSet;this.size=e.size()}};Exhibit.Expression._Collection._forEachValueInSet=function(e){this._values.visit(e)};Exhibit.Expression._Collection._forEachValueInArray=function(e){var t,n;t=this._values;for(n=0;n<t.length;n++)if(e(t[n]))break};Exhibit.Expression._Collection._getSetFromSet=function(){return this._values};Exhibit.Expression._Collection._getSetFromArray=function(){return new Exhibit.Set(this._values)};Exhibit.Expression._Collection._containsInSet=function(e){return this._values.contains(e)};Exhibit.Expression._Collection._containsInArray=function(e){var t,n;t=this._values;for(n=0;n<t.length;n++)if(t[n]===e)return!0;return!1};Exhibit.Expression.Path=function(){this._rootName=null;this._segments=[]};Exhibit.Expression.Path.create=function(e,t){var n=new Exhibit.Expression.Path;n._segments.push({property:e,forward:t,isArray:!1});return n};Exhibit.Expression.Path.prototype.setRootName=function(e){this._rootName=e};Exhibit.Expression.Path.prototype.appendSegment=function(e,t){this._segments.push({property:e,forward:t.charAt(0)===".",isArray:t.length>1})};Exhibit.Expression.Path.prototype.getSegment=function(e){var t;if(e<this._segments.length){t=this._segments[e];return{property:t.property,forward:t.forward,isArray:t.isArray}}return null};Exhibit.Expression.Path.prototype.getLastSegment=function(){return this.getSegment(this._segments.length-1)};Exhibit.Expression.Path.prototype.getSegmentCount=function(){return this._segments.length};Exhibit.Expression.Path.prototype.evaluate=function(e,t,n,r){var i,s,o,u;i=typeof this._rootName!="undefined"&&this._rootName!==null?this._rootName:n;s=typeof t[i]!="undefined"?t[i]:"text";o=null;if(typeof e[i]!="undefined"){u=e[i];u instanceof Exhibit.Set||u instanceof Array?o=new Exhibit.Expression._Collection(u,s):o=new Exhibit.Expression._Collection([u],s);return this._walkForward(o,r)}throw new Error(Exhibit._("%expression.error.noSuchVariable",i))};Exhibit.Expression.Path.prototype.evaluateBackward=function(e,t,n,r){var i=new Exhibit.Expression._Collection([e],t);return this._walkBackward(i,n,r)};Exhibit.Expression.Path.prototype.walkForward=function(e,t,n){return this._walkForward(new Exhibit.Expression._Collection(e,t),n)};Exhibit.Expression.Path.prototype.walkBackward=function(e,t,n,r){return this._walkBackward(new Exhibit.Expression._Collection(e,t),n,r)};Exhibit.Expression.Path.prototype._walkForward=function(e,t){var n,r,i,s,o,u,a;a=function(e,n,r){var i=e?t.getObjects:t.getSubjects;return function(e){i(e,r.property).visit(function(e){n.push(e)})}};for(n=0;n<this._segments.length;n++){r=this._segments[n];if(r.isArray){i=[];e.forEachValue(a(r.forward,i,r));if(r.forward){o=t.getProperty(r.property);s=typeof o!="undefined"&&o!==null?o.getValueType():"text"}else s="item";e=new Exhibit.Expression._Collection(i,s)}else if(r.forward){u=t.getObjectsUnion(e.getSet(),r.property);o=t.getProperty(r.property);s=typeof o!="undefined"&&o!==null?o.getValueType():"text";e=new Exhibit.Expression._Collection(u,s)}else{u=t.getSubjectsUnion(e.getSet(),r.property);e=new Exhibit.Expression._Collection(u,"item")}}return e};Exhibit.Expression.Path.prototype._walkBackward=function(e,t,n){var r,i,s,o,u,a,f;f=function(e,r,i,s){var o=e?n.getObjects:n.getSubjects;return function(e){o(e,i.property).visit(function(e){(s>0||typeof t=="undefined"||t===null||t.contains(e))&&r.push(e)})}};for(r=this._segments.length-1;r>=0;r--){i=this._segments[r];if(i.isArray){s=[];e.forEachValue(f(i.forward,s,i,r));if(i.forward){u=n.getProperty(i.property);o=typeof u!="undefined"&&u!==null?u.getValueType():"text"}else o="item";e=new Exhibit.Expression._Collection(s,o)}else if(i.forward){a=n.getSubjectsUnion(e.getSet(),i.property,null,r===0?t:null);e=new Exhibit.Expression._Collection(a,"item")}else{a=n.getObjectsUnion(e.getSet(),i.property,null,r===0?t:null);u=n.getProperty(i.property);o=typeof u!="undefined"&&u!==null?u.getValueType():"text";e=new Exhibit.Expression._Collection(a,o)}}return e};Exhibit.Expression.Path.prototype.rangeBackward=function(e,t,n,r,i){var s,o,u,a,f;s=new Exhibit.Set;o="item";if(this._segments.length>0){u=this._segments[this._segments.length-1];if(!u.forward)throw new Error(Exhibit._("%expression.error.mustBeForward"));i.getSubjectsInRange(u.property,e,t,n,s,this._segments.length===1?r:null);for(a=this._segments.length-2;a>=0;a--){u=this._segments[a];if(u.forward){s=i.getSubjectsUnion(s,u.property,null,a===0?r:null);o="item"}else{s=i.getObjectsUnion(s,u.property,null,a===0?r:null);f=i.getProperty(u.property);o=typeof f!="undefined"&&f!==null?f.getValueType():"text"}}}return{valueType:o,values:s,count:s.size()}};Exhibit.Expression.Path.prototype.testExists=function(e,t,n,r){return this.evaluate(e,t,n,r).size>0};Exhibit.Expression._Constant=function(e,t){this._value=e;this._valueType=t};Exhibit.Expression._Constant.prototype.evaluate=function(e,t,n,r){return new Exhibit.Expression._Collection([this._value],this._valueType)};Exhibit.Expression._Operator=function(e,t){this._operator=e;this._args=t};Exhibit.Expression._Operator.prototype.evaluate=function(e,t,n,r){var i=[],s=[],o,u,a;for(o=0;o<this._args.length;o++)s.push(this._args[o].evaluate(e,t,n,r));u=Exhibit.Expression._operators[this._operator];a=u.f;u.argumentType==="number"?s[0].forEachValue(function(e){typeof e!="number"&&(e=parseFloat(e));s[1].forEachValue(function(t){typeof t!="number"&&(t=parseFloat(t));i.push(a(e,t))})}):s[0].forEachValue(function(e){s[1].forEachValue(function(t){i.push(a(e,t))})});return new Exhibit.Expression._Collection(i,u.valueType)};Exhibit.Expression._operators={"+":{argumentType:"number",valueType:"number",f:function(e,t){return e+t}},"-":{argumentType:"number",valueType:"number",f:function(e,t){return e-t}},"*":{argumentType:"number",valueType:"number",f:function(e,t){return e*t}},"/":{argumentType:"number",valueType:"number",f:function(e,t){return e/t}},"=":{valueType:"boolean",f:function(e,t){return e===t}},"<>":{valueType:"boolean",f:function(e,t){return e!==t}},"><":{valueType:"boolean",f:function(e,t){return e!==t}},"<":{argumentType:"number",valueType:"boolean",f:function(e,t){return e<t}},">":{argumentType:"number",valueType:"boolean",f:function(e,t){return e>t}},"<=":{argumentType:"number",valueType:"boolean",f:function(e,t){return e<=t}},">=":{argumentType:"number",valueType:"boolean",f:function(e,t){return e>=t}}};Exhibit.Expression._FunctionCall=function(e,t){this._name=e;this._args=t};Exhibit.Expression._FunctionCall.prototype.evaluate=function(e,t,n,r){var i=[],s;for(s=0;s<this._args.length;s++)i.push(this._args[s].evaluate(e,t,n,r));if(typeof Exhibit.Functions[this._name]!="undefined")return Exhibit.Functions[this._name].f(i);throw new Error(Exhibit._("%expression.noSuchFunction",this._name))};Exhibit.Expression._ControlCall=function(e,t){this._name=e;this._args=t};Exhibit.Expression._ControlCall.prototype.evaluate=function(e,t,n,r){return Exhibit.Controls[this._name].f(this._args,e,t,n,r)};Exhibit.Functions={};Exhibit.FunctionUtilities={};Exhibit.FunctionUtilities.registerSimpleMappingFunction=function(e,t,n){Exhibit.Functions[e]={f:function(e){var r=new Exhibit.Set,i,s;s=function(){return function(e){var n=t(e);typeof n!="undefined"&&r.add(n)}};for(i=0;i<e.length;i++)e[i].forEachValue(s());return new Exhibit.Expression._Collection(r,n)}}};Exhibit.Functions.union={f:function(e){var t,n,r,i;t=new Exhibit.Set;n=null;if(e.length>0){n=e[0].valueType;for(r=0;r<e.length;r++){i=e[r];if(i.size>0){if(typeof n=="undefined"||n===null)n=i.valueType;t.addSet(i.getSet())}}}return new Exhibit.Expression._Collection(t,typeof n!="undefined"&&n!==null?n:"text")}};Exhibit.Functions.contains={f:function(e){var t,n;t=e[0].size>0;n=e[0].getSet();e[1].forEachValue(function(e){if(!n.contains(e)){t=!1;return!0}});return new Exhibit.Expression._Collection([t],"boolean")}};Exhibit.Functions.exists={f:function(e){return new Exhibit.Expression._Collection([e[0].size>0],"boolean")}};Exhibit.Functions.count={f:function(e){return new Exhibit.Expression._Collection([e[0].size],"number")}};Exhibit.Functions.not={f:function(e){return new Exhibit.Expression._Collection([!e[0].contains(!0)],"boolean")}};Exhibit.Functions.and={f:function(e){var t=!0,n;for(n=0;t&&n<e.length;n++)t=t&&e[n].contains(!0);return new Exhibit.Expression._Collection([t],"boolean")}};Exhibit.Functions.or={f:function(e){var t=!1,n;for(n=0;!t&&n<e.length;n++)t=t||e[n].contains(!0);return new Exhibit.Expression._Collection([t],"boolean")}};Exhibit.Functions.add={f:function(e){var t,n,r;t=0;r=function(){return function(e){if(typeof e!="undefined"&&e!==null)if(typeof e=="number")t+=e;else{var n=parseFloat(e);isNaN(n)||(t+=n)}}};for(n=0;n<e.length;n++)e[n].forEachValue(r());return new Exhibit.Expression._Collection([t],"number")}};Exhibit.Functions.concat={f:function(e){var t=[],n,r;r=function(){return function(e){typeof e!="undefined"&&e!==null&&t.push(e)}};for(n=0;n<e.length;n++)e[n].forEachValue(r());return new Exhibit.Expression._Collection([t.join("")],"text")}};Exhibit.Functions.multiply={f:function(e){var t=1,n,r;r=function(){return function(e){var n;if(typeof e!="undefined"&&e!==null)if(typeof e=="number")t*=e;else{n=parseFloat(e);isNaN(n)||(t*=n)}}};for(n=0;n<e.length;n++)e[n].forEachValue(r());return new Exhibit.Expression._Collection([t],"number")}};Exhibit.Functions["date-range"]={_parseDate:function(e){if(typeof e=="undefined"||e===null)return Number.NEGATIVE_INFINITY;if(e instanceof Date)return e.getTime();try{return Exhibit.DateTime.parseIso8601DateTime(e).getTime()}catch(t){return Number.NEGATIVE_INFINITY}},_computeRange:function(e,t,n){var r=t-e;if(isFinite(r)){typeof Exhibit.DateTime[n.toUpperCase()]!="undefined"&&(r=Math.round(r/Exhibit.DateTime.gregorianUnitLengths[Exhibit.DateTime[n.toUpperCase()]]));return r}return null},f:function(e){var t=this,n,r,i,s;n=Number.POSITIVE_INFINITY;e[0].forEachValue(function(e){n=Math.min(n,t._parseDate(e))});r=Number.NEGATIVE_INFINITY;e[1].forEachValue(function(e){r=Math.max(r,t._parseDate(e))});i="day";e[2].forEachValue(function(e){i=e});s=this._computeRange(n,r,i);return new Exhibit.Expression._Collection(typeof s!="undefined"&&s!==null?[s]:[],"number")}};Exhibit.Functions.distance={_units:{km:1e3,mile:1609.344},_computeDistance:function(e,t,n,r){var i=e.distanceFrom(t);r||(r=1);if(isFinite(i)){typeof this._units[n]!="undefined"&&(i/=this._units[n]);return Exhibit.Util.round(i,r)}return null},f:function(e){var t=this,r,i,s,o,u,a,f,l;r={};i=["origo","lat","lng","unit","round"];l=function(e){return function(t){r[e]=t}};for(s=0,n=i[s];s<i.length;s++)e[s].forEachValue(l(n));o=r.origo.split(",");u=new GLatLng(o[0],o[1]);a=new GLatLng(r.lat,r.lng);f=this._computeDistance(u,a,r.unit,r.round);return new Exhibit.Expression._Collection(typeof f!="undefined"&&f!==null?[f]:[],"number")}};Exhibit.Functions.min={f:function(e){var t=function(e){return e},n,r,i,s,o,u,a;n=Number.POSITIVE_INFINITY;r=null;a=function(e,i){return function(s){var o=e(s,t);if(o<n||n===Number.POSITIVE_INFINITY){n=o;r=r===null?i:r===i?r:"text"}}};for(i=0;i<e.length;i++){s=e[i];o=s.valueType?s.valueType:"text";u=Exhibit.SettingsUtilities._typeToParser(o);s.forEachValue(a(u,o))}return new Exhibit.Expression._Collection([n],typeof r!="undefined"&&r!==null?r:"text")}};Exhibit.Functions.max={f:function(e){var t=function(e){return e},n,r,i,s,o,u,a;n=Number.NEGATIVE_INFINITY;r=null;a=function(e,i){return function(s){var o=e(s,t);if(o>n||n===Number.NEGATIVE_INFINITY){n=o;r=r===null?i:r===i?r:"text"}}};for(i=0;i<e.length;i++){s=e[i];o=s.valueType?s.valueType:"text";u=Exhibit.SettingsUtilities._typeToParser(o);s.forEachValue(a(u,c))}return new Exhibit.Expression._Collection([n],typeof r!="undefined"&&r!==null?r:"text")}};Exhibit.Functions.remove={f:function(e){var t,n,r,i;t=e[0].getSet();n=e[0].valueType;for(r=1;r<e.length;r++){i=e[r];i.size>0&&t.removeSet(i.getSet())}return new Exhibit.Expression._Collection(t,n)}};Exhibit.Functions.now={f:function(e){return new Exhibit.Expression._Collection([new Date],"date")}};Exhibit.Controls={};Exhibit.Controls["if"]={f:function(e,t,n,r,i){var s=e[0].evaluate(t,n,r,i),o;o=!1;s.forEachValue(function(e){if(e){o=!0;return!0}});return o?e[1].evaluate(t,n,r,i):e[2].evaluate(t,n,r,i)}};Exhibit.Controls.foreach={f:function(e,t,n,r,i){var s,o,u,a,f;s=e[0].evaluate(t,n,r,i);o=t.value;u=n.value;n.value=s.valueType;a=[];f="text";s.forEachValue(function(s){t.value=s;var o=e[1].evaluate(t,n,r,i);f=o.valueType;o.forEachValue(function(e){a.push(e)})});t.value=o;n.value=u;return new Exhibit.Expression._Collection(a,f)}};Exhibit.Controls["default"]={f:function(e,t,n,r,i){var s,o;for(s=0;s<e.length;s++){o=e[s].evaluate(t,n,r,i);if(o.size>0)return o}return new Exhibit.Expression._Collection([],"text")}};Exhibit.Controls.filter={f:function(e,t,n,r,i){var s,o,u,a;s=e[0].evaluate(t,n,r,i);o=t.value;u=n.value;a=new Exhibit.Set;n.value=s.valueType;s.forEachValue(function(s){t.value=s;var o=e[1].evaluate(t,n,r,i);o.size>0&&o.contains("true")&&a.add(s)});t.value=o;n.value=u;return new Exhibit.Expression._Collection(a,s.valueType)}};Exhibit.ExpressionParser={};Exhibit.ExpressionParser.parse=function(e,t,n){t=t||0;n=n||{};var r=new Exhibit.ExpressionScanner(e,t);try{return Exhibit.ExpressionParser._internalParse(r,!1)}finally{n.index=r.token()!==null?r.token().start:r.index()}};Exhibit.ExpressionParser.parseSeveral=function(e,t,n){t=t||0;n=n||{};var r=new Exhibit.ExpressionScanner(e,t);try{return Exhibit.ExpressionParser._internalParse(r,!0)}finally{n.index=r.token()!==null?r.token().start:r.index()}};Exhibit.ExpressionParser._internalParse=function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d;n=Exhibit.ExpressionScanner;r=e.token();i=function(){e.next();r=e.token()};s=function(){return r!==null?r.start:e.index()};o=function(){var e=new Exhibit.Expression.Path,t;while(r!==null&&r.type===n.PATH_OPERATOR){t=r.value;i();if(r===null||r.type!==n.IDENTIFIER)throw new Error(Exhibit._("%expression.error.missingPropertyID",s()));e.appendSegment(r.value,t);i()}return e};u=function(){var e=null,t,u;if(typeof r=="undefined"||r===null)throw new Error(Exhibit._("%expression.error.missingFactor"));switch(r.type){case n.NUMBER:e=new Exhibit.Expression._Constant(r.value,"number");i();break;case n.STRING:e=new Exhibit.Expression._Constant(r.value,"text");i();break;case n.PATH_OPERATOR:e=o();break;case n.IDENTIFIER:t=r.value;i();if(typeof Exhibit.Controls[t]!="undefined"){if(r===null||r.type!==n.DELIMITER||r.value!=="(")throw new Error(Exhibit._("%expression.error.missingParenStart",t,s()));i();u=r!==null&&r.type===n.DELIMITER&&r.value===")"?[]:c();e=new Exhibit.Expression._ControlCall(t,u);if(r===null||r.type!==n.DELIMITER||r.value!==")")throw new Error(Exhibit._("%expression.error.missingParenEnd",t,s()));i()}else if(r!==null&&r.type===n.DELIMITER&&r.value==="("){i();u=r!==null&&r.type===n.DELIMITER&&r.value===")"?[]:c();e=new Exhibit.Expression._FunctionCall(t,u);if(r===null||r.type!==n.DELIMITER||r.value!==")")throw new Error(Exhibit._("%expression.error.missingParenFunction",t,s()));i()}else{e=o();e.setRootName(t)}break;case n.DELIMITER:if(r.value==="("){i();e=parseExpression();if(r!==null&&r.type===n.DELIMITER&&r.value===")"){i();break}throw new Error(Exhibit._("%expression.error.missingParen",+s()))}throw new Error(Exhibit._("%expression.error.unexpectedSyntax",r.value,s()));default:throw new Error(Exhibit._("%expression.error.unexpectedSyntax",r.value,s()))}return e};a=function(){var e=u(),t;while(r!==null&&r.type===n.OPERATOR&&(r.value==="*"||r.value==="/")){t=r.value;i();e=new Exhibit.Expression._Operator(t,[e,u()])}return e};f=function(){var e=a(),t;while(r!==null&&r.type===n.OPERATOR&&(r.value==="+"||r.value==="-")){t=r.value;i();e=new Exhibit.Expression._Operator(t,[e,a()])}return e};parseExpression=function(){var e=f(),t;while(r!==null&&r.type===n.OPERATOR&&(r.value==="="||r.value==="<>"||r.value==="<"||r.value==="<="||r.value===">"||r.value===">=")){t=r.value;i();e=new Exhibit.Expression._Operator(t,[e,f()])}return e};c=function(){var e=[parseExpression()];while(r!==null&&r.type===n.DELIMITER&&r.value===","){i();e.push(parseExpression())}return e};if(t){h=c();p=[];for(d=0;d<h.length;d++)p.push(new Exhibit.Expression._Impl(h[d]));return p}return new Exhibit.Expression._Impl(parseExpression())};Exhibit.ExpressionScanner=function(e,t){this._text=e+" ";this._maxIndex=e.length;this._index=t;this.next()};Exhibit.ExpressionScanner.DELIMITER=0;Exhibit.ExpressionScanner.NUMBER=1;Exhibit.ExpressionScanner.STRING=2;Exhibit.ExpressionScanner.IDENTIFIER=3;Exhibit.ExpressionScanner.OPERATOR=4;Exhibit.ExpressionScanner.PATH_OPERATOR=5;Exhibit.ExpressionScanner.prototype.token=function(){return this._token};Exhibit.ExpressionScanner.prototype.index=function(){return this._index};Exhibit.ExpressionScanner.prototype.next=function(){var e,t,n,r;this._token=null;while(this._index<this._maxIndex&&" 	\r\n".indexOf(this._text.charAt(this._index))>=0)this._index++;if(this._index<this._maxIndex){e=this._text.charAt(this._index);t=this._text.charAt(this._index+1);if(".!".indexOf(e)>=0)if(t==="@"){this._token={type:Exhibit.ExpressionScanner.PATH_OPERATOR,value:e+t,start:this._index,end
:this._index+2};this._index+=2}else{this._token={type:Exhibit.ExpressionScanner.PATH_OPERATOR,value:e,start:this._index,end:this._index+1};this._index++}else if("<>".indexOf(e)>=0)if(t==="="||"<>".indexOf(t)>=0&&e!==t){this._token={type:Exhibit.ExpressionScanner.OPERATOR,value:e+t,start:this._index,end:this._index+2};this._index+=2}else{this._token={type:Exhibit.ExpressionScanner.OPERATOR,value:e,start:this._index,end:this._index+1};this._index++}else if("+-*/=".indexOf(e)>=0){this._token={type:Exhibit.ExpressionScanner.OPERATOR,value:e,start:this._index,end:this._index+1};this._index++}else if("(),".indexOf(e)>=0){this._token={type:Exhibit.ExpressionScanner.DELIMITER,value:e,start:this._index,end:this._index+1};this._index++}else if("\"'".indexOf(e)>=0){n=this._index+1;while(n<this._maxIndex){if(this._text.charAt(n)===e&&this._text.charAt(n-1)!=="\\")break;n++}if(!(n<this._maxIndex))throw new Error(Exhibit._("%expression.error.unterminatedString",+this._index));this._token={type:Exhibit.ExpressionScanner.STRING,value:this._text.substring(this._index+1,n).replace(/\\'/g,"'").replace(/\\"/g,'"'),start:this._index,end:n+1};this._index=n+1}else if(this._isDigit(e)){n=this._index;while(n<this._maxIndex&&this._isDigit(this._text.charAt(n)))n++;if(n<this._maxIndex&&this._text.charAt(n)==="."){n++;while(n<this._maxIndex&&this._isDigit(this._text.charAt(n)))n++}this._token={type:Exhibit.ExpressionScanner.NUMBER,value:parseFloat(this._text.substring(this._index,n)),start:this._index,end:n};this._index=n}else{n=this._index;while(n<this._maxIndex){r=this._text.charAt(n);if(!("(),.!@ 	".indexOf(r)<0))break;n++}this._token={type:Exhibit.ExpressionScanner.IDENTIFIER,value:this._text.substring(this._index,n),start:this._index,end:n};this._index=n}}};Exhibit.ExpressionScanner.prototype._isDigit=function(e){return"0123456789".indexOf(e)>=0};Exhibit.UI={componentMap:{},validator:typeof Exhibit.babelPrefix!="undefined"?Exhibit.babelPrefix+"validator?url=":Exhibit.validateJSON};Exhibit.UI.registerComponent=function(e,t){var n=Exhibit._("%general.error.cannotRegister",e);typeof Exhibit.UI.componentMap[e]!="undefined"?Exhibit.Debug.warn(Exhibit._("%general.error.componentNameTaken",n)):typeof t=="undefined"||t===null?Exhibit.Debug.warn(Exhibit._("%general.error.noComponentObject",n)):typeof t.create=="undefined"?Exhibit.Debug.warn(Exhibit._("%general.error.missingCreateFunction",n)):typeof t.createFromDOM=="undefined"?Exhibit.Debug.warn(Exhibit._("%general.error.missingDOMCreateFunction",n)):Exhibit.UI.componentMap[e]=t};Exhibit.UI.create=function(e,t,n){var r,i;if(typeof e["role"]!="undefined"){r=e.role;typeof r!="undefined"&&r!==null&&r.startsWith("exhibit-")&&(r=r.substr("exhibit-".length));if(typeof Exhibit.UI.componentMap[r]!="undefined"){i=Exhibit.UI.componentMap[r].create;return i(e,t,n)}switch(r){case"lens":case"edit-lens":Exhibit.UIContext.registerLens(e,n.getLensRegistry());return null;case"view":return Exhibit.UI.createView(e,t,n);case"facet":return Exhibit.UI.createFacet(e,t,n);case"coordinator":return Exhibit.UI.createCoordinator(e,n);case"coder":return Exhibit.UI.createCoder(e,n);case"viewPanel":return Exhibit.ViewPanel.create(e,t,n);case"logo":return Exhibit.Logo.create(e,t,n);case"controlPanel":return Exhibit.ControlPanel.create(e,t,n);case"hiddenContent":$(t).hide();return null}}return null};Exhibit.UI.createFromDOM=function(e,t){var n,r;n=Exhibit.getRoleAttribute(e);if(typeof Exhibit.UI.componentMap[n]!="undefined"){r=Exhibit.UI.componentMap[n].createFromDOM;return r(e,t)}switch(n){case"lens":case"edit-lens":Exhibit.UIContext.registerLensFromDOM(e,t.getLensRegistry());return null;case"view":return Exhibit.UI.createViewFromDOM(e,null,t);case"facet":return Exhibit.UI.createFacetFromDOM(e,null,t);case"coordinator":return Exhibit.UI.createCoordinatorFromDOM(e,t);case"coder":return Exhibit.UI.createCoderFromDOM(e,t);case"viewPanel":return Exhibit.ViewPanel.createFromDOM(e,t);case"controlPanel":return Exhibit.ControlPanel.createFromDOM(e,null,t);case"logo":return Exhibit.Logo.createFromDOM(e,t);case"hiddenContent":$(e).hide();return null}return null};Exhibit.UI.generateCreationMethods=function(e){e.create=function(t,n,r){var i,s;i=Exhibit.UIContext.create(t,r);s={};Exhibit.SettingsUtilities.collectSettings(t,e._settingSpecs||{},s);return new e(n,i,s)};e.createFromDOM=function(t,n){var r,i;r=Exhibit.UIContext.createFromDOM(t,n);i={};Exhibit.SettingsUtilities.collectSettingsFromDOM(t,e._settingSpecs||{},i);return new e(t,r,i)}};Exhibit.UI.createView=function(e,t,n){var r=typeof e.viewClass!="undefined"?e.viewClass:Exhibit.TileView;typeof r=="string"&&(r=Exhibit.UI.viewClassNameToViewClass(r));return r.create(e,t,n)};Exhibit.UI.createViewFromDOM=function(e,t,n){var r=Exhibit.UI.viewClassNameToViewClass(Exhibit.getAttribute(e,"viewClass"));return r.createFromDOM(e,t,n)};Exhibit.UI.viewClassNameToViewClass=function(e){if(typeof e!="undefined"&&e!==null&&e.length>0)try{return Exhibit.UI._stringToObject(e,"View")}catch(t){Exhibit.Debug.warn(Exhibit._("%general.error.unknownViewClass",e))}return Exhibit.TileView};Exhibit.UI.createFacet=function(e,t,n){var r=typeof e.facetClass!="undefined"?e.facetClass:Exhibit.ListFacet;typeof r=="string"&&(r=Exhibit.UI.facetClassNameToFacetClass(r));return r.create(e,t,n)};Exhibit.UI.createFacetFromDOM=function(e,t,n){var r=Exhibit.UI.facetClassNameToFacetClass(Exhibit.getAttribute(e,"facetClass"));return r.createFromDOM(e,t,n)};Exhibit.UI.facetClassNameToFacetClass=function(e){if(typeof e!="undefined"&&e!==null&&e.length>0)try{return Exhibit.UI._stringToObject(e,"Facet")}catch(t){Exhibit.Debug.warn(Exhibit._("%general.error.unknownFacetClass",e))}return Exhibit.ListFacet};Exhibit.UI.createCoder=function(e,t){var n=typeof e.coderClass!="undefined"?e.coderClass:Exhibit.ColorCoder;typeof n=="string"&&(n=Exhibit.UI.coderClassNameToCoderClass(n));return n.create(e,t)};Exhibit.UI.createCoderFromDOM=function(e,t){var n=Exhibit.UI.coderClassNameToCoderClass(Exhibit.getAttribute(e,"coderClass"));return n.createFromDOM(e,t)};Exhibit.UI.coderClassNameToCoderClass=function(e){if(typeof e!="undefined"&&e!==null&&e.length>0)try{return Exhibit.UI._stringToObject(e,"Coder")}catch(t){Exhibit.Debug.warn(Exhibit._("%general.error.unknownCoderClass",e))}return Exhibit.ColorCoder};Exhibit.UI.createCoordinator=function(e,t){return Exhibit.Coordinator.create(e,t)};Exhibit.UI.createCoordinatorFromDOM=function(e,t){return Exhibit.Coordinator.createFromDOM(e,t)};Exhibit.UI._stringToObject=function(name,suffix){if(!name.startsWith("Exhibit.")){if(!name.endsWith(suffix))try{return eval("Exhibit."+name+suffix)}catch(ex1){}try{return eval("Exhibit."+name)}catch(ex2){}}if(!name.endsWith(suffix))try{return eval(name+suffix)}catch(ex3){}try{return eval(name)}catch(ex4){}throw new Error(Exhibit._("%general.error.unknownClass",name))};Exhibit.UI.showHelp=function(e,t,n){n=n?n:"_blank";typeof t!="undefined"&&t!==null?window.confirm(Exhibit._("%general.showDocumentationMessage",e))&&window.open(t,n):window.alert(e)};Exhibit.UI.showJsonFileValidation=function(e,t){var n="_blank";typeof Exhibit.babelPrefix!="undefined"&&t.indexOf("file:")===0?window.confirm(Exhibit._("%general.showJsonValidationFormMessage",e))&&window.open(Exhibit.UI.validator,n):window.confirm(Exhibit._("%general.showJsonValidationMessage",e))&&window.open(Exhibit.UI.validator+t,n)};Exhibit.UI._busyIndicator=null;Exhibit.UI._busyIndicatorCount=0;Exhibit.UI.showBusyIndicator=function(){var e,t,n;Exhibit.UI._busyIndicatorCount++;if(Exhibit.UI._busyIndicatorCount>1)return;Exhibit.UI._busyIndicator===null&&(Exhibit.UI._busyIndicator=Exhibit.UI.createBusyIndicator());e=typeof document.body.scrollTop!="undefined"?document.body.scrollTop:document.body.parentNode.scrollTop;t=typeof window.innerHeight!="undefined"?window.innerHeight:typeof document.body.clientHeight!="undefined"?document.body.clientHeight:document.body.parentNode.clientHeight;n=Math.floor(e+t/3);$(Exhibit.UI._busyIndicator).css("top",n+"px");$(document.body).append(Exhibit.UI._busyIndicator)};Exhibit.UI.hideBusyIndicator=function(){Exhibit.UI._busyIndicatorCount--;if(Exhibit.UI._busyIndicatorCount>0)return;try{Exhibit.UI._busyIndicator.remove()}catch(e){}};Exhibit.UI.protectUI=function(e){$(e).addClass("exhibit-ui-protection")};Exhibit.UI.makeActionLink=function(e,t){var n,r;n=$("<a>"+e+"</a>").attr("href","#").addClass("exhibit-action");r=function(e){if(typeof $(this).attr("disabled")=="undefined"){e.preventDefault();t(e)}};$(n).bind("click",r);return n};Exhibit.UI.enableActionLink=function(e,t){if(t){$(e).removeAttr("disabled");$(e).addClass("exhibit-action").removeClass("exhibit-action-disabled")}else{$(e).attr("disabled",!0);$(e).removeClass("exhibit-action").addClass("exhibit-action-disabled")}};Exhibit.UI.makeItemSpan=function(e,t,n){var r,i,s;r=n.getDatabase();if(typeof t=="undefined"||t===null){t=r.getObject(e,"label");if(typeof t=="undefined"||t===null)t=e}i=$("<a>"+t+"</a>").attr("href",Exhibit.Persistence.getItemLink(e)).addClass("exhibit-item");s=function(t){Exhibit.UI.showItemInPopup(e,this,n);t.preventDefault();t.stopPropagation()};i.bind("click",s);return i.get(0)};Exhibit.UI.makeValueSpan=function(e,t){var n,r;n=$("<span>").addClass("exhibit-value");if(t==="url"){r=e;Exhibit.params.safe&&r.trim().startsWith("javascript:")?n.text(r):n.html('<a href="'+r+'" target="_blank">'+(e.length>50?e.substr(0,20)+" ... "+e.substr(e.length-20):e)+"</a>")}else{Exhibit.params.safe&&(e=Exhibit.Formatter.encodeAngleBrackets(e));n.html(e)}return n.get(0)};Exhibit.UI.calculatePopupPosition=function(e){var t=$(e).offset();return{x:t.left+Math.round($(e).outerWidth()/2),y:t.top+Math.round($(e).outerHeight()/2)}};Exhibit.UI.showItemInPopup=function(e,t,n,r){var i,s;$(document).trigger("closeAllModeless.exhibit");r=r||{};r.coords=r.coords||Exhibit.UI.calculatePopupPosition(t);i=$("<div>");s={inPopup:!0,coords:r.coords};r.lensType==="normal"?s.lensTemplate=n.getLensRegistry().getNormalLens(e,n):r.lensType==="edit"?s.lensTemplate=n.getLensRegistry().getEditLens(e,n):r.lensType&&Exhibit.Debug.warn(Exhibit._("%general.error.unknownLensType",r.lensType));n.getLensRegistry().createLens(e,i,n,s);$.simileBubble("createBubbleForContentAndPoint",i,r.coords.x,r.coords.y,n.getSetting("bubbleWidth"))};Exhibit.UI.createButton=function(e,t,n){var r=$("<button>").html(e).addClass(n||"exhibit-button").addClass("screen");r.bind("click",t);return r};Exhibit.UI.createPopupMenuDom=function(e){var t,n;t=$("<div>").addClass("exhibit-menu-popup").addClass("exhibit-ui-protection");n={elmt:t,open:function(t){var r,i,s,o;r=this;if(typeof t!="undefined"){$(t.target).parent(".exhibit-dialog").length>0&&(n._dialogParent=$(t.target).parent(".exhibit-dialog:eq(0)").get(0));t.preventDefault()}i=$(document.body).width();s=$(document.body).height();o=$(e).offset();this.elmt.css("top",o.top+e.scrollHeight+"px");this.elmt.css("right",i-(o.left+e.scrollWidth)+"px");$(document.body).append(this.elmt);this.elmt.trigger("modelessOpened.exhibit");t.stopPropagation()},appendMenuItem:function(e,t,r){var i,s,o;i=this;s=$("<a>").attr("href","#").addClass("exhibit-menu-item").bind("click",function(e){r(e);n.close();e.preventDefault();e.stopPropagation()});o=$("<div>");s.append(o);o.append($.simileBubble("createTranslucentImage",typeof t!="undefined"&&t!==null?t:Exhibit.urlPrefix+"images/blank-16x16.png"));o.append(document.createTextNode(e));this.elmt.append(s)},appendSeparator:function(){this.elmt.append("<hr/>")}};Exhibit.UI.setupDialog(n,!1);return n};Exhibit.UI.createBusyIndicator=function(){var e,t,n,r,i,s,o,u,a,f;e=Exhibit.urlPrefix+"images/";t=$("<div>");if($.simileBubble("pngIsTranslucent")){n=$("<div>").css({height:"33px","padding-left":"44px",background:"url("+e+"message-bubble/message-top-left.png) top left no-repeat"});t.append(n);r=$("<div>").css({height:"33px",background:"url("+e+"message-bubble/message-top-right.png) top right no-repeat"});n.append(r);i=$("<div>").css({"padding-left":"44px",background:"url("+e+"message-bubble/message-left.png) top left repeat-y"});t.append(i);s=$("<div>").css({"padding-right":"44px",background:"url("+e+"message-bubble/message-right.png) top right repeat-y"});i.append(s);o=$("<div>");s.append(o);u=$("<div>").css({height:"55px","padding-left":"44px",background:"url("+e+"message-bubble/message-bottom-left.png) bottom left no-repeat"});t.append(u);a=$("<div>").css({height:"55px",background:"url("+e+"message-bubble/message-bottom-right.png) bottom right no-repeat"});u.append(a)}else{t.css({border:"2px solid #7777AA",padding:"20px",background:"white",opacity:.9});o=$("<div>");t.append(o)}t.addClass("exhibit-busyIndicator");o.addClass("exhibit-busyIndicator-content");f=$("<img />").attr("src",e+"progress-running.gif");o.append(f);o.append(document.createTextNode(Exhibit._("%general.busyIndicatorMessage")));return t};Exhibit.UI.createFocusDialogBox=function(e,t,n){var r,i;r={tag:"div",className:"exhibit-focusDialog exhibit-ui-protection",children:[{tag:"div",className:"exhibit-focusDialog-viewContainer",field:"viewContainer"},{tag:"div",className:"exhibit-focusDialog-controls",children:[{tag:"button",field:"closeButton",children:[Exhibit._("%general.focusDialogBoxCloseButtonLabel")]}]}]};i=$.simileDOM("template",r);Exhibit.UI.setupDialog(i,!0);i.open=function(){var r;$(document).trigger("modalSuperseded.exhibit");r=new Exhibit.Lens(e,i.viewContainer,t,n);$(i.elmt).css("top",document.body.scrollTop+100+"px");$(document.body).append(i.elmt);$(i.closeButton).bind("click",function(e){i.close();e.preventDefault();e.stopPropagation()});$(i.elmt).trigger("modalOpened.exhibit")};return i};Exhibit.UI.createTranslucentImage=function(e,t){return $.simileBubble("createTranslucentImage",Exhibit.urlPrefix+e,t)};Exhibit.UI.createTranslucentImageHTML=function(e,t){return $.simileBubble("createTranslucentImageHTML",Exhibit.urlPrefix+e,t)};Exhibit.UI._clickInElement=function(e,t,n){var r=$(n).offset(),i={w:$(n).outerWidth(),h:$(n).outerHeight()};return e<r.left&&e>r.left+i.w&&t<r.top&&t>r.top+i.h};Exhibit.UI.setupDialog=function(e,t,n){var r,i,s,o,u,a;typeof parentDialog!="undefined"&&parentDialog!==null&&(e._dialogParent=n);if(!t){e._dialogDescendants=[];r=function(t){if(!Exhibit.UI._clickInElement(t.pageX,t.pageY,e.elmt)){a=!1;for(u=0;u<e._dialogDescendants;u++){a=a||Exhibit.UI._clickInElement(t.pageX,t.pageY,e._dialogDescendants[u]);if(a)break}a||e.close(t)}};s=function(t){e.close(t)};i=function(t){e.close(t)};o=function(t){var n=t.target;e._dialogDescendants.push(n);$(n).bind("cancelModeless.exhibit",function(t){e._dialogDescendants.splice(e._dialogDescendants.indexOf(n),1);$(n).unbind(t)})};e.close=function(t){typeof t!="undefined"?t.type!=="cancelAllModeless"&&$(e.elmt).trigger("cancelModeless.exhibit"):$(e.elmt).trigger("cancelModeless.exhibit");$(document.body).unbind("click",r);$(e._dialogParent).unbind("cancelModeless.exhibit",i);$(document).unbind("cancelAllModeless.exhibit",s);$(e.elmt).trigger("closed.exhibit");$(e.elmt).remove()};$(e.elmt).bind("modelessOpened.exhibit",o);$(e.elmt).one("modelessOpened.exhibit",function(t){$(document.body).bind("click",r);$(e._dialogParent).bind("cancelModeless.exhibit",i);$(document).bind("cancellAllModeless.exhibit",s)})}else{e._superseded=0;r=function(t){if(e._superseded===0&&!Exhibit.UI._clickInElement(t.pageX,t.pageY,e.elmt)){t.preventDefault();t.stopImmediatePropagation()}};closedHandler=function(t){e._superseded--};supersededHandler=function(t){e._superseded++;$(t.target).bind("cancelModal.exhibit",closedHandler)};e.close=function(t){$(e.elmt).trigger("cancelModal.exhibit");$(document).trigger("cancelAllModeless.exhibit");$(e.elmt).remove();$(document.body).unbind("click",r);$(document).unbind("modalSuperseded.exhibit",supersededHandler)};$(e.elmt).one("modalOpened.exhibit",function(){$(document.body).bind("click",r);$(document).bind("modalSuperseded.exhibit",supersededHandler)})}};Exhibit.UIContext=function(){this._parent=null;this._exhibit=null;this._collection=null;this._lensRegistry=new Exhibit.LensRegistry;this._settings={};this._formatters={};this._listFormatter=null;this._editModeRegistry={};this._popupFunc=null};Exhibit.UIContext._settingSpecs={bubbleWidth:{type:"int",defaultValue:400},bubbleHeight:{type:"int",defaultValue:300}};Exhibit.UIContext.createRootContext=function(e,t){var n,r,i,s;n=new Exhibit.UIContext;n._exhibit=t;r=Exhibit.UIContext.initialSettings;for(i in r)r.hasOwnProperty(i)&&(n._settings[i]=r[i]);s=Exhibit.getAttribute(document.body,"formats");typeof s!="undefined"&&s!==null&&s.length>0&&Exhibit.FormatParser.parseSeveral(n,s,0,{});Exhibit.SettingsUtilities.collectSettingsFromDOM(document.body,Exhibit.UIContext._settingSpecs,n._settings);Exhibit.UIContext._configure(n,e);return n};Exhibit.UIContext.create=function(e,t,n){var r=Exhibit.UIContext._createWithParent(t);Exhibit.UIContext._configure(r,e,n);return r};Exhibit.UIContext.createFromDOM=function(e,t,n){var r,i,s;r=Exhibit.UIContext._createWithParent(t);n||Exhibit.UIContext.registerLensesFromDOM(e,r.getLensRegistry());i=Exhibit.getAttribute(e,"collectionID");typeof i!="undefined"&&i!==null&&i.length>0&&(r._collection=r._exhibit.getCollection(i));s=Exhibit.getAttribute(e,"formats");typeof s!="undefined"&&s!==null&&s.length>0&&Exhibit.FormatParser.parseSeveral(r,s,0,{});Exhibit.SettingsUtilities.collectSettingsFromDOM(e,Exhibit.UIContext._settingSpecs,r._settings);Exhibit.UIContext._configure(r,Exhibit.getConfigurationFromDOM(e),n);return r};Exhibit.UIContext.prototype.dispose=function(){};Exhibit.UIContext.prototype.getParentUIContext=function(){return this._parent};Exhibit.UIContext.prototype.getMain=function(){return this._exhibit};Exhibit.UIContext.prototype.getDatabase=function(){return this.getMain().getDatabase()};Exhibit.UIContext.prototype.getCollection=function(){this._collection===null&&(this._parent!==null?this._collection=this._parent.getCollection():this._collection=this._exhibit.getDefaultCollection());return this._collection};Exhibit.UIContext.prototype.getLensRegistry=function(){return this._lensRegistry};Exhibit.UIContext.prototype.getSetting=function(e){return typeof this._settings[e]!="undefined"?this._settings[e]:this._parent!==null?this._parent.getSetting(e):undefined};Exhibit.UIContext.prototype.getBooleanSetting=function(e,t){var n=this.getSetting(e);return n===undefined||n===null?t:n};Exhibit.UIContext.prototype.putSetting=function(e,t){this._settings[e]=t};Exhibit.UIContext.prototype.format=function(e,t,n){var r;typeof this._formatters[t]!="undefined"?r=this._formatters[t]:r=this._formatters[t]=new Exhibit.Formatter._constructors[t](this);r.format(e,n)};Exhibit.UIContext.prototype.formatList=function(e,t,n,r){this._listFormatter===null&&(this._listFormatter=new Exhibit.Formatter._ListFormatter(this));this._listFormatter.formatList(e,t,n,r)};Exhibit.UIContext.prototype.setEditMode=function(e,t){t?this._editModeRegistry[e]=!0:this._editModeRegistry[e]=!1};Exhibit.UIContext.prototype.isBeingEdited=function(e){return!!this._editModeRegistry[e]};Exhibit.UIContext._createWithParent=function(e){var t=new Exhibit.UIContext;t._parent=e;t._exhibit=e._exhibit;t._lensRegistry=new Exhibit.LensRegistry(e.getLensRegistry());t._editModeRegistry=e._editModeRegistry;return t};Exhibit.UIContext._configure=function(e,t,n){Exhibit.UIContext.registerLenses(t,e.getLensRegistry());typeof t["collectionID"]!="undefined"&&(e._collection=e._exhibit.getCollection(t.collectionID));typeof t["formats"]!="undefined"&&Exhibit.FormatParser.parseSeveral(e,t.formats,0,{});n||Exhibit.SettingsUtilities.collectSettings(t,Exhibit.UIContext._settingSpecs,e._settings)};Exhibit.UIContext.registerLens=function(e,t){var n,r;n=e.templateFile;if(typeof n!="undefined"&&n!==null)if(typeof e["itemTypes"]!="undefined")for(r=0;r<e.itemTypes.length;r++)t.registerLensForType(n,e.itemTypes[r]);else t.registerDefaultLens(n)};Exhibit.UIContext.registerLensFromDOM=function(e,t){var n,r,i,s,o,u;$(e).hide();n=Exhibit.getAttribute(e,"itemTypes",",");r=null;i=Exhibit.getAttribute(e,"templateFile");if(typeof i!="undefined"&&i!==null&&i.length>0)r=i;else{s=Exhibit.getAttribute(e,"template");o=s&&document.getElementById(s);typeof o!="undefined"&&o!==null?r=o:r=e}if(typeof r!="undefined"&&r!==null)if(typeof n=="undefined"||n===null||n.length===0||n.length===1&&n[0]==="")t.registerDefaultLens(r);else for(u=0;u<n.length;u++)t.registerLensForType(r,n[u])};Exhibit.UIContext.registerLenses=function(e,t){var n,r;if(typeof e["lenses"]!="undefined")for(n=0;n<e.lenses.length;n++)Exhibit.UIContext.registerLens(e.lenses[n],t);if(typeof e["lensSelector"]!="undefined"){r=e.lensSelector;typeof r=="function"?t.addLensSelector(r):Exhibit.Debug.log(Exhibit._("%general.error.lensSelectorNotFunction"))}};Exhibit.UIContext.registerLensesFromDOM=function(parentNode,lensRegistry){var node,role,lensSelectorString,lensSelector;node=$(parentNode).children().get(0);while(typeof node!="undefined"&&node!==null){if(node.nodeType===1){role=Exhibit.getRoleAttribute(node);(role==="lens"||role==="edit-lens")&&Exhibit.UIContext.registerLensFromDOM(node,lensRegistry)}node=node.nextSibling}lensSelectorString=Exhibit.getAttribute(parentNode,"lensSelector");if(typeof lensSelectorString!="undefined"&&lensSelectorString!==null&&lensSelectorString.length>0)try{lensSelector=eval(lensSelectorString);typeof lensSelector=="function"?lensRegistry.addLensSelector(lensSelector):Exhibit.Debug.log(Exhibit._("%general.error.lensSelectorExpressionNotFunction",lensSelectorString))}catch(e){Exhibit.Debug.exception(e,Exhibit._("%general.error.badLensSelectorExpression",lensSelectorString))}};Exhibit.UIContext.createLensRegistry=function(e,t){var n=new Exhibit.LensRegistry(t);Exhibit.UIContext.registerLenses(e,n);return n};Exhibit.UIContext.createLensRegistryFromDOM=function(e,t,n){var r=new Exhibit.LensRegistry(n);Exhibit.UIContext.registerLensesFromDOM(e,r);Exhibit.UIContext.registerLenses(t,r);return r};Exhibit.LensRegistry=function(e){this._parentRegistry=e;this._defaultLens=null;this._typeToLens={};this._editLensTemplates={};this._submissionLensTemplates={};this._lensSelectors=[]};Exhibit.LensRegistry.prototype.registerDefaultLens=function(e){this._defaultLens=typeof e=="string"?e:e.cloneNode(!0)};Exhibit.LensRegistry.prototype.registerLensForType=function(e,t){typeof e=="string"&&(this._typeToLens[t]=e);var n=Exhibit.getRoleAttribute(e);n==="lens"?this._typeToLens[t]=e.cloneNode(!0):n==="edit-lens"?this._editLensTemplates[t]=e.cloneNode(!0):Exhibit.Debug.warn(Exhibit._("%lens.error.unknownLensType",e))};Exhibit.LensRegistry.prototype.addLensSelector=function(e){this._lensSelectors.unshift(e)};Exhibit.LensRegistry.prototype.getLens=function(e,t){return t.isBeingEdited(e)?this.getEditLens(e,t):this.getNormalLens(e,t)};Exhibit.LensRegistry.prototype.getNormalLens=function(e,t){var n,r,i,s;n=t.getDatabase();for(r=0;r<this._lensSelectors.length;r++){i=this._lensSelectors[r](e,n);if(typeof i!="undefined"&&i!==null)return i}s=n.getObject(e,"type");return typeof this._typeToLens[s]!="undefined"?this._typeToLens[s]:typeof this._defaultLens!="undefined"&&this._defaultLens!==null?this._defaultLens:typeof this._parentRegistry!="undefined"&&this._parenRegistry!==null?this._parentRegistry.getLens(e,t):null};Exhibit.LensRegistry.prototype.getEditLens=function(e,t){var n=t.getDatabase().getObject(e,"type");return typeof this._editLensTemplates[n]!="undefined"?this._editLensTemplates[n]:this._parentRegistry&&this._parentRegistry.getEditLens(e,t)};Exhibit.LensRegistry.prototype.createLens=function(e,t,n,r){var i,s;i=new Exhibit.Lens;r=r||{};s=r.lensTemplate||this.getLens(e,n);typeof s=="undefined"||s===null?i._constructDefaultUI(e,t,n):typeof s=="string"?i._constructFromLensTemplateURL(e,t,n,s,r):i._constructFromLensTemplateDOM(e,t,n,s,r);return i};Exhibit.LensRegistry.prototype.createEditLens=function(e,t,n,r){r=r||{};r.lensTemplate=this.getEditLens(e,n);return this.createLens(e,t,n,r)};Exhibit.LensRegistry.prototype.createNormalLens=function(e,t,n,r){r=r||{};r.lensTemplate=this.getNormalLens(e,n);return this.createLens(e,t,n,r)};Exhibit.Lens=function(){};Exhibit.Lens._commonProperties=null;Exhibit.Lens.prototype._constructDefaultUI=function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p;r=n.getDatabase();if(typeof Exhibit.Lens._commonProperties=="undefined"||Exhibit.Lens._commonProperties===null)Exhibit.Lens._commonProperties=r.getAllProperties();i=Exhibit.Lens._commonProperties;s=r.getObject(e,"label");s=typeof s!="undefined"&&s!==null?s:e;Exhibit.params.safe&&(s=Exhibit.Formatter.encodeAngleBrackets(s));o={elmt:t,className:"exhibit-lens",children:[{tag:"div",className:"exhibit-lens-title",title:s,children:[s+" (",{tag:"a",href:Exhibit.Persistence.getItemLink(e),target:"_blank",children:[Exhibit._("%general.itemLinkLabel")]},")"]},{tag:"div",className:"exhibit-lens-body",children:[{tag:"table",className:"exhibit-lens-properties",field:"propertiesTable"}]}]};u=$.simileDOM("template",o);$(t).attr(Exhibit.makeExhibitAttribute("itemID"),e);a=Exhibit.ViewPanel.getPropertyValuesPairs(e,i,r);for(f=0;f<a.length;f++){l=a[f];c=$("<tr>").appendTo(u.propertiesTable);c=$(u.propertiesTable.get(0).insertRow(f)).attr("class","exhibit-lens-property");$("<td>").appendTo(c).attr("class","exhibit-lens-property-name").html(l.propertyLabel+": ");h=$("<td>");c.append(h);$(h).attr("class","exhibit-lens-property-values");if(l.valueType==="item")for(p=0;p<l.values.length;p++){p>0&&$(h).append(document.createTextNode(", "));$(h).append(Exhibit.UI.makeItemSpan(l.values[p],null,n))}else for(p=0;p<l.values.length;p++){p>0&&$(h).append(document.createTextNode(", "));$(h).append(Exhibit.UI.makeValueSpan(l.values[p],l.valueType))}}};Exhibit.Lens.prototype._constructDefaultEditingUI=function(e,t,n){};Exhibit.Lens._compiledTemplates={};Exhibit.Lens._handlers=["onblur","onfocus","onkeydown","onkeypress","onkeyup","onmousedown","onmouseenter","onmouseleave","onmousemove","onmouseout","onmouseover","onmouseup","onclick","onresize","onscroll"];Exhibit.Lens.prototype._constructFromLensTemplateURL=function(e,t,n,r){var i,s;i={lens:this,itemID:e,div:t,uiContext:n,opts:opts};s=Exhibit.Lens._compiledTemplates[r];if(typeof s=="undefined"||s===null)Exhibit.Lens._startCompilingTemplate(r,i);else if(!s.compiled)s.jobs.push(i);else{i.template=s;Exhibit.Lens._performConstructFromLensTemplateJob(i)}};Exhibit.Lens.prototype._constructFromLensTemplateDOM=function(e,t,n,r,i){var s,o,u;s={lens:this,itemID:e,div:t,uiContext:n,opts:i};o=r.id;if(typeof o=="undefined"||o===null||o.length===0){o="exhibitLensTemplate"+Math.floor(Math.random()*1e4);r.id=o}u=Exhibit.Lens._compiledTemplates[o];if(typeof u=="undefined"||u===null){u={url:o,template:Exhibit.Lens.compileTemplate(r,!1,n),compiled:!0,jobs:[]};Exhibit.Lens._compiledTemplates[o]=u}s.template=u;Exhibit.Lens._performConstructFromLensTemplateJob(s)};Exhibit.Lens._startCompilingTemplate=function(e,t){var n,r,i;n={url:e,template:null,compiled:!1,jobs:[t]};Exhibit.Lens._compiledTemplates[e]=n;r=function(t,n,r){Exhibit.Debug.log(Exhibit._("%lens.error.failedToLoad",e,n))};i=function(e,r,i){var s,o;try{n.template=Exhibit.Lens.compileTemplate(e.documentElement,!0,t.uiContext);n.compiled=!0;for(s=0;s<n.jobs.length;s++)try{o=n.jobs[s];o.template=n;Exhibit.Lens._performConstructFromLensTemplateJob(o)}catch(u){Exhibit.Debug.exception(u,Exhibit._("%lens.error.constructing"))}n.jobs=null}catch(a){Exhibit.Debug.exception(a,Exhibit._("%lens.error.compilingTemplate"))}};$.ajax({dataType:"xml",url:e,error:r,success:i});return n};Exhibit.Lens.compileTemplate=function(e,t,n){return Exhibit.Lens._processTemplateNode(e,t,n)};Exhibit.Lens._processTemplateNode=function(e,t,n){return e.nodeType===1?Exhibit.Lens._processTemplateElement(e,t,n):e.nodeValue};Exhibit.Lens._processTemplateElement=function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v;r={tag:e.tagName.toLowerCase(),uiContext:n,control:null,condition:null,content:null,contentAttributes:null,subcontentAttributes:null,attributes:[],styles:[],handlers:[],children:null};i={parseChildTextNodes:!0};s=e.attributes;for(o=0;o<s.length;o++){u=s[o];a=u.nodeName;f=u.nodeValue;Exhibit.Lens._processTemplateAttribute(n,r,i,a,f)}if(!t&&jQuery.support.noCloneEvent){l=e.cssText;typeof l!="undefined"&&l!==null&&l.length>0&&Exhibit.Lens._processStyle(r,f);c=Exhibit.Lens._handlers;for(h=0;h<c.length;h++){p=c[h];d=e[p];typeof d!="undefined"&&d!==null&&r.handlers.push({name:p,code:d})}}v=e.firstChild;if(typeof v!="undefined"&&v!==null){r.children=[];while(v!==null){(i.parseChildTextNodes&&v.nodeType===3||v.nodeType===1)&&r.children.push(Exhibit.Lens._processTemplateNode(v,t,r.uiContext));v=v.nextSibling}}return r};Exhibit.Lens._processTemplateAttribute=function(e,t,n,r,i){var s,o;if(typeof i=="undefined"||i===null||typeof i!="string"||i.length===0||r==="contentEditable")return;if(Exhibit.isExhibitAttribute(r)){r=Exhibit.extractAttributeName(r);if(r==="formats"){t.uiContext=Exhibit.UIContext._createWithParent(e);Exhibit.FormatParser.parseSeveral(t.uiContext,i,0,{})}else if(r==="onshow")t.attributes.push({name:r,value:i});else if(r==="control")t.control=i;else if(r==="content"){t.content=Exhibit.ExpressionParser.parse(i);t.attributes.push({name:Exhibit.makeExhibitAttribute("content"),value:i})}else if(r==="editor")t.attributes.push({name:Exhibit.makeExhibitAttribute("editor"),value:i});else if(r==="edit")t.edit=i;else if(r==="options")t.options=i;else if(r==="editvalues")t.editValues=i;else if(r==="tag")t.tag=i;else if(r==="if-exists")t.condition={test:"if-exists",expression:Exhibit.ExpressionParser.parse(i)};else if(r==="if"){t.condition={test:"if",expression:Exhibit.ExpressionParser.parse(i)};n.parseChildTextNodes=!1}else if(r==="select")t.condition={test:"select",expression:Exhibit.ExpressionParser.parse(i)};else if(r==="case"){t.condition={test:"case",value:i};n.parseChildTextNodes=!1}else{s=!1;o=r.indexOf("-style-content");o>0?s=!0:o=r.indexOf("-content");if(o>0){if(typeof t.contentAttributes=="undefined"||t.contentAttributes===null)t.contentAttributes=[];t.contentAttributes.push({name:r.substr(0,o),expression:Exhibit.ExpressionParser.parse(i),isStyle:s})}else{o=r.indexOf("-style-subcontent");o>0?s=!0:o=r.indexOf("-subcontent");if(o>0){if(typeof t.subcontentAttributes=="undefined"||t.subcontentAttributes===null)t.subcontentAttributes=[];t.subcontentAttributes.push({name:r.substr(0,o),fragments:Exhibit.Lens._parseSubcontentAttribute(i),isStyle:s})}}}}else if(r==="style")Exhibit.Lens._processStyle(t,i);else if(r!=="id"){r==="bgcolor"&&(r="bgColor");t.attributes.push({name:r,value:i})}};Exhibit.Lens._processStyle=function(e,t){var n,r,i,s,o;n=t.split(";");for(r=0;r<n.length;r++){i=n[r].split(":");if(i.length>1){s=i[0].trim();o=i[1].trim();e.styles.push({name:s,value:o})}}};Exhibit.Lens._parseSubcontentAttribute=function(e){var t,n,r,i;t=[];n=0;while(n<e.length&&(r=e.indexOf("{{",n))>=0){i=e.indexOf("}}",r);if(i<0)break;t.push(e.substring(n,r));t.push(Exhibit.ExpressionParser.parse(e.substring(r+2,i)));n=i+2}n<e.length&&t.push(e.substr(n));return t};Exhibit.Lens.constructFromLensTemplate=function(e,t,n,r,i){return Exhibit.Lens._performConstructFromLensTemplateJob({itemID:e,template:{template:t},div:n,uiContext:r,opts:i})};Exhibit.Lens._performConstructFromLensTemplateJob=function(e){var t,n;Exhibit.Lens._constructFromLensTemplateNode({value:e.itemID},{value:"item"},e.template.template,e.div,e.opts);t=$(e.div).get(0).tagName.toLowerCase()==="table"?$(e.div).get(0).rows[$(e.div).get(0).rows.length-1]:$(e.div).get(0).lastChild;$(document).trigger("onItemShow.exhibit",[e.itemID,t]);$(t).show();t.setAttribute(Exhibit.makeExhibitAttribute("itemID"),e.itemID);if(!Exhibit.params.safe){n=Exhibit.getAttribute(t,"onshow");if(typeof n!="undefined"&&n!==null&&n.length>0)try{(new Function(n)).call(t)}catch(r){Exhibit.Debug.log(r)}}return t};Exhibit.Lens._constructFromLensTemplateNode=function(e,t,n,r,i){function M(){if(typeof u!="undefined"&&u!==null)for(a=0;a<u.length;a++)Exhibit.Lens._constructFromLensTemplateNode(e,t,u[a],p,i)}var s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O;if(typeof n=="string"){$(r).append(document.createTextNode(n));return}s=n.uiContext;o=s.getDatabase();u=n.children;if(typeof n.condition!="undefined"&&n.condition!==null)if(n.condition.test==="if-exists"){if(!n.condition.expression.testExists(e,t,"value",o))return}else{if(n.condition.test==="if"){n.condition.expression.evaluate(e,t,"value",o).values.contains(!0)?typeof u!="undefined"&&u!==null&&u.length>0&&Exhibit.Lens._constructFromLensTemplateNode(e,t,u[0],r,i):typeof u!="undefined"&&u!==null&&u.length>1&&Exhibit.Lens._constructFromLensTemplateNode(e,t,u[1],r,i);return}if(n.condition.test==="select"){f=n.condition.expression.evaluate(e,t,"value",o).values;if(typeof u!="undefined"&&
u!==null){l=null;for(c=0;c<u.length;c++){h=u[c];if(typeof h.condition!="undefined"&&h.condition!==null&&h.condition.test==="case"){if(f.contains(h.condition.value)){Exhibit.Lens._constructFromLensTemplateNode(e,t,h,r,i);return}}else typeof h!="string"&&(l=h)}}typeof l!="undefined"&&l!==null&&Exhibit.Lens._constructFromLensTemplateNode(e,t,l,r,i);return}}p=Exhibit.Lens._constructElmtWithAttributes(n,r,o);if(typeof n.contentAttributes!="undefined"&&n.contentAttributes!==null){d=n.contentAttributes;O=function(e){return function(t){e.push(t)}};for(a=0;a<d.length;a++){v=d[a];f=[];v.expression.evaluate(e,t,"value",o).values.visit(O(f));m=f.join(";");v.isStyle?$(p).css(v.name,m):Exhibit.Lens._attributeValueIsSafe(v.name,m)&&$(p).attr(v.name,m)}}if(typeof n.subcontentAttributes!="undefined"&&n.subcontentAttributes!==null){g=n.subcontentAttributes;for(a=0;a<g.length;a++){v=g[a];y=v.fragments;b="";for(w=0;w<y.length;w++){E=y[w];typeof E=="string"?b+=E:b+=E.evaluateSingle(e,t,"value",o).value}v.isStyle?$(p).css(v.name,b):Exhibit.Lens._attributeValueIsSafe(v.name,b)&&$(p).attr(v.name,b)}}if(!Exhibit.params.safe){S=n.handlers;for(x=0;x<S.length;x++){T=S[x];p[T.name]=T.code}}N=e.value;if(typeof n.control!="undefined"&&n.control!==null)switch(n.control){case"item-link":C=$("<a>").html(Exhibit._("%general.itemLinkLabel")).attr("href",Exhibit.Persistence.getItemLink(N)).attr("target","_blank");$(p).append(C);break;case"remove-item":if(!i.disableEditWidgets&&o.isNewItem(N)){n.tag==="a"&&$(p).attr("href","#");$(p).bind("click",function(e){o.removeItem(N)});M()}else $(p).remove();break;case"start-editing":n.tag==="a"&&$(p).attr("href","#");if(i.disableEditWidgets)$(p).remove();else if(i.inPopup){$(p).bind("click",function(e){Exhibit.UI.showItemInPopup(N,null,s,{lensType:"edit",coords:i.coords})});M()}else{$(p).bind("click",function(){s.setEditMode(N,!0);$(s.getCollection().getElement()).trigger("onItemsChanged")});M()}break;case"stop-editing":n.tag==="a"&&$(p).attr("href","#");if(i.disableEditWidgets)$(p).remove();else if(i.inPopup){$(p).bind("click",function(){Exhibit.UI.showItemInPopup(N,null,s,{lensType:"normal",coords:i.coords})});M()}else{$(p).bind("click",function(){s.setEditMode(N,!1);$(s.getCollection().getElement()).trigger("onItemsChanged",[])});M()}break;case"accept-changes":if(o.isSubmission(N)){n.tag==="a"&&$(p).attr("href","#");$(p).bind("click",function(){o.mergeSubmissionIntoItem(N)});M()}else{Exhibit.Debug.warn(Exhibit._("%lens.error.misplacedAcceptChanges"));$(p).remove()}}else if(typeof n.content!="undefined"&&n.content!==null){b=n.content.evaluate(e,t,"value",o);if(typeof u!="undefined"&&u!==null){k={value:b.valueType,index:"number"};L=1;A=function(e){var t={value:e,index:L++};for(a=0;a<u.length;a++)Exhibit.Lens._constructFromLensTemplateNode(t,k,u[a],p,i)};if(b.values instanceof Array)for(a=0;a<b.values.length;a++)A(b.values[a]);else b.values.visit(A)}else Exhibit.Lens._constructDefaultValueList(b.values,b.valueType,p,n.uiContext)}else if(typeof n.edit!="undefined"&&n.edit!==null){M();Exhibit.Lens._constructEditableContent(n,p,N,s)}else if(typeof u!="undefined"&&u!==null)for(a=0;a<u.length;a++)Exhibit.Lens._constructFromLensTemplateNode(e,t,u[a],p,i)};Exhibit.Lens._constructElmtWithAttributes=function(e,t,n){var r,i,s,o,u,a,f;if(e.tag==="input"){i=["<input"];s=e.attributes;for(o=0;o<s.length;o++){u=s[o];Exhibit.Lens._attributeValueIsSafe(u.name,u.value)&&i.push(u.name+'="'+u.value+'"')}i.push("></input>");r=$(i.join(" "));$(t).append(r)}else{r=$("<"+e.tag+">");$(t).append(r);s=e.attributes;for(o=0;o<s.length;o++){u=s[o];if(Exhibit.Lens._attributeValueIsSafe(u.name,u.value))try{r.attr(u.name,u.value)}catch(l){}}}a=e.styles;for(o=0;o<a.length;o++){f=a[o];r.css(f.name,f.value)}return r};Exhibit.Lens._constructEditableContent=function(e,t,n,r){var i,s,o,u;i=r.getDatabase();s=e.edit.replace(".","");o=i.getObject(n,s);u=function(){this.value&&this.value!==o&&i.editItem(n,s,this.value)};if(e.tag==="select"){Exhibit.Lens._constructEditableSelect(e,t,n,r,o);$(t).bind("blur",u)}else{$(t).attr("value",o);$(t).bind("change",u)}};Exhibit.Lens.doesSelectContain=function(e,t){var n,r;for(n in e.options)if(e.options.hasOwnProperty(n)){r=e.options[n];if(r.text===t||r.value===t)return!0}return!1};Exhibit.Lens._constructEditableSelect=function(e,t,n,r,i){var s,o,u,a,f,l,c;if(e.options){s=Exhibit.ExpressionParser.parse(e.options);o=r.getDatabase().getAllItems();u=s.evaluate({value:o},{value:"item"},"value",r.getDatabase());a=u.values.toArray().sort();for(f in a)if(a.hasOwnProperty(f)){l=a[f];if(!Exhibit.Lens.doesSelectContain(t,l)){c=new Option(a[f],a[f]);t.add(c,null)}}}if(!i){if(!Exhibit.Lens.doesSelectContain(t,"")){c=new Option("","",!0);t.add(c,t.options[0])}}else for(f in t.options)t.options.hasOwnProperty(f)&&t.options[f].value===i&&(t.selectedIndex=f)};Exhibit.Lens._constructDefaultValueList=function(e,t,n,r){r.formatList(e,e.size(),t,function(e){$(n).append($(e))})};Exhibit.Lens._attributeValueIsSafe=function(e,t){if(Exhibit.params.safe)if(e==="href"&&t.startsWith("javascript:")||e.startsWith("on"))return!1;return!0};Exhibit.Coordinator=function(e){this._uiContext=e;this._listeners=[]};Exhibit.Coordinator.create=function(e,t){return new Exhibit.Coordinator(t)};Exhibit.Coordinator.createFromDOM=function(e,t){return new Exhibit.Coordinator(Exhibit.UIContext.createFromDOM(e,t,!1))};Exhibit.Coordinator.prototype.dispose=function(){this._uiContext.dispose();this._uiContext=null};Exhibit.Coordinator.prototype.addListener=function(e){var t=new Exhibit.Coordinator._Listener(this,e);this._listeners.push(t);return t};Exhibit.Coordinator.prototype._removeListener=function(e){var t;for(t=0;t<this._listeners.length;t++)if(this._listeners[t]===e){this._listeners.splice(t,1);return}};Exhibit.Coordinator.prototype._fire=function(e,t){var n,r;for(n=0;n<this._listeners.length;n++){r=this._listeners[n];r!==e&&r._callback(t)}};Exhibit.Coordinator._Listener=function(e,t){this._coordinator=e;this._callback=t};Exhibit.Coordinator._Listener.prototype.dispose=function(){this._coordinator._removeListener(this)};Exhibit.Coordinator._Listener.prototype.fire=function(e){this._coordinator._fire(this,e)};Exhibit.Formatter={_lessThanRegex:/</g,_greaterThanRegex:/>/g};Exhibit.Formatter.createListDelimiter=function(e,t,n){var r,i,s,o;r=n.getSetting("format/list/separator");i=n.getSetting("format/list/last-separator");s=n.getSetting("format/list/pair-separator");typeof r!="string"&&(r=Exhibit._("%formatter.listSeparator"));typeof i!="string"&&(i=Exhibit._("%formatter.listLastSeparator"));typeof s!="string"&&(s=Exhibit._("%formatter.listPairSeparator"));o=function(){o.index>0&&o.index<t&&(t>2?$(e).append(document.createTextNode(o.index===t-1?i:r)):$(e).append(document.createTextNode(s)));o.index++};o.index=0;return o};Exhibit.Formatter.encodeAngleBrackets=function(e){return e.replace(Exhibit.Formatter._lessThanRegex,"&lt;").replace(Exhibit.Formatter._greaterThanRegex,"&gt;")};Exhibit.Formatter._ListFormatter=function(e){this._uiContext=e;this._separator=e.getSetting("format/list/separator");this._lastSeparator=e.getSetting("format/list/last-separator");this._pairSeparator=e.getSetting("format/list/pair-separator");this._emptyText=e.getSetting("format/list/empty-text");typeof this._separator!="string"&&(this._separator=Exhibit._("%formatter.listSeparator"));typeof this._lastSeparator!="string"&&(this._lastSeparator=Exhibit._("%formatter.listLastSeparator"));typeof this._pairSeparator!="string"&&(this._pairSeparator=Exhibit._("%formatter.listPairSeparator"))};Exhibit.Formatter._ListFormatter.prototype.formatList=function(e,t,n,r){var i,s,o;i=this._uiContext;s=this;if(t===0)typeof this._emptyText!="undefined"&&this._emptyText!==null&&this._emptyText.length>0&&r(document.createTextNode(this._emptyText));else if(t===1)e.visit(function(e){i.format(e,n,r)});else{o=0;t===2?e.visit(function(e){i.format(e,n,r);o++;o===1&&r(document.createTextNode(s._pairSeparator))}):e.visit(function(e){i.format(e,n,r);o++;o<t&&r(document.createTextNode(o===t-1?s._lastSeparator:s._separator))})}};Exhibit.Formatter._TextFormatter=function(e){this._maxLength=e.getSetting("format/text/max-length");typeof this._maxLength=="number"?this._maxLength=Math.max(3,Math.round(this._maxLength)):this._maxLength=0};Exhibit.Formatter._TextFormatter.prototype.format=function(e,t){var n=$("<span>").html(this.formatText(e));t(n)};Exhibit.Formatter._TextFormatter.prototype.formatText=function(e){Exhibit.params.safe&&(e=Exhibit.Formatter.encodeAngleBrackets(e));return this._maxLength===0||e.length<=this._maxLength?e:Exhibit._("%formatter.textEllipsis",e.substr(0,this._maxLength))};Exhibit.Formatter._BooleanFormatter=function(e){};Exhibit.Formatter._BooleanFormatter.prototype.format=function(e,t){var n=$("<span>").html(this.formatText(e));t(n)};Exhibit.Formatter._BooleanFormatter.prototype.formatText=function(e){return(typeof e=="boolean"?e:typeof e=="string"?e==="true":!1)?Exhibit._("%formatter.booleanTrue"):Exhibit._("%formatter.booleanFalse")};Exhibit.Formatter._NumberFormatter=function(e){this._decimalDigits=e.getSetting("format/number/decimal-digits");typeof this._decimalDigits=="number"?this._decimalDigits=Math.max(-1,Math.round(this._decimalDigits)):this._decimalDigits=-1};Exhibit.Formatter._NumberFormatter.prototype.format=function(e,t){t(document.createTextNode(this.formatText(e)))};Exhibit.Formatter._NumberFormatter.prototype.formatText=function(e){return this._decimalDigits===-1?e.toString():e.toFixed(this._decimalDigits)};Exhibit.Formatter._ImageFormatter=function(e){this._uiContext=e;this._maxWidth=e.getSetting("format/image/max-width");typeof this._maxWidth=="number"?this._maxWidth=Math.max(-1,Math.round(this._maxWidth)):this._maxWidth=-1;this._maxHeight=e.getSetting("format/image/max-height");typeof this._maxHeight=="number"?this._maxHeight=Math.max(-1,Math.round(this._maxHeight)):this._maxHeight=-1;this._tooltip=e.getSetting("format/image/tooltip")};Exhibit.Formatter._ImageFormatter.prototype.format=function(e,t){Exhibit.params.safe&&(e=e.trim().startsWith("javascript:")?"":e);var n=$("<img>").attr("src",e);this._tooltip!==null&&(typeof this._tooltip=="string"?n.attr("title",this._tootlip):n.attr("title",this._tooltip.evaluateSingleOnItem(this._uiContext.getSetting("itemID"),this._uiContext.getDatabase()).value));t(n)};Exhibit.Formatter._ImageFormatter.prototype.formatText=function(e){return e};Exhibit.Formatter._URLFormatter=function(e){this._target=e.getSetting("format/url/target");this._externalIcon=e.getSetting("format/url/external-icon")};Exhibit.Formatter._URLFormatter.prototype.format=function(e,t){var n=$("a").attr("href",e).html(e);this._target!==null&&n.attr("target",this._target);t(n)};Exhibit.Formatter._URLFormatter.prototype.formatText=function(e){Exhibit.params.safe&&(e=e.trim().startsWith("javascript:")?"":e);return e};Exhibit.Formatter._CurrencyFormatter=function(e){this._decimalDigits=e.getSetting("format/currency/decimal-digits");typeof this._decimalDigits=="number"?this._decimalDigits=Math.max(-1,Math.round(this._decimalDigits)):this._decimalDigits=2;this._symbol=e.getSetting("format/currency/symbol");if(typeof this._symbol=="undefined"||this._symbol===null)this._symbol=Exhibit._("%formatter.currencySymbol");this._symbolPlacement=e.getSetting("format/currency/symbol-placement");if(typeof this._symbolPlacement=="undefined"||this._symbolPlacement===null)this._symbol=Exhibit._("%formatter.currencySymbolPlacement");this._negativeFormat={signed:e.getBooleanSetting("format/currency/negative-format/signed",Exhibit._("%formatter.currencyShowSign")),red:e.getBooleanSetting("format/currency/negative-format/red",Exhibit._("%formatter.currencyShowRed")),parentheses:e.getBooleanSetting("format/currency/negative-format/parentheses",Exhibit._("%formatter.currencyShowParentheses"))}};Exhibit.Formatter._CurrencyFormatter.prototype.format=function(e,t){var n,r;n=this.formatText(e);if(e<0&&this._negativeFormat.red){r=$("<span>").html(n).css("color","red");t(r)}else t(document.createTextNode(n))};Exhibit.Formatter._CurrencyFormatter.prototype.formatText=function(e){var t,n,r;t=e<0;this._decimalDigits===-1?n=Math.abs(e):n=Math.abs(e).toFixed(this._decimalDigits);r=t&&this._negativeFormat.signed?"-":"";t&&this._negativeFormat.parentheses&&(n="("+n+")");switch(this._negativeFormat){case"first":n=this._symbol+r+n;break;case"after-sign":n=r+this._symbol+n;break;case"last":n=r+n+this._symbol}return n};Exhibit.Formatter._ItemFormatter=function(e){this._uiContext=e;this._title=e.getSetting("format/item/title")};Exhibit.Formatter._ItemFormatter.prototype.format=function(e,t){var n,r,i,s;n=this;r=this.formatText(e);i=$('<a href="'+Exhibit.Persistence.getItemLink(e)+'" class="exhibit-item">'+r+"</a>");s=function(t){Exhibit.UI.showItemInPopup(e,i.get(0),n._uiContext);t.preventDefault();t.stopPropagation()};i.bind("click",s);t(i)};Exhibit.Formatter._ItemFormatter.prototype.formatText=function(e){var t,n;t=this._uiContext.getDatabase();n=null;typeof this._title=="undefined"||this._title===null?n=t.getObject(e,"label"):n=this._title.evaluateSingleOnItem(e,t).value;if(typeof n=="undefined"||n===null)n=e;return n};Exhibit.Formatter._DateFormatter=function(e){var t,n,r,i,s,o,u,a,f,l;this._timeZone=e.getSetting("format/date/time-zone");typeof this._timeZone!="number"&&(this._timeZone=-(new Date).getTimezoneOffset()/60);this._timeZoneOffset=this._timeZone*36e5;t=e.getSetting("format/date/mode");n=e.getSetting("format/date/show");r=null;switch(t){case"short":r=n==="date"?Exhibit._("%formatter.dateShortFormat"):n==="time"?Exhibit._("%formatter.timeShortFormat"):Exhibit._("%formatter.dateTimeShortFormat");break;case"medium":r=n==="date"?Exhibit._("%formatter.dateMediumFormat"):n==="time"?Exhibit._("%formatter.timeMediumFormat"):Exhibit._("%formatter.dateTimeMediumFormat");break;case"long":r=n==="date"?Exhibit._("%formatter.dateLongFormat"):n==="time"?Exhibit._("%formatter.timeLongFormat"):Exhibit._("%formatter.dateTimeLongFormat");break;case"full":r=n==="date"?Exhibit._("%formatter.dateFullFormat"):n==="time"?Exhibit._("%formatter.timeFullFormat"):Exhibit._("%formatter.dateTimeFullFormat");break;default:r=e.getSetting("format/date/template")}typeof r!="string"&&(r=Exhibit._("%formatter.dateTimeDefaultFormat"));i=[];s=r.match(/\b\w+\b/g);o=0;for(u=0;u<s.length;u++){a=s[u];f=r.indexOf(a,o);f>o&&i.push(r.substring(o,f));l=Exhibit.Formatter._DateFormatter._retrievers[a];typeof l=="function"?i.push(l):i.push(a);o=f+a.length}o<r.length&&i.push(r.substr(o));this._segments=i};Exhibit.Formatter._DateFormatter.prototype.format=function(e,t){t(document.createTextNode(this.formatText(e)))};Exhibit.Formatter._DateFormatter.prototype.formatText=function(e){var t,n,r,i,s;t=e instanceof Date?e:Exhibit.DateTime.parseIso8601DateTime(e);if(typeof t=="undefined"||t===null)return e;t.setTime(t.getTime()+this._timeZoneOffset);n="";r=this._segments;for(i=0;i<r.length;i++){s=r[i];typeof s=="string"?n+=s:n+=s(t)}return n};Exhibit.Formatter._DateFormatter._pad=function(e){return e<10?"0"+e:e.toString()};Exhibit.Formatter._DateFormatter._pad3=function(e){return e<10?"00"+e:e<100?"0"+e:e.toString()};Exhibit.Formatter._DateFormatter._retrievers={d:function(e){return e.getUTCDate().toString()},dd:function(e){return Exhibit.Formatter._DateFormatter._pad(e.getUTCDate())},EEE:function(e){return Exhibit._("%formatter.shortDaysOfWeek")[e.getUTCDay()]},EEEE:function(e){return Exhibit._("%formatter.daysOfWeek")[e.getUTCDay()]},MM:function(e){return Exhibit.Formatter._DateFormatter._pad(e.getUTCMonth()+1)},MMM:function(e){return Exhibit._("%formatter.shortMonths")[e.getUTCMonth()]},MMMM:function(e){return Exhibit._("%formatter.months")[e.getUTCMonth()]},yy:function(e){return Exhibit.Formatter._DateFormatter._pad(e.getUTCFullYear()%100)},yyyy:function(e){var t=e.getUTCFullYear();return t>0?t.toString():1-t},G:function(e){var t=e.getUTCYear();return t>0?Exhibit._("%formatter.commonEra"):Exhibit._("%formatter.beforeCommonEra")},HH:function(e){return Exhibit.Formatter._DateFormatter._pad(e.getUTCHours())},hh:function(e){var t=e.getUTCHours();return Exhibit.Formatter._DateFormatter._pad(t===0?12:t>12?t-12:t)},h:function(e){var t=e.getUTCHours();return(t===0?12:t>12?t-12:t).toString()},a:function(e){return e.getUTCHours()<12?Exhibit._("%formatter.beforeNoon"):Exhibit._("%formatter.afterNoon")},A:function(e){return e.getUTCHours()<12?Exhibit._("%formatter.BeforeNoon"):Exhibit._("%formatter.AfterNoon")},mm:function(e){return Exhibit.Formatter._DateFormatter._pad(e.getUTCMinutes())},ss:function(e){return Exhibit.Formatter._DateFormatter._pad(e.getUTCSeconds())},S:function(e){return Exhibit.Formatter._DateFormatter._pad3(e.getUTCMilliseconds())}};Exhibit.Formatter._constructors={number:Exhibit.Formatter._NumberFormatter,date:Exhibit.Formatter._DateFormatter,text:Exhibit.Formatter._TextFormatter,"boolean":Exhibit.Formatter._BooleanFormatter,image:Exhibit.Formatter._ImageFormatter,url:Exhibit.Formatter._URLFormatter,item:Exhibit.Formatter._ItemFormatter,currency:Exhibit.Formatter._CurrencyFormatter};Exhibit.FormatParser={};Exhibit.FormatParser._valueTypes={list:!0,number:!0,date:!0,item:!0,text:!0,url:!0,image:!0,currency:!0};Exhibit.FormatParser.parse=function(e,t,n,r){n=n||0;r=r||{};var i=new Exhibit.FormatScanner(t,n);try{return Exhibit.FormatParser._internalParse(e,i,r,!1)}finally{r.index=i.token()!==null?i.token().start:i.index()}};Exhibit.FormatParser.parseSeveral=function(e,t,n,r){n=n||0;r=r||{};var i=new Exhibit.FormatScanner(t,n);try{return Exhibit.FormatParser._internalParse(e,i,r,!0)}finally{r.index=i.token()!==null?i.token().start:i.index()}};Exhibit.FormatParser._internalParse=function(e,t,n,r){var i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S;i=Exhibit.FormatScanner;s=t.token();o=function(){t.next();s=t.token()};u=function(){return s!==null?s.start:t.index()};a=function(t,n,r){e.putSetting("format/"+t+"/"+n,r)};f=function(e,t,n){if(s!==null&&s.type!==i.IDENTIFIER&&typeof n[s.value]!="undefined"){a(e,t,n[s.value]);o();return!1}return!0};l=function(e,t,n){if(f(e,t,n)){if(typeof s=="undefined"||s===null||s.type!==i.NUMBER)throw new Error(Exhibit._("%format.error.missingNumber",u()));a(e,t,s.value);o()}};c=function(e,t,n){if(f(e,t,n)){if(typeof s=="undefined"||s===null||s.type!==i.NUMBER)throw new Error(Exhibit._("%format.error.missingInteger",u()));a(e,t,Math.round(s.value));o()}};h=function(e,t,n){if(f(e,t,n)){if(typeof s=="undefined"||s===null||s.type!==i.NUMBER||s.value<0)throw new Error(Exhibit._("%format.error.missingNonNegativeInteger",u()));a(e,t,Math.round(s.value));o()}};p=function(e,t,n){if(f(e,t,n)){if(typeof s=="undefined"||s===null||s.type!==i.STRING)throw new Error(Exhibit._("%format.error.missingString",u()));a(e,t,s.value);o()}};d=function(e,t,n){if(f(e,t,n)){if(typeof s=="undefined"||s===null||s.type!==i.URL)throw new Error(Exhibit._("%format.error.missingURL",u()));a(e,t,s.value);o()}};v=function(e,t,n){if(f(e,t,n)){if(typeof s=="undefined"||s===null||s.type!==i.EXPRESSION)throw new Error(Exhibit._("%format.error.missingExpression",u()));a(e,t,s.value);o()}};m=function(e,t,n){if(f(e,t,n)){if(typeof s=="undefined"||s===null||s.type!==i.EXPRESSION&&s.type!==i.STRING)throw new Error(Exhibit._("%format.error.missingExpressionOrString",u()));a(e,t,s.value);o()}};g=function(e,t,n){var r;if(typeof s=="undefined"||s===null||s.type!==i.IDENTIFIER)throw new Error(Exhibit._("%format.error.missingOption",u()));for(r=0;r<n.length;r++)if(s.value===n[r]){a(e,t,s.value);o();return}throw new Error(Exhibit._("%format.error.unsupportedOption",s.value,t,e,u()))};y=function(e,t,n,r){var f,l,c;while(s!==null&&s.type===i.IDENTIFIER){l=!1;c=!1;for(f=0;f<n.length&&!l;f++)if(s.value===n[f]){a(e,t+"/"+s.value,!0);o();l=!0}if(!l&&typeof r[s.value]!="undefined"){a(e,t+"/"+r[s.value],!1);o();c=!0}if(!c)throw new Error(Exhibit._("%format.error.unsupportedFlag",s.value,t,e,u()))}};b=function(e,t){switch(e){case"number":switch(t){case"decimal-digits":h(e,t,{"default":-1});return}break;case"date":switch(t){case"time-zone":l(e,t,{"default":null});return;case"show":g(e,t,["date","time","date-time"]);return;case"mode":g(e,t,["short","medium","long","full"]);a(e,"template",null);return;case"template":p(e,t,{});a(e,"mode",null);return}break;case"boolean":break;case"text":switch(t){case"max-length":c(e,t,{none:0});return}break;case"image":switch(t){case"tooltip":m(e,t,{none:null});return;case"max-width":case"max-height":c(e,t,{none:-1});return}break;case"url":switch(t){case"target":p(e,t,{none:null});return;case"external-icon":d(e,t,{none:null});return}break;case"item":switch(t){case"title":v(e,t,{"default":null});return}break;case"currency":switch(t){case"negative-format":y(e,t,["red","parentheses","signed"],{unsigned:"signed","no-parenthesis":"parentheses",black:"red"});return;case"symbol":p(e,t,{"default":"$",none:null});return;case"symbol-placement":g(e,t,["first","last","after-sign"]);return;case"decimal-digits":h(e,t,{"default":-1});return}break;case"list":switch(t){case"separator":case"last-separator":case"pair-separator":case"empty-text":p(e,t,{});return}}throw new Error(Exhibit._("%format.error.unsupportedSetting",t,e,u()))};w=function(e){while(s!==null&&s.type===i.IDENTIFIER){var t=s.value;o();if(typeof s=="undefined"||s===null||s.type!==i.DELIMITER||s.value!==":")throw new Error(Exhibit._("%format.error.missingColon",u()));o();b(e,t);if(typeof s=="undefined"||s===null||s.type!==i.DELIMITER||s.value!==";")break;o()}};E=function(){if(typeof s=="undefined"||s===null||s.type!==i.IDENTIFIER)throw new Error(Exhibit._("%format.error.missingValueType",u()));var e=s.value;if(typeof Exhibit.FormatParser._valueTypes[e]=="undefined")throw new Error(Exhibit._("%format.error.unsupportedValueType",e,u()));o();if(s!==null&&s.type===i.DELIMITER&&s.value==="{"){o();w(e);if(typeof s=="undefined"||s===null||s.type!==i.DELIMITER||s.value!=="}")throw new Error(Exhibit._("%format.error.missingBrace",u()));o()}return e};S=function(){var e="text";while(s!==null&&s.type===i.IDENTIFIER)e=E();return e};return r?S():E()};Exhibit.FormatScanner=function(e,t){this._text=e+" ";this._maxIndex=e.length;this._index=t;this.next()};Exhibit.FormatScanner.DELIMITER=0;Exhibit.FormatScanner.NUMBER=1;Exhibit.FormatScanner.STRING=2;Exhibit.FormatScanner.IDENTIFIER=3;Exhibit.FormatScanner.URL=4;Exhibit.FormatScanner.EXPRESSION=5;Exhibit.FormatScanner.COLOR=6;Exhibit.FormatScanner.prototype.token=function(){return this._token};Exhibit.FormatScanner.prototype.index=function(){return this._index};Exhibit.FormatScanner.prototype.next=function(){this._token=null;var e,t,n,r,i,s,o,u,a,f,l;e=this;t=function(t){while(t<e._maxIndex&&" 	\r\n".indexOf(e._text.charAt(t))>=0)t++;return t};this._index=t(this._index);if(this._index<this._maxIndex){r=this._text.charAt(this._index);i=this._text.charAt(this._index+1);if("{}(),:;".indexOf(r)>=0){this._token={type:Exhibit.FormatScanner.DELIMITER,value:r,start:this._index,end:this._index+1};this._index++}else if("\"'".indexOf(r)>=0){n=this._index+1;while(n<this._maxIndex){if(this._text.charAt(n)===r&&this._text.charAt(n-1)!=="\\")break;n++}if(!(n<this._maxIndex))throw new Error(Exhibit._("%format.error.unterminatedString",this._index));this._token={type:Exhibit.FormatScanner.STRING,value:this._text.substring(this._index+1,n).replace(/\\'/g,"'").replace(/\\"/g,'"'),start:this._index,end:n+1};this._index=n+1}else if(r==="#"){n=this._index+1;while(n<this._maxIndex&&this._isHexDigit(this._text.charAt(n)))n++;this._token={type:Exhibit.FormatScanner.COLOR,value:this._text.substring(this._index,n),start:this._index,end:n};this._index=n}else if(this._isDigit(r)){n=this._index;while(n<this._maxIndex&&this._isDigit(this._text.charAt(n)))n++;if(n<this._maxIndex&&this._text.charAt(n)==="."){n++;while(n<this._maxIndex&&this._isDigit(this._text.charAt(n)))n++}this._token={type:Exhibit.FormatScanner.NUMBER,value:parseFloat(this._text.substring(this._index,n)),start:this._index,end:n};this._index=n}else{n=this._index;while(n<this._maxIndex){a=this._text.substr(n).search(/\W/);if(a>0)n+=a;else{if(!("-".indexOf(this._text.charAt(n))>=0))break;n++}}s=this._text.substring(this._index,n);if(s==="url"){o=t(n);if(this._text.charAt(o)==="("){u=this._text.indexOf(")",o);if(!(u>0))throw new Error(Exhibit._("%format.error.missingCloseURL",this._index));this._token={type:Exhibit.FormatScanner.URL,value:this._text.substring(o+1,u),start:this._index,end:u+1};this._index=u+1}}else if(s==="expression"){o=t(n);if(this._text.charAt(o)==="("){f={};l=Exhibit.ExpressionParser.parse(this._text,o+1,f);u=t(f.index);if(this._text.charAt(u)!==")")throw new Error("Missing ) to close expression at "+f.index);this._token={type:Exhibit.FormatScanner.EXPRESSION,value:l,start:this._index,end:u+1};this._index=u+1}}else{this._token={type:Exhibit.FormatScanner.IDENTIFIER,value:s,start:this._index,end:n};this._index=n}}}};Exhibit.FormatScanner.prototype._isDigit=function(e){return"0123456789".indexOf(e)>=0};Exhibit.FormatScanner.prototype._isHexDigit=function(e){return"0123456789abcdefABCDEF".indexOf(e)>=0};Exhibit.Facet=function(e,t,n){var r,i,s,o,u,a,f,l,c,h;r=this;s=e;u=n;o=$(t);a=!1;i=null;f=null;l="";_settingSpecs={};this._settings={};this.getLabel=function(){return typeof this._settings.facetLabel!="undefined"?this._settings.facetLabel:Exhibit._("%facets.missingLabel",Exhibit.makeExhibitAttribute("facetLabel"))};this.setExpression=function(e){f=e};this.getExpression=function(){return f};this.setExpressionString=function(e){l=e;h()};this.getExpressionString=function(){return l};this.addSettingSpecs=function(e){$.extend(!0,_settingSpecs,e)};this.getSettingSpecs=function(){return _settingSpecs};this.getID=function(){return i};this.getUIContext=function(){return u};this.getContainer=function(){return o};this.register=function(){this.getUIContext().getMain().getRegistry().register(Exhibit.Facet.getRegistryKey(),this.getID(),this);a=!0};this.unregister=function(){r.getUIContext().getMain().getRegistry().unregister(Exhibit.Facet.getRegistryKey(),r.getID());a=!1};this._dispose=function(){$(o).empty();this.getUIContext().getCollection().removeFacet(this);this.unregister();i=null;o=null;u=null;f=null;l=null;_settings=null;_settingSpecs=null;r=null};h=function(){i=$(o).attr("id");if(typeof i=="undefined"||i===null)i=Exhibit.Facet.getRegistryKey()+"-"+s+"-"+r.getExpressionString()+"-"+r.getUIContext().getCollection().getID()+"-"+r.getUIContext().getMain().getRegistry().generateIdentifier(Exhibit.Facet.getRegistryKey())};h();r.addSettingSpecs(Exhibit.Facet._settingSpecs)};Exhibit.Facet._registryKey="facet";Exhibit.Facet._settingSpecs={facetLabel:{type:"text"}};Exhibit.Facet.getRegistryKey=function(){return Exhibit.Facet._registryKey};Exhibit.Facet.registerComponent=function(e,t){if(!t.hasRegistry(Exhibit.Facet.getRegistryKey())){t.createRegistry(Exhibit.Facet.getRegistryKey());$(document).trigger("registerFacets.exhibit")}};$(document).one("registerComponents.exhibit",Exhibit.Facet.registerComponent);Exhibit.ListFacet=function(e,t){$.extend(this,new Exhibit.Facet("list",e,t));this.addSettingSpecs(Exhibit.ListFacet._settingSpecs);this._colorCoder=null;this._valueSet=new Exhibit.Set;this._selectMissing=!1;this._delayedUpdateItems=null;this._dom=null;this._orderMap=null};Exhibit.ListFacet._settingSpecs={fixedOrder:{type:"text"},sortMode:{type:"text",defaultValue:"value"},sortDirection:{type:"text",defaultValue:"forward"},showMissing:{type:"boolean",defaultValue:!0},missingLabel:{type:"text"},scroll:{type:"boolean",defaultValue:!0},height:{type:"text"},colorCoder:{type:"text",defaultValue:null},collapsible:{type:"boolean",defaultValue:!1},collapsed:{type:"boolean",defaultValue:!1},formatter:{type:"text",defaultValue:null}};Exhibit.ListFacet.create=function(e,t,n){var r,i;i=Exhibit.UIContext.create(e,n);r=new Exhibit.ListFacet(t,i);Exhibit.ListFacet._configure(r,e);r._initializeUI();i.getCollection().addFacet(r);r.register();return r};Exhibit.ListFacet.createFromDOM=function(e,t,n){var r,i,s,o,u,a,f;r=Exhibit.getConfigurationFromDOM(e);i=Exhibit.UIContext.createFromDOM(e,n);s=new Exhibit.ListFacet(typeof t!="undefined"&&t!==null?t:e,i);Exhibit.SettingsUtilities.collectSettingsFromDOM(e,s.getSettingSpecs(),s._settings);try{o=Exhibit.getAttribute(e,"expression");if(typeof o!="undefined"&&o!==null&&o.length>0){s.setExpression(Exhibit.ExpressionParser.parse(o));s.setExpressionString(o)}u=Exhibit.getAttribute(e,"selection",";");if(typeof u!="undefined"&&u!==null&&u.length>0)for(f=0;f<u.length;f++)s._valueSet.add(u[f]);a=Exhibit.getAttribute(e,"selectMissing");typeof a!="undefined"&&a!==null&&a.length>0&&(s._selectMissing=a==="true")}catch(l){Exhibit.Debug.exception(l,"ListFacet: Error processing configuration of list facet")}Exhibit.ListFacet._configure(s,r);s._initializeUI();i.getCollection().addFacet(s);s.register();return s};Exhibit.ListFacet._configure=function(facet,configuration){var selection,i,segment,property,values,orderMap,formatter;Exhibit.SettingsUtilities.collectSettings(configuration,facet.getSettingSpecs(),facet._settings);if(typeof configuration.expression!="undefined"){facet.setExpressionString(configuration.expression);facet.setExpression(Exhibit.ExpressionParser.parse(configuration.expression))}if(typeof configuration.selection!="undefined"){selection=configuration.selection;for(i=0;i<selection.length;i++)facet._valueSet.add(selection[i])}typeof configuration.selectMissing!="undefined"&&(facet._selectMissing=configuration.selectMissing);if(typeof facet._settings.facetLabel=="undefined"&&facet.getExpression()!==null&&facet.getExpression().isPath()){segment=facet.getExpression().getPath().getLastSegment();property=facet.getUIContext().getDatabase().getProperty(segment.property);typeof property!="undefined"&&property!==null&&(facet._settings.facetLabel=segment.forward?property.getLabel():property.getReverseLabel())}if(typeof facet._settings.fixedOrder!="undefined"){values=facet._settings.fixedOrder.split(";");orderMap={};for(i=0;i<values.length;i++)orderMap[values[i].trim()]=i;facet._orderMap=orderMap}facet._settings.colorCoder!=="undefined"&&(facet._colorCoder=facet.getUIContext().getMain().getComponent(facet._settings.colorCoder));facet._settings.collapsed&&(facet._settings.collapsible=!0);if(typeof facet._settings.formatter!="undefined"){formatter=facet._settings.formatter;if(formatter!==null&&formatter.length>0)try{facet._formatter=eval(formatter)}catch(e){Exhibit.Debug.log(e)}}facet._cache=new Exhibit.FacetUtilities.Cache(facet.getUIContext().getDatabase(),facet.getUIContext().getCollection(),facet.getExpression())};Exhibit.ListFacet.prototype.dispose=function(){this._cache.dispose();this._cache=null;this._colorCoder=null;this._dom=null;this._valueSet=null;this._orderMap=null;this._dispose()};Exhibit.ListFacet.prototype.hasRestrictions=function(){return this._valueSet.size()>0||this._selectMissing};Exhibit.ListFacet.prototype.clearAllRestrictions=function(){$(this.getContainer()).trigger("onBeforeFacetReset.exhibit");this._valueSet=new Exhibit.Set;this._selectMissing=!1;this._notifyCollection()};Exhibit.ListFacet.prototype.applyRestrictions=function(e){var t;this._valueSet=new Exhibit.Set;for(t=0;t<e.selection.length;t++)this._valueSet.add(e.selection[t]);this._selectMissing=e.selectMissing;this._notifyCollection()};Exhibit.ListFacet.prototype.setSelection=function(e,t){t?this._valueSet.add(e):this._valueSet.remove(e);this._notifyCollection()};Exhibit.ListFacet.prototype.setSelectMissing=function(e){if(e!==this._selectMissing){this._selectMissing=e;this._notifyCollection()}};Exhibit.ListFacet.prototype.restrict=function(e){if(this._valueSet.size()===0&&!this._selectMissing)return e;var t=this._cache.getItemsFromValues(this._valueSet,e);this._selectMissing&&this._cache.getItemsMissingValue(e,t);return t};Exhibit.ListFacet.prototype.onUncollapse=function(){if(this._delayedUpdateItems!==null){this.update(this._delayedUpdateItems);this._delayedUpdateItems=null}};Exhibit.ListFacet.prototype.update=function(e){if(Exhibit.FacetUtilities.isCollapsed(this)){this._delayedUpdateItems=e;return}$(this._dom.valuesContainer).hide().empty();this._constructBody(this._computeFacet(e));$(this._dom.valuesContainer).show()};Exhibit.ListFacet.prototype._computeFacet=function(e){var t,n,r,i,s,o,u,a,f,l;t=this.getUIContext().getDatabase();n=this._cache.getValueCountsFromItems(e);r=n.entries;i=n.valueType;if(r.length>0){s=this._valueSet;o=i==="item"?function(e){var n=t.getObject(e,"label");return n!==null?n:e}:function(e){return e};for(u=0;u<r.length;u++){a=r[u];a.actionLabel=a.selectionLabel=o(a.value);a.selected=s.contains(a.value)}r.sort(this._createSortFunction(i))}if(this._settings.showMissing||this._selectMissing){f=this._cache.countItemsMissingValue(e);if(f>0||this._selectMissing
){l=$("<span>").attr("class","exhibit-facet-value-missingThisField").html(typeof this._settings.missingLabel!="undefined"?this._settings.missingLabel:Exhibit._("%facets.missingThisField"));r.unshift({value:null,count:f,selected:this._selectMissing,selectionLabel:$(l).get(0),actionLabel:Exhibit._("%facets.missingThisField")})}}return r};Exhibit.ListFacet.prototype._notifyCollection=function(){this.getUIContext().getCollection().onFacetUpdated(this)};Exhibit.ListFacet.prototype._initializeUI=function(){var e=this;this._dom=Exhibit.FacetUtilities[this._settings.scroll?"constructFacetFrame":"constructFlowingFacetFrame"](this,this.getContainer(),this.getLabel(),function(t,n,r){e._clearSelections()},this.getUIContext(),this._settings.collapsible,this._settings.collapsed);typeof this._settings.height!="undefined"&&this._settings.scroll&&$(this._dom.valuesContainer).css("height",this._settings.height)};Exhibit.ListFacet.prototype._constructBody=function(e){var t,n,r,i,s,o;t=this;n=this._dom.valuesContainer;$(n).hide();r=Exhibit.FacetUtilities[this._settings.scroll?"constructFacetItem":"constructFlowingFacetItem"];i=this._valueSet.size()>0||this._selectMissing;s=function(e){var s,o,u;s=function(n){t._filter(e.value,e.actionLabel,!1);n.preventDefault();n.stopPropagation()};o=function(n){t._filter(e.value,e.actionLabel,!n.ctrlKey&&!n.metaKey);n.preventDefault();n.stopPropagation()};u=r(e.selectionLabel,e.count,typeof t._colorCoder!="undefined"&&t._colorCoder!==null?t._colorCoder.translate(e.value):null,e.selected,i,s,o,t.getUIContext());t._formatter&&t._formatter(u);$(n).append(u)};for(o=0;o<e.length;o++)s(e[o]);$(n).show();this._dom.setSelectionCount(this._valueSet.size()+(this._selectMissing?1:0))};Exhibit.ListFacet.prototype._filter=function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p,d;r=this;u=new Exhibit.Set(this._valueSet);a=this._selectMissing;if(typeof e=="undefined"||e===null){h=a;p=h&&u.size()===0;if(n){u.size()===0?l=!a:l=!0;f=new Exhibit.Set}else{l=!a;f=new Exhibit.Set(u)}}else{h=u.contains(e);p=h&&u.size()===1&&!a;if(n){l=!1;f=new Exhibit.Set;u.contains(e)?(u.size()>1||a)&&f.add(e):f.add(e)}else{l=a;f=new Exhibit.Set(u);f.contains(e)?f.remove(e):f.add(e)}}d={selection:f.toArray(),selectMissing:l};Exhibit.History.pushComponentState(this,Exhibit.Facet.getRegistryKey(),d,n&&!p?Exhibit._("%facets.facetSelectOnlyActionTitle",t,this.getLabel()):Exhibit._(h?"%facets.facetUnselectActionTitle":"%facets.facetSelectActionTitle",t,this.getLabel()),!0)};Exhibit.ListFacet.prototype._clearSelections=function(){Exhibit.History.pushComponentState(this,Exhibit.Facet.getRegistryKey(),this.exportEmptyState(),Exhibit._("%facets.facetClearSelectionsActionTitle",this.getLabel()),!0)};Exhibit.ListFacet.prototype._createSortFunction=function(e){var t,n,r,i;t=function(e,t){return e.selectionLabel.localeCompare(t.selectionLabel)};if(this._orderMap!==null){n=this._orderMap;t=function(e,t){return typeof n[e.selectionLabel]!="undefined"?typeof n[t.selectionLabel]!="undefined"?n[e.selectionLabel]-n[t.selectionLabel]:-1:typeof n[t.selectionLabel]!="undefined"?1:e.selectionLabel.localeCompare(t.selectionLabel)}}else e==="number"&&(t=function(e,t){e=parseFloat(e.value);t=parseFloat(t.value);return e<t?-1:e>t?1:0});r=t;this._settings.sortMode==="count"&&(r=function(e,n){var r=n.count-e.count;return r!==0?r:t(e,n)});i=r;this._settings.sortDirection==="reverse"&&(i=function(e,t){return r(t,e)});return i};Exhibit.ListFacet.prototype.exportState=function(){return this._exportState(!1)};Exhibit.ListFacet.prototype.exportEmptyState=function(){return this._exportState(!0)};Exhibit.ListFacet.prototype._exportState=function(e){var t=[];e||(t=this._valueSet.toArray());return{selection:t,selectMissing:e?!1:this._selectMissing}};Exhibit.ListFacet.prototype.importState=function(e){this.stateDiffers(e)&&(e.selection.length===0&&!e.selectMissing?this.clearAllRestrictions():this.applyRestrictions(e))};Exhibit.ListFacet.prototype.stateDiffers=function(e){var t,n,r;if(e.selectMissing!==this._selectMissing)return!0;n=e.selection.length;r=this._valueSet.size();if(n!==r)return!0;t=new Exhibit.Set(e.selection);t.addSet(this._valueSet);return t.size()!==n?!0:!1};Exhibit.TextSearchFacet=function(e,t){var n=this;$.extend(this,new Exhibit.Facet("text",e,t));this.addSettingSpecs(Exhibit.TextSearchFacet._settingSpecs);this._text=null;this._dom=null;this._timerID=null;this._onRootItemsChanged=function(e){typeof n._itemToValue!="undefined"&&delete n._itemToValue};$(t.getCollection().getElement()).bind("onRootItemsChanged.exhibit",this._onRootItemsChanged)};Exhibit.TextSearchFacet._settingSpecs={queryParamName:{type:"text"},requiresEnter:{type:"boolean",defaultValue:!1}};Exhibit.TextSearchFacet.create=function(e,t,n){var n=Exhibit.UIContext.create(e,n),r=new Exhibit.TextSearchFacet(t,n);Exhibit.TextSearchFacet._configure(r,e);r._initializeUI();n.getCollection().addFacet(r);r.register();return r};Exhibit.TextSearchFacet.createFromDOM=function(e,t,n){var r=Exhibit.getConfigurationFromDOM(e),n=Exhibit.UIContext.createFromDOM(e,n),i=new Exhibit.TextSearchFacet(typeof t!="undefined"&&t!==null?t:e,n);Exhibit.SettingsUtilities.collectSettingsFromDOM(e,i.getSettingSpecs(),i._settings);try{var s=Exhibit.getAttribute(e,"expressions");if(typeof s!="undefined"&&s!==null&&s.length>0){i.setExpressionString(s);i.setExpression(Exhibit.ExpressionParser.parseSeveral(s))}var o=Exhibit.getAttribute(e,"query");typeof o!="undefined"&&o!==null&&o.length>0&&(i._text=o)}catch(u){Exhibit.Debug.exception(u,Exhibit._("%facets.error.configuration","TextSearchFacet"))}Exhibit.TextSearchFacet._configure(i,r);i._initializeUI();n.getCollection().addFacet(i);i.register();return i};Exhibit.TextSearchFacet._configure=function(e,t){var n,r;Exhibit.SettingsUtilities.collectSettings(t,e.getSettingSpecs(),e._settings);if(typeof t.expressions!="undefined"){n=[];r=[];for(var i=0;i<t.expressions.length;i++){r.push(t.expressions[i]);n.push(Exhibit.ExpressionParser.parse(t.expressions[i]))}e.setExpressionString(expressionStrings.join(",").replace(/ /g,""));e.setExpression(n)}if(typeof t.selection!="undefined"){var s=t.selection;for(var i=0;i<s.length;i++)e._valueSet.add(s[i])}typeof t.query!="undefined"&&(e._text=t.query);if(typeof e._settings.queryParamName!="undefined"){var o=Exhibit.parseURLParameters();typeof o[e._settings.queryParamName]!="undefined"&&(e._text=o[e._settings.queryParamName])}};Exhibit.TextSearchFacet.prototype.dispose=function(){this.getUIContext().getCollection().removeFacet(this);$(this.getUIContext().getCollection().getElement()).unbind("onRootItemsChanged.exhibit",this._onRootItemsChanged);this._text=null;this._dom=null;this._itemToValue=null;this._timerID=null;this._dispose()};Exhibit.TextSearchFacet.prototype.hasRestrictions=function(){return this._text!==null};Exhibit.TextSearchFacet.prototype.clearAllRestrictions=function(){$(this.getContainer()).trigger("onBeforeFacetReset.exhibit");var e=this._text;if(this._text!==null){this._text=null;this._notifyCollection()}$(this._dom.input).val("")};Exhibit.TextSearchFacet.prototype.applyRestrictions=function(e){this.setText(e.text)};Exhibit.TextSearchFacet.prototype.setText=function(e){if(typeof e!="undefined"&&e!==null){e=e.trim();$(this._dom.input).val(e);e=e.length>0?e:null}else $(this._dom.input).val("");if(e!==this._text){this._text=e;this._notifyCollection()}};Exhibit.TextSearchFacet.prototype.restrict=function(e){var t,n,r;if(this._text===null)return e;$(this.getContainer()).trigger("onTextSearchFacetSearch.exhibit",[this._text]);this._buildMaps();t=new Exhibit.Set;n=this._itemToValue;r=this._text.toLowerCase();e.visit(function(e){var i,s;if(typeof n[e]!="undefined"){i=n[e];for(s=0;s<i.length;s++)if(i[s].indexOf(r)>=0){t.add(e);break}}});return t};Exhibit.TextSearchFacet.prototype.update=function(e){};Exhibit.TextSearchFacet.prototype._notifyCollection=function(){this.getUIContext().getCollection().onFacetUpdated(this)};Exhibit.TextSearchFacet.prototype._initializeUI=function(){var e=this;this._dom=Exhibit.TextSearchFacet.constructFacetFrame(this.getContainer(),this._settings.facetLabel);this._text!==null&&$(this._dom.input).val(this._text);$(this._dom.input).bind("keyup",function(t){e._onTextInputKeyUp(t)})};Exhibit.TextSearchFacet.constructFacetFrame=function(e,t){return typeof t!="undefined"&&t!==null&&t!==""?$.simileDOM("string",e,'<div class="exhibit-facet-header"><span class="exhibit-facet-header-title">'+t+"</span>"+"</div>"+'<div class="exhibit-text-facet"><input type="text" id="input"></div>'):$.simileDOM("string",e,'<div class="exhibit-text-facet"><input type="text" id="input"></div>')};Exhibit.TextSearchFacet.prototype._onTextInputKeyUp=function(e){var t,n;this._timerID!==null&&window.clearTimeout(this._timerID);t=this;if(this._settings.requiresEnter===!1)this._timerID=window.setTimeout(function(){t._onTimeout()},500);else{n=$(this._dom.input).val().trim();if(n.length===0||e.which===13)this._timerID=window.setTimeout(function(){t._onTimeout()},0)}};Exhibit.TextSearchFacet.prototype._onTimeout=function(){var e,t,n;this._timerID=null;e=$(this._dom.input).val().trim();e.length===0&&(e=null);if(e!==this._text){t=this;n=this._text;Exhibit.History.pushComponentState(this,Exhibit.Facet._registryKey,{text:e},e!==null?Exhibit._("%facets.facetTextSearchActionTitle",e):Exhibit._("%facets.facetClearTextSearchActionTitle"),!0)}};Exhibit.TextSearchFacet.prototype._buildMaps=function(){var e,t,n,r,i;if(typeof this._itemToValue=="undefined"){e={};t=this.getUIContext().getCollection().getAllItems();n=this.getUIContext().getDatabase();if(this.getExpression().length>0){r=this.getExpression();t.visit(function(t){var i,s,o;i=[];for(s=0;s<r.length;s++){o=r[s];o.evaluateOnItem(t,n).values.visit(function(e){i.push(e.toLowerCase())})}e[t]=i})}else{i=n.getAllProperties();t.visit(function(t){var r,s;r=[];for(s=0;s<i.length;s++)n.getObjects(t,i[s]).visit(function(e){r.push(e.toLowerCase())});e[t]=r})}this._itemToValue=e}};Exhibit.TextSearchFacet.prototype.exportState=function(){return this._exportState(!1)};Exhibit.TextSearchFacet.prototype.exportEmptyState=function(){return this._exportState(!0)};Exhibit.TextSearchFacet.prototype._exportState=function(e){return{text:e?null:this._text}};Exhibit.TextSearchFacet.prototype.importState=function(e){this.applyRestrictions(e)};Exhibit.HierarchicalFacet=function(e,t){var n=this;$.extend(this,new Exhibit.Facet("hierarchical",e,t));this.addSettingSpecs(Exhibit.HierarchicalFacet._settingSpecs);this._colorCoder=null;this._uniformGroupingExpression=null;this._selections=[];this._expanded={};this._dom=null;this._onRootItemsChanged=function(){typeof n._cache!="undefined"&&delete n._cache};$(t.getCollection().getElement()).bind("onRootItemsChanged.exhibit",this._onRootItemsChanged)};Exhibit.HierarchicalFacet._settingSpecs={fixedOrder:{type:"text"},sortMode:{type:"text",defaultValue:"value"},sortDirection:{type:"text",defaultValue:"forward"},othersLabel:{type:"text"},scroll:{type:"boolean",defaultValue:!0},height:{type:"text"},colorCoder:{type:"text",defaultValue:null},collapsible:{type:"boolean",defaultValue:!1},collapsed:{type:"boolean",defaultValue:!1}};Exhibit.HierarchicalFacet.create=function(e,t,n){var n,r;n=Exhibit.UIContext.create(e,n);r=new Exhibit.HierarchicalFacet(t,n);Exhibit.HierarchicalFacet._configure(r,e);r._initializeUI();n.getCollection().addFacet(r);r.register();return r};Exhibit.HierarchicalFacet.createFromDOM=function(e,t,n){var r,n,i,s,o,u,a,f;r=Exhibit.getConfigurationFromDOM(e);n=Exhibit.UIContext.createFromDOM(e,n);i=new Exhibit.HierarchicalFacet(typeof t!="undefined"&&t!==null?t:e,n);Exhibit.SettingsUtilities.collectSettingsFromDOM(e,i.getSettingSpecs(),i._settings);try{s=Exhibit.getAttribute(e,"expression");if(s!==null&&s.length>0){i.setExpressionString(s);i.setExpression(Exhibit.ExpressionParser.parse(s))}o=Exhibit.getAttribute(e,"uniformGrouping");o!==null&&o.length>0&&(i._uniformGroupingExpression=Exhibit.ExpressionParser.parse(o));u=Exhibit.getAttribute(e,"selection",";");if(u!==null&&u.length>0)for(a=0;a<u.length;a++){f=u[a];i._selections=i._internalAddSelection({value:f,selectOthers:!1})}}catch(l){Exhibit.Debug.exception(l,Exhibit._("%facets.error.configuration","HierarchicalFacet"))}Exhibit.HierarchicalFacet._configure(i,r);i._initializeUI();n.getCollection().addFacet(i);i.register();return i};Exhibit.HierarchicalFacet._configure=function(e,t){var n,r,i,s,o,u;Exhibit.SettingsUtilities.collectSettings(t,e.getSettingSpecs(),e._settings);if(typeof t.expression!="undefined"){e.setExpressionString(t.expression);e.setExpression(Exhibit.ExpressionParser.parse(t.expression))}typeof t.uniformGrouping!="undefined"&&(e._uniformGroupingExpression=Exhibit.ExpressionParser.parse(t.uniformGrouping));if(typeof t.selection!="undefined"){n=t.selection;for(r=0;r<n.length;r++)e._selections.push({value:n[r],selectOthers:!1})}if(typeof e._settings.facetLabel=="undefined"&&e.getExpression()!==null&&e.getExpression().isPath()){i=e.getExpression().getPath().getLastSegment();s=e.getUIContext().getDatabase().getProperty(i.property);s!==null&&(e._settings.facetLabel=i.forward?s.getLabel():s.getReverseLabel())}if(typeof e._settings.fixedOrder!="undefined"){o=e._settings.fixedOrder.split(";");u={};for(r=0;r<o.length;r++)u[o[r].trim()]=r;e._orderMap=u}typeof e._settings.colorCoder!="undefined"&&(e._colorCoder=e.getUIContext().getMain().getComponent(e._settings.colorCoder));e._settings.collapsed&&(e._settings.collapsible=!0)};Exhibit.HierarchicalFacet.prototype.dispose=function(){this.getUIContext().getCollection().removeFacet(this);$(this.getUIContext().getCollection().getElement()).unbind("onRootItemsChanged.exhibit",this._onRootItemsChanged);this._dom=null;this._orderMap=null;this._colorCoder=null;this._uniformGroupingExpression=null;this._selections=null;this._cache=null;this._expanded=null;this._dispose()};Exhibit.HierarchicalFacet.prototype.hasRestrictions=function(){return this._selections.length>0};Exhibit.HierarchicalFacet.prototype.clearAllRestrictions=function(){$(this.getContainer()).trigger("onBeforeFacetReset.exhibit");if(this._selections.length>0){this._selections=[];this._notifyCollection()}};Exhibit.HierarchicalFacet.prototype.applyRestrictions=function(e){this._selections=[].concat(e);this._notifyCollection()};Exhibit.HierarchicalFacet.prototype.setSelection=function(e,t){var n,r;n={value:e,selectOthers:!1};t?r=this._internalAddSelection(n):r=this._internalRemoveSelection(n);return r};Exhibit.HierarchicalFacet.prototype.setSelectOthers=function(e,t){var n,r;n={value:e,selectOthers:!0};t?r=this._internalAddSelection(n):r=this._internalRemoveSelection(n);return r};Exhibit.HierarchicalFacet.prototype.restrict=function(e){if(this._selections.length==0)return e;var t,n,r,i,s,o;this._buildCache();t=new Exhibit.Set;n=function(n){if(typeof n.children!="undefined"){r(n.children);Exhibit.Set.createIntersection(n.others,e,t)}else Exhibit.Set.createIntersection(n.items,e,t)};r=function(e){var t;for(t=0;t<e.length;t++)n(e[t])};for(i=0;i<this._selections.length;i++){s=this._selections[i];o=this._getTreeNode(s.value);typeof o!="undefined"&&o!==null&&(s.selectOthers?Exhibit.Set.createIntersection(o.others,e,t):n(o))}return t};Exhibit.HierarchicalFacet.prototype._internalAddSelection=function(e){var t,n,r,i,s,o,u,a,f;t={};n={};this._buildCache();r=this._cache;i=function(e){var n,s,o;if(typeof r.valueToParent[e]!="undefined"){n=r.valueToParent[e];for(s=0;s<n.length;s++){o=n[s];t[o]=!0;i(o)}}};s=function(e){var t,i,o;if(typeof r.valueToChildren[e]!="undefined"){t=r.valueToChildren[e];for(i=0;i<t.length;i++){o=t[i];n[o]=!0;s(o)}}};if(e.value!==null){i(e.value);if(e.selectOthers)t[e.value]=!0;else{n[e.value]=!0;s(e.value)}}o=this._selections;u=[e];for(a=0;a<o.length;a++){f=o[a];(!(f.value in t)||f.selectOthers)&&!(f.value in n)&&u.push(f)}return u};Exhibit.HierarchicalFacet.prototype._internalRemoveSelection=function(e){var t,n,r,i;t=this._selections;n=[];for(r=0;r<t.length;r++){i=t[r];(i.value!=e.value||i.selectOthers!=e.selectOthers)&&n.push(i)}return n};Exhibit.HierarchicalFacet.prototype.update=function(e){var t;$(this._dom.valuesContainer).hide().empty();t=this._computeFacet(e);typeof t!="undefined"&&t!==null&&this._constructBody(t);$(this._dom.valuesContainer).show()};Exhibit.HierarchicalFacet.prototype._computeFacet=function(e){var t,n,r,i,s,o,u,a;this._buildCache();t=this.getUIContext().getDatabase();n=this._getValueSorter();r=typeof this._settings.othersLabel!="undefined"?this._settings.othersLabel:Exhibit._("%facets.hierarchical.othersLabel");i={};for(s=0;s<this._selections.length;s++){o=this._selections[s];i[o.value]=o.selectOthers}u=function(t,s,o){var a,f,l,c,h,p,d;a=t.value in i&&!i[t.value];if(typeof t.children!="undefined"){f={value:t.value,label:t.label,children:[],selected:a,areOthers:!1};l=new Exhibit.Set;for(c=0;c<t.children.length;c++){h=t.children[c];u(h,f.children,l)}f.children.sort(n);if(t.others.size()>0){p=t.value in i&&i[t.value];d=Exhibit.Set.createIntersection(e,t.others);if(d.size()>0||p){f.children.push({value:t.value,label:r,count:d.size(),selected:p,areOthers:!0});l.addSet(d)}}f.count=l.size();if(a||f.count>0||f.children.length>0){s.push(f);o!=null&&l.size()>0&&o.addSet(l)}}else{d=Exhibit.Set.createIntersection(e,t.items);if(d.size()>0||a){s.push({value:t.value,label:t.label,count:d.size(),selected:a,areOthers:!1});o!=null&&d.size()>0&&o.addSet(d)}}};a=[];u(this._cache.tree,a,null);return a[0]};Exhibit.HierarchicalFacet.prototype._getValueSorter=function(){var e,t,n,r;e=function(e,t){return e.label.localeCompare(t.label)};if(typeof this._orderMap!="undefined"){t=this._orderMap;e=function(e,n){return typeof t[e.label]!="undefined"?typeof t[n.label]!="undefined"?t[e.label]-t[n.label]:-1:typeof t[n.label]!="undefined"?1:e.label.localeCompare(n.label)}}else this._cache.valueType==="number"&&(e=function(e,t){e=parseFloat(e.value);t=parseFloat(t.value);return e<t?-1:e>t?1:0});n=e;this._settings.sortMode==="count"&&(n=function(t,n){var r=n.count-t.count;return r!=0?r:e(t,n)});r=n;this._settings.sortDirection==="reverse"&&(r=function(e,t){return n(t,e)});return r};Exhibit.HierarchicalFacet.prototype._notifyCollection=function(){this.getUIContext().getCollection().onFacetUpdated(this)};Exhibit.HierarchicalFacet.prototype._initializeUI=function(){var e=this;this._dom=Exhibit.FacetUtilities[this._settings.scroll?"constructFacetFrame":"constructFlowingFacetFrame"](this,this.getContainer(),this.getLabel(),function(t,n,r){e._clearSelections()},this.getUIContext(),this._settings.collapsible,this._settings.collapsed);typeof this._settings.height!="undefined"&&this._settings.height!==null&&this._settings.scroll&&$(this._dom.valuesContainer).css("height",this._settings.height)};Exhibit.HierarchicalFacet.prototype._constructBody=function(e){var t,n,r,i,s,o;t=this;n=this._dom.valuesContainer;$(n).hide();r=Exhibit.FacetUtilities[this._settings.scroll?"constructHierarchicalFacetItem":"constructFlowingHierarchicalFacetItem"];i=this._selections.length>0;s=function(e,n){var s,u,a,f,l;s=typeof e.children!="undefined";u=function(n){if(s)if(e.selected){if(typeof t._expanded[e.value]!="undefined"){delete t._expanded[e.value];l.showChildren(!1)}}else if(typeof t._expanded[e.value]=="undefined"){t._expanded[e.value]=!0;l.showChildren(!0)}t._filter(e.value,e.areOthers,e.label,e.selected,!1);n.preventDefault();n.stopPropagation()};a=function(n){if(s)if(e.selected){if(typeof t._expanded[e.value]!="undefined"){delete t._expanded[e.value];l.showChildren(!1)}}else if(typeof t._expanded[e.value]=="undefined"){t._expanded[e.value]=!0;l.showChildren(!0)}t._filter(e.value,e.areOthers,e.label,e.selected,!n.ctrlKey&&!n.metaKey);n.preventDefault();n.stopPropagation()};f=function(n){var r;if(typeof t._expanded[e.value]!="undefined"){delete t._expanded[e.value];r=!1}else{t._expanded[e.value]=!0;r=!0}l.showChildren(r);n.preventDefault();n.stopPropagation()};l=r(e.label,e.count,t._colorCoder!=null?t._colorCoder.translate(e.value):null,e.selected,s,typeof t._expanded[e.value]!="undefined",i,u,a,f,t.getUIContext());$(n).append(l.elmt);s&&o(e.children,l.childrenContainer)};o=function(e,t){var n;for(n=0;n<e.length;n++)s(e[n],t)};o(e.children,n);$(n).show();this._dom.setSelectionCount(this._selections.length)};Exhibit.HierarchicalFacet.prototype._filter=function(e,t,n,r,i){var s,o,u,a;s=this;o=r&&this._selections.length==1;u={value:e,selectOthers:t};r?i?o?a=[]:a=[u]:a=this._internalRemoveSelection(u):i?a=[u]:a=this._internalAddSelection(u);Exhibit.History.pushComponentState(this,Exhibit.Facet.getRegistryKey(),{selections:a},i&&!o?Exhibit._("%facets.facetSelectOnlyActionTitle",n,this.getLabel()):Exhibit._(r?"%facets.facetUnselectActionTitle":"%facets.facetSelectActionTitle",n,this.getLabel()),!0)};Exhibit.HierarchicalFacet.prototype._clearSelections=function(){Exhibit.History.pushComponentState(this,Exhibit.Facet.getRegistryKey(),this.exportEmptyState(),Exhibit._("%facets.facetClearSelectionsActionTitle",this.getLabel()),!0)};Exhibit.HierarchicalFacet.prototype._buildCache=function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d;if(typeof this._cache=="undefined"){e={};t="text";n={};r={};i={};s=new Exhibit.Set;o=function(e,t,n){typeof n[e]!="undefined"?n[e].push(t):n[e]=[t]};u=this.getUIContext().getDatabase();a={value:null,label:Exhibit._("%facets.hierarchical.rootLabel"),others:new Exhibit.Set,children:[]};f=this.getExpression();this.getUIContext().getCollection().getAllItems().visit(function(n){var r;r=f.evaluateOnItem(n,u);if(r.values.size()>0){t=r.valueType;r.values.visit(function(t){s.add(t);o(t,n,e)})}else a.others.add(n)});l=this._uniformGroupingExpression;c=new Exhibit.Set;h=function(e){var t;t=new Exhibit.Set;e.visit(function(i){var s;s=l.evaluateOnItem(i,u);s.values.size()>0?s.values.visit(function(s){o(i,s,r);o(s,i,n);e.contains(s)||t.add(s);return!0}):c.add(i)});t.size()>0&&h(t)};h(s);p=function(t,r,s,o){var a,f,l,c,h,d,v;a=u.getObject(t,"label");f={value:t,label:a!=null?a:t};r.push(f);i[t]=o;if(typeof n[t]!="undefined"){f.children=[];l=new Exhibit.Set;c=n[t];for(h=0;h<c.length;h++)p(c[h],f.children,l,o.concat(h));f.others=new Exhibit.Set;if(typeof e[t]!="undefined"){d=e[t];for(h=0;h<d.length;h++){v=d[h];if(!l.contains(v)){f.others.add(v);s.add(v)}}}s.addSet(l)}else{f.items=new Exhibit.Set;if(t in e){d=e[t];for(h=0;h<d.length;h++){v=d[h];f.items.add(v);s.add(v)}}}};d=0;c.visit(function(e){p(e,a.children,new Exhibit.Set,[d++])});this._cache={tree:a,valueToChildren:n,valueToParent:r,valueToPath:i,valueType:t}}};Exhibit.HierarchicalFacet.prototype._getTreeNode=function(e){var t,n;if(e===null)return this._cache.tree;t=this._cache.valueToPath[e];n=function(e,t,r){var i;i=e.children[t[r]];return++r<t.length?n(i,t,r):i};return t?n(this._cache.tree,t,0):null};Exhibit.HierarchicalFacet.prototype.exportEmptyState=function(){return this._exportState(!0)};Exhibit.HierarchicalFacet.prototype.exportState=function(){return this._exportState(!1)};Exhibit.HierarchicalFacet.prototype._exportState=function(e){var t=[];e||(t=this._selections);return{selections:t}};Exhibit.HierarchicalFacet.prototype.importState=function(e){this.stateDiffers(e)&&(e.selections.length===0?this.clearAllRestrictions():this.applyRestrictions(e.selections))};Exhibit.HierarchicalFacet.prototype.stateDiffers=function(e){var t,n,r;n=e.selections.length;t=this._selections.length;if(n!==t)return!0;r=new Exhibit.Set(e.selections);r.addSet(this._selections);return r.size()!==n?!0:!1};Exhibit.View=function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p;r=this;s=e;c=n;l=$(t);h=!1;i=null;o=null;u=null;a=null;f={};this._settings={};this.setLabel=function(e){u=e};this.getLabel=function(){return u};this.setViewPanel=function(e){a=e};this.getViewPanel=function(){return a};this.addSettingSpecs=function(e){$.extend(!0,f,e)};this.getSettingSpecs=function(){return f};this.setToolbox=function(e,t){o=e;typeof t!="undefined"&&t!==null&&(o.getGeneratedHTML=t)};this.getToolbox=function(){return o};this.getID=function(){return i};this.getUIContext=function(){return c};this.getContainer=function(){return l};this.register=function(){this.getUIContext().getMain().getRegistry().register(Exhibit.View.getRegistryKey(),this.getID(),this);h=!0};this.unregister=function(){r.getUIContext().getMain().getRegistry().unregister(Exhibit.View.getRegistryKey(),r.getID());h=!1};this._dispose=function(){a=null;u=null;f=null;o!==null&&o.dispose();o=null;this._settings=null;$(l).empty();l=null;this.unregister();c=null};p=function(){i=$(l).attr("id");if(typeof i=="undefined"||i===null)i=s+"-"+r.getUIContext().getCollection().getID()+"-"+r.getUIContext().getMain().getRegistry().generateIdentifier(Exhibit.View.getRegistryKey())};p();this.addSettingSpecs(Exhibit.View._settingSpecs)};Exhibit.View.prototype._initializeViewUI=function(e){this._settings.showToolbox&&this.setToolbox(Exhibit.ToolboxWidget.create({toolboxHoverReveal:this._settings.toolboxHoverReveal},this.getContainer(),this.getUIContext()),e)};Exhibit.View._registryKey="view";Exhibit.View._settingSpecs={showToolbox:{type:"boolean",defaultValue:!0},toolboxHoverReveal:{type:"boolean",defaultValue:!1}};Exhibit.View.getRegistryKey=function(){return Exhibit.View._registryKey};Exhibit.View.registerComponent=function(e,t){t.hasRegistry(Exhibit.View.getRegistryKey())||t.createRegistry(Exhibit.View.getRegistryKey())};Exhibit.View.addViewState=function(e,t){var n;n=Exhibit.History.getState();if(n!==null)if(typeof n.data.components[e]=="undefined"){n.data.components[e]={state:t,type:Exhibit.View.getRegistryKey()};Exhibit.History.replaceState(n.data)}else $(document).trigger("importReady.exhibit",[Exhibit.View.getRegistryKey(),e])};$(document).one("registerComponents.exhibit",Exhibit.View.registerComponent);Exhibit.ViewPanel=function(e,t){this._uiContext=t;this._div=e;this._uiContextCache={};this._viewConstructors=[];this._viewConfigs=[];this._viewLabels=[];this._viewTooltips=[];this._viewDomConfigs=[];this._viewIndex=0;this._view=null;this._registered=!1};Exhibit.ViewPanel._registryKey="viewPanel";Exhibit.ViewPanel._registerComponent=function(e,t){t.hasRegistry(Exhibit.ViewPanel._registryKey)||t.createRegistry(Exhibit.ViewPanel._registryKey)};Exhibit.ViewPanel.create=function(e,t,n){var r,i,s,o,u,a,f,l;r=new Exhibit.ViewPanel(t,n);if(typeof e.views!="undefined")for(i=0;i<e.views.length;i++){viewConfig=e.views[i];o=typeof view.viewClass!="undefined"?view.viewClass:Exhibit.TileView;if(typeof o=="string"){l=o;o=Exhibit.UI.viewClassNameToViewClass(o)}u=null;typeof viewConfig.viewLabel!="undefined"?u=viewConfig.viewLabel:typeof viewConfig.label!="undefined"?u=viewConfig.label:Exhibit.ViewPanel.getViewLabel(l)!==null?u=Exhibit.ViewPanel.getViewLabel(l):typeof l!="undefined"?u=l:u=Exhibit._("%viewPanel.noViewLabel");a=null;typeof viewConfig.tooltip!="undefined"?a=viewConfig.tooltip:Exhibit.ViewPanel.getViewTooltip(l)!==null?a=Exhibit.ViewPanel.getViewTooltip(l):a=u;r._viewConstructors.push(o);r._viewConfigs.push(viewConfig);r._viewLabels.push(u);r._viewTooltips.push(a);r._viewDomConfigs.push(null)}typeof e.initialView!="undefined"&&(r._viewIndex=e.initialView);r._setIdentifier();r.register();r._internalValidate();r._initializeUI();return r};Exhibit.ViewPanel.createFromDOM=function(e,t){var n,r,i,s,o,u,a,f,l,c;n=new Exhibit.ViewPanel(e,Exhibit.UIContext.createFromDOM(e,t,!1));$(e).children().each(function(e,t){$(this).hide();r=Exhibit.getRoleAttribute(this);if(r==="view"){i=Exhibit.TileView;s=Exhibit.getAttribute(this,"viewClass");if(typeof s!="undefined"&&s!==null&&s.length>0){i=Exhibit.UI.viewClassNameToViewClass(s);(typeof i=="undefined"||i===null)&&Exhibit.Debug.warn(Exhibit._("%viewPanel.error.unknownView",s))}o=Exhibit.getAttribute(this,"viewLabel");a=typeof o!="undefined"&&o!==null&&o.length>0?o:Exhibit.getAttribute(this,"label");u=Exhibit.getAttribute(this,"title");if(typeof a=="undefined"||a===null)Exhibit.ViewPanel.getViewLabel(s)!==null?a=Exhibit.ViewPanel.getViewLabel(s):typeof s!="undefined"?a=s:a=Exhibit._("%viewPanel.noViewLabel");if(typeof u=="undefined"||u===null)Exhibit.ViewPanel.getViewTooltip(s)!==null?u=Exhibit.ViewPanel.getViewTooltip(s):u=a;n._viewConstructors.push(i);n._viewConfigs.push(null);n._viewLabels.push(a);n._viewTooltips.push(u);n._viewDomConfigs.push(this)}});initialView=Exhibit.getAttribute(e,"initialView");if(typeof initialView!="undefined"&&initialView!==null&&initialView.length>0)try{c=parseInt(initialView,10);isNaN(c)||(n._viewIndex=c)}catch(h){}n._setIdentifier();n.register();n._internalValidate();n._initializeUI();return n};Exhibit.ViewPanel.getViewLabel=function(e){return Exhibit.ViewPanel._getLocalized(e,"label")};Exhibit.ViewPanel.getViewTooltip=function(e){return Exhibit.ViewPanel._getLocalized(e,"tooltip")};Exhibit.ViewPanel._getLocalized=function(e,t){if(typeof e=="undefined"||e===null)return null;e.indexOf("View")===-1&&(e+="View");e.indexOf("Exhibit.")===0&&(e=e.substring("Exhibit.".length));return Exhibit._("%"+e+"."+t)};Exhibit.ViewPanel.prototype.dispose=function(){if(this._view!==null){this._view.dispose();this._view=null}$(this._div).empty();this.unregister();this._uiContext.dispose();this._uiContext=null;this._div=null};Exhibit.ViewPanel.prototype.getContainer=function(){return $(this._div)};Exhibit.ViewPanel.prototype._setIdentifier=function(){this._id=$(this._div).attr("id");if(typeof this._id=="undefined"||this._id===null)this._id=Exhibit.ViewPanel._registryKey+"-"+this._uiContext.getCollection().getID()+"-"+this._uiContext.getMain().getRegistry().generateIdentifier(Exhibit.ViewPanel._registryKey)};Exhibit.ViewPanel.prototype.register=function(){if(!this._uiContext.getMain().getRegistry().isRegistered(Exhibit.ViewPanel._registryKey,this.getID())){this._uiContext.getMain().getRegistry().register(Exhibit.ViewPanel._registryKey,this.getID(),this);this._registered=!0}};Exhibit.ViewPanel.prototype.unregister=function(){this._uiContext.getMain().getRegistry().unregister(Exhibit.ViewPanel._registryKey,this.getID());this._registered=!1};Exhibit.ViewPanel.prototype.getID=function(){return this._id};Exhibit.ViewPanel.prototype._internalValidate=function(){if(this._viewConstructors.length===0){this._viewConstructors.push(Exhibit.TileView);this._viewConfigs.push({});this._viewLabels.push(Exhibit._("%TileView.label"));this._viewTooltips.push(Exhibit._("%TileView.tooltip"));this._viewDomConfigs.push(null)}this._viewIndex=Math.max(0,Math.min(this._viewIndex,this._viewConstructors.length-1))};Exhibit.ViewPanel.prototype._initializeUI=function(){var e,t;e=$("<div>");$(this._div).children().length>0?$(this._div).prepend(e):$(this._div).append(e);t=this;this._dom=Exhibit.ViewPanel.constructDom($(this._div).children().get(0),this._viewLabels,this._viewTooltips,function(e){t._selectView(e)});this._createView()};Exhibit.ViewPanel.prototype._createView=function(){var e,t,n,r;e=this._dom.getViewContainer();$(e).empty();t=$("<div>");$(e).append(t);n=this._viewIndex;r=this._uiContextCache[n]||this._uiContext;try{this._viewDomConfigs[n]!==null?this._view=this._viewConstructors[n].createFromDOM(this._viewDomConfigs[n],e,r):this._view=this._viewConstructors[n].create(this._viewConfigs[n],e,r)}catch(i){Exhibit.Debug.log(Exhibit._("%viewPanel.error.failedViewCreate",this._viewLabels[n],n));Exhibit.Debug.exception(i)}this._uiContextCache[n]=this._view.getUIContext();this._view.setLabel(this._viewLabels[n]);this._view.setViewPanel(this);this._dom.setViewIndex(n)};Exhibit.ViewPanel.prototype._switchView=function(e){$(this.getContainer()).trigger("onBeforeViewPanelSwitch.exhibit",[this._viewIndex]);if(this._view!==null){this._view.dispose();this._view=null}this._viewIndex=e;this._createView();$(this.getContainer()).trigger("onAfterViewPanelSwitch.exhibit",[this._viewIndex,this._view])};Exhibit.ViewPanel.prototype._selectView=function(e){var t,n;t=this._viewIndex;n=this;Exhibit.History.pushComponentState(this,Exhibit.ViewPanel._registryKey,this.exportState(this.makeState(e)),Exhibit._("%viewPanel.selectViewActionTitle",n._viewLabels[e]),!0)};Exhibit.ViewPanel.getPropertyValuesPairs=function(e,t,n){var r,i,s,o;r=[];i=function(t,i){var s,o,u,a,f;s=n.getProperty(t);o=i?n.getObjects(e,t):n.getSubjects(e,t);u=o.size();if(u>0){a=s.getValueType()==="item";f={propertyLabel:i?u>1?s.getPluralLabel():s.getLabel():u>1?s.getReversePluralLabel():s.getReverseLabel(),valueType:s.getValueType(),values:[]};a?o.visit(function(e){var t=n.getObject(e,"label");f.values.push(typeof t!="undefined"&&t!==null?t:e)}):o.visit(function(e){f.values.push(e)});r.push(f)}};for(s=0;s<t.length;s++){o=t[s];typeof o=="string"?i(o,!0):i(o.property,o.forward)}return r};Exhibit.ViewPanel.constructDom=function(e,t,n,r){var i,s;i={elmt:e,"class":"exhibit-viewPanel exhibit-ui-protection",children:[{tag:"div","class":"exhibit-viewPanel-viewSelection",field:"viewSelectionDiv"
},{tag:"div","class":"exhibit-viewPanel-viewContainer",field:"viewContainerDiv"}]};s=$.simileDOM("template",i);s.getViewContainer=function(){return s.viewContainerDiv};s.setViewIndex=function(e){var i,o;if(t.length>1){$(s.viewSelectionDiv).empty();i=function(i){var o,u,a;o=i===e;i>0&&$(s.viewSelectionDiv).append(Exhibit._("%viewPanel.viewSeparator"));u=$("<span>");u.attr("class",o?"exhibit-viewPanel-viewSelection-selectedView":"exhibit-viewPanel-viewSelection-view").attr("title",n[i]).html(t[i]);if(!o){a=function(e){r(i);e.preventDefault();e.stopPropagation()};u.bind("click",a)}$(s.viewSelectionDiv).append(u)};for(o=0;o<t.length;o++)i(o)}};return s};Exhibit.ViewPanel.prototype.exportState=function(e){return typeof e=="undefined"||e===null?{viewIndex:this._viewIndex}:e};Exhibit.ViewPanel.prototype.importState=function(e){this.stateDiffers(e)&&this._switchView(e.viewIndex)};Exhibit.ViewPanel.prototype.makeState=function(e){return{viewIndex:e}};Exhibit.ViewPanel.prototype.stateDiffers=function(e){return e.viewIndex!==this._viewIndex};$(document).one("registerComponents.exhibit",Exhibit.ViewPanel._registerComponent);Exhibit.OrderedViewFrame=function(e){this._uiContext=e;this._orders=null;this._possibleOrders=null;this._settings={};this._historyKey="orderedViewFrame";this.parentReconstruct=null;this.parentHistoryAction=null};Exhibit.OrderedViewFrame._settingSpecs={showAll:{type:"boolean",defaultValue:!1},grouped:{type:"boolean",defaultValue:!0},showDuplicates:{type:"boolean",defaultValue:!1},abbreviatedCount:{type:"int",defaultValue:10},showHeader:{type:"boolean",defaultValue:!0},showSummary:{type:"boolean",defaultValue:!0},showControls:{type:"boolean",defaultValue:!0},showFooter:{type:"boolean",defaultValue:!0},paginate:{type:"boolean",defaultValue:!1},pageSize:{type:"int",defaultValue:20},pageWindow:{type:"int",defaultValue:2},page:{type:"int",defaultValue:0},alwaysShowPagingControls:{type:"boolean",defaultValue:!1},pagingControlLocations:{type:"enum",defaultValue:"topbottom",choices:["top","bottom","topbottom"]}};Exhibit.OrderedViewFrame.prototype.configure=function(e){if(typeof e.orders!="undefined"){this._orders=[];this._configureOrders(e.orders)}if(typeof e.possibleOrders!="undefined"){this._possibleOrders=[];this._configurePossibleOrders(e.possibleOrders)}Exhibit.SettingsUtilities.collectSettings(e,Exhibit.OrderedViewFrame._settingSpecs,this._settings);this._internalValidate()};Exhibit.OrderedViewFrame.prototype.configureFromDOM=function(e){var t,n,r,i,s;t=Exhibit.getAttribute(e,"orders",",");if(typeof t!="undefined"&&t!==null&&t.length>0){this._orders=[];this._configureOrders(t)}n=Exhibit.getAttribute(e,"directions",",");if(typeof n!="undefined"&&n!==null&&n.length>0&&this._orders!==null)for(r=0;r<n.length&&r<this._orders.length;r++)this._orders[r].ascending=n[r].toLowerCase()!=="descending";i=Exhibit.getAttribute(e,"possibleOrders",",");if(typeof i!="undefined"&&i!==null&&i.length>0){this._possibleOrders=[];this._configurePossibleOrders(i)}s=Exhibit.getAttribute(e,"possibleDirections",",");if(typeof s!="undefined"&&s!==null&&s.length>0&&typeof this._possibleOrders!="undefined"&&this._possibleOrders!==null)for(r=0;r<s.length&&r<this._possibleOrders.length;r++)this._possibleOrders[r].ascending=s[r].toLowerCase()!=="descending";Exhibit.SettingsUtilities.collectSettingsFromDOM(e,Exhibit.OrderedViewFrame._settingSpecs,this._settings);this._internalValidate()};Exhibit.OrderedViewFrame.prototype.dispose=function(){if(this._headerDom){this._headerDom.dispose();this._headerDom=null}if(this._footerDom){this._footerDom.dispose();this._footerDom=null}this._divHeader=null;this._divFooter=null;this._uiContext=null};Exhibit.OrderedViewFrame.prototype._internalValidate=function(){this._orders!==null&&this._orders.length===0&&(this._orders=null);this._possibleOrders!==null&&this._possibleOrders.length===0&&(this._possibleOrders=null);this._settings.paginate&&(this._settings.grouped=!1)};Exhibit.OrderedViewFrame.prototype._configureOrders=function(e){var t,n,r,i,s,o,u;for(t=0;t<e.length;t++){n=e[t];i=!0;r=null;if(typeof n=="string")r=n;else if(typeof n=="object"){r=n.expression;i=typeof n.ascending!="undefined"?n.ascending:!0}if(r!==null)try{s=Exhibit.ExpressionParser.parse(r);if(s.isPath()){o=s.getPath();if(o.getSegmentCount()===1){u=o.getSegment(0);this._orders.push({property:u.property,forward:u.forward,ascending:i})}}}catch(a){Exhibit.Debug.warn(Exhibit._("%orderedViewFrame.error.orderExpression",r))}else Exhibit.Debug.warn(Exhibit._("%orderedViewFrame.error.orderObject",JSON.stringify(n)))}};Exhibit.OrderedViewFrame.prototype._configurePossibleOrders=function(e){var t,n,r,i,s,o,u;for(t=0;t<e.length;t++){n=e[t];i=!0;r=null;if(typeof n=="string")r=n;else if(typeof n=="object"){r=n.expression;i=typeof n.ascending!="undefined"?n.ascending:!0}if(r!==null)try{s=Exhibit.ExpressionParser.parse(r);if(s.isPath()){o=s.getPath();if(o.getSegmentCount()===1){u=o.getSegment(0);this._possibleOrders.push({property:u.property,forward:u.forward,ascending:i})}}}catch(a){Exhibit.Debug.warn(Exhibit._("%orderedViewFrame.error.possibleOrderExpression",r))}else Exhibit.Debug.warn(Exhibit._("%orderedViewFrame.error.possibleOrderObject",JSON.stringify(n)))}};Exhibit.OrderedViewFrame.prototype.initializeUI=function(){var e;e=this;this._settings.showHeader&&(this._headerDom=Exhibit.OrderedViewFrame.createHeaderDom(this._uiContext,this._divHeader,this._settings.showSummary,this._settings.showControls,function(t){e._openSortPopup(t,-1)},function(t){e._toggleGroup(t)},function(t){e._gotoPage(t)}));this._settings.showFooter&&(this._footerDom=Exhibit.OrderedViewFrame.createFooterDom(this._uiContext,this._divFooter,function(t){e._setShowAll(!0)},function(t){e._setShowAll(!1)},function(t){e._gotoPage(t)}))};Exhibit.OrderedViewFrame.prototype.reconstruct=function(){var e,t,n,r,s,o,u,a,f,l;e=this;t=this._uiContext.getCollection();n=this._uiContext.getDatabase();r=t.countAllItems();s=t.countRestrictedItems();o=!1;if(s>0){u=t.getRestrictedItems();o=this._internalReconstruct(u);a=[];f=function(t,r){var i,s;i=n.getProperty(t.property);s=typeof i!="undefined"&&i!==null?t.forward?i.getPluralLabel():i.getReversePluralLabel():t.forward?t.property:"reverse of "+t.property;a.push(Exhibit.UI.makeActionLink(s,function(t){e._openSortPopup(t,r)}))};l=this._getOrders();for(i=0;i<l.length;i++)f(l[i],i);if(this._settings.showHeader&&this._settings.showControls){this._headerDom.setOrders(a);this._headerDom.enableThenByAction(a.length<this._getPossibleOrders().length)}}this._settings.showHeader&&this._settings.showControls&&this._headerDom.groupOptionWidget.setChecked(this._settings.grouped);this._settings.showFooter&&this._footerDom.setCounts(s,this._settings.abbreviatedCount,this._settings.showAll,(!o||!this._settings.grouped)&&!this._settings.paginate)};Exhibit.OrderedViewFrame.prototype._internalReconstruct=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v;t=this;n=this._settings;r=this._uiContext.getDatabase();i=this._getOrders();s=0;o=!1;u=function(e){(s>=d&&s<v||o&&n.grouped)&&t.onNewItem(e,s);s++};a=function(e,r,i){(s>=d&&s<v||o&&n.grouped)&&t.onNewGroup(e,r,i)};f=function(e,t){var s,h,p,d,v,m,g,y;s=i[t];h=s.forward?r.getObjectsUnion(e,s.property):r.getSubjectsUnion(e,s.property);p="text";if(s.forward){d=r.getProperty(s.property);p=typeof d!="undefined"&&d!==null?d.getValueType():"text"}else p="item";v=p==="item"||p==="text"?l(e,t,h,p):c(e,t,h,p);m=!1;for(g=0;g<v.length;g++)v[g].items.size()>1&&(m=!0);m&&(o=!0);for(g=0;g<v.length;g++){y=v[g];if(y.items.size()>0){m&&n.grouped&&a(y.display,p,t);e.removeSet(y.items);y.items.size()>1&&t<i.length-1?f(y.items,t+1):y.items.visit(u)}}if(e.size()>0){m&&n.grouped&&a(Exhibit._("%general.missingSortKey"),p,t);e.size()>1&&t<i.length-1?f(e,t+1):e.visit(u)}};l=function(e,t,s,o){var u,a,f,l,c,h,p;u=[];l=i[t];if(o==="item"){s.visit(function(e){var t=r.getObject(e,"label");t=typeof t!="undefined"&&t!==null?t:e;u.push({itemID:e,display:t})});a=function(e,t){var n=e.display.localeCompare(t.display);return n!==0?n:e.itemID.localeCompare(t.itemID)};f=l.forward?function(t){return r.getSubjects(t.itemID,l.property,null,e)}:function(t){return r.getObjects(t.itemID,l.property,null,e)}}else{s.visit(function(e){u.push({display:e})});a=function(e,t){return e.display.localeCompare(t.display)};f=l.forward?function(t){return r.getSubjects(t.display,l.property,null,e)}:function(t){return r.getObjects(t.display,l.property,null,e)}}u.sort(function(e,t){return(l.ascending?1:-1)*a(e,t)});for(c=0;c<u.length;c++){h=u[c];h.items=f(h);n.showDuplicates||e.removeSet(h.items)}return u};c=function(e,t,s,o){var u,a,f,l,c,h,p;u=[];a={};f=i[t];o==="number"?l=function(e){if(typeof e=="number")return e;try{return parseFloat(e)}catch(t){return null}}:l=function(e){if(e instanceof Date)return e.getTime();try{return Exhibit.DateTime.parseIso8601DateTime(e.toString()).getTime()}catch(t){return null}};s.visit(function(e){var t,n;t=l(e);if(typeof sortKey!="undefined"&&t!==null){n=a[t];if(!n){n={sortkey:t,display:e,values:[],items:new Exhibit.Set};a[t]=n;u.push(n)}n.values.push(e)}});u.sort(function(e,t){return(f.ascending?1:-1)*(e.sortkey-t.sortkey)});for(h=0;h<u.length;h++){c=u[h];vals=c.values;for(p=0;p<vals.length;p++)f.forward?r.getSubjects(vals[p],f.property,c.items,e):r.getObjects(vals[p],f.property,c.items,e);n.showDuplicates||e.removeSet(c.items)}return u};h=e.size();p=Math.ceil(h/n.pageSize);d=0;v=n.showAll?h:Math.min(h,n.abbreviatedCount);if(!n.grouped&&n.paginate&&(p>1||p>0&&n.alwaysShowPagingControls)){d=n.page*n.pageSize;v=Math.min(d+n.pageSize,h);n.showHeader&&(n.pagingControlLocations==="top"||n.pagingControlLocations==="topbottom")&&this._headerDom.renderPageLinks(n.page,p,n.pageWindow);n.showFooter&&(n.pagingControlLocations==="bottom"||n.pagingControlLocations==="topbottom")&&this._footerDom.renderPageLinks(n.page,p,n.pageWindow)}else{n.showHeader&&this._headerDom.hidePageLinks();n.showFooter&&this._footerDom.hidePageLinks()}f(e,0);return o};Exhibit.OrderedViewFrame.prototype._getOrders=function(){return this._orders||[this._getPossibleOrders()[0]]};Exhibit.OrderedViewFrame.prototype._getPossibleOrders=function(){var e,t,n;e=null;if(typeof this._possibleOrders=="undefined"||this._possibleOrders===null){e=this._uiContext.getDatabase().getAllProperties();for(t=0;t<e.length;t++){n=e[t];e[t]={ascending:!0,forward:!0,property:n}}}else e=[].concat(this._possibleOrders);e.length===0&&e.push({property:"label",forward:!0,ascending:!0});return e};Exhibit.OrderedViewFrame.prototype._openSortPopup=function(e,t){var n,r,s,o,u,a,f,l,c,h,p,d,v,m,g,y;n=this;r=this._uiContext.getDatabase();s=Exhibit.UI.createPopupMenuDom(e.target);o=this._getOrders();if(t>=0){u=o[t];a=r.getProperty(u.property);f=u.forward?a.getPluralLabel():a.getReversePluralLabel();l=u.forward?a.getValueType():"item";c=Exhibit.ViewUtilities.getSortLabels(l);s.appendMenuItem(c.ascending,Exhibit.urlPrefix+(u.ascending?"images/option-check.png":"images/option.png"),u.ascending?function(){}:function(){n._reSort(t,u.property,u.forward,!0,!1)});s.appendMenuItem(c.descending,Exhibit.urlPrefix+(u.ascending?"images/option.png":"images/option-check.png"),u.ascending?function(){n._reSort(t,u.property,u.forward,!1,!1)}:function(){});if(o.length>1){s.appendSeparator();s.appendMenuItem(Exhibit._("%orderedViewFrame.removeOrderLabel"),null,function(){n._removeOrder(t)})}}h=[];p=this._getPossibleOrders();for(i=0;i<p.length;i++){d=p[i];v=!1;for(m=t<0?o.length-1:t;m>=0;m--){g=o[m];if(g.property===d.property&&g.forward===d.forward){v=!0;break}}if(!v){a=r.getProperty(d.property);h.push({property:d.property,forward:d.forward,ascending:d.ascending,label:d.forward?a.getPluralLabel():a.getReversePluralLabel()})}}if(h.length>0){t>=0&&s.appendSeparator();h.sort(function(e,t){return e.label.localeCompare(t.label)});y=function(e){s.appendMenuItem(e.label,null,function(){n._reSort(t,e.property,e.forward,e.ascending,!0)})};for(i=0;i<h.length;i++)y(h[i])}s.open(e)};Exhibit.OrderedViewFrame.prototype._reSort=function(e,t,n,r,i){var s,o,u,a,f;oldOrders=this._getOrders();e=e<0?oldOrders.length:e;s=oldOrders.slice(0,e);s.push({property:t,forward:n,ascending:r});i||(s=s.concat(oldOrders.slice(e+1)));o=this._uiContext.getDatabase().getProperty(t);u=n?o.getPluralLabel():o.getReversePluralLabel();a=n?o.getValueType():"item";f=Exhibit.ViewUtilities.getSortLabels(a);this.parentHistoryAction(this._historyKey,this.makeState(s),Exhibit._("%orderedViewFrame.formatSortActionTitle",u,r?f.ascending:f.descending))};Exhibit.OrderedViewFrame.prototype._removeOrder=function(e){var t,n,r,i,s,o,u;t=this._getOrders();n=t.slice(0,e).concat(t.slice(e+1));r=t[e];i=this._uiContext.getDatabase().getProperty(r.property);s=r.forward?i.getPluralLabel():i.getReversePluralLabel();o=r.forward?i.getValueType():"item";u=Exhibit.ViewUtilities.getSortLabels(o);this.parentHistoryAction(this._historyKey,this.makeState(n),Exhibit._("%orderedViewFrame.formatRemoveOrderActionTitle",s,r.ascending?u.ascending:u.descending))};Exhibit.OrderedViewFrame.prototype._setShowAll=function(e){this.parentHistoryAction(this._historyKey,this.makeState(null,e),Exhibit._(e?"%orderedViewFrame.showAllActionTitle":"%orderedViewFrame.dontShowAllActionTitle"))};Exhibit.OrderedViewFrame.prototype._toggleGroup=function(){var e;e=this._settings.grouped;this.parentHistoryAction(this._historyKey,this.makeState(null,e?null:!0,null,!e),Exhibit._(e?"%orderedViewFrame.ungroupAsSortedActionTitle":"%orderedViewFrame.groupAsSortedActionTitle"))};Exhibit.OrderedViewFrame.prototype._toggleShowDuplicates=function(){var e;e=this._settings.showDuplicates;this.parentHistoryAction(this._historyKey,this.makeState(null,null,!e),Exhibit._(e?"%orderedViewFrame.hideDuplicatesActionTitle":"%orderedViewFrame.showDuplicatesActionTitle"))};Exhibit.OrderedViewFrame.prototype._gotoPage=function(e){this.parentHistoryAction(this._historyKey,this.makeState(null,null,null,null,e),Exhibit.ViewUtilities.makePagingActionTitle(e))};Exhibit.OrderedViewFrame.headerTemplate='<div id="collectionSummaryDiv" style="display: none;"></div><div class="exhibit-collectionView-header-sortControls" style="display: none;" id="controlsDiv">%1$s<span class="exhibit-collectionView-header-groupControl"> &bull; <a id="groupOption" class="exhibit-action"></a></span></div>';Exhibit.OrderedViewFrame.createHeaderDom=function(e,t,n,r,i,s,o){var u,a;u=sprintf(Exhibit.OrderedViewFrame.headerTemplate+'<div class="exhibit-collectionView-pagingControls" style="display: none;" id="topPagingDiv"></div>',Exhibit._("%orderedViewFrame.sortingControlsTemplate"));a=$.simileDOM("string",t,u,{});$(t).attr("class","exhibit-collectionView-header");if(n){$(a.collectionSummaryDiv).show();a.collectionSummaryWidget=Exhibit.CollectionSummaryWidget.create({},a.collectionSummaryDiv,e)}if(r){$(a.controlsDiv).show();a.groupOptionWidget=Exhibit.OptionWidget.create({label:Exhibit._("%orderedViewFrame.groupedAsSortedOptionLabel"),onToggle:s},a.groupOption,e);$(a.thenSortByAction).bind("click",i);a.enableThenByAction=function(e){Exhibit.UI.enableActionLink(a.thenSortByAction,e)};a.setOrders=function(t){var n,r;$(a.ordersSpan).empty();addDelimiter=Exhibit.Formatter.createListDelimiter(a.ordersSpan,t.length,e);for(r=0;r<t.length;r++){addDelimiter();$(a.ordersSpan).append(t[r])}addDelimiter()}}a.renderPageLinks=function(e,t,n){Exhibit.OrderedViewFrame.renderPageLinks(a.topPagingDiv,e,t,n,o);$(a.topPagingDiv).show()};a.hidePageLinks=function(){$(a.topPagingDiv).hide()};a.dispose=function(){if(typeof a.collectionSummaryWidget!="undefined"){a.collectionSummaryWidget.dispose();a.collectionSummaryWidget=null}a.groupOptionWidget.dispose();a.groupOptionWidget=null};return a};Exhibit.OrderedViewFrame.footerTemplate="<div id='showAllSpan'></div>";Exhibit.OrderedViewFrame.createFooterDom=function(e,t,n,r,i){var s;s=$.simileDOM("string",t,Exhibit.OrderedViewFrame.footerTemplate+'<div class="exhibit-collectionView-pagingControls" style="display: none;" id="bottomPagingDiv"></div>',{});$(t).attr("class","exhibit-collectionView-footer");s.setCounts=function(e,t,i,o){$(s.showAllSpan).empty();if(o&&e>t){$(s.showAllSpan).show();i?$(s.showAllSpan).append(Exhibit.UI.makeActionLink(Exhibit._("%orderedViewFrame.formatDontShowAll",t),r)):$(s.showAllSpan).append(Exhibit.UI.makeActionLink(Exhibit._("%orderedViewFrame.formatShowAll",e),n))}};s.renderPageLinks=function(e,t,n){Exhibit.OrderedViewFrame.renderPageLinks(s.bottomPagingDiv,e,t,n,i);$(s.bottomPagingDiv).show();$(s.showAllSpan).hide()};s.hidePageLinks=function(){$(s.bottomPagingDiv).hide()};s.dispose=function(){};return s};Exhibit.OrderedViewFrame.renderPageLinks=function(e,t,n,r,i){var s,o,u,a,f,l,c;$(e).attr("class","exhibit-collectionView-pagingControls");$(e).empty();s=this;o=function(t,n){var r,s,o;r=$("<span>").attr("class","exhibit-collectionView-pagingControls-page");$(e).append(r);s=$("<a>").html(t).attr("href","#").attr("title",Exhibit.ViewUtilities.makePagingLinkTooltip(n));r.append(s);o=function(e){i(n);e.preventDefault();e.stopPropagation()};s.bind("click",o)};u=function(n){if(n===t){var r=$("<span>").attr("class","exhibit-collectionView-pagingControls-currentPage").html(n+1);$(e).append(r)}else o(n+1,n)};a=function(t){var n=$("<span>").html(t);$(e).append(n)};if(t>0){o(Exhibit._("%orderedViewFrame.previousPage"),t-1);Exhibit._("%orderedViewFrame.pageSeparator").length>0&&a(" ")}f=0;l=n-1;if(t-r>1){u(0);a(Exhibit._("%orderedViewFrame.pageWindowEllipses"));f=t-r}t+r<n-2&&(l=t+r);for(c=f;c<=l;c++){c>f&&Exhibit._("%orderedViewFrame.pageSeparator").length>0&&a(Exhibit._("%orderedViewFrame.pageSeparator"));u(c)}if(l<n-1){a(Exhibit._("%orderedViewFrame.pageWindowEllipses"));u(n-1)}if(t<n-1){Exhibit._("%orderedViewFrame.pageSeparator").length>0&&a(" ");o(Exhibit._("%orderedViewFrame.nextPage"),t+1)}};Exhibit.OrderedViewFrame.prototype.exportState=function(e){return typeof e=="undefined"||e===null?this.makeState():e};Exhibit.OrderedViewFrame.prototype.importState=function(e){var t,n,r;t=!1;if(e.grouped!==this._settings.grouped){this._settings.grouped=e.grouped;t=!0}if(e.showAll!==this._settings.showAll){this._settings.showAll=e.showAll;t=!0}if(e.showDuplicates!==this._settings.showDuplicates){this._settings.showDuplicates=showDuplicates;t=!0}if(e.page!==this._settings.page){this._settings.page=e.page;t=!0}if(e.orders.length!==this._getOrders().length){this._orders=e.orders;t=!0}else{r=this._getOrders();for(n=0;n<e.orders.length;n++)if(e.orders[n].property!==r[n].property||e.orders[n].ascending!==r[n].ascending||e.orders[n].descending!==r[n].descending){this._orders=e.orders;t=!0;break}}t&&this.parentReconstruct()};Exhibit.OrderedViewFrame.prototype.makeState=function(e,t,n,r,i){e=typeof e!="undefined"&&e!==null?e:this._getOrders();t=typeof t!="undefined"&&t!==null?t:this._settings.showAll;n=typeof n!="undefined"&&n!==null?n:this._settings.showDuplicates;r=typeof r!="undefined"&&r!==null?r:this._settings.grouped;i=typeof i!="undefined"&&i!==null?i:this._settings.page;return{orders:e,showAll:t,showDuplicates:n,grouped:r,page:i}};Exhibit.OrderedViewFrame.prototype.stateDiffers=function(e){var t,n;t=!1;t=e.page!==this._settings.page||e.grouped!==this._settings.grouped||e.showAll!==this._settings.showAll||e.showDuplicates!==this._settings.showDuplicates||e.orders.length!==this._getOrders().length;if(!t){n=this._getOrders();for(i=0;i<e.orders.length;i++)if(e.orders[i].property!==n[i].property||e.orders[i].ascending!==n[i].ascending||e.orders[i].descending!==n[i].descending){t=!0;break}}return t};Exhibit.TileView=function(e,t){var n=this;$.extend(this,new Exhibit.View("tile",e,t));this.addSettingSpecs(Exhibit.TileView._settingSpecs);this._onItemsChanged=function(){n._orderedViewFrame._settings.page=0;n._reconstruct()};$(t.getCollection().getElement()).bind("onItemsChanged.exhibit",n._onItemsChanged);this._orderedViewFrame=new Exhibit.OrderedViewFrame(t);this._orderedViewFrame.parentReconstruct=function(){n._reconstruct()};this._orderedViewFrame.parentHistoryAction=function(e,t,r){Exhibit.History.pushComponentState(n,Exhibit.View.getRegistryKey(),n.exportState(n.makeStateWithSub(e,t)),r,!0)};this.register()};Exhibit.TileView._settingSpecs={};Exhibit.TileView.create=function(e,t,n){var r=new Exhibit.TileView(t,Exhibit.UIContext.create(e,n));Exhibit.SettingsUtilities.collectSettings(e,r.getSettingSpecs(),r._settings);r._orderedViewFrame.configure(e);r._initializeUI();return r};Exhibit.TileView.createFromDOM=function(e,t,n){var r,i;r=Exhibit.getConfigurationFromDOM(e);i=new Exhibit.TileView(typeof t!="undefined"&&t!==null?t:e,Exhibit.UIContext.createFromDOM(e,n));Exhibit.SettingsUtilities.collectSettingsFromDOM(e,i.getSettingSpecs(),i._settings);Exhibit.SettingsUtilities.collectSettings(r,i.getSettingSpecs(),i._settings);i._orderedViewFrame.configureFromDOM(e);i._orderedViewFrame.configure(r);i._initializeUI();return i};Exhibit.TileView.prototype.dispose=function(){var e=this;$(this.getUIContext().getCollection().getElement()).unbind("onItemsChanged.exhibit",e._onItemsChanged);this._orderedViewFrame.dispose();this._orderedViewFrame=null;this._dom=null;this._dispose()};Exhibit.TileView.prototype._initializeUI=function(){var e,t;e=this;$(this.getContainer()).empty();e._initializeViewUI(function(){return $(e._dom.bodyDiv).html()});t={elmt:this.getContainer(),children:[{tag:"div",field:"headerDiv"},{tag:"div","class":"exhibit-collectionView-body",field:"bodyDiv"},{tag:"div",field:"footerDiv"}]};this._dom=$.simileDOM("template",t);this._orderedViewFrame._divHeader=this._dom.headerDiv;this._orderedViewFrame._divFooter=this._dom.footerDiv;this._orderedViewFrame.initializeUI();Exhibit.View.addViewState(this.getID(),this.exportState());this._reconstruct()};Exhibit.TileView.prototype._reconstruct=function(){var e,t,n,r;e=this;t={div:this._dom.bodyDiv,contents:null,groupDoms:[],groupCounts:[]};n=function(n){for(r=n;r<t.groupDoms.length;r++)$(t.groupDoms[r].countSpan).html(t.groupCounts[r]);t.groupDoms=t.groupDoms.slice(0,n);t.groupCounts=t.groupCounts.slice(0,n);n>0?t.div=t.groupDoms[n-1].contentDiv:t.div=e._dom.bodyDiv;t.contents=null};this._orderedViewFrame.onNewGroup=function(e,r,i){n(i);var s=Exhibit.TileView.constructGroup(i,e);$(t.div).append(s.elmt);t.div=s.contentDiv;t.groupDoms.push(s);t.groupCounts.push(0)};this._orderedViewFrame.onNewItem=function(n,r){var i,s,o;if(typeof t.contents=="undefined"||t.contents===null){t.contents=Exhibit.TileView.constructList();$(t.div).append(t.contents)}for(i=0;i<t.groupCounts.length;i++)t.groupCounts[i]++;s=$("<li>");o=e.getUIContext().getLensRegistry().createLens(n,s,e.getUIContext());t.contents.append(s)};$(this.getContainer()).hide();$(this._dom.bodyDiv).empty();this._orderedViewFrame.reconstruct();n(0);$(this.getContainer()).show()};Exhibit.TileView.prototype.makeState=function(){return{}};Exhibit.TileView.prototype.makeStateWithSub=function(e,t){var n;n=this.makeState();n[e]=t;return n};Exhibit.TileView.prototype.exportState=function(e){return typeof e=="undefined"||e===null?this.makeStateWithSub(this._orderedViewFrame._historyKey,this._orderedViewFrame.exportState()):e};Exhibit.TileView.prototype.importState=function(e){this._orderedViewFrame!==null&&this.stateDiffers(e)&&this._orderedViewFrame.importState(e.orderedViewFrame)};Exhibit.TileView.prototype.stateDiffers=function(e){return typeof e.orderedViewFrame!="undefined"?this._orderedViewFrame.stateDiffers(e.orderedViewFrame):!1};Exhibit.TileView.constructGroup=function(e,t){var n={tag:"div","class":"exhibit-collectionView-group",children:[{tag:"h"+(e+1),children:[t,{tag:"span","class":"exhibit-collectionView-group-count",children:[" (",{tag:"span",field:"countSpan"},")"]}],field:"header"},{tag:"div","class":"exhibit-collectionView-group-content",field:"contentDiv"}]};return $.simileDOM("template",n)};Exhibit.TileView.constructList=function(){return $("<ol>").addClass("exhibit-tileView-body")};Exhibit.TabularView=function(e,t){var n=this;$.extend(this,new Exhibit.View("tabular",e,t));this.addSettingSpecs(Exhibit.TabularView._settingSpecs);$.extend(this._settings,{rowStyler:null,tableStyler:null,indexMap:{}});this._columns=[];this._rowTemplate=null;this._dom=null;this._onItemsChanged=function(e){n._settings.page=0;n._reconstruct()};$(t.getCollection().getElement()).bind("onItemsChanged.exhibit",n._onItemsChanged);this.register()};Exhibit.TabularView._settingSpecs={sortAscending:{type:"boolean",defaultValue:!0},sortColumn:{type:"int",defaultValue:0},showSummary:{type:"boolean",defaultValue:!0},border:{type:"int",defaultValue:1},cellPadding:{type:"int",defaultValue:5},cellSpacing:{type:"int",defaultValue:3},paginate:{type:"boolean",defaultValue:!1},pageSize:{type:"int",defaultValue:20},pageWindow:{type:"int",defaultValue:2},page:{type:"int",defaultValue:0},alwaysShowPagingControls:{type:"boolean",defaultValue:!1},pagingControlLocations:{type:"enum",defaultValue:"topbottom",choices:["top","bottom","topbottom"]}};Exhibit.TabularView.create=function(e,t,n){var r=new Exhibit.TabularView(t,Exhibit.UIContext.create(e,n));Exhibit.TabularView._configure(r,e);r._internalValidate();r._initializeUI();return r};Exhibit.TabularView.createFromDOM=function(configElmt,containerElmt,uiContext){var configuration,view,expressions,labels,s,i,expression,formats,index,startPosition,column,o,tables,f;configuration=Exhibit.getConfigurationFromDOM(configElmt);uiContext=Exhibit.UIContext.createFromDOM(configElmt,uiContext);view=new Exhibit.TabularView(typeof containerElmt!="undefined"&&containerElmt!==null?containerElmt:configElmt,uiContext);Exhibit.SettingsUtilities.collectSettingsFromDOM(configElmt,view.getSettingSpecs(),view._settings);try{expressions=[];labels=Exhibit.getAttribute(configElmt,"columnLabels",",")||[];s=Exhibit.getAttribute(configElmt,"columns");typeof s!="undefined"&&s!==null&&s.length>0&&(expressions=Exhibit.ExpressionParser.parseSeveral(s));for(i=0;i<expressions.length;i++){expression=expressions[i];view._columns.push({expression:expression,uiContext:Exhibit.UIContext.create({},view.getUIContext(),!0),styler:null,label:i<labels.length?labels[i]:null,format:"list"})}formats=Exhibit.getAttribute(configElmt,"columnFormats");if(typeof formats!="undefined"&&formats!==null&&formats.length>0){index=0;startPosition=0;while(index<view._columns.length&&startPosition<formats.length){column=view._columns[index];o={};column.format=Exhibit.FormatParser.parseSeveral(column.uiContext,formats,startPosition,o);startPosition=o.index;while(startPosition<formats.length&&" 	\r\n".indexOf(formats.charAt(startPosition))>=0)startPosition++;startPosition<formats.length&&formats.charAt(startPosition)===","&&startPosition++;index++}}tables=$("table",configElmt);tables.length>0&&$("table:eq(0) tr",configElmt).length>0&&(view._rowTemplate=Exhibit.Lens.compileTemplate($("table:eq(0) tr:eq(0)",configElmt).get(0),!1,uiContext))}catch(e){Exhibit.Debug.exception(e,Exhibit._("%TabularView.error.configuration"))}s=Exhibit.getAttribute(configElmt,"rowStyler");if(typeof s!="undefined"&&s!==null&&s.length>0){f=eval(s);typeof f=="function"&&(view._settings.rowStyler=f)}s=Exhibit.getAttribute(configElmt,"tableStyler");if(typeof s!="undefined"&&s!==null&&s.length>0){f=eval(s);typeof f=="function"&&(view._settings.tableStyler=f)}Exhibit.TabularView._configure(view,configuration);view._internalValidate();view._initializeUI();return view};Exhibit.TabularView._configure=function(e,t){var n,r,i,s,o,u,a,f,l;Exhibit.SettingsUtilities.collectSettings(t,Exhibit.TabularView._settingSpecs,e._settings);if(typeof t.columns!="undefined"){n=t.columns;for(r=0;r<n.length;r++){i=n[r];o=null;u=null;a=null;if(typeof i=="string")s=i;else{s=i.expression;o=i.styler;u=i.label;a=i.format}f=Exhibit.ExpressionParser.parse(s);if(f.isPath()){l=f.getPath();typeof a!="undefined"&&a!==null&&a.length>0?a=Exhibit.FormatParser.parse(e.getUIContext(),a,0):a="list";e._columns.push({expression:f,styler:o,label:u,format:a,uiContext:e.getUIContext()})}}}typeof t.rowStyler!="undefined"&&(e._settings.rowStyler=t.rowStyler);typeof t.tableStyler!="undefined"&&(e._settings.tableStyler=t.tableStyler)};Exhibit.TabularView.prototype._internalValidate=function(){var e,t,n,r;if(this._columns.length===0){e=this.getUIContext().getDatabase();t=e.getAllProperties();for(n=0;n<t.length;n++){r=t[n];r!=="uri"&&this._columns.push({expression:Exhibit.ExpressionParser.parse("."+r),styler:null,label:e.getProperty(r).getLabel(),format:"list"})}}this._settings.sortColumn=Math.max(0,Math.min(this._settings.sortColumn,this._columns.length-1))};Exhibit.TabularView.prototype.dispose=function(){$(this.getUIContext().getCollection().getElement()).unbind("onItemsChanged.exhibit",this._onItemsChanged);this._collectionSummaryWidget.dispose();this._collectionSummaryWidget=null;this._dom=null;this._dispose()};Exhibit.TabularView.prototype._initializeUI=function(){var e=this;$(this.getContainer()).empty();e._initializeViewUI(function(){return $(e._dom.bodyDiv).html()});this._dom=Exhibit.TabularView.createDom(this.getContainer());this._collectionSummaryWidget=Exhibit.CollectionSummaryWidget.create({},this._dom.collectionSummaryDiv,this.getUIContext());this._settings.showSummary||$(this._dom.collectionSummaryDiv).hide();Exhibit.View.addViewState(this.getID(),this.exportState());this._reconstruct()};Exhibit.TabularView.prototype._reconstruct=function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m;e=this;t=this.getUIContext().getCollection();n=this.getUIContext().getDatabase();r=this._dom.bodyDiv;$(r).empty();i=[];s=t.countAllItems();if(s>0){o=t.getRestrictedItems();o.visit(function(e){i.push({id:e,sortKey:""})})}if(i.length>0){u=this._columns[this._settings.sortColumn];a=this._createSortFunction(i,u.expression,this._settings.sortAscending);i.sort(this._stabilize(a,this._settings.indexMap,s+1));for(h=0;h<i.length;h++)this._settings.indexMap[i[h].id]=h;f=$("<table>");f.attr("class","exhibit-tabularView-body");this._settings.tableStyler!==null?this._settings.tableStyler(f.get(0),n):f.attr("cellSpacing",this._settings.cellSpacing).attr("cellPadding",this._settings.cellPadding).attr("border",this._settings.border);l=$("<tr>");f.prepend(l);c=function(t){var n,r;n=e._columns[t];if(typeof n.label=="undefined"||n.label===null)n.label=e._getColumnLabel(n.expression);r=$("<th>");Exhibit.TabularView.createColumnHeader(exhibit,r.get(0),n.label,t===e._settings.sortColumn,e._settings.sortAscending,function(n){e._doSort(t);n.preventDefault();n.stopPropagation()});l.append(r)};for(h=0;h<this._columns.length;h++)c(h);this._rowTemplate!==null?p=function(t){var r,s;r=i[t];s=Exhibit.Lens.constructFromLensTemplate(r.id,e._rowTemplate,f,e.getUIContext());e._settings.rowStyler!==null&&e._settings.rowStyler(r.id,n,s,t)}:p=function(t){var r,s,o,u,a,l,c,h;r=i[t];s=$("<tr>");f.append(s);o=function(e){return function(t){$(e).append(t)}};for(u=0;u<e._columns.length;u++){a=e._columns[u];l=$("<td>");s.append(l);c=a.expression.evaluate({value:r.id},{value:"item"},"value",n);h=a.format==="list"?c.valueType:a.format;a.uiContext.formatList(c.values,c.size,h,o(l));typeof a.styler!="undefined"&&a.styler!==null&&a.styler(r.id,n,l.get(0))}e._settings.rowStyler!==null&&e._settings.rowStyler(r.id,n,s.get(0),t)};m=!1;if(this._settings.paginate){d=this._settings.page*this._settings.pageSize;v=Math.min(d+this._settings.pageSize,i.length);m=i.length>this._settings.pageSize||i.length>0&&this._settings.alwaysShowPagingControls}else{d=0;v=i.length}for(h=d;h<v;h++)p(h);$(r).append(f);if(m){if(this._settings.pagingControlLocations==="top"||this._settings.pagingControlLocations==="topbottom"){this._renderPagingDiv(this._dom.topPagingDiv,i.length,this._settings.page);$(this._dom.topPagingDiv).show()}if(this._settings.pagingControlLocations==="bottom"||this._settings.pagingControlLocations==="topbottom"){this._renderPagingDiv(this._dom.bottomPagingDiv,i.length,this._settings.page);$(this._dom.bottomPagingDiv).show()}}else{$(this._dom.topPagingDiv).hide();$(this._dom.bottomPagingDiv).hide()}}};Exhibit.TabularView.prototype._renderPagingDiv=function(e,t,n){var r,i;r=Math.ceil(t/this._settings.pageSize);i=this;Exhibit.OrderedViewFrame.renderPageLinks(e,n,r,this._settings.pageWindow,function(e){i._gotoPage(e)})};Exhibit.TabularView.prototype._getColumnLabel=function(e){var t,n,r,i,s;t=this.getUIContext().getDatabase();n=e.getPath();r=n.getSegment(n.getSegmentCount()-1);i=r.property;s=t.getProperty(i);return typeof s!="undefined"&&s!==null?r.forward?s.getLabel():s.getReverseLabel():i};Exhibit.TabularView.prototype._stabilize=function(e,t){var n;n=function(n,r){var i=e(n,r);if(i)return i;i1=typeof t[n.id]!="undefined"?t[n.id]:-1;i2=typeof t[r.id]!="undefined"?t[r.id]:-1;return i1-i2};return n};Exhibit.TabularView.prototype._createSortFunction=function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v;r=this
.getUIContext().getDatabase();i=n?1:-1;s=function(e,t){var n=i*(e.sortKey-t.sortKey);return isNaN(n)?0:n};o=function(e,t){return i*e.sortKey.localeCompare(t.sortKey)};u=[];a={};f=function(e){return function(t){e.sortKey=t}};for(l=0;l<e.length;l++){c=e[l];h=t.evaluate({value:c.id},{value:"item"},"value",r);h.values.visit(f(c));if(typeof a[h.valueType]=="undefined"){a[h.valueType]=!0;u.push(h.valueType)}}p="text";u.length===1?p=u[0]:p="text";if(p==="number"){v=s;d=function(e){if(typeof e=="undefined"||e===null)return Number.NEGATIVE_INFINITY;if(typeof e=="number")return e;var t=parseFloat(e);return isNaN(t)?Number.MAX_VALUE:t}}else if(p==="date"){v=s;d=function(e){if(typeof e=="undefined"||e===null)return Number.NEGATIVE_INFINITY;if(e instanceof Date)return e.getTime();try{return Exhibit.DateTime.parseIso8601DateTime(e).getTime()}catch(t){return Number.MAX_VALUE}}}else if(p==="boolean"){v=s;d=function(e){return typeof e=="undefined"||e===null?Number.MAX_VALUE:typeof e=="boolean"?e?1:0:e.toString().toLowerCase()==="true"}}else if(p==="item"){v=o;d=function(e){if(typeof e=="undefined"||e===null)return Exhibit._("%general.missingSortKey");var t=r.getObject(e,"label");return typeof t=="undefined"||t===null?e:t}}else{v=o;d=function(e){return typeof e=="undefined"||e===null?Exhibit._("%general.missingSortKey"):e.toString()}}for(l=0;l<e.length;l++){c=e[l];c.sortKey=d(c.sortKey)}return v};Exhibit.TabularView.prototype._doSort=function(e){var t,n;t=this._settings.sortColumn;n=this._settings.sortAscending;this._settings.sortColumn=e;this._settings.sortAscending=t===e?!n:!0;this._settings.page=0;Exhibit.History.pushComponentState(this,Exhibit.View._registryKey,this.exportState(),Exhibit._(this._settings.sortAscending?"%TabularView.sortColumnAscending":"%TabularView.sortColumnDescending",this._columns[e].label),!0)};Exhibit.TabularView.prototype._gotoPage=function(e){this._settings.page=e;Exhibit.History.pushComponentState(this,Exhibit.View._registryKey,this.exportState(),Exhibit.ViewUtilities.makePagingActionTitle(e),!0)};Exhibit.TabularView.prototype.exportState=function(){return{page:this._settings.page,sortColumn:this._settings.sortColumn,sortAscending:this._settings.sortAscending}};Exhibit.TabularView.prototype.importState=function(e){if(this.getUIContext()!==null){this._settings.page=e.page;this._settings.sortColumn=e.sortColumn;this._settings.sortAscending=e.sortAscending;this._reconstruct()}};Exhibit.TabularView._constructDefaultValueList=function(e,t,n,r){r.formatList(e,e.size(),t,function(e){n.appendChild(e)})};Exhibit.TabularView.createDom=function(e){var t;t={elmt:e,"class":"exhibit-collectionView-header",children:[{tag:"div",field:"collectionSummaryDiv"},{tag:"div","class":"exhibit-tabularView-pagingControls",field:"topPagingDiv"},{tag:"div",field:"bodyDiv"},{tag:"div","class":"exhibit-tabularView-pagingControls",field:"bottomPagingDiv"}]};return $.simileDOM("template",t)};Exhibit.TabularView.createColumnHeader=function(e,t,n,r,i,s){var o,u;o={elmt:t,"class":r?"exhibit-tabularView-columnHeader-sorted":"exhibit-tabularView-columnHeader",title:Exhibit._(r?"%TabularView.columnHeaderReSortTooltip":"%TabularView.columnHeaderSortTooltip"),children:[n]};r&&o.children.push({elmt:Exhibit.UI.createTranslucentImage(i?"images/up-arrow.png":"images/down-arrow.png")});$(t).bind("click",s);u=$.simileDOM("template",o);return u};Exhibit.ThumbnailView=function(e,t){var n=this;$.extend(this,new Exhibit.View("thumbnail",e,t));this.addSettingSpecs(Exhibit.ThumbnailView._settingSpecs);this._onItemsChanged=function(){n._orderedViewFrame._settings.page=0;n._reconstruct()};$(t.getCollection().getElement()).bind("onItemsChanged.exhibit",n._onItemsChanged);this._orderedViewFrame=new Exhibit.OrderedViewFrame(t);this._orderedViewFrame.parentReconstruct=function(){n._reconstruct()};this._orderedViewFrame.parentHistoryAction=function(e,t,r){Exhibit.History.pushComponentState(n,Exhibit.View.getRegistryKey(),n.exportState(n.makeStateWithSub(e,t)),r,!0)};this.register()};Exhibit.ThumbnailView._settingSpecs={columnCount:{type:"int",defaultValue:-1}};Exhibit.ThumbnailView._itemContainerClass="exhibit-thumbnailView-itemContainer";Exhibit.ThumbnailView.create=function(e,t,n){var r=new Exhibit.ThumbnailView(t,Exhibit.UIContext.create(e,n,!0));r._lensRegistry=Exhibit.UIContext.createLensRegistry(e,n.getLensRegistry());Exhibit.SettingsUtilities.collectSettings(e,r.getSettingSpecs(),r._settings);r._orderedViewFrame.configure(e);r._initializeUI();return r};Exhibit.ThumbnailView.createFromDOM=function(e,t,n){var r,i;r=Exhibit.getConfigurationFromDOM(e);i=new Exhibit.ThumbnailView(typeof t!="undefined"&&t!==null?t:e,Exhibit.UIContext.createFromDOM(e,n,!0));i._lensRegistry=Exhibit.UIContext.createLensRegistryFromDOM(e,r,n.getLensRegistry());Exhibit.SettingsUtilities.collectSettingsFromDOM(e,i.getSettingSpecs(),i._settings);Exhibit.SettingsUtilities.collectSettings(r,i.getSettingSpecs(),i._settings);i._orderedViewFrame.configureFromDOM(e);i._orderedViewFrame.configure(r);i._initializeUI();return i};Exhibit.ThumbnailView.prototype.dispose=function(){var e=this;$(this.getUIContext().getCollection().getElement()).unbind("onItemsChanged.exhibit",e._onItemsChanged);this._orderedViewFrame.dispose();this._orderedViewFrame=null;this._lensRegistry=null;this._dom=null;this._dispose()};Exhibit.ThumbnailView.prototype._initializeUI=function(){var e,t;e=this;$(this.getContainer()).empty();e._initializeViewUI(function(){return $(e._dom.bodyDiv).html()});t={elmt:this.getContainer(),children:[{tag:"div",field:"headerDiv"},{tag:"div","class":"exhibit-collectionView-body",field:"bodyDiv"},{tag:"div",field:"footerDiv"}]};this._dom=$.simileDOM("template",t);this._orderedViewFrame._divHeader=this._dom.headerDiv;this._orderedViewFrame._divFooter=this._dom.footerDiv;this._orderedViewFrame._generatedContentElmtRetriever=function(){return e._dom.bodyDiv};this._orderedViewFrame.initializeUI();Exhibit.View.addViewState(this.getID(),this.exportState());this._reconstruct()};Exhibit.ThumbnailView.prototype._reconstruct=function(){this._settings.columnCount<2?this._reconstructWithFloats():this._reconstructWithTable()};Exhibit.ThumbnailView.prototype._reconstructWithFloats=function(){var e,t,n,r;e=this;t={div:this._dom.bodyDiv,itemContainer:null,groupDoms:[],groupCounts:[]};n=function(n){for(r=n;r<t.groupDoms.length;r++)t.groupDoms[r].countSpan.innerHTML=t.groupCounts[r];t.groupDoms=t.groupDoms.slice(0,n);t.groupCounts=t.groupCounts.slice(0,n);n>0?t.div=t.groupDoms[n-1].contentDiv:t.div=e._dom.bodyDiv;t.itemContainer=null};this._orderedViewFrame.onNewGroup=function(e,r,i){n(i);var s=Exhibit.ThumbnailView.constructGroup(i,e);$(t.div).append(s.elmt);t.div=s.contentDiv;t.groupDoms.push(s);t.groupCounts.push(0)};this._orderedViewFrame.onNewItem=function(n,r){var i,s,o;if(typeof t.itemContainer=="undefined"||t.itemContainer===null){t.itemContainer=Exhibit.ThumbnailView.constructItemContainer();$(t.div).append(t.itemContainer)}for(i=0;i<t.groupCounts.length;i++)t.groupCounts[i]++;itemLensDiv=$("<div>");itemLensDiv.attr("class",Exhibit.ThumbnailView._itemContainerClass);o=e._lensRegistry.createLens(n,itemLensDiv,e.getUIContext());t.itemContainer.append(itemLensDiv)};$(this.getContainer()).hide();$(this._dom.bodyDiv).empty();this._orderedViewFrame.reconstruct();n(0);$(this.getContainer()).show()};Exhibit.ThumbnailView.prototype._reconstructWithTable=function(){var e,t,n;e=this;t={div:this._dom.bodyDiv,groupDoms:[],groupCounts:[],table:null,columnIndex:0};n=function(n){var r;for(r=n;r<t.groupDoms.length;r++)t.groupDoms[r].countSpan.innerHTML=t.groupCounts[r];t.groupDoms=t.groupDoms.slice(0,n);t.groupCounts=t.groupCounts.slice(0,n);n>0?t.div=t.groupDoms[n-1].contentDiv:t.div=e._dom.bodyDiv;t.itemContainer=null;t.table=null;t.columnIndex=0};this._orderedViewFrame.onNewGroup=function(e,r,i){n(i);var s=Exhibit.ThumbnailView.constructGroup(i,e);$(t.div).append(s.elmt);t.div=s.contentDiv;t.groupDoms.push(s);t.groupCounts.push(0)};this._orderedViewFrame.onNewItem=function(n,r){var i,s,o,u;t.columnIndex>=e._settings.columnCount&&(t.columnIndex=0);if(typeof t.table=="undefined"||t.table===null){t.table=Exhibit.ThumbnailView.constructTableItemContainer();$(t.div).append(t.table)}t.columnIndex===0&&t.table.insertRow(t.table.rows.length);s=t.table.rows[t.table.rows.length-1].insertCell(t.columnIndex++);for(i=0;i<t.groupCounts.length;i++)t.groupCounts[i]++;o=$("<div>");o.attr("class",Exhibit.ThumbnailView._itemContainerClass);itemLens=e._lensRegistry.createLens(n,o,e.getUIContext());$(s).append(o)};$(this.getContainer()).hide();$(this._dom.bodyDiv).empty();this._orderedViewFrame.reconstruct();n(0);$(this.getContainer()).show()};Exhibit.ThumbnailView.prototype.makeState=function(){return{}};Exhibit.ThumbnailView.prototype.makeStateWithSub=function(e,t){var n;n=this.makeState();n[e]=t;return n};Exhibit.ThumbnailView.prototype.exportState=function(e){return typeof e=="undefined"||e===null?this.makeStateWithSub(this._orderedViewFrame._historyKey,this._orderedViewFrame.exportState()):e};Exhibit.ThumbnailView.prototype.importState=function(e){this._orderedViewFrame!==null&&this.stateDiffers(e)&&this._orderedViewFrame.importState(e.orderedViewFrame)};Exhibit.ThumbnailView.prototype.stateDiffers=function(e){return typeof e.orderedViewFrame!="undefined"?this._orderedViewFrame.stateDiffers(e.orderedViewFrame):!1};Exhibit.ThumbnailView.constructGroup=function(e,t){var n={tag:"div","class":"exhibit-thumbnailView-group",children:[{tag:"h"+(e+1),children:[t,{tag:"span","class":"exhibit-collectionView-group-count",children:[" (",{tag:"span",field:"countSpan"},")"]}],field:"header"},{tag:"div","class":"exhibit-collectionView-group-content",field:"contentDiv"}]};return $.simileDOM("template",n)};Exhibit.ThumbnailView.constructItemContainer=function(){var e=$("<div>");e.addClass("exhibit-thumbnailView-body");return e};Exhibit.ThumbnailView.constructTableItemContainer=function(){var e=$("<table>");e.addClass("exhibit-thumbnailView-body");return e.get(0)};Exhibit.ControlPanel=function(e,t){this._uiContext=t;this._widgets=[];this._div=e;this._settings={};this._hovering=!1;this._id=null;this._registered=!1;this._childOpen=!1;this._createdAsDefault=!1};Exhibit.ControlPanel._settingSpecs={showBookmark:{type:"boolean",defaultValue:!0},developerMode:{type:"boolean",defaultvalue:!1},hoverReveal:{type:"boolean",defaultValue:!1}};Exhibit.ControlPanel._registryKey="controlPanel";Exhibit.ControlPanel.create=function(e,t,n){var r=new Exhibit.ControlPanel(t,Exhibit.UIContext.create(e,n));Exhibit.ControlPanel._configure(r,e);r._setIdentifier();r.register();r._initializeUI();return r};Exhibit.ControlPanel.createFromDOM=function(e,t,n){var r,i;r=Exhibit.getConfigurationFromDOM(e);i=new Exhibit.ControlPanel(typeof t!="undefined"&&t!==null?t:e,Exhibit.UIContext.createFromDOM(e,n));Exhibit.ControlPanel._configureFromDOM(i,r);i._setIdentifier();i.register();i._initializeUI();return i};Exhibit.ControlPanel._configure=function(e,t){Exhibit.SettingsUtilities.collectSettings(t,Exhibit.ControlPanel._settingSpecs,e._settings)};Exhibit.ControlPanel._configureFromDOM=function(e,t){Exhibit.SettingsUtilities.collectSettingsFromDOM(e._div,Exhibit.ControlPanel._settingSpecs,e._settings)};Exhibit.ControlPanel.registerComponent=function(e,t){t.hasRegistry(Exhibit.ControlPanel._registryKey)||t.createRegistry(Exhibit.ControlPanel._registryKey)};Exhibit.ControlPanel.mouseOutsideElmt=function(e,t){var n=$(t).offset();return e.pageX<n.left||e.pageX>n.left+$(t).outerWidth()||e.pageY<n.top||e.pageY>n.top+$(t).outerHeight()};Exhibit.ControlPanel.prototype._initializeUI=function(){var e,t;t=this;if(this._settings.hoverReveal){$(this.getContainer()).fadeTo(1,0);$(this.getContainer()).bind("mouseover",function(e){t._hovering=!0;$(this).fadeTo("fast",1)});$(document.body).bind("mousemove",function(e){if(t._hovering&&!t._childOpen&&Exhibit.ControlPanel.mouseOutsideElmt(e,t.getContainer())){t._hovering=!1;$(t.getContainer()).fadeTo("fast",0)}})}if(this._settings.showBookmark){e=Exhibit.BookmarkWidget.create({},this.getContainer(),this._uiContext);this.addWidget(e,!0)}if(this._settings.developerMode){e=Exhibit.ResetHistoryWidget.create({},this.getContainer(),this._uiContext);this.addWidget(e,!0)}$(this.getContainer()).addClass("exhibit-controlPanel")};Exhibit.ControlPanel.prototype._setIdentifier=function(){this._id=$(this._div).attr("id");if(typeof this._id=="undefined"||this._id===null)this._id=Exhibit.ControlPanel._registryKey+"-"+this._uiContext.getCollection().getID()+"-"+this._uiContext.getMain().getRegistry().generateIdentifier(Exhibit.ControlPanel._registryKey)};Exhibit.ControlPanel.prototype.register=function(){if(!this._uiContext.getMain().getRegistry().isRegistered(Exhibit.ControlPanel._registryKey,this.getID())){this._uiContext.getMain().getRegistry().register(Exhibit.ControlPanel._registryKey,this.getID(),this);this._registered=!0}};Exhibit.ControlPanel.prototype.unregister=function(){this._uiContext.getMain().getRegistry().unregister(Exhibit.ControlPanel._registryKey,this.getID());this._registered=!1};Exhibit.ControlPanel.prototype.getContainer=function(){return $(this._div)};Exhibit.ControlPanel.prototype.getID=function(){return this._id};Exhibit.ControlPanel.prototype.childOpened=function(){this._childOpen=!0};Exhibit.ControlPanel.prototype.childClosed=function(){this._childOpen=!1};Exhibit.ControlPanel.prototype.setCreatedAsDefault=function(){var e;e=this;this._createdAsDefault=!0;$(this._div).hide();$(document).one("exhibitConfigured.exhibit",function(t,n){var r,i,s,o;i=Exhibit.ViewPanel._registryKey;r=n.getRegistry().getKeys(i);if(r.length===0){i=Exhibit.View._registryKey;r=n.getRegistry().getKeys(i)}if(r.length!==0){o=n.getRegistry().get(i,r[0]);if(typeof o._div!="undefined"){$(o._div).before(e._div);$(e._div).show()}}})};Exhibit.ControlPanel.prototype.createdAsDefault=function(){return this._createdAsDefault};Exhibit.ControlPanel.prototype.dispose=function(){this.unregister();this._uiContext.dispose();this._uiContext=null;this._div=null;this._widgets=null;this._settings=null};Exhibit.ControlPanel.prototype.addWidget=function(e,t){this._widgets.push(e);typeof e.setControlPanel=="function"&&e.setControlPanel(this);(typeof t=="undefined"||!t)&&this.reconstruct()};Exhibit.ControlPanel.prototype.removeWidget=function(e){var t,n;n=null;for(t=0;t<this._widgets.length;t++)if(this._widgets[t]===e){n=this._widgets.splice(t,1);break}this.reconstruct();return n};Exhibit.ControlPanel.prototype.reconstruct=function(){var e;$(this._div).empty();for(e=0;e<this._widgets.length;e++)typeof this._widgets[e].reconstruct=="function"&&this._widgets[e].reconstruct(this)};$(document).one("registerComponents.exhibit",Exhibit.ControlPanel.registerComponent);Exhibit.CollectionSummaryWidget=function(e,t){this._exhibit=t.getMain();this._collection=t.getCollection();this._uiContext=t;this._div=e;var n=this;this._onItemsChanged=function(){n._reconstruct()};$(this._collection.getElement()).bind("onItemsChanged.exhibit",this._onItemsChanged)};Exhibit.CollectionSummaryWidget.create=function(e,t,n){var r=new Exhibit.CollectionSummaryWidget(t,Exhibit.UIContext.create(e,n));r._initializeUI();return r};Exhibit.CollectionSummaryWidget.createFromDOM=function(e,t,n){var r=new Exhibit.CollectionSummaryWidget(typeof t!="undefined"&&t!==null?t:e,Exhibit.UIContext.createFromDOM(e,n));r._initializeUI();return r};Exhibit.CollectionSummaryWidget.prototype.dispose=function(){$(this._uiContext.getCollection().getElement()).unbind("onItemsChanged.exhibit",this._onItemsChanged);$(this._div).empty();this._noResultsDom=null;this._allResultsDom=null;this._filteredResultsDom=null;this._div=null;this._collection=null;this._exhibit=null};Exhibit.CollectionSummaryWidget.prototype._initializeUI=function(){var e,t;e=this;t=function(t){t.preventDefault();t.stopPropagation();e._resetCollection()};$(this._div).hide();this._allResultsDom=$.simileDOM("string","span",Exhibit._("%widget.collectionSummary.allResultsTemplate","exhibit-collectionSummaryWidget-results"));this._filteredResultsDom=$.simileDOM("string","span",Exhibit._("%widget.collectionSummary.filteredResultsTemplate","exhibit-collectionSummaryWidget-results"),{resetActionLink:Exhibit.UI.makeActionLink(Exhibit._("%widget.collectionSummary.resetFiltersLabel"),t)});this._noResultsDom=$.simileDOM("string","span",Exhibit._("%widget.collectionSummary.noResultsTemplate","exhibit-collectionSummaryWidget-results","exhibit-collectionSummaryWidget-count"),{resetActionLink:Exhibit.UI.makeActionLink(Exhibit._("%widget.collectionSummary.resetFiltersLabel"),t)});$(this._div).append(this._allResultsDom.elmt);$(this._div).append(this._filteredResultsDom.elmt);$(this._div).append(this._noResultsDom.elmt);this._reconstruct()};Exhibit.CollectionSummaryWidget.prototype._reconstruct=function(){var e,t,n,r,i,s,o;e=this._collection.countAllItems();t=this._collection.countRestrictedItems();n=this._uiContext.getDatabase();r=this._dom;$(this._div).hide();$(this._allResultsDom.elmt).hide();$(this._filteredResultsDom.elmt).hide();$(this._noResultsDom.elmt).hide();if(e>0)if(t===0)$(this._noResultsDom.elmt).show();else{i=n.getTypeIDs(this._collection.getRestrictedItems()).toArray();s=i.length===1?i[0]:"Item";o=n.labelItemsOfType(t,s,"exhibit-collectionSummaryWidget-count");if(t===e){$(this._allResultsDom.elmt).show();$(this._allResultsDom.resultDescription).empty();$(this._allResultsDom.resultDescription).append(o)}else{$(this._filteredResultsDom.elmt).show();$(this._filteredResultsDom.resultDescription).empty();$(this._filteredResultsDom.resultDescription).append(o);$(this._filteredResultsDom.originalCountSpan).html(e)}}$(this._div).show()};Exhibit.CollectionSummaryWidget.prototype._resetCollection=function(){var e,t;t=this._collection;$(this._collection.getElement()).trigger("onResetAllFilters.exhibit");e=this._collection.clearAllRestrictions();Exhibit.History.pushState(e.data,Exhibit._("%widget.collectionSummary.resetActionTitle"))};Exhibit.OptionWidget=function(e,t,n){this._label=e.label;this._checked=typeof e.checked!="undefined"?e.checked:!1;this._onToggle=e.onToggle;this._containerElmt=t;this._uiContext=n;this._initializeUI()};Exhibit.OptionWidget.create=function(e,t,n){return new Exhibit.OptionWidget(e,t,n)};Exhibit.OptionWidget.prototype.dispose=function(){$(this._containerElmt).empty();this._dom=null;this._containerElmt=null;this._uiContext=null};Exhibit.OptionWidget.uncheckedImageURL=Exhibit.urlPrefix+"images/option.png";Exhibit.OptionWidget.checkedImageURL=Exhibit.urlPrefix+"images/option-check.png";Exhibit.OptionWidget.uncheckedTemplate='<span id="uncheckedSpan" style="display: none;"><img id="uncheckedImage" /> %1$s</span>';Exhibit.OptionWidget.checkedTemplate='<span id="checkedSpan" style="display: none;"><img id="checkedImage" /> %1$s</span>';Exhibit.OptionWidget.prototype._initializeUI=function(){this._containerElmt.className="exhibit-optionWidget";this._dom=$.simileDOM("string",this._containerElmt,sprintf(Exhibit.OptionWidget.uncheckedTemplate+Exhibit.OptionWidget.checkedTemplate,this._label),{uncheckedImage:$.simileBubble("createTranslucentImage",Exhibit.OptionWidget.uncheckedImageURL),checkedImage:$.simileBubble("createTranslucentImage",Exhibit.OptionWidget.checkedImageURL)});this._checked?$(this._dom.checkedSpan).show():$(this._dom.uncheckedSpan).show();$(this._containerElmt).bind("click",this._onToggle)};Exhibit.OptionWidget.prototype.getChecked=function(){return this._checked};Exhibit.OptionWidget.prototype.setChecked=function(e){if(e!==this._checked){this._checked=e;if(e){$(this._dom.checkedSpan).show();$(this._dom.uncheckedSpan).hide()}else{$(this._dom.checkedSpan).hide();$(this._dom.uncheckedSpan).show()}}};Exhibit.OptionWidget.prototype.toggle=function(){this.setChecked(!this._checked)};Exhibit.ResizableDivWidget=function(e,t,n){this._div=t;this._configuration=e;typeof e.minHeight=="undefined"&&(e.minHeight=10);this._dragging=!1;this._height=null;this._origin=null;this._ondrag=null;this._initializeUI()};Exhibit.ResizableDivWidget.create=function(e,t,n){return new Exhibit.ResizableDivWidget(e,t,n)};Exhibit.ResizableDivWidget.prototype.dispose=function(){$(this._div).empty();this._contentDiv=null;this._resizerDiv=null;this._div=null};Exhibit.ResizableDivWidget.prototype.getContentDiv=function(){return this._contentDiv};Exhibit.ResizableDivWidget.prototype._initializeUI=function(){var e=this;$(this._div).html('<div></div><div class="exhibit-resizableDivWidget-resizer">'+Exhibit.UI.createTranslucentImageHTML("images/down-arrow.png")+"</div>");this._contentDiv=$(this._div).children().get(0);this._resizerDiv=$(this._div).children().get(1);$(this._resizerDiv).bind("mousedown",function(t){e._dragging=!0;e._height=$(e._contentDiv).height();e._origin={x:t.pageX,y:t.pageY};e._ondrag=function(n){var r=e._height+n.pageY-e._origin.y;t.preventDefault();t.stopPropagation();$(e._contentDiv).height(Math.max(r,e._configuration.minHeight))};$(document).bind("mousemove",e._ondrag);e._dragdone=function(t){e._dragging=!1;$(document).unbind("mousemove",e._ondrag);typeof e._configuration.onResize=="function"&&e._configuration.onResize()};$(e._resizerDiv).one("mouseup",e._dragdone)})};$(document).bind("registerLocales.exhibit",function(){$(document).trigger("beforeLocalesRegistered.exhibit");new Exhibit.Locale("default",Exhibit.urlPrefix+"locales/en/locale.js");new Exhibit.Locale("en",Exhibit.urlPrefix+"locales/en/locale.js");$(document).trigger("localesRegistered.exhibit")});$(document).ready(function(){var e,t;e=[];t=!1;$(document).bind("delayCreation.exhibit",function(t,n){e.push(n)});$(document).bind("delayFinished.exhibit",function(n,r){var i=e.indexOf(r);if(i>=0){e.splice(i);if(e.length===0&&t){e=null;$(document).trigger("scriptsLoaded.exhibit")}}});$(document).bind("localeSet.exhibit",function(e,t){var n;for(n=0;n<t.length;n++)Exhibit.loader.script(t[n]);$(document).trigger("loadExtensions.exhibit")});$(document).bind("error.exhibit",function(e,t,n){Exhibit.UI.hideBusyIndicator();Exhibit.Debug.exception(t,n);alert(n)});$(document).one("localeLoaded.exhibit",function(n){t=!0;e.length===0&&$(document).trigger("scriptsLoaded.exhibit")});$(document).one("scriptsLoaded.exhibit",function(e){$(document).trigger("registerStaticComponents.exhibit",Exhibit.staticRegistry)});$(document).one("exhibitConfigured.exhibit",function(e,t){Exhibit.Bookmark.init();Exhibit.History.init(t)});$(document).one("loadExtensions.exhibit",function(e){Exhibit.signals["loadExtensions.exhibit"]=!0});$(document).one("exhibitConfigured.exhibit",function(e){Exhibit.signals["exhibitConfigured.exhibit"]=!0});Exhibit.checkBackwardsCompatibility();Exhibit.staticRegistry=new Exhibit.Registry(!0);$("link[rel='exhibit-extension']").each(function(e,t){Exhibit.loader.script($(t).attr("href"))});Exhibit.loader.wait(function(){$(document).trigger("registerLocalization.exhibit",Exhibit.staticRegistry)})});!function(e){"use strict";var t=function(t){this.element=e(t)};t.prototype={constructor:t,show:function(){var t=this.element,n=t.closest("ul:not(.dropdown-menu)"),r=t.attr("data-target"),i,s,o;if(!r){r=t.attr("href");r=r&&r.replace(/.*(?=#[^\s]*$)/,"")}if(t.parent("li").hasClass("active"))return;i=n.find(".active a").last()[0];o=e.Event("show",{relatedTarget:i});t.trigger(o);if(o.isDefaultPrevented())return;s=e(r);this.activate(t.parent("li"),n);this.activate(s,s.parent(),function(){t.trigger({type:"shown",relatedTarget:i})})},activate:function(t,n,r){function o(){i.removeClass("active").find("> .dropdown-menu > .active").removeClass("active");t.addClass("active");if(s){t[0].offsetWidth;t.addClass("in")}else t.removeClass("fade");t.parent(".dropdown-menu")&&t.closest("li.dropdown").addClass("active");r&&r()}var i=n.find("> .active"),s=r&&e.support.transition&&i.hasClass("fade");s?i.one(e.support.transition.end,o):o();i.removeClass("in")}};e.fn.tab=function(n){return this.each(function(){var r=e(this),i=r.data("tab");i||r.data("tab",i=new t(this));typeof n=="string"&&i[n]()})};e.fn.tab.Constructor=t;e(function(){e("body").on("click.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(t){t.preventDefault();e(this).tab("show")})})}(window.jQuery);(function(e){typeof define=="function"&&define.amd?define(["jquery"],e):e(jQuery)})(function(e){"use strict";function D(){D.history=D.history||[];D.history.push(arguments);if("object"==typeof console){var e=console[console.warn?"warn":"log"],t=Array.prototype.slice.call(arguments),n;typeof arguments[0]=="string"&&(t[0]="qTip2: "+t[0]);n=e.apply?e.apply(console,t):e(t)}}function P(t){var i;if(!t||"object"!=typeof t)return n;if(t.metadata===r||"object"!=typeof t.metadata)t.metadata={type:t.metadata};if("content"in t){if(t.content===r||"object"!=typeof t.content||t.content.jquery)t.content={text:t.content};i=t.content.text||n;!e.isFunction(i)&&(!i&&!i.attr||i.length<1||"object"==typeof i&&!i.jquery)&&(t.content.text=n);if("title"in t.content){if(t.content.title===r||"object"!=typeof t.content.title)t.content.title={text:t.content.title};i=t.content.title.text||n;!e.isFunction(i)&&(!i&&!i.attr||i.length<1||"object"==typeof i&&!i.jquery)&&(t.content.title.text=n)}}"position"in t&&(t.position===r||"object"!=typeof t.position)&&(t.position={my:t.position,at:t.position});"show"in t&&(t.show===r||"object"!=typeof t.show)&&(t.show.jquery?t.show={target:t.show}:t.show={event:t.show});"hide"in t&&(t.hide===r||"object"!=typeof t.hide)&&(t.hide.jquery?t.hide={target:t.hide}:t.hide={event:t.hide});"style"in t&&(t.style===r||"object"!=typeof t.style)&&(t.style={classes:t.style});e.each(y,function(){this.sanitize&&this.sanitize(t)});return t}function H(s,o,d,v){function q(e){var t=0,n,r=o,i=e.split(".");while(r=r[i[t++]])t<i.length&&(n=r);return[n||o,i.pop()]}function R(){var e=o.style.widget;B.toggleClass(S,e).toggleClass(N,o.style.def&&!e);F.content.toggleClass(S+"-content",e);F.titlebar&&F.titlebar.toggleClass(S+"-header",e);F.button&&F.button.toggleClass(E+"-icon",!e)}function U(e){if(F.title){F.titlebar.remove();F.titlebar=F.title=F.button=r;e!==n&&m.reposition()}}function z(){var t=o.content.title.button,r=typeof t=="string",i=r?t:"Close tooltip";F.button&&F.button.remove();t.jquery?F.button=t:F.button=e("<a />",{"class":"ui-state-default ui-tooltip-close "+(o.style.widget?"":E+"-icon"),title:i,"aria-label":i}).prepend(e("<span />",{"class":"ui-icon ui-icon-close",html:"&times;"}));F.button.appendTo(F.titlebar).attr("role","button").click(function(e){B.hasClass(x)||m.hide(e);return n});m.redraw()}function W(){var n=O+"-title";F.titlebar&&U();F.titlebar=e("<div />",{"class":E+"-titlebar "+(o.style.widget?"ui-widget-header":"")}).append(F.title=e("<div />",{id:n,"class":E+"-title","aria-atomic":t})).insertBefore(F.content).delegate(".ui-tooltip-close","mousedown keydown mouseup keyup mouseout",function(t){e(this).toggleClass("ui-state-active ui-state-focus",t.type.substr(-4)==="down")}).delegate(".ui-tooltip-close","mouseover mouseout",function(t){e(this).toggleClass("ui-state-hover",t.type==="mouseover")});o.content.title.button?z():m.rendered&&m.redraw()}function X(e){var t=F.button,r=F.title;if(!m.rendered)return n;if(!e)t.remove();else{r||W();z()}}function V(t,r){var i=F.title;if(!m.rendered||!t)return n;e.isFunction(t)&&(t=t.call(s,I.event,m));if(t===n||!t&&t!=="")return U(n);t.jquery&&t.length>0?i.empty().append(t.css({display:"block"})):i.html(t);m.redraw();r!==n&&m.rendered&&B[0].offsetWidth>0&&m.reposition(I.event)}function J(t,r){function u(t){function a(i){if(i){delete u[i.src];clearTimeout(m.timers.img[i.src]);e(i).unbind(j)}if(e.isEmptyObject(u)){m.redraw();r!==n&&m.reposition(I.event);t()}}var s,u={};if((s=o.find("img[src]:not([height]):not([width])")).length===0)return a();s.each(function(t,n){if(u[n.src]!==i)return;var r=0,s=3;(function o(){if(n.height||n.width||r>s)return a(n);r+=1;m.timers.img[n.src]=setTimeout(o,700)})();e(n).bind("error"+j+" load"+j,function(){a(this)});u[n.src]=n})}var o=F.content;if(!m.rendered||!t)return n;e.isFunction(t)&&(t=t.call(s,I.event,m)||"");t.jquery&&t.length>0?o.empty().append(t.css({display:"block"})):o.html(t);if(m.rendered<0)B.queue("fx",u);else{H=0;u(e.noop)}return m}function K(){function f(e){if(B.hasClass(x))return n;clearTimeout(m.timers.show);clearTimeout(m.timers.hide);var r=function(){m.toggle(t,e)};o.show.delay>0?m.timers.show=setTimeout(r,o.show.delay):r()}function l(t){if(B.hasClass(x)||D||H)return n;var s=e(t.relatedTarget||t.target),u=s.closest(T)[0]===B[0],a=s[0]===i.show[0];clearTimeout(m.timers.show);clearTimeout(m.timers.hide);if(r.target==="mouse"&&u||o.hide.fixed&&/mouse(out|leave|move)/.test(t.type)&&(u||a)){try{t.preventDefault();t.stopImmediatePropagation()}catch(f){}return}o.hide.delay>0?m.timers.hide=setTimeout(function(){m.hide(t)},o.hide.delay):m.hide(t)}function c(e){if(B.hasClass(x))return n;clearTimeout(m.timers.inactive);m.timers.inactive=setTimeout(function(){m.hide(e)},o.hide.inactive)}function h(e){m.rendered&&B[0].offsetWidth>0&&m.reposition(e)}var r=o.position,i={show:o.show.target,hide:o.hide.target,viewport:e(r.viewport),document:e(document),body:e(document.body),window:e(window)},u={show:e.trim(""+o.show.event).split(" "),hide:e.trim(""+o.hide.event).split(" ")},a=e.browser.msie&&parseInt(e.browser.version,10)===6;B.bind("mouseenter"+j+" mouseleave"+j,function(e){var t=e.type==="mouseenter";t&&m.focus(e);B.toggleClass(k,t)});/mouse(out|leave)/i.test(o.hide.event)&&o.hide.leave==="window"&&i.window.bind("mouseleave"+j+" blur"+j,function(e){!/select|option/.test(e.target.nodeName)&&!e.relatedTarget&&m.hide(e)});if(o.hide.fixed){i.hide=i.hide.add(B);B.bind("mouseover"+j,function(){B.hasClass(x)||clearTimeout(m.timers.hide)})}else/mouse(over|enter)/i.test(o.show.event)&&i.hide.bind("mouseleave"+j,function(e){clearTimeout(m.timers.show)});(""+o.hide.event).indexOf("unfocus")>-1&&r.container.closest("html").bind("mousedown"+j,function(t){var n=e(t.target),r=m.rendered&&!B.hasClass(x)&&B[0].offsetWidth>0,i=n.parents(T).filter(B[0]).length>0;n[0]!==s[0]&&n[0]!==B[0]&&!i&&!s.has(n[0]).length&&!n.attr("disabled")&&m.hide(t)});if("number"==typeof o.hide.inactive){i.show.bind("qtip-"+d+"-inactive",c);e.each(g.inactiveEvents,function(e,t){i.hide.add(F.tooltip).bind(t+j+"-inactive",c)})}e.each(u.hide,function(t,n){var r=e.inArray(n,u.show),s=e(i.hide);if(r>-1&&s.add(i.show).length===s.length||n==="unfocus"){i.show.bind(n+j,function(e){B[0].offsetWidth>0?l(e):f(e)});delete u.show[r]}else i.hide.bind(n+j,l)});e.each(u.show,function(e,t){i.show.bind(t+j,f)});"number"==typeof o.hide.distance&&i.show.add(B).bind("mousemove"+j,function(e){var t=I.origin||{},n=o.hide.distance,r=Math.abs;(r(e.pageX-t.pageX)>=n||r(e.pageY-t.pageY)>=n)&&m.hide(e)});if(r.target==="mouse"){i.show.bind("mousemove"+j,function(e){b={pageX:e.pageX,pageY:e.pageY,type:"mousemove"}});if(r.adjust.mouse){if(o.hide.event){B.bind("mouseleave"+j,function(e){(e.relatedTarget||e.target)!==i.show[0]&&m.hide(e)});F.target.bind("mouseenter"+j+" mouseleave"+j,function(e){I.onTarget=e.type==="mouseenter"})}i.document.bind("mousemove"+j,function(e){m.rendered&&I.onTarget&&!B.hasClass(x)&&B[0].offsetWidth>0&&m.reposition(e||b)})}}(r.adjust.resize||i.viewport.length)&&(e.event.special.resize?i.viewport:i.window).bind("resize"+j,h);(i.viewport.length||a&&B.css("position")==="fixed")&&i.viewport.bind("scroll"+j,h)}function Q(){var t=[o.show.target[0],o.hide.target[0],m.rendered&&F.tooltip[0],o.position.container[0],o.position.viewport[0],window,document];m.rendered?e([]).pushStack(e.grep(t,function(e){return typeof e=="object"})).unbind(j):o.show.target.unbind(j+"-create")}var m=this,A=document.body,O=E+"-"+d,D=0,H=0,B=e(),j=".qtip-"+d,F,I;m.id=d;m.rendered=n;m.destroyed=n;m.elements=F={target:s};m.timers={img:{}};m.options=o;m.checks={};m.plugins={};m.cache=I={event:{},target:e(),disabled:n,attr:v,onTarget:n,lastClass:""};m.checks.builtin={"^id$":function(r,i,s){var o=s===t?g.nextid:s,u=E+"-"+o;if(o!==n&&o.length>0&&!e("#"+u).length){B[0].id=u;F.content[0].id=u+"-content";F.title[0].id=u+"-title"}},"^content.text$":function(e,t,n){J(n)},"^content.title.text$":function(e,t,n){if(!n)return U();!F.title&&n&&W();V(n)},"^content.title.button$":function(e,t,n){X(n)},"^position.(my|at)$":function(e,t,n){"string"==typeof n&&(e[t]=new y.Corner(n))},"^position.container$":function(e,t,n){m.rendered&&B.appendTo(n)},"^show.ready$":function(){m.rendered?m.toggle(t):m.render(1)},"^style.classes$":function(e,t,n){B.attr("class",E+" qtip ui-helper-reset "+n)},"^style.widget|content.title":R,"^events.(render|show|move|hide|focus|blur)$":function(t,n,r){B[(e.isFunction(r)?"":"un")+"bind"]("tooltip"+n,r)},"^(show|hide|position).(event|target|fixed|inactive|leave|distance|viewport|adjust)":function(){var e=
o.position;B.attr("tracking",e.target==="mouse"&&e.adjust.mouse);Q();K()}};e.extend(m,{render:function(r){if(m.rendered)return m;var i=o.content.text,u=o.content.title.text,a=o.position,f=e.Event("tooltiprender");e.attr(s[0],"aria-describedby",O);B=F.tooltip=e("<div/>",{id:O,"class":E+" qtip ui-helper-reset "+N+" "+o.style.classes+" "+E+"-pos-"+o.position.my.abbrev(),width:o.style.width||"",height:o.style.height||"",tracking:a.target==="mouse"&&a.adjust.mouse,role:"alert","aria-live":"polite","aria-atomic":n,"aria-describedby":O+"-content","aria-hidden":t}).toggleClass(x,I.disabled).data("qtip",m).appendTo(o.position.container).append(F.content=e("<div />",{"class":E+"-content",id:O+"-content","aria-atomic":t}));m.rendered=-1;H=1;D=1;if(u){W();e.isFunction(u)||V(u,n)}e.isFunction(i)||J(i,n);m.rendered=t;R();e.each(o.events,function(t,n){e.isFunction(n)&&B.bind(t==="toggle"?"tooltipshow tooltiphide":"tooltip"+t,n)});e.each(y,function(){this.initialize==="render"&&this(m)});K();B.queue("fx",function(e){f.originalEvent=I.event;B.trigger(f,[m]);H=0;D=0;m.redraw();(o.show.ready||r)&&m.toggle(t,I.event,n);e()});return m},get:function(e){var t,n;switch(e.toLowerCase()){case"dimensions":t={height:B.outerHeight(),width:B.outerWidth()};break;case"offset":t=y.offset(B,o.position.container);break;default:n=q(e.toLowerCase());t=n[0][n[1]];t=t.precedance?t.string():t}return t},set:function(i,s){function p(e,t){var n,r,i;for(n in c)for(r in c[n])if(i=(new RegExp(r,"i")).exec(e)){t.push(i);c[n][r].apply(m,t)}}var u=/^position\.(my|at|adjust|target|container)|style|content|show\.ready/i,a=/^content\.(title|attr)|style/i,f=n,l=n,c=m.checks,h;if("string"==typeof i){h=i;i={};i[h]=s}else i=e.extend(t,{},i);e.each(i,function(t,n){var r=q(t.toLowerCase()),s;s=r[0][r[1]];r[0][r[1]]="object"==typeof n&&n.nodeType?e(n):n;i[t]=[r[0],r[1],n,s];f=u.test(t)||f;l=a.test(t)||l});P(o);D=H=1;e.each(i,p);D=H=0;if(m.rendered&&B[0].offsetWidth>0){f&&m.reposition(o.position.target==="mouse"?r:I.event);l&&m.redraw()}return m},toggle:function(i,s){function w(){if(i){e.browser.msie&&B[0].style.removeAttribute("filter");B.css("overflow","");"string"==typeof a.autofocus&&e(a.autofocus,B).focus();a.target.trigger("qtip-"+d+"-inactive")}else B.css({display:"",visibility:"",opacity:"",left:"",top:""});y=e.Event("tooltip"+(i?"visible":"hidden"));y.originalEvent=s?I.event:r;B.trigger(y,[m])}if(!m.rendered)return i?m.render(1):m;var u=i?"show":"hide",a=o[u],f=o[i?"hide":"show"],l=o.position,c=o.content,h=B[0].offsetWidth>0,p=i||a.target.length===1,v=!s||a.target.length<2||I.target[0]===s.target,g,y;(typeof i).search("boolean|number")&&(i=!h);if(!B.is(":animated")&&h===i&&v)return m;if(s){if(/over|enter/.test(s.type)&&/out|leave/.test(I.event.type)&&o.show.target.add(s.target).length===o.show.target.length&&B.has(s.relatedTarget).length)return m;I.event=e.extend({},s)}y=e.Event("tooltip"+u);y.originalEvent=s?I.event:r;B.trigger(y,[m,90]);if(y.isDefaultPrevented())return m;e.attr(B[0],"aria-hidden",!i);if(i){I.origin=e.extend({},b);m.focus(s);e.isFunction(c.text)&&J(c.text,n);e.isFunction(c.title.text)&&V(c.title.text,n);if(!_&&l.target==="mouse"&&l.adjust.mouse){e(document).bind("mousemove.qtip",function(e){b={pageX:e.pageX,pageY:e.pageY,type:"mousemove"}});_=t}m.reposition(s,arguments[2]);(y.solo=!!a.solo)&&e(T,a.solo).not(B).qtip("hide",y)}else{clearTimeout(m.timers.show);delete I.origin;if(_&&!e(T+'[tracking="true"]:visible',a.solo).not(B).length){e(document).unbind("mousemove.qtip");_=n}m.blur(s)}if(a.effect===n||p===n){B[u]();w.call(B)}else if(e.isFunction(a.effect)){B.stop(1,1);a.effect.call(B,m);B.queue("fx",function(e){w();e()})}else B.fadeTo(90,i?1:0,w);i&&a.target.trigger("qtip-"+d+"-inactive");return m},show:function(e){return m.toggle(t,e)},hide:function(e){return m.toggle(n,e)},focus:function(t){if(!m.rendered)return m;var n=e(T),r=parseInt(B[0].style.zIndex,10),i=g.zindex+n.length,s=e.extend({},t),o,u;if(!B.hasClass(C)){u=e.Event("tooltipfocus");u.originalEvent=s;B.trigger(u,[m,i]);if(!u.isDefaultPrevented()){if(r!==i){n.each(function(){this.style.zIndex>r&&(this.style.zIndex=this.style.zIndex-1)});n.filter("."+C).qtip("blur",s)}B.addClass(C)[0].style.zIndex=i}}return m},blur:function(t){var n=e.extend({},t),r;B.removeClass(C);r=e.Event("tooltipblur");r.originalEvent=n;B.trigger(r,[m]);return m},reposition:function(t,r){if(!m.rendered||D)return m;D=1;var i=o.position.target,s=o.position,u=s.my,a=s.at,d=s.adjust,v=d.method.split(" "),g=B.outerWidth(),w=B.outerHeight(),E=0,S=0,x=e.Event("tooltipmove"),T=B.css("position")==="fixed",N=s.viewport,C={left:0,top:0},k=s.container,L=B[0].offsetWidth>0,A,O,M;if(e.isArray(i)&&i.length===2){a={x:l,y:f};C={left:i[0],top:i[1]}}else if(i==="mouse"&&(t&&t.pageX||I.event.pageX)){a={x:l,y:f};t=(!t||t.type!=="resize"&&t.type!=="scroll"?t&&t.pageX&&t.type==="mousemove"?t:b&&b.pageX&&(d.mouse||!t||!t.pageX)?{pageX:b.pageX,pageY:b.pageY}:!d.mouse&&I.origin&&I.origin.pageX&&o.show.distance?I.origin:t:I.event)||t||I.event||b||{};C={top:t.pageY,left:t.pageX}}else{i==="event"&&t&&t.target&&t.type!=="scroll"&&t.type!=="resize"?I.target=e(t.target):i!=="event"&&(I.target=e(i.jquery?i:F.target));i=I.target;i=e(i).eq(0);if(i.length===0)return m;if(i[0]===document||i[0]===window){E=y.iOS?window.innerWidth:i.width();S=y.iOS?window.innerHeight:i.height();i[0]===window&&(C={top:(N||i).scrollTop(),left:(N||i).scrollLeft()})}else if(y.imagemap&&i.is("area"))A=y.imagemap(m,i,a,y.viewport?v:n);else if(y.svg&&typeof i[0].xmlbase=="string")A=y.svg(m,i,a,y.viewport?v:n);else{E=i.outerWidth();S=i.outerHeight();C=y.offset(i,k)}if(A){E=A.width;S=A.height;O=A.offset;C=A.position}if(y.iOS>3.1&&y.iOS<4.1||y.iOS>=4.3&&y.iOS<4.33||!y.iOS&&T){M=e(window);C.left-=M.scrollLeft();C.top-=M.scrollTop()}C.left+=a.x===h?E:a.x===p?E/2:0;C.top+=a.y===c?S:a.y===p?S/2:0}C.left+=d.x+(u.x===h?-g:u.x===p?-g/2:0);C.top+=d.y+(u.y===c?-w:u.y===p?-w/2:0);if(y.viewport){C.adjusted=y.viewport(m,C,s,E,S,g,w);O&&C.adjusted.left&&(C.left+=O.left);O&&C.adjusted.top&&(C.top+=O.top)}else C.adjusted={left:0,top:0};x.originalEvent=e.extend({},t);B.trigger(x,[m,C,N.elem||N]);if(x.isDefaultPrevented())return m;delete C.adjusted;if(r===n||!L||isNaN(C.left)||isNaN(C.top)||i==="mouse"||!e.isFunction(s.effect))B.css(C);else if(e.isFunction(s.effect)){s.effect.call(B,m,e.extend({},C));B.queue(function(t){e(this).css({opacity:"",height:""});e.browser.msie&&this.style.removeAttribute("filter");t()})}D=0;return m},redraw:function(){if(m.rendered<1||H)return m;var e=o.position.container,t,n,r,i;H=1;o.style.height&&B.css(a,o.style.height);if(o.style.width)B.css(u,o.style.width);else{B.css(u,"").addClass(L);n=B.width()+1;r=B.css("max-width")||"";i=B.css("min-width")||"";t=(r+i).indexOf("%")>-1?e.width()/100:0;r=(r.indexOf("%")>-1?t:1)*parseInt(r,10)||n;i=(i.indexOf("%")>-1?t:1)*parseInt(i,10)||0;n=r+i?Math.min(Math.max(n,i),r):n;B.css(u,Math.round(n)).removeClass(L)}H=0;return m},disable:function(t){"boolean"!=typeof t&&(t=!B.hasClass(x)&&!I.disabled);if(m.rendered){B.toggleClass(x,t);e.attr(B[0],"aria-disabled",t)}else I.disabled=!!t;return m},enable:function(){return m.disable(n)},destroy:function(){var n=s[0],r=e.attr(n,M),i=s.data("qtip");m.destroyed=t;if(m.rendered){B.stop(1,0).remove();e.each(m.plugins,function(){this.destroy&&this.destroy()})}clearTimeout(m.timers.show);clearTimeout(m.timers.hide);Q();if(!i||m===i){e.removeData(n,"qtip");if(o.suppress&&r){e.attr(n,"title",r);s.removeAttr(M)}s.removeAttr("aria-describedby")}s.unbind(".qtip-"+d);delete w[m.id];return s}})}function B(i,s){var o,u,a,f,l,c=e(this),h=e(document.body),p=this===document?h:c,d=c.metadata?c.metadata(s.metadata):r,v=s.metadata.type==="html5"&&d?d[s.metadata.name]:r,m=c.data(s.metadata.name||"qtipopts");try{m=typeof m=="string"?(new Function("return "+m))():m}catch(b){D("Unable to parse HTML5 attribute data: "+m)}f=e.extend(t,{},g.defaults,s,typeof m=="object"?P(m):r,P(v||d));u=f.position;f.id=i;if("boolean"==typeof f.content.text){a=c.attr(f.content.attr);if(f.content.attr===n||!a){D("Unable to locate content for tooltip! Aborting render of tooltip on element: ",c);return n}f.content.text=a}u.container.length||(u.container=h);u.target===n&&(u.target=p);f.show.target===n&&(f.show.target=p);f.show.solo===t&&(f.show.solo=u.container.closest("body"));f.hide.target===n&&(f.hide.target=p);f.position.viewport===t&&(f.position.viewport=u.container);u.container=u.container.eq(0);u.at=new y.Corner(u.at);u.my=new y.Corner(u.my);if(e.data(this,"qtip"))if(f.overwrite)c.qtip("destroy");else if(f.overwrite===n)return n;f.suppress&&(l=e.attr(this,"title"))&&e(this).removeAttr("title").attr(M,l).attr("title","");o=new H(c,f,i,!!a);e.data(this,"qtip",o);c.bind("remove.qtip-"+i+" removeqtip.qtip-"+i,function(){o.destroy()});return o}function j(r){var i=this,s=r.elements.tooltip,o=r.options.content.ajax,u=g.defaults.content.ajax,a=".qtip-ajax",f=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,l=t,c=n,h;r.checks.ajax={"^content.ajax":function(e,t,n){t==="ajax"&&(o=n);t==="once"?i.init():o&&o.url?i.load():s.unbind(a)}};e.extend(i,{init:function(){o&&o.url&&s.unbind(a)[o.once?"one":"bind"]("tooltipshow"+a,i.load);return i},load:function(s){function g(){var i;if(r.destroyed)return;l=n;if(v){c=t;r.show(s.originalEvent)}(i=u.complete||o.complete)&&e.isFunction(i)&&i.apply(o.context||r,arguments)}function y(t,n,i){var s;if(r.destroyed)return;d&&(t=e("<div/>").append(t.replace(f,"")).find(d));(s=u.success||o.success)&&e.isFunction(s)?s.call(o.context||r,t,n,i):r.set("content.text",t)}function b(e,t,n){if(r.destroyed||e.status===0)return;r.set("content.text",t+": "+n)}if(c){c=n;return}var a=o.url.indexOf(" "),p=o.url,d,v=!o.loading&&l;if(v)try{s.preventDefault()}catch(m){}else if(s&&s.isDefaultPrevented())return i;h&&h.abort&&h.abort();if(a>-1){d=p.substr(a);p=p.substr(0,a)}h=e.ajax(e.extend({error:u.error||b,context:r},o,{url:p,success:y,complete:g}))},destroy:function(){h&&h.abort&&h.abort();r.destroyed=t}});i.init()}function F(t){var n=this,r=t.elements,i=r.tooltip,s=".bgiframe-"+t.id;e.extend(n,{init:function(){r.bgiframe=e('<iframe class="ui-tooltip-bgiframe" frameborder="0" tabindex="-1" src="javascript:\'\';"  style="display:block; position:absolute; z-index:-1; filter:alpha(opacity=0); -ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";"></iframe>');r.bgiframe.appendTo(i);i.bind("tooltipmove"+s,n.adjust)},adjust:function(){var e=t.get("dimensions"),n=t.plugins.tip,s=r.tip,o,u;u=parseInt(i.css("border-left-width"),10)||0;u={left:-u,top:-u};if(n&&s){o=n.corner.precedance==="x"?["width","left"]:["height","top"];u[o[1]]-=s[o[0]]()}r.bgiframe.css(u).css(e)},destroy:function(){r.bgiframe.remove();i.unbind(s)}});n.init()}function I(r){function m(){d=e(p,u).not("[disabled]").map(function(){return typeof this.focus=="function"?this:null})}function g(e){d.length<1&&e.length?e.not("body").blur():d.first().focus()}function b(t){var r=e(t.target),i=r.closest(".qtip"),s;s=i.length<1?n:parseInt(i[0].style.zIndex,10)>parseInt(u[0].style.zIndex,10);!s&&e(t.target).closest(T)[0]!==u[0]&&g(r)}var i=this,s=r.options.show.modal,o=r.elements,u=o.tooltip,a="#qtip-overlay",f=".qtipmodal",l=f+r.id,c="is-modal-qtip",h=e(document.body),p=y.modal.focusable.join(","),d={},v;r.checks.modal={"^show.modal.(on|blur)$":function(){i.init();o.overlay.toggle(u.is(":visible"))},"^content.text$":m};e.extend(i,{init:function(){if(!s.on)return i;v=i.create();u.attr(c,t).css("z-index",y.modal.zindex+e(T+"["+c+"]").length).unbind(f).unbind(l).bind("tooltipshow"+f+" tooltiphide"+f,function(t,n,r){var s=t.originalEvent;if(t.target===u[0])if(s&&t.type==="tooltiphide"&&/mouse(leave|enter)/.test(s.type)&&e(s.relatedTarget).closest(v[0]).length)try{t.preventDefault()}catch(o){}else(!s||s&&!s.solo)&&i[t.type.replace("tooltip","")](t,r)}).bind("tooltipfocus"+f,function(t){if(t.isDefaultPrevented()||t.target!==u[0])return;var n=e(T).filter("["+c+"]"),r=y.modal.zindex+n.length,i=parseInt(u[0].style.zIndex,10);v[0].style.zIndex=r-2;n.each(function(){this.style.zIndex>i&&(this.style.zIndex-=1)});n.end().filter("."+C).qtip("blur",t.originalEvent);u.addClass(C)[0].style.zIndex=r;try{t.preventDefault()}catch(s){}}).bind("tooltiphide"+f,function(t){t.target===u[0]&&e("["+c+"]").filter(":visible").not(u).last().qtip("focus",t)});s.escape&&e(document).unbind(l).bind("keydown"+l,function(e){e.keyCode===27&&u.hasClass(C)&&r.hide(e)});s.blur&&o.overlay.unbind(l).bind("click"+l,function(e){u.hasClass(C)&&r.hide(e)});m();return i},create:function(){function r(){v.css({height:e(window).height(),width:e(window).width()})}var t=e(a);if(t.length)return o.overlay=t.insertAfter(e(T).last());v=o.overlay=e("<div />",{id:a.substr(1),html:"<div></div>",mousedown:function(){return n}}).hide().insertAfter(e(T).last());e(window).unbind(f).bind("resize"+f,r);r();return v},toggle:function(r,o,a){if(r&&r.isDefaultPrevented())return i;var f=s.effect,p=o?"show":"hide",d=v.is(":visible"),m=e("["+c+"]").filter(":visible").not(u),y;v||(v=i.create());if(v.is(":animated")&&d===o||!o&&m.length)return i;if(o){v.css({left:0,top:0});v.toggleClass("blurs",s.blur);if(s.stealfocus!==n){h.bind("focusin"+l,b);g(e("body *"))}}else h.unbind("focusin"+l);v.stop(t,n);e.isFunction(f)?f.call(v,o):f===n?v[p]():v.fadeTo(parseInt(a,10)||90,o?1:0,function(){o||e(this).hide()});o||v.queue(function(e){v.css({left:"",top:""});e()});return i},show:function(e,n){return i.toggle(e,t,n)},hide:function(e,t){return i.toggle(e,n,t)},destroy:function(){var t=v;if(t){t=e("["+c+"]").not(u).length<1;if(t){o.overlay.remove();e(document).unbind(f)}else o.overlay.unbind(f+r.id);h.undelegate("*","focusin"+l)}return u.removeAttr(c).unbind(f)}});i.init()}function q(e,t,n){var r=Math.ceil(t/2),i=Math.ceil(n/2),s={bottomright:[[0,0],[t,n],[t,0]],bottomleft:[[0,0],[t,0],[0,n]],topright:[[0,n],[t,0],[t,n]],topleft:[[0,0],[0,n],[t,n]],topcenter:[[0,n],[r,0],[t,n]],bottomcenter:[[0,0],[t,0],[r,n]],rightcenter:[[0,0],[t,i],[0,n]],leftcenter:[[t,0],[t,n],[0,i]]};s.lefttop=s.bottomright;s.righttop=s.bottomleft;s.leftbottom=s.topright;s.rightbottom=s.topleft;return s[e.string()]}function R(d,v){function A(){x.width=b.height;x.height=b.width}function O(){x.width=b.width;x.height=b.height}function M(e,r,u,a){if(!w.tip)return;var v=g.corner.clone(),y=u.adjusted,E=d.options.position.adjust.method.split(" "),x=E[0],T=E[1]||E[0],N={left:n,top:n,x:0,y:0},C,k={},L;if(g.corner.fixed!==t){x===m&&v.precedance===s&&y.left&&v.y!==p?v.precedance=v.precedance===s?o:s:x!==m&&y.left&&(v.x=v.x===p?y.left>0?l:h:v.x===l?h:l);T===m&&v.precedance===o&&y.top&&v.x!==p?v.precedance=v.precedance===o?s:o:T!==m&&y.top&&(v.y=v.y===p?y.top>0?f:c:v.y===f?c:f);v.string()!==S.corner.string()&&(S.top!==y.top||S.left!==y.left)&&g.update(v,n)}C=g.position(v,y);C[v.x]+=_(v,v.x,t);C[v.y]+=_(v,v.y,t);C.right!==i&&(C.left=-C.right);C.bottom!==i&&(C.top=-C.bottom);C.user=Math.max(0,b.offset);if(N.left=x===m&&!!y.left)if(v.x===p)k["margin-left"]=N.x=C["margin-left"]-y.left;else{L=C.right!==i?[y.left,-C.left]:[-y.left,C.left];if((N.x=Math.max(L[0],L[1]))>L[0]){u.left-=y.left;N.left=n}k[C.right!==i?h:l]=N.x}if(N.top=T===m&&!!y.top)if(v.y===p)k["margin-top"]=N.y=C["margin-top"]-y.top;else{L=C.bottom!==i?[y.top,-C.top]:[-y.top,C.top];if((N.y=Math.max(L[0],L[1]))>L[0]){u.top-=y.top;N.top=n}k[C.bottom!==i?c:f]=N.y}w.tip.css(k).toggle(!(N.x&&N.y||v.x===p&&N.y||v.y===p&&N.x));u.left-=C.left.charAt?C.user:x!==m||N.top||!N.left&&!N.top?C.left:0;u.top-=C.top.charAt?C.user:T!==m||N.left||!N.left&&!N.top?C.top:0;S.left=y.left;S.top=y.top;S.corner=v.clone()}function _(e,t,n){t=t?t:e[e.precedance];var r=E.hasClass(L),i=w.titlebar&&e.y===f,s=i?w.titlebar:w.tooltip,o="border-"+t+"-width",u;E.addClass(L);u=parseInt(s.css(o),10);u=(n?u||parseInt(E.css(o),10):u)||0;E.toggleClass(L,r);return u}function D(t){var n=w.titlebar&&t.y===f,r=n?w.titlebar:w.content,i=e.browser.mozilla,s=i?"-moz-":e.browser.webkit?"-webkit-":"",o=t.y+(i?"":"-")+t.x,u=s+(i?"border-radius-"+o:"border-"+o+"-radius");return parseInt(r.css(u),10)||parseInt(E.css(u),10)||0}function P(e){var t=e.precedance===o,n=x[t?u:a],r=x[t?a:u],i=e.string().indexOf(p)>-1,s=n*(i?.5:1),f=Math.pow,l=Math.round,c,h,d,v=Math.sqrt(f(s,2)+f(r,2)),m=[N/s*v,N/r*v];m[2]=Math.sqrt(f(m[0],2)-f(N,2));m[3]=Math.sqrt(f(m[1],2)-f(N,2));c=v+m[2]+m[3]+(i?0:m[0]);h=c/v;d=[l(h*r),l(h*n)];return{height:d[t?0:1],width:d[t?1:0]}}var g=this,b=d.options.style.tip,w=d.elements,E=w.tooltip,S={top:0,left:0},x={width:b.width,height:b.height},T={},N=b.border||0,C=".qtip-tip",k=!!(e("<canvas />")[0]||{}).getContext;g.corner=r;g.mimic=r;g.border=N;g.offset=b.offset;g.size=x;d.checks.tip={"^position.my|style.tip.(corner|mimic|border)$":function(){g.init()||g.destroy();d.reposition()},"^style.tip.(height|width)$":function(){x={width:b.width,height:b.height};g.create();g.update();d.reposition()},"^content.title.text|style.(classes|widget)$":function(){w.tip&&w.tip.length&&g.update()}};e.extend(g,{init:function(){var t=g.detectCorner()&&(k||e.browser.msie);if(t){g.create();g.update();E.unbind(C).bind("tooltipmove"+C,M)}return t},detectCorner:function(){var e=b.corner,r=d.options.position,i=r.at,s=r.my.string?r.my.string():r.my;if(e===n||s===n&&i===n)return n;if(e===t)g.corner=new y.Corner(s);else if(!e.string){g.corner=new y.Corner(e);g.corner.fixed=t}S.corner=new y.Corner(g.corner.string());return g.corner.string()!=="centercenter"},detectColours:function(t){var n,r,i,s=w.tip.css("cssText",""),o=t||g.corner,u=o[o.precedance],a="border-"+u+"-color",l="border"+u.charAt(0)+u.substr(1)+"Color",c=/rgba?\(0, 0, 0(, 0)?\)|transparent|#123456/i,h="background-color",d="transparent",v=" !important",m=w.titlebar&&(o.y===f||o.y===p&&s.position().top+x.height/2+b.offset<w.titlebar.outerHeight(1)),y=m?w.titlebar:w.tooltip;E.addClass(L);T.fill=r=s.css(h);T.border=i=s[0].style[l]||s.css(a)||E.css(a);if(!r||c.test(r)){T.fill=y.css(h)||d;c.test(T.fill)&&(T.fill=E.css(h)||r)}if(!i||c.test(i)||i===e(document.body).css("color")){T.border=y.css(a)||d;if(c.test(T.border)||T.border===y.css("color"))T.border=E.css(a)||E.css(l)||i}e("*",s).add(s).css("cssText",h+":"+d+v+";border:0"+v+";");E.removeClass(L)},create:function(){var t=x.width,n=x.height,r;w.tip&&w.tip.remove();w.tip=e("<div />",{"class":"ui-tooltip-tip"}).css({width:t,height:n}).prependTo(E);if(k)e("<canvas />").appendTo(w.tip)[0].getContext("2d").save();else{r='<vml:shape coordorigin="0,0" style="display:inline-block; position:absolute; behavior:url(#default#VML);"></vml:shape>';w.tip.html(r+r);e("*",w.tip).bind("click mousedown",function(e){e.stopPropagation()})}},update:function(i,u){var a=w.tip,d=a.children(),v=x.width,m=x.height,C="px solid ",L="px dashed transparent",M=b.mimic,D=Math.round,H,B,j,F,I;i||(i=S.corner||g.corner);if(M===n)M=i;else{M=new y.Corner(M);M.precedance=i.precedance;M.x==="inherit"?M.x=i.x:M.y==="inherit"?M.y=i.y:M.x===M.y&&(M[i.precedance]=i[i.precedance])}H=M.precedance;i.precedance===s?A():O();w.tip.css({width:v=x.width,height:m=x.height});g.detectColours(i);if(T.border!=="transparent"){N=_(i,r,t);b.border===0&&N>0&&(T.fill=T.border);g.border=N=b.border!==t?b.border:N}else g.border=N=0;j=q(M,v,m);g.size=I=P(i);a.css(I);i.precedance===o?F=[D(M.x===l?N:M.x===h?I.width-v-N:(I.width-v)/2),D(M.y===f?I.height-m:0)]:F=[D(M.x===l?I.width-v:0),D(M.y===f?N:M.y===c?I.height-m-N:(I.height-m)/2)];if(k){d.attr(I);B=d[0].getContext("2d");B.restore();B.save();B.clearRect(0,0,3e3,3e3);B.fillStyle=T.fill;B.strokeStyle=T.border;B.lineWidth=N*2;B.lineJoin="miter";B.miterLimit=100;B.translate(F[0],F[1]);B.beginPath();B.moveTo(j[0][0],j[0][1]);B.lineTo(j[1][0],j[1][1]);B.lineTo(j[2][0],j[2][1]);B.closePath();if(N){if(E.css("background-clip")==="border-box"){B.strokeStyle=T.fill;B.stroke()}B.strokeStyle=T.border;B.stroke()}B.fill()}else{j="m"+j[0][0]+","+j[0][1]+" l"+j[1][0]+","+j[1][1]+" "+j[2][0]+","+j[2][1]+" xe";F[2]=N&&/^(r|b)/i.test(i.string())?parseFloat(e.browser.version,10)===8?2:1:0;d.css({antialias:""+(M.string().indexOf(p)>-1),left:F[0]-F[2]*Number(H===s),top:F[1]-F[2]*Number(H===o),width:v+N,height:m+N}).each(function(t){var n=e(this);n[n.prop?"prop":"attr"]({coordsize:v+N+" "+(m+N),path:j,fillcolor:T.fill,filled:!!t,stroked:!t}).css({display:N||t?"block":"none"});!t&&n.html()===""&&n.html('<vml:stroke weight="'+N*2+'px" color="'+T.border+'" miterlimit="1000" joinstyle="miter" '+' style="behavior:url(#default#VML); display:inline-block;" />')})}u!==n&&g.position(i)},position:function(t){var r=w.tip,i={},c=Math.max(0,b.offset),h,d,v;if(b.corner===n||!r)return n;t=t||g.corner;h=t.precedance;d=P(t);v=[t.x,t.y];h===s&&v.reverse();e.each(v,function(e,n){var r,s;if(n===p){r=h===o?l:f;i[r]="50%";i["margin-"+r]=-Math.round(d[h===o?u:a]/2)+c}else{r=_(t,n);s=D(t);i[n]=e?0:c+(s>r?s:-r)}});i[t[h]]-=d[h===s?u:a];r.css({top:"",bottom:"",left:"",right:"",margin:""}).css(i);return i},destroy:function(){w.tip&&w.tip.remove();w.tip=!1;E.unbind(C)}});g.init()}var t=!0,n=!1,r=null,i,s="x",o="y",u="width",a="height",f="top",l="left",c="bottom",h="right",p="center",d="flip",v="flipinvert",m="shift",g,y,b,w={},E="ui-tooltip",S="ui-widget",x="ui-state-disabled",T="div.qtip."+E,N=E+"-default",C=E+"-focus",k=E+"-hover",L=E+"-fluid",A="-31000px",O="_replacedByqTip",M="oldtitle",_;g=e.fn.qtip=function(s,o,u){var a=(""+s).toLowerCase(),f=r,l=e.makeArray(arguments).slice(1),c=l[l.length-1],h=this[0]?e.data(this[0],"qtip"):r;if(!arguments.length&&h||a==="api")return h;if("string"==typeof s){this.each(function(){var r=e.data(this,"qtip");if(!r)return t;c&&c.timeStamp&&(r.cache.event=c);if(a!=="option"&&a!=="options"||!o)r[a]&&r[a].apply(r[a],l);else{if(!e.isPlainObject(o)&&u===i){f=r.get(o);return n}r.set(o,u)}});return f!==r?f:this}if("object"==typeof s||!arguments.length){h=P(e.extend(t,{},s));return g.bind.call(this,h,c)}};g.bind=function(r,s){return this.each(function(o){function p(t){function r(){c.render(typeof t=="object"||u.show.ready);a.show.add(a.hide).unbind(l)}if(c.cache.disabled)return n;c.cache.event=e.extend({},t);c.cache.target=t?e(t.target):[i];if(u.show.delay>0){clearTimeout(c.timers.show);c.timers.show=setTimeout(r,u.show.delay);f.show!==f.hide&&a.hide.bind(f.hide,function(){clearTimeout(c.timers.show)})}else r()}var u,a,f,l,c,h;h=e.isArray(r.id)?r.id[o]:r.id;h=!h||h===n||h.length<1||w[h]?g.nextid++:w[h]=h;l=".qtip-"+h+"-create";c=B.call(this,h,r);if(c===n)return t;u=c.options;e.each(y,function(){this.initialize==="initialize"&&this(c)});a={show:u.show.target,hide:u.hide.target};f={show:e.trim(""+u.show.event).replace(/ /g,l+" ")+l,hide:e.trim(""+u.hide.event).replace(/ /g,l+" ")+l};/mouse(over|enter)/i.test(f.show)&&!/mouse(out|leave)/i.test(f.hide)&&(f.hide+=" mouseleave"+l);a.show.bind("mousemove"+l,function(e){b={pageX:e.pageX,pageY:e.pageY,type:"mousemove"};c.cache.onTarget=t});a.show.bind(f.show,p);(u.show.ready||u.prerender)&&p(s)})};y=g.plugins={Corner:function(e){e=(""+e).replace(/([A-Z])/," $1").replace(/middle/gi,p).toLowerCase();this.x=(e.match(/left|right/i)||e.match(/center/)||["inherit"])[0].toLowerCase();this.y=(e.match(/top|bottom|center/i)||["inherit"])[0].toLowerCase();var t=e.charAt(0);this.precedance=t==="t"||t==="b"?o:s;this.string=function(){return this.precedance===o?this.y+this.x:this.x+this.y};this.abbrev=function(){var e=this.x.substr(0,1),t=this.y.substr(0,1);return e===t?e:this.precedance===o?t+e:e+t};this.invertx=function(e){this.x=this.x===l?h:this.x===h?l:e||this.x};this.inverty=function(e){this.y=this.y===f?c:this.y===c?f:e||this.y};this.clone=function(){return{x:this.x,y:this.y,precedance:this.precedance,string:this.string,abbrev:this.abbrev,clone:this.clone,invertx:this.invertx,inverty:this.inverty}}},offset:function(t,n){function f(e,t){r.left+=t*e.scrollLeft();r.top+=t*e.scrollTop()}var r=t.offset(),i=t.closest("body")[0],s=n,o,u,a;if(s){do if(s.css("position")!=="static"){u=s.position();r.left-=u.left+(parseInt(s.css("borderLeftWidth"),10)||0)+(parseInt(s.css("marginLeft"),10)||0);r.top-=u.top+(parseInt(s.css("borderTopWidth"),10)||0)+(parseInt(s.css("marginTop"),10)||0);!o&&(a=s.css("overflow"))!=="hidden"&&a!=="visible"&&(o=s)}while((s=e(s[0].offsetParent)).length);o&&o[0]!==i&&f(o,1)}return r},iOS:parseFloat((""+(/CPU.*OS ([0-9_]{1,5})|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))||n,fn:{attr:function(t,n){if(this.length){var r=this[0],i="title",s=e.data(r,"qtip");if(t===i&&s&&"object"==typeof s&&s.options.suppress){if(arguments.length<2)return e.attr(r,M);s&&s.options.content.attr===i&&s.cache.attr&&s.set("content.text",n);return this.attr(M,n)}}return e.fn["attr"+O].apply(this,arguments)},clone:function(t){var n=e([]),r="title",i=e.fn["clone"+O].apply(this,arguments);t||i.filter("["+M+"]").attr("title",function(){return e.attr(this,M)}).removeAttr(M);return i}}};e.each(y.fn,function(n,r){if(!r||e.fn[n+O])return t;var i=e.fn[n+O]=e.fn[n];e.fn[n]=function(){return r.apply(this,arguments)||i.apply(this,arguments)}});if(!e.ui){e["cleanData"+O]=e.cleanData;e.cleanData=function(t){for(var n=0,r;(r=t[n])!==i;n++)try{e(r).triggerHandler("removeqtip")}catch(s){}e["cleanData"+O](t)}}g.version="2.0.0pre";g.nextid=0;g.inactiveEvents="click dblclick mousedown mouseup mousemove mouseleave mouseenter".split(" ");g.zindex=15e3;g.defaults={prerender:n,id:n,overwrite:t,suppress:t,content:{text:t,attr:"title",title:{text:n,button:n}},position:{my:"top left",at:"bottom right",target:n,container:n,viewport:n,adjust:{x:0,y:0,mouse:t,resize:t,method:"flip flip"},effect:function(t,r,i){e(this).animate(r,{duration:200,queue:n})}},show:{target:n,event:"mouseenter",effect:t,delay:90,solo:n,ready:n,autofocus:n},hide:{target:n,event:"mouseleave",effect:t,delay:0,fixed:n,inactive:n,leave:"window",distance:n},style:{classes:"",widget:n,width:n,height:n,def:t},events:{render:r,move:r,show:r,hide:r,toggle:r,visible:r,hidden:r,focus:r,blur:r}};y.ajax=function(e){var t=e.plugins.ajax;return"object"==typeof t?t:e.plugins.ajax=new j(e)};y.ajax.initialize="render";y.ajax.sanitize=function(e){var t=e.content,n;if(t&&"ajax"in t){n=t.ajax;typeof n!="object"&&(n=e.content.ajax={url:n});"boolean"!=typeof n.once&&n.once&&(n.once=!!n.once)}};e.extend(t,g.defaults,{content:{ajax:{loading:t,once:t}}});y.bgiframe=function(t){var r=e.browser,i=t.plugins.bgiframe;return e("select, object").length<1||!r.msie||(""+r.version).charAt(0)!=="6"?n:"object"==typeof i?i:t.plugins.bgiframe=new F(t)};y.bgiframe.initialize="render";y.imagemap=function(t,n,r,i){function E(e,t,n){var r=0,i=1,s=1,o=0,u=0,a=e.width,d=e.height;while(a>0&&d>0&&i>0&&s>0){a=Math.floor(a/2);d=Math.floor(d/2);n.x===l?i=a:n.x===h?i=e.width-a:i+=Math.floor(a/2);n.y===f?s=d:n.y===c?s=e.height-d:s+=Math.floor(d/2);r=t.length;while(r--){if(t.length<2)break;o=t[r][0]-e.position.left;u=t[r][1]-e.position.top;(n.x===l&&o>=i||n.x===h&&o<=i||n.x===p&&(o<i||o>e.width-i)||n.y===f&&u>=s||n.y===c&&u<=s||n.y===p&&(u<s||u>e.height-s))&&t.splice(r,1)}}return{left:t[0][0],top:t[0][1]}}n.jquery||(n=e(n));var s=t.cache.areas={},o=(n[0].shape||n.attr("shape")).toLowerCase(),u=n[0].coords||n.attr("coords"),a=u.split(","),d=[],v=e('img[usemap="#'+n.parent("map").attr("name")+'"]'),m=v.offset(),g={width:0,height:0,position:{top:1e10,right:0,bottom:0,left:1e10}},y=0,b=0,w;m.left+=Math.ceil((v.outerWidth()-v.width())/2);m.top+=Math.ceil((v.outerHeight()-v.height())/2);if(o==="poly"){y=a.length;while(y--){b=[parseInt(a[--y],10),parseInt(a[y+1],10)];b[0]>g.position.right&&(g.position.right=b[0]);b[0]<g.position.left&&(g.position.left=b[0]);b[1]>g.position.bottom&&(g.position.bottom=b[1]);b[1]<g.position.top&&(g.position.top=b[1]);d.push(b)}}else{y=-1;while(y++<a)d.push(parseInt(a[y],10))}switch(o){case"rect":g={width:Math.abs(d[2]-d[0]),height:Math.abs(d[3]-d[1]),position:{left:Math.min(d[0],d[2]),top:Math.min(d[1],d[3])}};break;case"circle":g={width:d[2]+2,height:d[2]+2,position:{left:d[0],top:d[1]}};break;case"poly":g.width=Math.abs(g.position.right-g.position.left);g.height=Math.abs(g.position.bottom-g.position.top);if(r.abbrev()==="c")g.position={left:g.position.left+g.width/2,top:g.position.top+g.height/2};else{if(!s[r+u]){g.position=E(g,d.slice(),r);if(i&&(i[0]==="flip"||i[1]==="flip")){g.offset=E(g,d.slice(),{x:r.x===l?h:r.x===h?l:p,y:r.y===f?c:r.y===c?f:p});g.offset.left-=g.position.left;g.offset.top-=g.position.top}s[r+u]=g}g=s[r+u]}g.width=g.height=0}g.position.left+=m.left;g.position.top+=m.top;return g};y.modal=function(e){var t=e.plugins.modal;return"object"==typeof t?t:e.plugins.modal=new I(e)};y.modal.initialize="render";y.modal.sanitize=function(e){e.show&&(typeof e.show.modal!="object"?e.show.modal={on:!!e.show.modal}:typeof e.show.modal.on=="undefined"&&(e.show.modal.on=t))};y.modal.zindex=g.zindex+1e3;y.modal.focusable=["a[href]","area[href]","input","select","textarea","button","iframe","object","embed","[tabindex]","[contenteditable]"];e.extend(t,g.defaults,{show:{modal:{on:n,effect:t,blur:t,stealfocus:t,escape:t}}});y.svg=function(t,n,r,i){var s=e(document),o=n[0],u={width:0,height:0,position:{top:1e10,left:1e10}},a,f,l,c,h;while(!o.getBBox)o=o.parentNode;if(o.getBBox&&o.parentNode){a=o.getBBox();f=o.getScreenCTM();l=o.farthestViewportElement||o;if(!l.createSVGPoint)return u;c=l.createSVGPoint();c.x=a.x;c.y=a.y;h=c.matrixTransform(f);u.position.left=h.x;u.position.top=h.y;c.x+=a.width;c.y+=a.height;h=c.matrixTransform(f);u.width=h.x-u.position.left;u.height=h.y-u.position.top;u.position.left+=s.scrollLeft();u.position.top+=s.scrollTop()}return u};y.tip=function(e){var t=e.plugins.tip;return"object"==typeof t?t:e.plugins.tip=new R(e)};y.tip.initialize="render";y.tip.sanitize=function(e){var n=e.style,r;if(n&&"tip"in n){r=e.style.tip;typeof r!="object"&&(e.style.tip={corner:r});/string|boolean/i.test(typeof r.corner)||(r.corner=t);typeof r.width!="number"&&delete r.width;typeof r.height!="number"&&delete r.height;typeof r.border!="number"&&r.border!==t&&delete r.border;typeof r.offset!="number"&&delete r.offset}};e.extend(t,g.defaults,{style:{tip:{corner:t,mimic:n,width:6,height:6,border:t,offset:0}}});y.viewport=function(e,t,n,r,d,g,y){function B(e,n,r,s,o,u,a,f,l){var c=t[o],h=S[e],d=x[e],g=r===m,y=-A.offset[o]+L.offset[o]+L["scroll"+o],b=h===o?l:h===u?-l:-l/2,w=d===o?f:d===u?-f:-f/2,E=M&&M.size?M.size[a]||0:0,T=M&&M.corner&&M.corner.precedance===e&&!g?E:0,N=y-c+T,C=c+l-L[a]-y+T,k=b-(S.precedance===e||h===S[n]?w:0)-(d===p?f/2:0);if(g){T=M&&M.corner&&M.corner.precedance===n?E:0;k=(h===o?1:-1)*b-T;t[o]+=N>0?N:C>0?-C:0;t[o]=Math.max(-A.offset[o]+L.offset[o]+(T&&M.corner[e]===p?M.offset:0),c-k,Math.min(Math.max(-A.offset[o]+L.offset[o]+L[a],c+k),t[o]))}else{s*=r===v?2:0;if(N>0&&(h!==o||C>0)){t[o]-=k+s;P["invert"+e](o)}else if(C>0&&(h!==u||N>0)){t[o]-=(h===p?-k:k)+s;P["invert"+e](u)}if(t[o]<y&&-t[o]>C){t[o]=c;P=i}}return t[o]-c}var b=n.target,w=e.elements.tooltip,S=n.my,x=n.at,T=n.adjust,N=T.method.split(" "),C=N[0],k=N[1]||N[0],L=n.viewport,A=n.container,O=e.cache,M=e.plugins.tip,_={left:0,top:0},D,P,H;if(!L.jquery||b[0]===window||b[0]===document.body||T.method==="none")return _;D=w.css("position")==="fixed";L={elem:L,height:L[(L[0]===window?"h":"outerH")+"eight"](),width:L[(L[0]===window?"w":"outerW")+"idth"](),scrollleft:D?0:L.scrollLeft(),scrolltop:D?0:L.scrollTop(),offset:L.offset()||{left:0,top:0}};A={elem:A,scrollLeft:A.scrollLeft(),scrollTop:A.scrollTop(),offset:A.offset()||{left:0,top:0}};if(C!=="shift"||k!=="shift")P=S.clone();_={left:C!=="none"?B(s,o,C,T.x,l,h,u,r,g):0,top:k!=="none"?B(o,s,k,T.y,f,c,a,d,y):0};P&&O.lastClass!==(H=E+"-pos-"+P.abbrev())&&w.removeClass(e.cache.lastClass).addClass(e.cache.lastClass=H);return _}});(function(e){typeof e.fn.each2=="undefined"&&e.fn.extend({each2:function(t){var n=e([0]),r=-1,i=this.length;while(++r<i&&(n.context=n[0]=this[r])&&t.call(n[0],r,n)!==!1);return this}})})(jQuery);(function(e,t){"use strict";function a(e,t){var n=0,r=t.length,i;if(typeof e=="undefined")return-1;if(e.constructor===String){for(;n<r;n+=1)if(e.localeCompare(t[n])===0)return n}else for(;n<r;n+=1){i=t[n];if(i.constructor===String){if(i.localeCompare(e)===0)return n}else if(i===e)return n}return-1}function f(e,n){return e===n?!0:e===t||n===t?!1:e===null||n===null?!1:e.constructor===String?e.localeCompare(n)===0:n.constructor===String?n.localeCompare(e)===0:!1}function l(t,n){var r,i,s;if(t===null||t.length<1)return[];r=t.split(n);for(i=0,s=r.length;i<s;i+=1)r[i]=e.trim(r[i]);return r}function c(e){return e.outerWidth()-e.width()}function h(n){var r="keyup-change-value";n.bind("keydown",function(){e.data(n,r)===t&&e.data(n,r,n.val())});n.bind("keyup",function(){var i=e.data(n,r);if(i!==t&&n.val()!==i){e.removeData(n,r);n.trigger("keyup-change")}})}function p(n){n.bind("mousemove",function(n){var r=e(document).data
("select2-lastpos");(r===t||r.x!==n.pageX||r.y!==n.pageY)&&e(n.target).trigger("mousemove-filtered",n)})}function d(e,t){var n;return function(){window.clearTimeout(n);n=window.setTimeout(t,e)}}function v(e,t){var n=d(e,function(e){t.trigger("scroll-debounced",e)});t.bind("scroll",function(e){a(e.target,t.get())>=0&&n(e)})}function m(e){e.preventDefault();e.stopPropagation()}function g(t){if(!u){var n=t[0].currentStyle||window.getComputedStyle(t[0],null);u=e("<div></div>").css({position:"absolute",left:"-1000px",top:"-1000px",display:"none",fontSize:n.fontSize,fontFamily:n.fontFamily,fontStyle:n.fontStyle,fontWeight:n.fontWeight,letterSpacing:n.letterSpacing,textTransform:n.textTransform,whiteSpace:"nowrap"});e("body").append(u)}u.text(t.val());return u.width()}function y(e,t,n){var r=e.toUpperCase().indexOf(t.toUpperCase()),i=t.length;if(r<0){n.push(e);return}n.push(e.substring(0,r));n.push("<span class='select2-match'>");n.push(e.substring(r,r+i));n.push("</span>");n.push(e.substring(r+i,e.length))}function b(t){var n,r=0,i=null,s=t.quietMillis||100;return function(o){window.clearTimeout(n);n=window.setTimeout(function(){r+=1;var n=r,s=t.data,u=t.transport||e.ajax,a=t.type||"GET";s=s.call(this,o.term,o.page,o.context);null!==i&&i.abort();i=u.call(null,{url:t.url,dataType:t.dataType,data:s,type:a,success:function(e){if(n<r)return;var i=t.results(e,o.page);o.callback(i)}})},s)}}function w(t){var n=t,r,i=function(e){return""+e.text};if(!e.isArray(n)){i=n.text;if(!e.isFunction(i)){r=n.text;i=function(e){return e[r]}}n=n.results}return function(t){var r=t.term,s={};if(r===""){t.callback({results:n});return}s.results=e(n).filter(function(){return t.matcher(r,i(this))}).get();t.callback(s)}}function E(n){return e.isFunction(n)?n:function(r){var i=r.term,s={results:[]};e(n).each(function(){var e=this.text!==t,n=e?this.text:this;(i===""||r.matcher(i,n))&&s.results.push(e?this:{id:this,text:this})});r.callback(s)}}function S(t){return e.isFunction(t)?t():t}function x(t,n){var r=function(){};r.prototype=new t;r.prototype.constructor=r;r.prototype.parent=t.prototype;r.prototype=e.extend(r.prototype,n);return r}if(window.Select2!==t)return;var n,r,i,s,o,u;n={TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,SHIFT:16,CTRL:17,ALT:18,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,BACKSPACE:8,DELETE:46,isArrow:function(e){e=e.which?e.which:e;switch(e){case n.LEFT:case n.RIGHT:case n.UP:case n.DOWN:return!0}return!1},isControl:function(e){e=e.which?e.which:e;switch(e){case n.SHIFT:case n.CTRL:case n.ALT:return!0}return e.metaKey?!0:!1},isFunctionKey:function(e){e=e.which?e.which:e;return e>=112&&e<=123}};o=function(){var e=1;return function(){return e++}}();e(document).delegate("*","mousemove",function(t){e(document).data("select2-lastpos",{x:t.pageX,y:t.pageY})});e(document).ready(function(){e(document).delegate("*","mousedown focusin touchend",function(t){var n=e(t.target).closest("div.select2-container").get(0);if(n)e(document).find("div.select2-container-active").each(function(){this!==n&&e(this).data("select2").blur()});else{n=e(t.target).closest("div.select2-drop").get(0);e(document).find("div.select2-drop-active").each(function(){this!==n&&e(this).data("select2").blur()})}})});r=x(Object,{bind:function(e){var t=this;return function(){e.apply(t,arguments)}},init:function(n){var r,i,s=".select2-results";this.opts=n=this.prepareOpts(n);this.id=n.id;n.element.data("select2")!==t&&n.element.data("select2")!==null&&this.destroy();this.enabled=!0;this.container=this.createContainer();this.body=n.element.closest("body");n.element.attr("class")!==t&&this.container.addClass(n.element.attr("class"));this.container.css(S(n.containerCss));this.container.addClass(S(n.containerCssClass));this.opts.element.data("select2",this).hide().after(this.container);this.container.data("select2",this);this.dropdown=this.container.find(".select2-drop");this.dropdown.css(S(n.dropdownCss));this.dropdown.addClass(S(n.dropdownCssClass));this.dropdown.data("select2",this);this.results=r=this.container.find(s);this.search=i=this.container.find("input.select2-input");this.resultsPage=0;this.context=null;this.initContainer();p(this.results);this.dropdown.delegate(s,"mousemove-filtered",this.bind(this.highlightUnderEvent));v(80,this.results);this.dropdown.delegate(s,"scroll-debounced",this.bind(this.loadMoreIfNeeded));e.fn.mousewheel&&r.mousewheel(function(e,t,n,i){var s=r.scrollTop(),o;if(i>0&&s-i<=0){r.scrollTop(0);m(e)}else if(i<0&&r.get(0).scrollHeight-r.scrollTop()+i<=r.height()){r.scrollTop(r.get(0).scrollHeight-r.height());m(e)}});h(i);i.bind("keyup-change",this.bind(this.updateResults));i.bind("focus",function(){i.addClass("select2-focused");i.val()===" "&&i.val("")});i.bind("blur",function(){i.removeClass("select2-focused")});this.dropdown.delegate(s,"click",this.bind(function(t){if(e(t.target).closest(".select2-result-selectable:not(.select2-disabled)").length>0){this.highlightUnderEvent(t);this.selectHighlighted(t)}else this.focusSearch();m(t)}));this.dropdown.bind("click mouseup mousedown",function(e){e.stopPropagation()});if(e.isFunction(this.opts.initSelection)){this.initSelection();this.monitorSource()}n.element.is(":disabled")&&this.disable()},destroy:function(){var e=this.opts.element.data("select2");if(e!==t){e.container.remove();e.dropdown.remove();e.opts.element.removeData("select2").unbind(".select2").show()}},prepareOpts:function(n){var r,i,s;r=n.element;r.get(0).tagName.toLowerCase()==="select"&&(this.select=i=n.element);i&&e.each(["id","multiple","ajax","query","createSearchChoice","initSelection","data","tags"],function(){if(this in n)throw new Error("Option '"+this+"' is not allowed for Select2 when attached to a <select> element.")});n=e.extend({},{containerCss:{},dropdownCss:{},containerCssClass:"",dropdownCssClass:"",populateResults:function(r,i,s){var o={},u,a=[],f,l,c,h,p,d=this.opts.id;u=function(r,i,o){var a,f,l,c,h,p,v,m,g;for(a=0,f=r.length;a<f;a+=1){c=r[a];h=d(c)!==t;p="children"in c&&c.children.length>0;v=e("<li></li>");v.addClass("select2-results-dept-"+o);v.addClass("select2-result");v.addClass(h?"select2-result-selectable":"select2-result-unselectable");p&&v.addClass("select2-result-with-children");m=e("<div></div>");m.addClass("select2-result-label");var y=n.formatResult(c,m,s);y!==t&&m.html(y);v.append(m);if(p){g=e("<ul></ul>");g.addClass("select2-result-sub");u(c.children,g,o+1);v.append(g)}v.data("select2-data",c);i.append(v)}};u(i,r,0)},formatResult:function(e,t,n){var r=[];y(e.text,n.term,r);return r.join("")},formatSelection:function(e,t){return e.text},formatNoMatches:function(){return"No matches found"},formatInputTooShort:function(e,t){return"Please enter "+(t-e.length)+" more characters"},formatLoadMore:function(e){return"Loading more results..."},minimumResultsForSearch:0,minimumInputLength:0,id:function(e){return e.id},matcher:function(e,t){return t.toUpperCase().indexOf(e.toUpperCase())>=0}},n);if(typeof n.id!="function"){s=n.id;n.id=function(e){return e[s]}}if(i){n.query=this.bind(function(n){var i={results:[],more:!1},s=n.term,o,u,a;a=function(e,t){var r;if(e.is("option"))n.matcher(s,e.text())&&t.push({id:e.attr("value"),text:e.text(),element:e.get()});else if(e.is("optgroup")){r={text:e.attr("label"),children:[],element:e.get()};e.children().each2(function(e,t){a(t,r.children)});r.children.length>0&&t.push(r)}};o=r.children();if(this.getPlaceholder()!==t&&o.length>0){u=o[0];e(u).text()===""&&(o=o.not(u))}o.each2(function(e,t){a(t,i.results)});n.callback(i)});n.id=function(e){return e.id}}else if(!("query"in n))if("ajax"in n)n.query=b(n.ajax);else if("data"in n)n.query=w(n.data);else if("tags"in n){n.query=E(n.tags);n.createSearchChoice=function(e){return{id:e,text:e}};n.initSelection=function(t,n){var r=[];e(l(t.val(),",")).each(function(){r.push({id:this,text:this})});n(r)}}if(typeof n.query!="function")throw"query function not defined for Select2 "+n.element.attr("id");return n},monitorSource:function(){this.opts.element.bind("change.select2",this.bind(function(e){this.opts.element.data("select2-change-triggered")!==!0&&this.initSelection()}))},triggerChange:function(t){t=t||{};t=e.extend({},t,{type:"change",val:this.val()});this.opts.element.data("select2-change-triggered",!0);this.opts.element.trigger(t);this.opts.element.data("select2-change-triggered",!1)},enable:function(){if(this.enabled)return;this.enabled=!0;this.container.removeClass("select2-container-disabled")},disable:function(){if(!this.enabled)return;this.close();this.enabled=!1;this.container.addClass("select2-container-disabled")},opened:function(){return this.container.hasClass("select2-dropdown-open")},positionDropdown:function(){var e=this.container.offset(),t=this.container.outerHeight(),n=this.container.outerWidth(),r=this.dropdown.outerHeight(),i=document.body.scrollTop+document.documentElement.clientHeight,s=e.top+t,o=s+r<=i,u=e.top-r>=document.body.scrollTop,a=this.dropdown.hasClass("select2-drop-above"),f,l;if(a){f=!0;!u&&o&&(f=!1)}else{f=!1;!o&&u&&(f=!0)}if(f){s=e.top-r;this.container.addClass("select2-drop-above");this.dropdown.addClass("select2-drop-above")}else{this.container.removeClass("select2-drop-above");this.dropdown.removeClass("select2-drop-above")}l={top:s,left:e.left,width:n};this.dropdown.css(l)},shouldOpen:function(){var e;if(this.opened())return!1;e=jQuery.Event("open");this.opts.element.trigger(e);return!e.isDefaultPrevented()},clearDropdownAlignmentPreference:function(){this.container.removeClass("select2-drop-above");this.dropdown.removeClass("select2-drop-above")},open:function(){if(!this.shouldOpen())return!1;window.setTimeout(this.bind(this.opening),1);return!0},opening:function(){this.clearDropdownAlignmentPreference();this.search.val()===" "&&this.search.val("");this.dropdown.addClass("select2-drop-active");this.positionDropdown();this.updateResults(!0);this.dropdown[0]!==this.body.children().last()[0]&&this.dropdown.detach().appendTo(this.body);this.dropdown.show();this.ensureHighlightVisible();this.focusSearch();this.container.addClass("select2-dropdown-open").addClass("select2-container-active")},close:function(){if(!this.opened())return;this.clearDropdownAlignmentPreference();this.dropdown.hide();this.container.removeClass("select2-dropdown-open");this.results.empty();this.clearSearch()},clearSearch:function(){},ensureHighlightVisible:function(){var t=this.results,n,r,i,s,o,u,a;r=this.highlight();if(r<0)return;if(r==0){t.scrollTop(0);return}n=t.find(".select2-result-selectable");i=e(n[r]);s=i.offset().top+i.outerHeight();if(r===n.length-1){a=t.find("li.select2-more-results");a.length>0&&(s=a.offset().top+a.outerHeight())}o=t.offset().top+t.outerHeight();s>o&&t.scrollTop(t.scrollTop()+(s-o));u=i.offset().top-t.offset().top;u<0&&t.scrollTop(t.scrollTop()+u)},moveHighlight:function(t){var n=this.results.find(".select2-result-selectable"),r=this.highlight();while(r>-1&&r<n.length){r+=t;var i=e(n[r]);if(i.hasClass("select2-result-selectable")&&!i.hasClass("select2-disabled")){this.highlight(r);break}}},highlight:function(t){var n=this.results.find(".select2-result-selectable");if(arguments.length===0)return a(n.filter(".select2-highlighted")[0],n.get());t>=n.length&&(t=n.length-1);t<0&&(t=0);n.removeClass("select2-highlighted");e(n[t]).addClass("select2-highlighted");this.ensureHighlightVisible()},highlightUnderEvent:function(t){var n=e(t.target).closest(".select2-result-selectable");if(n.length>0&&!n.is(".select2-highlighted")){var r=this.results.find(".select2-result-selectable");this.highlight(r.index(n))}else n.length==0&&this.results.find(".select2-highlighted").removeClass("select2-highlighted")},loadMoreIfNeeded:function(){var e=this.results,t=e.find("li.select2-more-results"),n,r=-1,i=this.resultsPage+1,s=this,o=this.search.val(),u=this.context;if(t.length===0)return;n=t.offset().top-e.offset().top-e.height();if(n<=0){t.addClass("select2-active");this.opts.query({term:o,page:i,context:u,matcher:this.opts.matcher,callback:this.bind(function(n){s.opts.populateResults.call(this,e,n.results,{term:o,page:i,context:u});if(n.more===!0){t.detach().appendTo(e.children(":last")).text(s.opts.formatLoadMore(i+1));window.setTimeout(function(){s.loadMoreIfNeeded()},10)}else t.remove();s.positionDropdown();s.resultsPage=i})})}},updateResults:function(n){function u(){i.scrollTop(0);r.removeClass("select2-active");o.positionDropdown()}function a(e){i.html(e);u()}var r=this.search,i=this.results,s=this.opts,o=this;if(n!==!0&&this.showSearchInput===!1)return;r.addClass("select2-active");if(r.val().length<s.minimumInputLength){a("<li class='select2-no-results'>"+s.formatInputTooShort(r.val(),s.minimumInputLength)+"</li>");return}this.resultsPage=1;s.query({term:r.val(),page:this.resultsPage,context:null,matcher:s.matcher,callback:this.bind(function(l){var c;this.context=l.context===t?null:l.context;if(this.opts.createSearchChoice&&r.val()!==""){c=this.opts.createSearchChoice.call(null,r.val(),l.results);c!==t&&c!==null&&o.id(c)!==t&&o.id(c)!==null&&e(l.results).filter(function(){return f(o.id(this),o.id(c))}).length===0&&l.results.unshift(c)}if(l.results.length===0){a("<li class='select2-no-results'>"+s.formatNoMatches(r.val())+"</li>");return}i.empty();o.opts.populateResults.call(this,i,l.results,{term:r.val(),page:this.resultsPage,context:null});u();if(l.more===!0){i.children().filter(":last").append("<li class='select2-more-results'>"+s.formatLoadMore(this.resultsPage)+"</li>");window.setTimeout(function(){o.loadMoreIfNeeded()},10)}this.postprocessResults(l,n)})})},cancel:function(){this.close()},blur:function(){this.close();this.container.removeClass("select2-container-active");this.dropdown.removeClass("select2-drop-active");this.search[0]===document.activeElement&&this.search.blur();this.clearSearch();this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus")},focusSearch:function(){window.setTimeout(this.bind(function(){this.search.focus()}),10)},selectHighlighted:function(){var e=this.results.find(".select2-highlighted").not(".select2-disabled").closest(".select2-result-selectable").data("select2-data");e&&this.onSelect(e)},getPlaceholder:function(){return this.opts.element.attr("placeholder")||this.opts.element.attr("data-placeholder")||this.opts.element.data("placeholder")||this.opts.placeholder},getContainerWidth:function(){var e,n,r,i,s;if(this.opts.width!==t)return this.opts.width;e=this.opts.element.attr("style");if(e!==t){n=e.split(";");for(i=0,s=n.length;i<s;i+=1){r=n[i].replace(/\s/g,"").match(/width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/);if(r!==null&&r.length>=1)return r[1]}}e=this.opts.element.css("width");return e.indexOf("%")>0?e:this.opts.element.width()===0?"auto":this.opts.element.outerWidth()+"px"}});i=x(r,{createContainer:function(){return e("<div></div>",{"class":"select2-container",style:"width: "+this.getContainerWidth()}).html(["    <a href='javascript:void(0)' class='select2-choice'>","   <span></span><abbr class='select2-search-choice-close' style='display:none;'></abbr>","   <div><b></b></div>","</a>","    <div class='select2-drop select2-offscreen'>","   <div class='select2-search'>","       <input type='text' autocomplete='off' class='select2-input'/>","   </div>","   <ul class='select2-results'>","   </ul>","</div>"].join(""))},opening:function(){this.parent.opening.apply(this,arguments);this.dropdown.removeClass("select2-offscreen")},close:function(){if(!this.opened())return;this.parent.close.apply(this,arguments);this.dropdown.removeAttr("style").addClass("select2-offscreen").insertAfter(this.selection).show()},focus:function(){this.close();this.search.focus()},isFocused:function(){return this.selection[0]===document.activeElement},cancel:function(){this.parent.cancel.apply(this,arguments);this.search.focus()},initContainer:function(){var e,t=this.container,r=this.dropdown,i=!1;this.selection=e=t.find(".select2-choice");this.search.bind("keydown",this.bind(function(e){if(!this.enabled)return;if(e.which===n.PAGE_UP||e.which===n.PAGE_DOWN||e.which===n.SPACE){m(e);return}if(this.opened())switch(e.which){case n.UP:case n.DOWN:this.moveHighlight(e.which===n.UP?-1:1);m(e);return;case n.TAB:case n.ENTER:this.selectHighlighted();m(e);return;case n.ESC:this.cancel(e);m(e);return}else{if(e.which===n.TAB||n.isControl(e)||n.isFunctionKey(e)||e.which===n.ESC)return;this.open();if(e.which===n.ENTER){m(e);return}}}));e.bind("click",this.bind(function(e){i=!0;if(this.opened()){this.close();this.search.focus()}else this.enabled&&this.open();m(e);i=!1}));r.bind("click",this.bind(function(){this.search.focus()}));e.delegate("abbr","click",this.bind(function(e){if(!this.enabled)return;this.clear();m(e);this.close();this.triggerChange();this.search.focus()}));e.bind("focus",this.bind(function(){this.search.focus()}));this.setPlaceholder();this.search.bind("focus",this.bind(function(){this.container.addClass("select2-container-active")}))},clear:function(){this.opts.element.val("");this.selection.find("span").empty();this.selection.removeData("select2-data");this.setPlaceholder()},initSelection:function(){var e;if(this.opts.element.val()===""){this.updateSelection({id:"",text:""});this.close();this.setPlaceholder()}else{var n=this;this.opts.initSelection.call(null,this.opts.element,function(e){if(e!==t&&e!==null){n.updateSelection(e);n.close();n.setPlaceholder()}})}},prepareOpts:function(){var t=this.parent.prepareOpts.apply(this,arguments);t.element.get(0).tagName.toLowerCase()==="select"&&(t.initSelection=function(t,n){var r=t.find(":selected");e.isFunction(n)&&n({id:r.attr("value"),text:r.text()})});return t},setPlaceholder:function(){var e=this.getPlaceholder();if(this.opts.element.val()===""&&e!==t){if(this.select&&this.select.find("option:first").text()!=="")return;typeof e=="object"?this.updateSelection(e):this.selection.find("span").html(e);this.selection.addClass("select2-default");this.selection.find("abbr").hide()}},postprocessResults:function(t,n){var r=0,i=this,s=!0;this.results.find(".select2-result-selectable").each2(function(e,t){if(f(i.id(t.data("select2-data")),i.opts.element.val())){r=e;return!1}});this.highlight(r);if(n===!0){s=this.showSearchInput=t.results.length>=this.opts.minimumResultsForSearch;this.dropdown.find(".select2-search")[s?"removeClass":"addClass"]("select2-search-hidden");e(this.dropdown,this.container)[s?"addClass":"removeClass"]("select2-with-searchbox")}},onSelect:function(e){var t=this.opts.element.val();this.opts.element.val(this.id(e));this.updateSelection(e);this.close();this.search.focus();f(t,this.id(e))||this.triggerChange()},updateSelection:function(e){var n=this.selection.find("span"),r;this.selection.data("select2-data",e);n.empty();r=this.opts.formatSelection(e,n);r!==t&&n.append(r);this.selection.removeClass("select2-default");this.opts.allowClear&&this.getPlaceholder()!==t&&this.selection.find("abbr").show()},val:function(){var e,t=null;if(arguments.length===0)return this.opts.element.val();e=arguments[0];if(this.select){this.select.val(e).find(":selected").each2(function(e,n){t={id:n.attr("value"),text:n.text()};return!1});this.updateSelection(t)}else{this.opts.element.val(e?this.id(e):"");this.updateSelection(e)}this.setPlaceholder()},clearSearch:function(){this.search.val("")},data:function(e){if(arguments.length===0)return this.selection.data("select2-data");if(!e||e==="")this.clear();else{this.opts.element.val(e?this.id(e):"");this.updateSelection(e)}}});s=x(r,{createContainer:function(){return e("<div></div>",{"class":"select2-container select2-container-multi",style:"width: "+this.getContainerWidth()}).html(["    <ul class='select2-choices'>","  <li class='select2-search-field'>","    <input type='text' autocomplete='off' style='width: 25px;' class='select2-input'>","  </li>","</ul>","<div class='select2-drop select2-drop-multi' style='display:none;'>","   <ul class='select2-results'>","   </ul>","</div>"].join(""))},prepareOpts:function(){var t=this.parent.prepareOpts.apply(this,arguments);t=e.extend({},{closeOnSelect:!0},t);t.element.get(0).tagName.toLowerCase()==="select"&&(t.initSelection=function(t,n){var r=[];t.find(":selected").each2(function(e,t){r.push({id:t.attr("value"),text:t.text()})});e.isFunction(n)&&n(r)});return t},initContainer:function(){var e=".select2-choices",t;this.searchContainer=this.container.find(".select2-search-field");this.selection=t=this.container.find(e);this.search.bind("keydown",this.bind(function(e){if(!this.enabled)return;if(e.which===n.BACKSPACE&&this.search.val()===""){this.close();var r,i=t.find(".select2-search-choice-focus");if(i.length>0){this.unselect(i.first());this.search.width(10);m(e);return}r=t.find(".select2-search-choice");r.length>0&&r.last().addClass("select2-search-choice-focus")}else t.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus");if(this.opened())switch(e.which){case n.UP:case n.DOWN:this.moveHighlight(e.which===n.UP?-1:1);m(e);return;case n.ENTER:case n.TAB:this.selectHighlighted();m(e);return;case n.ESC:this.cancel(e);m(e);return}if(e.which===n.TAB||n.isControl(e)||n.isFunctionKey(e)||e.which===n.BACKSPACE||e.which===n.ESC)return;this.open();(e.which===n.PAGE_UP||e.which===n.PAGE_DOWN)&&m(e)}));this.search.bind("keyup",this.bind(this.resizeSearch));this.container.delegate(e,"click",this.bind(function(e){if(!this.enabled)return;this.clearPlaceholder();this.open();this.focusSearch();e.preventDefault()}));this.container.delegate(e,"focus",this.bind(function(){if(!this.enabled)return;this.container.addClass("select2-container-active");this.dropdown.addClass("select2-drop-active");this.clearPlaceholder()}));this.clearSearch()},enable:function(){if(this.enabled)return;this.parent.enable.apply(this,arguments);this.search.show()},disable:function(){if(!this.enabled)return;this.parent.disable.apply(this,arguments);this.search.hide()},initSelection:function(){var e;if(this.opts.element.val()===""){this.updateSelection([]);this.close();this.clearSearch()}if(this.select||this.opts.element.val()!==""){var n=this;this.opts.initSelection.call(null,this.opts.element,function(e){if(e!==t&&e!==null){n.updateSelection(e);n.close();n.clearSearch()}})}},clearSearch:function(){var e=this.getPlaceholder();if(e!==t&&this.getVal().length===0&&this.search.hasClass("select2-focused")===!1){this.search.val(e).addClass("select2-default");this.resizeSearch()}else this.search.val(" ").width(10)},clearPlaceholder:function(){this.search.hasClass("select2-default")?this.search.val("").removeClass("select2-default"):this.search.val()===" "&&this.search.val("")},opening:function(){this.parent.opening.apply(this,arguments);this.clearPlaceholder();this.resizeSearch();this.focusSearch()},close:function(){if(!this.opened())return;this.parent.close.apply(this,arguments)},focus:function(){this.close();this.search.focus()},isFocused:function(){return this.search.hasClass("select2-focused")},updateSelection:function(t){var n=[],r=[],i=this;e(t).each(function(){if(a(i.id(this),n)<0){n.push(i.id(this));r.push(this)}});t=r;this.selection.find(".select2-search-choice").remove();e(t).each(function(){i.addSelectedChoice(this)});i.postprocessResults()},onSelect:function(e){this.addSelectedChoice(e);this.select&&this.postprocessResults();if(this.opts.closeOnSelect){this.close();this.search.width(10)}else{this.search.width(10);this.resizeSearch()}this.triggerChange({added:e});this.focusSearch()},cancel:function(){this.close();this.focusSearch()},addSelectedChoice:function(n){var r=e("<li class='select2-search-choice'></li>"),i=this.id(n),s=this.getVal(),o;r.find(".select2-tmp").replaceWith(this.opts.formatSelection(n));o=this.opts.formatSelection(n,r);o!==t&&r.append(o);r.append("<a href='javascript:void(0)' class='select2-search-choice-close' tabindex='-1'></a>");r.find(".select2-search-choice-close").bind("click dblclick",this.bind(function(t){if(!this.enabled)return;this.unselect(e(t.target));this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus");m(t);this.close();this.focusSearch()})).bind("focus",this.bind(function(){if(!this.enabled)return;this.container.addClass("select2-container-active");this.dropdown.addClass("select2-drop-active")}));r.data("select2-data",n);r.insertBefore(this.searchContainer);s.push(i);this.setVal(s)},unselect:function(e){var t=this.getVal(),n,r;e=e.closest(".select2-search-choice");if(e.length===0)throw"Invalid argument: "+e+". Must be .select2-search-choice";n=e.data("select2-data");r=a(this.id(n),t);if(r>=0){t.splice(r,1);this.setVal(t);this.select&&this.postprocessResults()}e.remove();this.triggerChange({removed:n})},postprocessResults:function(){var e=this.getVal(),t=this.results.find(".select2-result-selectable"),n=this;t.each2(function(t,r){var i=n.id(r.data("select2-data"));a(i,e)>=0?r.addClass("select2-disabled"):r.removeClass("select2-disabled")});t.each2(function(e,t){if(!t.hasClass("select2-disabled")){n.highlight(e);return!1}})},resizeSearch:function(){var e,t,n,r,i,s=c(this.search);e=g(this.search)+10;t=this.search.offset().left;n=this.selection.width();r=this.selection.offset().left;i=n-(t-r)-s;i<e&&(i=n-s);i<40&&(i=n-s);this.search.width(i)},getVal:function(){var e;if(this.select){e=this.select.val();return e===null?[]:e}e=this.opts.element.val();return l(e,",")},setVal:function(t){var n;if(this.select)this.select.val(t);else{n=[];e(t).each(function(){a(this,n)<0&&n.push(this)});this.opts.element.val(n.length===0?"":n.join(","))}},val:function(){var t,n=[],r=this;if(arguments.length===0)return this.getVal();t=arguments[0];if(this.select){this.setVal(t);this.select.find(":selected").each(function(){n.push({id:e(this).attr("value"),text:e(this).text()})});this.updateSelection(n)}else{t=t===null?[]:t;e(t).each(function(){n.push(r.id(this))});this.setVal(n);this.updateSelection(t)}this.clearSearch()},onSortStart:function(){if(this.select)throw new Error("Sorting of elements is not supported when attached to <select>. Attach to <input type='hidden'/> instead.");this.search.width(0);this.searchContainer.hide()},onSortEnd:function(){var t=[],n=this;this.searchContainer.show();this.searchContainer.appendTo(this.searchContainer.parent());this.resizeSearch();this.selection.find(".select2-search-choice").each(function(){t.push(n.opts.id(e(this).data("select2-data")))});this.setVal(t);this.triggerChange()},data:function(t){var n=this,r;if(arguments.length===0)return this.selection.find(".select2-search-choice").map(function(){return e(this).data("select2-data")}).get();r=e.map(t,function(e){return n.opts.id(e)});this.setVal(r);this.updateSelection(t);this.clearSearch()}});e.fn.select2=function(){var n=Array.prototype.slice.call(arguments,0),r,o,u,f,l=["val","destroy","open","close","focus","isFocused","container","onSortStart","onSortEnd","enable","disable","positionDropdown","data"];this.each(function(){if(n.length===0||typeof n[0]=="object"){r=n.length===0?{}:e.extend({},n[0]);r.element=e(this);if(r.element.get(0).tagName.toLowerCase()==="select")f=r.element.attr("multiple");else{f=r.multiple||!1;"tags"in r&&(r.multiple=f=!0)}o=f?new s:new i;o.init(r)}else{if(typeof n[0]!="string")throw"Invalid arguments to select2 plugin: "+n;if(a(n[0],l)<0)throw"Unknown method: "+n[0];u=t;o=e(this).data("select2");if(o===t)return;n[0]==="container"?u=o.container:u=o[n[0]].apply(o,n.slice(1));if(u!==t)return!1}});return u===t?this:u};window.Select2={query:{ajax:b,local:w,tags:E},util:{debounce:d,markMatch:y},"class":{"abstract":r,single:i,multi:s}}})(jQuery);(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,J,K,Q,G,Y,Z,et,tt,nt,rt,it=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};Select2["class"].abstract.prototype.positionDropdown=function(){var e;e=this.container.offset();return this.dropdown.css({top:e.top+this.container.outerHeight(),left:e.left,width:this.container.outerWidth()})};p={types:{Module:{pluralLabel:"Modules"}},properties:{mc:{valueType:"number"}},items:[]};u=[];Z=nuscors.departments;for(d in Z){f=Z[d];for(I=0,z=f.length;I<z;I++){a=f[I];u.push(a);a!==d&&p.items.push({label:a,faculty:d})}}o=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];H=[];for(q=0,W=o.length;q<W;q++){s=o[q];H.push(s);et=["Morning","Afternoon","Evening"];for(R=0,X=et.length;R<X;R++){P=et[R];b=""+s+" "+P;p.items.push({label:b,day:s});H.push(b)}tt=$(".lessons > div");for(U=0,V=tt.length;U<V;U++){l=tt[U];$(l).attr("data-ex-fixed-order",H.join(";"))}}N=nuscors.mods;T={};v=function(e){return T[e.split(" ")[0]]};C=N.code.length;for(m=Q=0;0<=C?Q<C:Q>C;m=0<=C?++Q:--Q){T[N.code[m].split(" ")[0]]=m;S={lectures:{},tutorials:{}};nt=["lectures","tutorials"];for(G=0,J=nt.length;G<J;G++){w=nt[G];if(!(x=N[w][m]))continue;for(F in x)for(k in x[F]){rt=x[F][k];for(Y=0,K=rt.length;Y<K;Y++){E=rt[Y];E[2]<"1200"?_="Morning":E[2]<"1800"?_="Afternoon":_="Evening";S[w][o[E[1]]+" "+_]=!0}}}p.items.push({type:"Module",label:N.code[m],level:+N.code[m].match(/\d/)[0]*1e3,title:N.title[m],description:N.description[m],exam:N.exam[m],mc:N.mcs[m],prereq:N.prerequisite[m],preclusion:N.preclusion[m],workload:N.workload[m],department:u[N.department[m]],lectures:function(){var e;e=[];for(y in S.lectures)e.push(y);return e}(),tutorials:function(){var e;e=[];for(y in S.tutorials)e.push(y);return e}(),types:nuscors.modTypes[N.types[m]]})}window.tableStyler=function(e,t){return e.className="modules table table-striped table-bordered"};$(document).one("scriptsLoaded.exhibit",function(){window.database=Exhibit.Database.create();window.database.loadData(p);window.exhibit=Exhibit.create();window.exhibit.configureFromDOM();$("#overlay").fadeOut();return $(".exhibit-collectionView-header").on("click","a.add",function(){var e,t,n;n=$("#select2").select2("val");t=$(this).data("code");if(it.call(n,t)>=0)return alert(t+" already selected!");n.push(t);return $("#select2").select2("val",function(){var t,r,i;i=[];for(r=0,t=n.length;r<t;r++){e=n[r];i.push({id:e,text:e+" "+N.title[v(e)]})}return i}())})});M=function(e){return{id:N.code[e],text:""+N.code[e]+" "+N.title[e]}};L=50;$("#select2").select2({placeholder:"Add modules by code or title",multiple:!0,initSelection:function(e,t){var n;return t(function(){var t,r,i,s;i=e.val().split(",");s=[];for(r=0,t=i.length;r<t;r++){n=i[r];s.push((m=v(n))!=null?M(m):void 0)}return s}())},query:function(e){var t,n,r,i,s;if(e.term.length===0){_=(i=e.context)!=null?i:e.context=0;t=_+L;r={context:t,more:t<C?!0:void 0,results:function(){var e,n;n=[];for(m=e=_;_<=t?e<t:e>t;m=_<=t?++e:--e)n.push(M(m));return n}()};return e.callback(r)}r={results:[],more:!0};n=new RegExp(e.term,"i");m=(s=e.context)!=null?s:e.context=0;while(m<C){if(N.code[m].search(n)!==-1&&r.results.push(M(m))===L){r.context=++m;e.callback(r)}m++}m-=C;while(m<C){if(title[m].search(n)!==-1&&r.results.push(M(m))===L){r.context=++m+C;e.callback(r)}m++}r.more=!1;return e.callback(r)}});$("a#toggle").click(function(){$("a#toggle i").toggleClass("icon-chevron-left icon-chevron-right");$("#sidebar").animate({width:"toggle"},100);$("#content").toggleClass("span12 span9");return $("#content").toggleClass("no-sidebar")});t="<tr>"+function(){var e,t;t=[];for(g=e=16;e<=47;g=++e)t.push('<td class="'+("0"+Math.floor(g/2)+[0,3][g%2]+"0").slice(-4)+" hh"+[0,3][g%2]+'0"></td>');return t}()+"</tr>";$(function(){var e,n,r;r=[];for(s=n=0;n<=5;s=++n)r.push(function(){var n,r;r=[];for(e=n=0;n<=1;e=++n)r.push($("#"+s).append(t));return r}());return r});j=[];$('a[href="#timetable-builder"]').one("shown",function(){var e,t,n,r;n=$(".spacer.mon > td");r=[];for(t=0,e=n.length;t<e;t++){l=n[t];r.push(j.push($(l).offset().left))}return r});$('a[href="#timetable-builder"]').on("show",function(){var e,t,i,s;t=$("#select2").select2("val");for(e in B)it.call(t,e)<0&&O(e);for(s=0,i=t.length;s<i;s++){e=t[s];n(e)}return r?$("#clash").show():$("#clash").hide()});c=function(e){if(!e)return;return e.slice(3,5)+e.slice(0,2)+{A:0,P:1,E:2}[e[11]]};i=[];B={};h=[];r=0;n=function(t){var n,s,o,u,a,f,l,p,d,g,b,S,T,C,L,A,O,M,_,D,P,H;if(t in B)return;f=B[t]={};l=v(t);i.length||(i=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]);n=i.splice(Math.floor(Math.random()*i.length),1)[0];S=N.title[l];u=N.exam[l];if(y=c(u)){T=$("<tr>",{"class":"exam color"+n,html:"<td>"+t+"</td><td>"+S+"</td>"+("<td>"+u+"</td>")});m=0;for(M=0,L=h.length;M<L;M++){o=h[M];if(y<=o.key){if(y===o.key){T.addClass("clash");$("#exams > tbody > tr:nth-child("+(m+1)+")").addClass("clash");r++}break}m++}m===h.length?$("#exams > tbody").append(T):$("#exams > tbody > tr:nth-child("+(m+1)+")").before(T);h.splice(m,0,{code:t,key:y,tr:T})}else $("<tr>",{"class":"exam color"+n,html:"<td>"+t+"</td><td>"+N.title[l]+"</td><td>No Exam</td>"}).appendTo("#exams > tbody"
);P=["lectures","tutorials"];for(_=0,A=P.length;_<A;_++){w=P[_];if(!(x=N[w][l]))continue;for(F in x){g=f[F]={};p=0;s=0;b=!0;for(C in x[F])if(s++===1){b=!1;break}for(k in x[F]){d=g[k]=[];H=x[F][k];for(D=0,O=H.length;D<O;D++){a=H[D];E=new e(a,{code:t,color:n,modIndex:l,name:k,sameName:d,sameType:g,singleton:b,title:S,type:F});d.push(E);p||E.attach()}p++}}}return f};O=function(e){var t,n,i,s,o,u,a,f,l,p,d;if(!(s=B[e]))return;if(y=c(N.exam[v(e)])){n=function(){var e,t,n;n=[];for(t=0,e=h.length;t<e;t++){i=h[t];i.key===y&&n.push(i)}return n}();if(n.length>1){if(n.length===2)for(f=0,o=n.length;f<o;f++){t=n[f];t.tr.removeClass("clash")}r--}}for(m=l=0,u=h.length;l<u;m=++l){i=h[m];if(e===i.code){i.tr.remove();h.splice(m,1);break}}for(F in s){d=s[F];for(k in d){x=d[k];for(p=0,a=x.length;p<a;p++){E=x[p];E.detach(!0)}}}return delete B[e]};e=function(){function r(t,r){var i,s=this;this.week=t[0],this.day=t[1],this.start=t[2],this.end=t[3],this.room=t[4];$.extend(this,r);this.duration=Math.round(((this.end==="0000"?"2400":this.end)-this.start)/50);this.room=nuscors.rooms[this.room];i=nuscors.lessonTypes[this.type];week=typeof this.week=="number"?n[this.week]:"Weeks "+this.week;this.el=$("<div>",{"class":"lesson "+(this.modIndex+this.type)+" "+this.name+" color"+this.color,html:""+this.code.split(" ")[0]+"<br>"+e[i]+" ["+this.name+"]"}).data("lesson",this).qtip({content:{text:"<strong>"+this.code+"</strong><br>"+this.title+"<br>"+i+" ["+this.name+"] @ "+this.room+"<br>"+week+" "+this.start+"-"+this.end},position:{my:"left center",at:"right center",viewport:!0}});if(this.singleton)this.el.addClass("singleton");else{this.el.draggable({addClasses:!1,appendTo:"#timetable",cursor:"move",opacity:.5,helper:function(){return s.el.clone(!1).width(s.el.width()).height(s.el.height())},start:function(){var e,t;e=s.sameType;t=[];for(k in e){x=e[k];t.push(function(){var e,t,n;n=[];for(t=0,e=x.length;t<e;t++){E=x[t];k!==this.name&&n.push(E.attach())}return n}.call(s))}return t},revert:function(e){var t,n,r,i,o,u,a,f,l,c;e||(t=s.name);f=s.sameType;for(k in f){x=f[k];for(o=0,n=x.length;o<n;o++){E=x[o];k!==t&&E.detach()}}$("body").css("cursor","auto");if(e){l=s.sameName;for(u=0,r=l.length;u<r;u++){E=l[u];E.cascade()}c=s.sameType[e.data("lesson").name];for(a=0,i=c.length;a<i;a++){E=c[a];E.detach().attach()}return!1}return!0}});this.el.droppable({hoverClass:"hover",activeClass:"active",addClasses:!1,accept:"."+this.modIndex+this.type+":not(."+this.name+")",over:function(){var e,t,n,r;n=s.sameName;r=[];for(t=0,e=n.length;t<e;t++){E=n[t];r.push(E.el.addClass("hover"))}return r},out:function(){var e,t,n,r;n=s.sameName;r=[];for(t=0,e=n.length;t<e;t++){E=n[t];r.push(E.el.removeClass("hover"))}return r},drop:function(){var e,t,n,r;n=s.sameName;r=[];for(t=0,e=n.length;t<e;t++){E=n[t];r.push(E.el.removeClass("hover"))}return r}})}}var e,n;e={"Design Lecture":"LEC",Laboratory:"LAB",Lecture:"LEC","Packaged Lecture":"LEC","Packaged Tutorial":"TUT",Recitation:"REC","Sectional Teaching":"SEC","Seminar-Style Module Class":"SEM",Tutorial:"TUT","Tutorial Type 2":"TUT2","Tutorial Type 3":"TUT3"};n=["Every Week","Odd Weeks","Even Weeks"];r.prototype.attach=function(){var e,n,r,i,s;this.day===5&&$(".sat").show();e=$("#"+this.day+" > tr");for(m=i=0,s=e.length;0<=s?i<=s:i>=s;m=0<=s?++i:--i){r=m===e.length?$(t).appendTo("#"+this.day):e[m];if(!(n=$(r).children("td."+this.start+":empty")))continue;this.detached=n.nextUntil("td."+this.end,"td:empty");if(this.detached.length===this.duration-1){this.trPos=m+1;break}}n.attr("colspan",this.duration).html(this.el);this.detached.detach();return this};r.prototype.detach=function(e){var t;t=this.el.parent().removeAttr("colspan").after(this.detached).parent();e?this.el.remove():this.el.detach();if(!t.find(".lesson").length)switch(t.index()){case 0:t.siblings().length===1&&t.parent().append(t);break;case 1:t.siblings().length>1&&t.remove();break;default:t.remove()}return this};r.prototype.cascade=function(){var e,t,n,r;n=$("#"+this.day+" > tr:nth-child("+this.trPos+") ~ tr .lesson");r=[];for(t=0,e=n.length;t<e;t++){l=n[t];r.push($(l).data("lesson").detach().attach())}return r};return r}();A=void 0;$("#timetable").mousemove(function(e){var t;m=1;while(m<j.length){if(e.pageX<j[m])break;m++}if(A!==(t=Math.ceil(m/2))){A!=null&&$("colgroup:nth-child("+A+")").removeClass("hover");$("colgroup:nth-child("+t+")").addClass("hover");return A=t}});$("#timetable").mouseleave(function(){if(A!=null){$("colgroup:nth-child("+A+")").removeClass("hover");return A=void 0}});D={Mor:"Before 12pm",ter:"From 12pm to 6pm",Eve:"After 6pm"}}).call(this);(function(e,t){function n(t,n){var i=t.nodeName.toLowerCase();if("area"===i){var s=t.parentNode,o=s.name,u;if(!t.href||!o||s.nodeName.toLowerCase()!=="map")return!1;u=e("img[usemap=#"+o+"]")[0];return!!u&&r(u)}return(/input|select|textarea|button|object/.test(i)?!t.disabled:"a"==i?t.href||n:n)&&r(t)}function r(t){return!e(t).parents().andSelf().filter(function(){return e.curCSS(this,"visibility")==="hidden"||e.expr.filters.hidden(this)}).length}e.ui=e.ui||{};if(e.ui.version)return;e.extend(e.ui,{version:"1.8.21",keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}});e.fn.extend({propAttr:e.fn.prop||e.fn.attr,_focus:e.fn.focus,focus:function(t,n){return typeof t=="number"?this.each(function(){var r=this;setTimeout(function(){e(r).focus();n&&n.call(r)},t)}):this._focus.apply(this,arguments)},scrollParent:function(){var t;e.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?t=this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.curCSS(this,"position",1))&&/(auto|scroll)/.test(e.curCSS(this,"overflow",1)+e.curCSS(this,"overflow-y",1)+e.curCSS(this,"overflow-x",1))}).eq(0):t=this.parents().filter(function(){return/(auto|scroll)/.test(e.curCSS(this,"overflow",1)+e.curCSS(this,"overflow-y",1)+e.curCSS(this,"overflow-x",1))}).eq(0);return/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(n){if(n!==t)return this.css("zIndex",n);if(this.length){var r=e(this[0]),i,s;while(r.length&&r[0]!==document){i=r.css("position");if(i==="absolute"||i==="relative"||i==="fixed"){s=parseInt(r.css("zIndex"),10);if(!isNaN(s)&&s!==0)return s}r=r.parent()}}return 0},disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}});e.each(["Width","Height"],function(n,r){function u(t,n,r,s){e.each(i,function(){n-=parseFloat(e.curCSS(t,"padding"+this,!0))||0;r&&(n-=parseFloat(e.curCSS(t,"border"+this+"Width",!0))||0);s&&(n-=parseFloat(e.curCSS(t,"margin"+this,!0))||0)});return n}var i=r==="Width"?["Left","Right"]:["Top","Bottom"],s=r.toLowerCase(),o={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+r]=function(n){return n===t?o["inner"+r].call(this):this.each(function(){e(this).css(s,u(this,n)+"px")})};e.fn["outer"+r]=function(t,n){return typeof t!="number"?o["outer"+r].call(this,t):this.each(function(){e(this).css(s,u(this,t,!0,n)+"px")})}});e.extend(e.expr[":"],{data:function(t,n,r){return!!e.data(t,r[3])},focusable:function(t){return n(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var r=e.attr(t,"tabindex"),i=isNaN(r);return(i||r>=0)&&n(t,!i)}});e(function(){var t=document.body,n=t.appendChild(n=document.createElement("div"));n.offsetHeight;e.extend(n.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0});e.support.minHeight=n.offsetHeight===100;e.support.selectstart="onselectstart"in n;t.removeChild(n).style.display="none"});e.extend(e.ui,{plugin:{add:function(t,n,r){var i=e.ui[t].prototype;for(var s in r){i.plugins[s]=i.plugins[s]||[];i.plugins[s].push([n,r[s]])}},call:function(e,t,n){var r=e.plugins[t];if(!r||!e.element[0].parentNode)return;for(var i=0;i<r.length;i++)e.options[r[i][0]]&&r[i][1].apply(e.element,n)}},contains:function(e,t){return document.compareDocumentPosition?e.compareDocumentPosition(t)&16:e!==t&&e.contains(t)},hasScroll:function(t,n){if(e(t).css("overflow")==="hidden")return!1;var r=n&&n==="left"?"scrollLeft":"scrollTop",i=!1;if(t[r]>0)return!0;t[r]=1;i=t[r]>0;t[r]=0;return i},isOverAxis:function(e,t,n){return e>t&&e<t+n},isOver:function(t,n,r,i,s,o){return e.ui.isOverAxis(t,r,s)&&e.ui.isOverAxis(n,i,o)}})})(jQuery);(function(e,t){if(e.cleanData){var n=e.cleanData;e.cleanData=function(t){for(var r=0,i;(i=t[r])!=null;r++)try{e(i).triggerHandler("remove")}catch(s){}n(t)}}else{var r=e.fn.remove;e.fn.remove=function(t,n){return this.each(function(){n||(!t||e.filter(t,[this]).length)&&e("*",this).add([this]).each(function(){try{e(this).triggerHandler("remove")}catch(t){}});return r.call(e(this),t,n)})}}e.widget=function(t,n,r){var i=t.split(".")[0],s;t=t.split(".")[1];s=i+"-"+t;if(!r){r=n;n=e.Widget}e.expr[":"][s]=function(n){return!!e.data(n,t)};e[i]=e[i]||{};e[i][t]=function(e,t){arguments.length&&this._createWidget(e,t)};var o=new n;o.options=e.extend(!0,{},o.options);e[i][t].prototype=e.extend(!0,o,{namespace:i,widgetName:t,widgetEventPrefix:e[i][t].prototype.widgetEventPrefix||t,widgetBaseClass:s},r);e.widget.bridge(t,e[i][t])};e.widget.bridge=function(n,r){e.fn[n]=function(i){var s=typeof i=="string",o=Array.prototype.slice.call(arguments,1),u=this;i=!s&&o.length?e.extend.apply(null,[!0,i].concat(o)):i;if(s&&i.charAt(0)==="_")return u;s?this.each(function(){var r=e.data(this,n),s=r&&e.isFunction(r[i])?r[i].apply(r,o):r;if(s!==r&&s!==t){u=s;return!1}}):this.each(function(){var t=e.data(this,n);t?t.option(i||{})._init():e.data(this,n,new r(i,this))});return u}};e.Widget=function(e,t){arguments.length&&this._createWidget(e,t)};e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:!1},_createWidget:function(t,n){e.data(n,this.widgetName,this);this.element=e(n);this.options=e.extend(!0,{},this.options,this._getCreateOptions(),t);var r=this;this.element.bind("remove."+this.widgetName,function(){r.destroy()});this._create();this._trigger("create");this._init()},_getCreateOptions:function(){return e.metadata&&e.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName);this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled "+"ui-state-disabled")},widget:function(){return this.element},option:function(n,r){var i=n;if(arguments.length===0)return e.extend({},this.options);if(typeof n=="string"){if(r===t)return this.options[n];i={};i[n]=r}this._setOptions(i);return this},_setOptions:function(t){var n=this;e.each(t,function(e,t){n._setOption(e,t)});return this},_setOption:function(e,t){this.options[e]=t;e==="disabled"&&this.widget()[t?"addClass":"removeClass"](this.widgetBaseClass+"-disabled"+" "+"ui-state-disabled").attr("aria-disabled",t);return this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_trigger:function(t,n,r){var i,s,o=this.options[t];r=r||{};n=e.Event(n);n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase();n.target=this.element[0];s=n.originalEvent;if(s)for(i in s)i in n||(n[i]=s[i]);this.element.trigger(n,r);return!(e.isFunction(o)&&o.call(this.element[0],n,r)===!1||n.isDefaultPrevented())}}})(jQuery);(function(e,t){var n=!1;e(document).mouseup(function(e){n=!1});e.widget("ui.mouse",{options:{cancel:":input,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(n){if(!0===e.data(n.target,t.widgetName+".preventClickEvent")){e.removeData(n.target,t.widgetName+".preventClickEvent");n.stopImmediatePropagation();return!1}});this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName);e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(t){if(n)return;this._mouseStarted&&this._mouseUp(t);this._mouseDownEvent=t;var r=this,i=t.which==1,s=typeof this.options.cancel=="string"&&t.target.nodeName?e(t.target).closest(this.options.cancel).length:!1;if(!i||s||!this._mouseCapture(t))return!0;this.mouseDelayMet=!this.options.delay;this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){r.mouseDelayMet=!0},this.options.delay));if(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)){this._mouseStarted=this._mouseStart(t)!==!1;if(!this._mouseStarted){t.preventDefault();return!0}}!0===e.data(t.target,this.widgetName+".preventClickEvent")&&e.removeData(t.target,this.widgetName+".preventClickEvent");this._mouseMoveDelegate=function(e){return r._mouseMove(e)};this._mouseUpDelegate=function(e){return r._mouseUp(e)};e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate);t.preventDefault();n=!0;return!0},_mouseMove:function(t){if(!e.browser.msie||document.documentMode>=9||!!t.button){if(this._mouseStarted){this._mouseDrag(t);return t.preventDefault()}if(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)){this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1;this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)}return!this._mouseStarted}return this._mouseUp(t)},_mouseUp:function(t){e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate);if(this._mouseStarted){this._mouseStarted=!1;t.target==this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0);this._mouseStop(t)}return!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(e){return this.mouseDelayMet},_mouseStart:function(e){},_mouseDrag:function(e){},_mouseStop:function(e){},_mouseCapture:function(e){return!0}})})(jQuery);(function(e,t){e.widget("ui.draggable",e.ui.mouse,{widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1},_create:function(){this.options.helper=="original"&&!/^(?:r|a|f)/.test(this.element.css("position"))&&(this.element[0].style.position="relative");this.options.addClasses&&this.element.addClass("ui-draggable");this.options.disabled&&this.element.addClass("ui-draggable-disabled");this._mouseInit()},destroy:function(){if(!this.element.data("draggable"))return;this.element.removeData("draggable").unbind(".draggable").removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled");this._mouseDestroy();return this},_mouseCapture:function(t){var n=this.options;if(this.helper||n.disabled||e(t.target).is(".ui-resizable-handle"))return!1;this.handle=this._getHandle(t);if(!this.handle)return!1;n.iframeFix&&e(n.iframeFix===!0?"iframe":n.iframeFix).each(function(){e('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(e(this).offset()).appendTo("body")});return!0},_mouseStart:function(t){var n=this.options;this.helper=this._createHelper(t);this.helper.addClass("ui-draggable-dragging");this._cacheHelperProportions();e.ui.ddmanager&&(e.ui.ddmanager.current=this);this._cacheMargins();this.cssPosition=this.helper.css("position");this.scrollParent=this.helper.scrollParent();this.offset=this.positionAbs=this.element.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.originalPosition=this.position=this._generatePosition(t);this.originalPageX=t.pageX;this.originalPageY=t.pageY;n.cursorAt&&this._adjustOffsetFromHelper(n.cursorAt);n.containment&&this._setContainment();if(this._trigger("start",t)===!1){this._clear();return!1}this._cacheHelperProportions();e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t);this._mouseDrag(t,!0);e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t);return!0},_mouseDrag:function(t,n){this.position=this._generatePosition(t);this.positionAbs=this._convertPositionTo("absolute");if(!n){var r=this._uiHash();if(this._trigger("drag",t,r)===!1){this._mouseUp({});return!1}this.position=r.position}if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+"px";e.ui.ddmanager&&e.ui.ddmanager.drag(this,t);return!1},_mouseStop:function(t){var n=!1;e.ui.ddmanager&&!this.options.dropBehaviour&&(n=e.ui.ddmanager.drop(this,t));if(this.dropped){n=this.dropped;this.dropped=!1}var r=this.element[0],i=!1;while(r&&(r=r.parentNode))r==document&&(i=!0);if(!i&&this.options.helper==="original")return!1;if(this.options.revert=="invalid"&&!n||this.options.revert=="valid"&&n||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,n)){var s=this;e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){s._trigger("stop",t)!==!1&&s._clear()})}else this._trigger("stop",t)!==!1&&this._clear();return!1},_mouseUp:function(t){this.options.iframeFix===!0&&e("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)});e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t);return e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear();return this},_getHandle:function(t){var n=!this.options.handle||!e(this.options.handle,this.element).length?!0:!1;e(this.options.handle,this.element).find("*").andSelf().each(function(){this==t.target&&(n=!0)});return n},_createHelper:function(t){var n=this.options,r=e.isFunction(n.helper)?e(n.helper.apply(this.element[0],[t])):n.helper=="clone"?this.element.clone().removeAttr("id"):this.element;r.parents("body").length||r.appendTo(n.appendTo=="parent"?this.element[0].parentNode:n.appendTo);r[0]!=this.element[0]&&!/(fixed|absolute)/.test(r.css("position"))&&r.css("position","absolute");return r},_adjustOffsetFromHelper:function(t){typeof t=="string"&&(t=t.split(" "));e.isArray(t)&&(t={left:+t[0],top:+t[1]||0});"left"in t&&(this.offset.click.left=t.left+this.margins.left);"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left);"top"in t&&(this.offset.click.top=t.top+this.margins.top);"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();if(this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&e.ui.contains(this.scrollParent[0],this.offsetParent[0])){t.left+=this.scrollParent.scrollLeft();t.top+=this.scrollParent.scrollTop()}if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&e.browser.msie)t={top:0,left:0};return{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var e=this.element.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t=this.options;t.containment=="parent"&&(t.containment=this.helper[0].parentNode);if(t.containment=="document"||t.containment=="window")this.containment=[t.containment=="document"?0:e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,t.containment=="document"?0:e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,(t.containment=="document"?0:e(window).scrollLeft())+e(t.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(t.containment=="document"?0:e(window).scrollTop())+(e(t.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(t.containment)&&t.containment.constructor!=Array){var n=e(t.containment),r=n[0];if(!r)return;var i=n.offset(),s=e(r).css("overflow")!="hidden";this.containment=[(parseInt(e(r).css("borderLeftWidth"),10)||0)+(parseInt(e(r).css("paddingLeft"),10)||0),(parseInt(e(r).css("borderTopWidth"),10)||0)+(parseInt(e(r).css("paddingTop"),10)||0),(s?Math.max(r.scrollWidth,r.offsetWidth):r.offsetWidth)-(parseInt(e(r).css("borderLeftWidth"),10)||0)-(parseInt(e(r).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(s?Math.max(r.scrollHeight,r.offsetHeight):r.offsetHeight)-(parseInt(e(r).css("borderTopWidth"),10)||0)-(parseInt(e(r).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom];this.relative_container=n}else t.containment.constructor==Array&&(this.containment=t.containment)},_convertPositionTo:function(t,n){n||(n=this.position);var r=t=="absolute"?1:-1,i=this.options,s=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!e.ui.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(s[0].tagName);return{top:n.top+this.offset.relative.top*r+this.offset.parent.top*r-(e.browser.safari&&e.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():o?0:s.scrollTop())*r),left:n.left+this.offset.relative.left*r+this.offset.parent.left*r-(e.browser.safari&&e.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():o?0:s.scrollLeft())*r)}},_generatePosition:function(t){var n=this.options,r=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!e.ui.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,i=/(html|body)/i.test(r[0].tagName),s=t.pageX,o=t.pageY;if(this.originalPosition){var u;if(this.containment){if(this.relative_container){var a=this.relative_container.offset();u=[this.containment[0]+a.left,this.containment[1]+a.top,this.containment[2]+a.left,this.containment[3]+a.top]}else u=this.containment;t.pageX-this.offset.click.left<u[0]&&(s=u[0]+this.offset.click.left);t.pageY-this.offset.click.top<u[1]&&(o=u[1]+this.offset.click.top);t.pageX-this.offset.click.left>u[2]&&(s=u[2]+this.offset.click.left);t.pageY-this.offset.click.top>u[3]&&(o=u[3]+this.offset.click.top)}if(n.grid){var f=n.grid[1]?this.originalPageY+Math.round((o-this.originalPageY)/n.grid[1])*n.grid[1]:this.originalPageY;o=u?f-this.offset.click.top<u[1]||f-this.offset.click.top>u[3]?f-this.offset.click.top<u[1]?f+n.grid[1]:f-n.grid[1]:f:f;var l=n.grid[0]?this.originalPageX+Math.round((s-this.originalPageX)/n.grid[0])*n.grid[0]:this.originalPageX;s=u?l-this.offset.click.left<u[0]||l-this.offset.click.left>u[2]?l-this.offset.click.left<u[0]?l+n.grid[0]:l-n.grid[0]:l:l}}return{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(e.browser.safari&&e.browser.version<526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollTop():i?0:r.scrollTop()),left:s-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(e.browser.safari&&e.browser.version<526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():i?0:r.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging");this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove();this.helper=null;this.cancelHelperRemoval=!1},_trigger:function(t,n,r){r=r||this._uiHash();e.ui.plugin.call(this,t,[n,r]);t=="drag"&&(this.positionAbs=this._convertPositionTo("absolute"));return e.Widget.prototype._trigger.call(this,t,n,r)},plugins:{},_uiHash:function(e){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}});e.extend(e.ui.draggable,{version:"1.8.21"});e.ui.plugin.add("draggable","connectToSortable",{start:function(t,n){var r=e(this).data("draggable"),i=r.options,s=e.extend({},n,{item:r.element});r.sortables=[];e(i.connectToSortable).each(function(){var n=e.data(this,"sortable");if(n&&!n.options.disabled){r.sortables.push({instance:n,shouldRevert:n.options.revert});n.refreshPositions();n._trigger("activate",t,s)}})},stop:function(t,n){var r=e(this).data("draggable"),i=e.extend({},n,{item:r.element});e.each(r.sortables,function(){if(this.instance.isOver){this.instance.isOver=0;r.cancelHelperRemoval=!0;this.instance.cancelHelperRemoval=!1;this.shouldRevert&&(this.instance.options.revert=!0);this.instance._mouseStop(t);this.instance.options.helper=this.instance.options._helper;r.options.helper=="original"&&this.instance.currentItem.css({top:"auto",left:"auto"})}else{this.instance.cancelHelperRemoval=!1;this.instance._trigger("deactivate",t,i)}})},drag:function(t,n){var r=e(this).data("draggable"),i=this,s=function(t){var n=this.offset.click.top,r=this.offset.click.left,i=this.positionAbs.top,s=this.positionAbs.left,o=t.height,u=t.width,a=t.top,f=t.left;return e.ui.isOver(i+n,s+r,a,f,o,u)};e.each(r.sortables,function(s){this.instance.positionAbs=r.positionAbs;this.instance.helperProportions=r.helperProportions;this.instance.offset.click=r.offset.click;if(this.instance._intersectsWith(this.instance.containerCache)){if(!this.instance.isOver){this.instance.isOver=1;this.instance.currentItem=e(i).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item",!0);this.instance.options._helper=this.instance.options.helper;this.instance.options.helper=function(){return n.helper[0]};t.target=this.instance.currentItem[0];this.instance._mouseCapture(t,!0);this.instance._mouseStart(t,!0,!0);this.instance.offset.click.top=r.offset.click.top;this.instance.offset.click.left=r.offset.click.left;this.instance.offset.parent.left-=r.offset.parent.left-this.instance.offset.parent.left;this.instance.offset.parent.top-=r.offset.parent.top-this.instance.offset.parent.top;r._trigger("toSortable",t);r.dropped=this.instance.element;r.currentItem=r.element;this.instance.fromOutside=r}this.instance.currentItem&&this.instance._mouseDrag(t)}else if(this.instance.isOver){this.instance.isOver=0;this.instance.cancelHelperRemoval=!0;this.instance.options.revert=!1;this.instance._trigger("out",t,this.instance._uiHash(this.instance));this.instance._mouseStop(t,!0);this.instance.options.helper=this.instance.options._helper;this.instance.currentItem.remove();this.instance.placeholder&&this.instance.placeholder.remove();r._trigger("fromSortable",t);r.dropped=!1}})}});e.ui.plugin.add("draggable","cursor",{start:function(t,n){var r=e("body"),i=e(this).data("draggable").options;r.css("cursor")&&(i._cursor=r.css("cursor"));r.css("cursor",i.cursor)},stop:function(t,n){var r=e(this).data("draggable").options;r._cursor&&e("body").css("cursor",r._cursor)}});e.ui.plugin.add("draggable","opacity",{start:function(t,n){var r=e(n.helper),i=e(this).data("draggable").options;r.css("opacity")&&(i._opacity=r.css("opacity"));r.css("opacity",i.opacity)},stop:function(t,n){var r=e(this).data("draggable").options;r._opacity&&e(n.helper).css("opacity",r._opacity)}});e.ui.plugin.add("draggable","scroll",{start:function(t,n){var r=e(this).data("draggable");r.scrollParent[0]!=document&&r.scrollParent[0].tagName!="HTML"&&(r.overflowOffset=r.scrollParent.offset())},drag:function(t,n){var r=e(this).data("draggable"),i=r.options,s=!1;if(r.scrollParent[0]!=document&&r.scrollParent[0].tagName!="HTML"){if(!i.axis||i.axis!="x")r.overflowOffset.top+r.scrollParent[0].offsetHeight-t.pageY<i.scrollSensitivity?r.scrollParent[0].scrollTop=s=r.scrollParent[0].scrollTop+i.scrollSpeed:t.pageY-r.overflowOffset.top<i.scrollSensitivity&&(r.scrollParent[0].scrollTop=s=r.scrollParent[0].scrollTop-i.scrollSpeed);if(!i.axis||i.axis!="y")r.overflowOffset.left+r.scrollParent[0].offsetWidth-t.pageX<i.scrollSensitivity?r.scrollParent[0].scrollLeft=s=r.scrollParent[0].scrollLeft+i.scrollSpeed:t.pageX-r.overflowOffset.left<i.scrollSensitivity&&(r.scrollParent[0].scrollLeft=s=r.scrollParent[0].scrollLeft-i.scrollSpeed)}else{if(!i.axis||i.axis!="x")t.pageY-e(document).scrollTop()<i.scrollSensitivity?s=e(document).scrollTop(e(document).scrollTop()-i.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<i.scrollSensitivity&&(s=e(document).scrollTop(e(document).scrollTop()+i.scrollSpeed));if(!i.axis||i.axis!="y")t.pageX-e(document).scrollLeft()<i.scrollSensitivity?s=e(document).scrollLeft(e(document).scrollLeft()-i.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<i.scrollSensitivity&&(s=e(document).scrollLeft(e(document).scrollLeft()+i.scrollSpeed))}s!==!1&&e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(r,t)}});e.ui.plugin.add("draggable","snap",{start:function(t,n){var r=e(this).data("draggable"),i=r.options;r.snapElements=[];e(i.snap.constructor!=String?i.snap.items||":data(draggable)":i.snap).each(function(){var t=e(this),n=t.offset();this!=r.element[0]&&r.snapElements.push({item:this,width:t.outerWidth(),height:t.outerHeight(),top:n.top,left:n.left})})},drag:function(t,n){var r=e(this).data("draggable"),i=r.options,s=i.snapTolerance,o=n.offset.left,u=o+r.helperProportions.width,a=n.offset.top,f=a+r.helperProportions.height;for(var l=r.snapElements.length-1;l>=0;l--){var c=r.snapElements[l].left,h=c+r.snapElements[l].width,p=r.snapElements[l].top,d=p+r.snapElements[l].height;if(!(c-s<o&&o<h+s&&p-s<a&&a<d+s||c-s<o&&o<h+s&&p-s<f&&f<d+s||c-s<u&&u<h+s&&p-s<a&&a<d+s||c-s<u&&u<h+s&&p-s<f&&f<d+s)){r.snapElements[l].snapping&&r.options.snap.release&&r.options.snap.release.call(r.element,t,e.extend(r._uiHash(),{snapItem:r.snapElements[l].item}));r.snapElements[l].snapping=!1;continue}if(i.snapMode!="inner"){var v=Math.abs(p-f)<=s,m=Math.abs(d-a)<=s,g=Math.abs(c-u)<=s,y=Math.abs(h-o)<=s;v&&(n.position.top=r._convertPositionTo("relative",{top:p-r.helperProportions.height,left:0}).top-r.margins.top);m&&(n.position.top=r._convertPositionTo("relative",{top:d,left:0}).top-r.margins.top);g&&(n.position.left=r._convertPositionTo("relative",{top:0,left:c-r.helperProportions.width}).left-r.margins.left);y&&(n.position.left=r._convertPositionTo("relative",{top:0,left:h}).left-r.margins.left)}var b=v||m||g||y;if(i.snapMode!="outer"){var v=Math.abs(p-a)<=s,m=Math.abs(d-f)<=s,g=Math.abs(c-o)<=s,y=Math.abs(h-u)<=s;v&&(n.position.top=r._convertPositionTo("relative",{top:p,left:0}).top-r.margins.top);m&&(n.position.top=r._convertPositionTo("relative",{top:d-r.helperProportions.height,left:0}).top-r.margins.top);g&&(n.position.left=r._convertPositionTo("relative",{top:0,left:c}).left-r.margins.left);y&&(n.position.left=r._convertPositionTo("relative",{top:0,left:h-r.helperProportions.width}).left-r.margins.left)}!r.snapElements[l].snapping&&(v||m||g||y||b)&&r.options.snap.snap&&r.options.snap.snap.call(r.element,t,e.extend(r._uiHash(),{snapItem:r.snapElements[l].item}));r.snapElements[l].snapping=v||m||g||y||b}}});e.ui.plugin.add("draggable","stack",{start:function(t,n){var r=e(this).data("draggable").options,i=e.makeArray(e(r.stack)).sort(function(t,n){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(n).css("zIndex"),10)||0)});if(!i.length)return;var s=parseInt(i[0].style.zIndex)||0;e(i).each(function(e){this.style.zIndex=s+e});this[0].style.zIndex=s+i.length}});e.ui.plugin.add("draggable"
,"zIndex",{start:function(t,n){var r=e(n.helper),i=e(this).data("draggable").options;r.css("zIndex")&&(i._zIndex=r.css("zIndex"));r.css("zIndex",i.zIndex)},stop:function(t,n){var r=e(this).data("draggable").options;r._zIndex&&e(n.helper).css("zIndex",r._zIndex)}})})(jQuery);(function(e,t){e.widget("ui.droppable",{widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect"},_create:function(){var t=this.options,n=t.accept;this.isover=0;this.isout=1;this.accept=e.isFunction(n)?n:function(e){return e.is(n)};this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight};e.ui.ddmanager.droppables[t.scope]=e.ui.ddmanager.droppables[t.scope]||[];e.ui.ddmanager.droppables[t.scope].push(this);t.addClasses&&this.element.addClass("ui-droppable")},destroy:function(){var t=e.ui.ddmanager.droppables[this.options.scope];for(var n=0;n<t.length;n++)t[n]==this&&t.splice(n,1);this.element.removeClass("ui-droppable ui-droppable-disabled").removeData("droppable").unbind(".droppable");return this},_setOption:function(t,n){t=="accept"&&(this.accept=e.isFunction(n)?n:function(e){return e.is(n)});e.Widget.prototype._setOption.apply(this,arguments)},_activate:function(t){var n=e.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass);n&&this._trigger("activate",t,this.ui(n))},_deactivate:function(t){var n=e.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass);n&&this._trigger("deactivate",t,this.ui(n))},_over:function(t){var n=e.ui.ddmanager.current;if(!n||(n.currentItem||n.element)[0]==this.element[0])return;if(this.accept.call(this.element[0],n.currentItem||n.element)){this.options.hoverClass&&this.element.addClass(this.options.hoverClass);this._trigger("over",t,this.ui(n))}},_out:function(t){var n=e.ui.ddmanager.current;if(!n||(n.currentItem||n.element)[0]==this.element[0])return;if(this.accept.call(this.element[0],n.currentItem||n.element)){this.options.hoverClass&&this.element.removeClass(this.options.hoverClass);this._trigger("out",t,this.ui(n))}},_drop:function(t,n){var r=n||e.ui.ddmanager.current;if(!r||(r.currentItem||r.element)[0]==this.element[0])return!1;var i=!1;this.element.find(":data(droppable)").not(".ui-draggable-dragging").each(function(){var t=e.data(this,"droppable");if(t.options.greedy&&!t.options.disabled&&t.options.scope==r.options.scope&&t.accept.call(t.element[0],r.currentItem||r.element)&&e.ui.intersect(r,e.extend(t,{offset:t.element.offset()}),t.options.tolerance)){i=!0;return!1}});if(i)return!1;if(this.accept.call(this.element[0],r.currentItem||r.element)){this.options.activeClass&&this.element.removeClass(this.options.activeClass);this.options.hoverClass&&this.element.removeClass(this.options.hoverClass);this._trigger("drop",t,this.ui(r));return this.element}return!1},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}});e.extend(e.ui.droppable,{version:"1.8.21"});e.ui.intersect=function(t,n,r){if(!n.offset)return!1;var i=(t.positionAbs||t.position.absolute).left,s=i+t.helperProportions.width,o=(t.positionAbs||t.position.absolute).top,u=o+t.helperProportions.height,a=n.offset.left,f=a+n.proportions.width,l=n.offset.top,c=l+n.proportions.height;switch(r){case"fit":return a<=i&&s<=f&&l<=o&&u<=c;case"intersect":return a<i+t.helperProportions.width/2&&s-t.helperProportions.width/2<f&&l<o+t.helperProportions.height/2&&u-t.helperProportions.height/2<c;case"pointer":var h=(t.positionAbs||t.position.absolute).left+(t.clickOffset||t.offset.click).left,p=(t.positionAbs||t.position.absolute).top+(t.clickOffset||t.offset.click).top,d=e.ui.isOver(p,h,l,a,n.proportions.height,n.proportions.width);return d;case"touch":return(o>=l&&o<=c||u>=l&&u<=c||o<l&&u>c)&&(i>=a&&i<=f||s>=a&&s<=f||i<a&&s>f);default:return!1}};e.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(t,n){var r=e.ui.ddmanager.droppables[t.options.scope]||[],i=n?n.type:null,s=(t.currentItem||t.element).find(":data(droppable)").andSelf();e:for(var o=0;o<r.length;o++){if(r[o].options.disabled||t&&!r[o].accept.call(r[o].element[0],t.currentItem||t.element))continue;for(var u=0;u<s.length;u++)if(s[u]==r[o].element[0]){r[o].proportions.height=0;continue e}r[o].visible=r[o].element.css("display")!="none";if(!r[o].visible)continue;i=="mousedown"&&r[o]._activate.call(r[o],n);r[o].offset=r[o].element.offset();r[o].proportions={width:r[o].element[0].offsetWidth,height:r[o].element[0].offsetHeight}}},drop:function(t,n){var r=!1;e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(!this.options)return;!this.options.disabled&&this.visible&&e.ui.intersect(t,this,this.options.tolerance)&&(r=this._drop.call(this,n)||r);if(!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)){this.isout=1;this.isover=0;this._deactivate.call(this,n)}});return r},dragStart:function(t,n){t.element.parents(":not(body,html)").bind("scroll.droppable",function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,n)})},drag:function(t,n){t.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(t,n);e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(this.options.disabled||this.greedyChild||!this.visible)return;var r=e.ui.intersect(t,this,this.options.tolerance),i=!r&&this.isover==1?"isout":r&&this.isover==0?"isover":null;if(!i)return;var s;if(this.options.greedy){var o=this.element.parents(":data(droppable):eq(0)");if(o.length){s=e.data(o[0],"droppable");s.greedyChild=i=="isover"?1:0}}if(s&&i=="isover"){s.isover=0;s.isout=1;s._out.call(s,n)}this[i]=1;this[i=="isout"?"isover":"isout"]=0;this[i=="isover"?"_over":"_out"].call(this,n);if(s&&i=="isout"){s.isout=0;s.isover=1;s._over.call(s,n)}})},dragStop:function(t,n){t.element.parents(":not(body,html)").unbind("scroll.droppable");t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,n)}}})(jQuery);(function(e){function i(e,t){if(e.originalEvent.touches.length>1)return;e.preventDefault();var n=e.originalEvent.changedTouches[0],r=document.createEvent("MouseEvents");r.initMouseEvent(t,!0,!0,window,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null);e.target.dispatchEvent(r)}e.support.touch="ontouchend"in document;if(!e.support.touch)return;var t=e.ui.mouse.prototype,n=t._mouseInit,r;t._touchStart=function(e){var t=this;if(r||!t._mouseCapture(e.originalEvent.changedTouches[0]))return;r=!0;t._touchMoved=!1;i(e,"mouseover");i(e,"mousemove");i(e,"mousedown")};t._touchMove=function(e){if(!r)return;this._touchMoved=!0;i(e,"mousemove")};t._touchEnd=function(e){if(!r)return;i(e,"mouseup");i(e,"mouseout");this._touchMoved||i(e,"click");r=!1};t._mouseInit=function(){var t=this;t.element.bind("touchstart",e.proxy(t,"_touchStart")).bind("touchmove",e.proxy(t,"_touchMove")).bind("touchend",e.proxy(t,"_touchEnd"));n.call(t)}})(jQuery);